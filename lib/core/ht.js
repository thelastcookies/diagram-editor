!function(W,u,A){"use strict";function J(N,W){if("function"!=typeof W&&null!==W)throw new TypeError("Super expression must either be null or a function");N.prototype=u.create(W&&W.prototype,{constructor:{value:N,writable:!0,configurable:!0}}),W&&Df(N,W)}function S(U){var g=u.prototype.toString.call(U);return"Array]"===g.substring(g.length-6)}function l(h,I,O,V,N,S){I=I||[],O=O||[],V=V||[];try{I.push(h);var J=Function.apply(0,I);return O[O.length]="return "+J,Function.apply(0,O).apply(0,V)}catch(U){return S&&S(U),N}}function w(t){var q={};return{get:function(U){if(q[U]!==A)return q[U];var P;switch(U){case"WEBGL_depth_texture":P=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":P=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":P=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":P=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":P=t.getExtension("WEBGL_compressed_texture_etc1");break;default:P=t.getExtension(U)}return q[U]=P,P}}}function p(C,G,w){function X(){if(M!==A)return M;var b=G.get("EXT_texture_filter_anisotropic");return M=null!==b?C.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function g(B){if("highp"===B){if(C.getShaderPrecisionFormat(C.VERTEX_SHADER,C.HIGH_FLOAT).precision>0&&C.getShaderPrecisionFormat(C.FRAGMENT_SHADER,C.HIGH_FLOAT).precision>0)return"highp";B="mediump"}return"mediump"===B&&C.getShaderPrecisionFormat(C.VERTEX_SHADER,C.MEDIUM_FLOAT).precision>0&&C.getShaderPrecisionFormat(C.FRAGMENT_SHADER,C.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var M;w=w||{};var K="undefined"!=typeof WebGL2RenderingContext&&C instanceof WebGL2RenderingContext,i=w.precision!==A?w.precision:"highp",b=g(i);b!==i&&(console.warn("WebGL:",i,"not supported, using",b,"instead."),i=b);var p,z=w.logarithmicDepthBuffer===!0,I=C.getParameter(C.MAX_TEXTURE_IMAGE_UNITS),E=C.getParameter(C.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Q=C.getParameter(C.MAX_TEXTURE_SIZE),c=C.getParameter(C.MAX_CUBE_MAP_TEXTURE_SIZE),f=C.getParameter(C.MAX_VERTEX_ATTRIBS),t=C.getParameter(C.MAX_VERTEX_UNIFORM_VECTORS),s=C.getParameter(C.MAX_VARYING_VECTORS),P=C.getParameter(C.MAX_FRAGMENT_UNIFORM_VECTORS),m=E>0,S=K||!!G.get("OES_texture_float"),O=(K||!!G.get("OES_element_index_uint"))&&"undefined"!=typeof Uint32Array,k=m&&S,Y=K?C.getParameter(C.MAX_SAMPLES):0,R=!1;return K?R=!0:(p=G.get("ANGLE_instanced_arrays"))&&(R=!0,C.vertexAttribDivisor=function(G,r){return p.vertexAttribDivisorANGLE(G,r)},C.drawElementsInstanced=function(P,X,m,k,z){return p.drawElementsInstancedANGLE(P,X,m,k,z)},C.drawArraysInstanced=function(L,C,V,X){return p.drawArraysInstancedANGLE(L,C,V,X)}),{getMaxAnisotropy:X,getMaxPrecision:g,precision:i,logarithmicDepthBuffer:z,maxTextures:I,maxVertexTextures:E,maxTextureSize:Q,maxCubemapSize:c,maxAttributes:f,maxVertexUniforms:t,maxVaryings:s,maxFragmentUniforms:P,vertexTextures:m,floatFragmentTextures:S,elementTypeUint:O,floatVertexTextures:k,maxSamples:Y,instancedArray:R}}function d(G,r){return G.z!==r.z?r.z-G.z:G.id-r.id}var H="ht";if(!W[H]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),W.performance&&W.performance.now||function(){var B=Date.now();W.performance||(W.performance={}),W.performance.now=function(){return Date.now()-B}}();for(var O=Date.now(),R=16,J=["ms","moz","webkit","o"],e=0;e<J.length&&!W.requestAnimationFrame;++e)W.requestAnimationFrame=W[J[e]+"RequestAnimationFrame"],W.cancelAnimationFrame=W[J[e]+"CancelAnimationFrame"]||W[J[e]+"CancelRequestAnimationFrame"];W.requestAnimationFrame||(W.requestAnimationFrame=function(L){var G=Date.now(),y=R+O-G;return 0>y&&(y=0),O=G,W.setTimeout(function(){O=Date.now(),L(performance.now())},y)}),W.cancelAnimationFrame||(W.cancelAnimationFrame=function(O){return W.clearTimeout(O)}),u.assign===A&&(u.assign=function(L){if(L===A||null===L)throw new TypeError("Cannot convert undefined or null to object");for(var E=u(L),Z=1;Z<arguments.length;Z++){var b=arguments[Z];if(b!==A&&null!==b)for(var G in b)u.prototype.hasOwnProperty.call(b,G)&&(E[G]=b[G])}return E}),W.btoa===A&&(W.btoa=function(E){for(var c,s,r=String(E),t=0,x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",T="";r.charAt(0|t)||(x="=",t%1);T+=x.charAt(63&c>>8-8*(t%1))){if(s=r.charCodeAt(t+=.75),s>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");c=c<<8|s}return T})}();var n,Z,k,r,i=W.location,$=i&&W.document,q=null,f=A,x=W[H]={},z=W[H+"config"],M=x.Default=z&&z.Default||{},T=x.Style=z&&z.Style||{},B=x.Attr=z&&z.Attr||{},t=function(){return!0},m=function(){return!1},R=function(q){return q},K=function(X){return!X},b=x.Color=z&&z.Color||{},v=x.IsGetter=z&&z.IsGetter||{};!function(){var N=!1;try{var c=u.defineProperty({},"passive",{get:function(){return N=!0,A}});i&&(k=n=i)&&W.addEventListener("test",c,c),i&&(r=Z=i)&&W.removeEventListener("test",c,c)}catch(G){N=!1}M.passiveSupported=N}();var G,g,s,U,_=M.passiveSupported,a=M.eventListenerOptionsFalse=_?{passive:!1,capture:!1}:!1,j=M.eventListenerOptionsTrue=_?{passive:!1,capture:!0}:!0,X=function(y,u,k,G){y.addEventListener(u,k,G?j:a)},F=function(A,R,Z,h){A.removeEventListener(R,Z,h?j:a)},C=Math,N=C.round,L=C.floor,y=C.ceil,h=C.sqrt,E=C.max,e=C.min,D=C.abs,O=C.cos,V=C.acos,o=C.sin,Q=C.pow,I=C.asin,P=C.exp,Y=C.PI,c=2*Y,Ek=Y/2,al=C.tan,Cl=C.atan2,ol=C.random,rq=C.log,pg=function(m,A,n){return Math.max(A,Math.min(n,m))},Gr=Q(2,1),Ec=!1,hd=W.parseInt||global.parseInt,zh="2022-12-15",Fh=i&&(W.navigator?W.navigator.platform.indexOf("Win")>-1:!1),Zm=function(D){return D*D},Zl=i&&W.setTimeout,hh=i&&W.clearTimeout,Rr=i&&(W.navigator?W.navigator.userAgent.toLowerCase():""),kd=function(C){return C.test(Rr)},wc=kd(/msie/),mp=kd(/msie/)||kd(/trident/),Ni=kd(/msie 10/),Sr=kd(/edge/),Fm=kd(/firefox/),$g=kd(/mac/),In=kd(/mscAndroid/),lf=M.isTouchable===A?Fh?!1:$?"ontouchend"in $:!1:M.isTouchable,mf="default",yb="single",Yf="multiple",Ao="front",ki="back",wk="left",Bj="right",vg="top",rj="bottom",kl="center",$d="eye",cq="middle",yo="east",cr="west",im="north",Yc="none",Zh="px",Rm="absolute",Ki="border",Hb="triangle",jk="rect",sp="circle",Xp="cylinder",Xi="shape",fi="items",uc="normal",ko="remove",bl="clear",xj="width",ii="height",cp="ingroup",kc="check",gq="uncheck",Ul="radio",gp="radioOn",Jg="radioOff",kh="points",Pm="values",ij="series",th="body",dd="label",ip="label2",Mb="note",Wh="note2",ed="icons",we="labelFont",Cg="labelColor",tb="labelSelectColor",Fk="note.expanded",rh="note2.expanded",Ge="edge.expanded",Zf="edge.points",Oi="edge.type",Ci="rotation",Cc="hidden",Vi="visible",tl="tuv",qb="no",To="draw",Rh="select",Yh="currentSubGraph",Uf="selectBackground",Ig="autoMakeVisible",Lh="autoHideScrollBar",Vd="scrollBarColor",Ij="scrollBarSize",Qk="indent",vj="rowHeight",xd="columnLineColor",zn="rowLineColor",ec="columnLineVisible",vq="rowLineVisible",_q="visibleFunc",Gp="expandIcon",Rc="collapseIcon",Fb="checkMode",vc="sortFunc",cn="editable",Yp="batchEditable",Gk="tristate",ys="asc",on="desc",Nn="position",_r="__",Re="elevation",Il="children",_p="translateX",Fd="translateY",Sl="dataModel",ke="maxSize",go="enc",td="state",ap=go+"o"+"de",Qm="shape3d",Eb="shape3d.resolution",Zr="shape3d.visible",xk="shape3d.from.visible",yc="shape3d.to.visible",Cf="shape3d.top.visible",ao="shape3d.bottom.visible",eo="repeat.uv.length",$o="serializeValue",qe="deserializeValue",Ng="centerUniform",qh="uniform",Yb="rgba(255,255,255,0)",Ll="style",zd="attr",sg="field",ss="string",ji="boolean",_n="color",Ud="int",Oo="number",tf="ew-resize",ye="ns-resize",cd="pointer",un="auto",cs="mousedown",Mr="mousemove",zp="mouseup",dr="mouseout",fs="touchstart",Mg="touchmove",gh="touchend",Yg="keydown",Wo="keyup",kr=["DOMMouseScroll","mousewheel"],Qj=Fm?kr[0]:kr[1],Tb=_r+H+_r+ap,og=[fs,Mg,gh],kq=[cs,Mr,zp,dr,Qj,"wheel","mouseenter","mouseleave","mouseover"],Rp=[Yg,Wo,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"],lb=lf?og.concat(Rp):kq.concat(Rp),Pi=q,Uk=q,ac=q,nl=q,$b=!1,Vh=zp.length,aq=function(){ac&&(hh(ac.timeout),ac=q)},wp=function(){ac&&Rn(ac.e,ac.info)};W.addEventListener&&(f=i)&&(lf||(X(W,dr,function(){aq()}),X(W,Qj,function(){Sn()})),X(W,Wo,function(Y){91===Y.keyCode?qr={}:delete qr[Y.keyCode]},!0),X(W,Yg,function(i){qr[i.keyCode]=!0},!0),X(W,"blur",function(){qr={}}));var Mj,km,pe,Lc=0,El=q,yl=function(w,l){var r=Zl(function(){delete El[r],Er(El)&&(El=q),w()},l);return r},se=q,jh=q,$p={},zl={},tc={},Im={},rf={},em={},qr={},Fi={},Uq={},Ff={},mb={},ve=/.json$/,dk=/\.(json|bin)$/,Wp=/^data:image\/svg\+xml/,Cq={},Gb=[],yq={},uq=q,tr=q,pr=function(){},Zj=function(){throw"Oops!"},af=[0,0,0],Wb={x:0,y:0,width:0,height:0},Jk=q,vb=q,Ch=q,tm=function(i,L){zl[i]=L,L&&L.comps&&!L.uuid&&(L.uuid=x.Math.generateUUID()),Eg[i]&&(L.cacheRule=Eg[i],delete Eg[i])},zq=function(G){vb&&!G._72O&&(Ch||(Ch={}),Ch[G._72O=Fq()]=G),Mj!=q?Cj()<.05&&U&&!km&&(ih=aq):ih=_k},Md=function(P,s,R,v){vb||(vb={});var c=vb[P];if(c){if(c.url===s)return;c.image?(c.image.onload=pr,c.image.onerror=pr):c.request&&(c.request.onload=pr,c.request.onerror=pr)}if(ve.test(s)){var l=new Gd;if(vb[P]={request:l,url:s},s=M.beforeLoadURL(s,P),s.data){var K=M.parse(s.data);qg(P,K),M.handleImageLoaded(P,K)}else{l.onload=function(){if(200===this.status||0===this.status){var F=M.parse(l.getResponseText());qg(P,F),M.handleImageLoaded(P,F)}else qg(P,M.handleUnfoundImage(P,s)||q)},l.onerror=function(){qg(P,M.handleUnfoundImage(P,s)||q)};var i={};i.url=encodeURI(s),i.sync=!1,l.send(i)}}else{var K=new Image;vb[P]={image:K,url:s},/^data:image/.test(s)||(s=M.beforeLoadURL(s,P),s=M.appendTimeStamp(s),s=encodeURI(s),K.crossOrigin=M.crossOrigin),M.convertImageSrc(s,function(m){mp&&(s.toLowerCase().indexOf(".svg")>0||Wp.test(s))?($.body.appendChild(K),K.style.visibility="hidden",K.onload=function(){Zl(function(){if(R&&(K.width=R),v&&(K.height=v),!K.width||!K.height){var T=K.width||K.clientWidth,d=K.height||K.clientHeight;K.width=T,K.height=d}M.handleImageLoaded(P,K),qg(P,K),$.body.removeChild(K),K.style.visibility=""},180)},K.onerror=function(){qg(P,M.handleUnfoundImage(P,s)||q),$.body.removeChild(K),K.style.visibility=""}):(K.onload=function(){R&&(K.width=R),v&&(K.height=v),M.handleImageLoaded(P,K),qg(P,K)},K.onerror=function(){qg(P,M.handleUnfoundImage(P,s)||q)}),K.src=m})}},qg=function(s,P){if(tm(s,P),delete vb[s],Er(vb)&&(vb=q,Ch)){for(var V in Ch){var D=Ch[V];D._2O&&D._2O[s]&&(D.deleteTexture(s),delete D._2O[s]),D.invalidateAll&&D.invalidateAll(A,"imageLoaded",s),D.redraw&&D.redraw(),D.iv(),P&&P.layoutAttach&&hc(D.dm)&&D.dm().updateLayoutAttach(s),delete D._72O}Ch=q}if(P&&Ch)for(var V in Ch){var D=Ch[V];D.invalidateAll&&D.invalidateAll(A,"imageLoading",s),D.redraw&&D.redraw(),D.iv(),P.layoutAttach&&hc(D.dm)&&D.dm().updateLayoutAttach(s)}},oj=function(){return rq=C&&Date,function(){return W.performance&&W.performance.now?W.performance.now():Date.now()}}(),sn=function($,T,a){return{width:$,height:T,comps:bj(a)?a:[a]}},Qb=function($,W){return{type:sp,rect:[$,W,1.6,1.6],borderWidth:1,borderColor:pb,gradient:Dl,gradientColor:bm,background:pb}},um=function(b,e){return sn(16,16,{type:Hb,rect:[4,4,10,8],background:b,rotation:e?1.57:3.14})},lh=function(f,W){return sn(16,16,{type:Hb,rect:[4,4,8,7],background:f,rotation:W?3.14:0})},Gj=function(g){var x=g._orientation;return"horizontal"===x||"h"===x},Fe=function(K,Q){var n=q||4,H=q||1,p=q||1;0>n?n=0:n>.25&&(n=.25);var u,z,h,m,S,W,M,d=.5,E=[],X=[],L=[],w=c/p,U=c/H,v=d-n;for(z=0;H>=z;z++)for(m=-Y+z*U,W=O(m),S=o(m),u=0;p>=u;u++)h=u*w,M=v+n*W,E.push(O(h)*M,S*n,-o(h)*M),(g=[K,Q])&&X.push(u/p,1-z/H);for(z=0;H>z;z++){var I=z*(p+1),k=(z+1)*(p+1);for(u=0;p>u;u++)L.push(I+u,k+u+1,k+u,I+u,I+u+1,k+u+1),Hl.z=Uc.z=[K,Q]}},en=function(K){var y=2,B=0;for(var w in K)w.length===y&&hd(w,32)===nc&&(uq=tr=K[w]),B++;return B},Fn=function(i,D,S,w){return S||(S=lf?5:3,S/=w||1),{x:i-S,y:D-S,width:2*S,height:2*S}},de=function(l,a,F,G){var T=this;a||(a=lf?5:3,F=20,G=20);var M={x:l,y:a,width:F,height:G};if(F)for(var s=0;F>s;s++)if(3===F)G=20;else for(var x=0;G>x;x++)T=W?W:F;var N={x:Y,y:2*Y};if(Do(M,N)){var m=ii[0]+vg[0]+bl[1]+ys.length,o=Cc[0]+Gk[0]+bl[1]+th.length;ch[$d]=[T[m],T[o]],T[m]=Lg[$d],T[o]=Lg[Qm]}},Ld=function(E){return(/ble$/.test(E)||/ed$/.test(E)||v[E]?"is":"get")+E.charAt(0).toUpperCase()+E.slice(1)},Lg=function(Z){return"set"+Z.charAt(0).toUpperCase()+Z.slice(1)},ro=function(x){return typeof x===ss||x instanceof String},xe=function(q){return typeof q===Oo},_k=function(O){return typeof O===ji},fg=function(b){return b&&"object"==typeof b},hc=function(t){return"function"==typeof t},bj=function(u){return u instanceof Array},Bd=function(h){return h instanceof lo},Ar=function(y){return bj(y)?new lo(y):y},uk=function(H){return H instanceof Ak},dq=function(D){return D instanceof Hr},qq=function(u){return u instanceof Om},Ac=function(f,C){if(!(f instanceof x.Group))return!1;if(!C)return f.isExpanded();var Q=C.getDataUI(f);return Q&&Q._88I?!0:!1},us=function(T){return T instanceof df},Uo=function(a){return a&&"IFRAME"===a.tagName},Br=function(D){return D==q||M.numberDigits==q?D:parseFloat(D.toFixed(M.numberDigits))},Te=function(i,P,Y){var U,X=P.length;if(Y)for(var g=0;Y>g;g++)if(3===X)i.push(P[0]),i.push(P[1]),i.push(P[2]);else for(U=0;X>U;U++)i.push(P[U]);else if(3===X)i.push(P[0]),i.push(P[1]),i.push(P[2]);else for(U=0;X>U;U++)i.push(P[U])},En=function(t){return t?fg(t)?t:{}:!1},zb=function(S,U,R){var T,X=fg(S)?S:S.prototype;for(T in U)R&&T in X?X[T]===A&&console.warn("class",X,"has own undefined property",T,", keep exist!"):X[T]=U[T];return S},Ab=function(A,m){if(!("wheelDelta"in m)){var Z=m.deltaMode;m.wheelDelta=Z===m.DOM_DELTA_PIXEL?-m.deltaY:Z===m.DOM_DELTA_LINE?40*-m.deltaY:120*-m.deltaY}A.handle_mousewheel(m)},ag=function(z){return String.fromCharCode(z)},ll=function(e){for(var g,l=0,H="";l<e.length;l++)g=e[e.length-1-l],"%"===g?g="'":"a"===g?g='"':"]"===g&&(g="\\"),H+=ag(g.charCodeAt(0)-1);return H},Vq=function(E,H,b){E.superClass.constructor.apply(H,b)},Er=function(X){for(var V in X)return!1;return!0},ob=function(g){return g?0===g.length:!0},Uj=function(){var A="";return[gq[0],zn[0],dd[0]].forEach(function(E){A+=Lg(E).slice(3)}),qh=$&&$[A]||Ng,function($,S){return $===S?!0:$.x===S.x&&$.y===S.y&&$.width===S.width&&$.height===S.height}}(),Lb=function(l,P,j){return P>l?P:l>j?j:l},Vb=function(m){return 0>m?-1:m>0?1:0},Cj=function(){var T=1e4*o(Vh++);return T-L(T)},fb=function(I,C,a){return Tg(I.x,I.y,C.x,C.y,a.x,a.y,a.x+a.width,a.y,!0)||Tg(I.x,I.y,C.x,C.y,a.x+a.width,a.y,a.x+a.width,a.y+a.height,!0)||Tg(I.x,I.y,C.x,C.y,a.x+a.width,a.y+a.height,a.x,a.y+a.height,!0)||Tg(I.x,I.y,C.x,C.y,a.x,a.y+a.height,a.x,a.y,!0)},Tg=function(A,F,t,o,I,b,J,d,U){var X=(J-I)*(F-b)-(d-b)*(A-I),M=(d-b)*(t-A)-(J-I)*(o-F);if(0!==M){var x=X/M,B=A+x*(t-A),R=F+x*(o-F);return U&&(B+Qd<e(A,t)||B-Qd>E(A,t)||B+Qd<e(I,J)||B-Qd>E(I,J)||R+Qd<e(F,o)||R-Qd>E(F,o)||R+Qd<e(b,d)||R-Qd>E(b,d))?q:[B,R]}return q},Gc=function(_,W,l){if(_&&l)if(W){if(W===Ll)return _.getStyle(l);if(W===zd)return _.getAttr(l);if(W===sg)return _[l]}else if(l=Ld(l),_[l])return _[l]();return A},Ed=function(X,o,W,V){if(X&&W)if(o){if(o===Ll)X.s(W,V);else if(o===zd)X.a(W,V);else if(o===sg){var f=X[W];X[W]=V,X.fp("f:"+W,f,V)}}else W=Lg(W),X[W]&&X[W](V)},jj=function(g,m,c){var s=100*Math.max(g.width,g.height);return m&&"top"!==m?"bottom"===m?{x:g.x-s,y:g.y-s,width:g.width+2*s,height:g.height*c+s}:"right"===m?{x:g.x-s,y:g.y-s,width:g.width*c+s,height:g.height+2*s}:"left"===m?{x:g.x+g.width*(1-c),y:g.y-s,width:g.width*c+s,height:g.height+2*s}:void 0:{x:g.x-s,y:g.y+g.height*(1-c),width:g.width+2*s,height:g.height*c+s}},cb=function(Z,S,F,p,J){S&&Dh(Z,F,p,1,J,S)},Af=function(x,G,R,q){var k=1-x;return k*k*G+2*x*k*R+x*x*q},Hl=function(A,s,i,L,P){var Q=1-A;return Q*Q*Q*s+3*Q*Q*A*i+3*Q*A*A*L+A*A*A*P},oi=function(Y){var H,n,l,E,m=0;return Y.forEach(function(v){if(H=v.length,H>0)for(n=v[0],E=1;H>E;E++)l=v[E],m+=Hh(n,l),n=l}),m},Bl=function(k,Y,J){var f="__"+k,o=function(b){("mousedown"===k||"mouseup"===k||"touchstart"===k||"touchend"===k)&&zr(b),J.disabled||J["handle_"+k](b)};J[f]||(J[f]=o,X(Y,k,o))},js=function(x,X,U){var i="__"+x,H=U[i];H&&(F(X,x,H),delete U[i])},yf=function(g,B){var P="_"+B;g[Ld(B)]=function(){return this[P]},g[Lg(B)]=function(s){var d=this[P];this[P]=s,this.fp(B,d,s)}},ri=function(q){return u.create(q)},tg=function($){if(!$.element){var O,z;(O=$.textField)?z=hb(Jt.TextField,O):(O=$.textArea)?z=hb(Jt.TextArea,O):(O=$.button)?z=hb(Jt.Button,O):(O=$.comboBox)?z=hb(Jt.ComboBox,O):(O=$.checkBox)?z=hb(Jt.CheckBox,O):(O=$.radioButton)?z=hb(Jt.RadioButton,O):(O=$.slider)?z=hb(Jt.Slider,O):(O=$.colorPicker)?z=hb(Jt.ColorPicker,O):(O=$.image)&&(z=hb(Jt.Image,O)),z&&($.element=z)}},bn=function(P,Z){var F=Kn(P);return F._ht=Z,F},up=W.top===W?W.top:W||W.document,Kn=function(d,O){var X=$.createElement("div"),J=X.style;return X.tabIndex=-1,X.onkeydown=lr,J.msTouchAction=Yc,Sp(X,q,0),lf&&J.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",q),d&&(J.overflow=Cc),O&&Bh(O,X),X},rs=function(Y,s){var J=$.createElement("canvas"),f=J.style;return f.msTouchAction=Yc,s||(f.pointerEvents=Yc),Sp(J,q,0),Y&&Bh(Y,J),J},Sp=function(h,E,d){var G=h.style;G.border=E?E+" solid 1px":0,G.outline=0,G.padding=d?"0 "+d+Zh:0,br(h)},br=function(O){var i=O.style;i.position=Rm,i.margin=0,i.setProperty("box-sizing","border-box",q),i.setProperty("-moz-box-sizing","border-box",q)},Sk=function(D,g,p,s){s||(s=Jh),g!=q&&(D.width=g*s,D.style.width=g+Zh),p!=q&&(D.height=p*s,D.style.height=p+Zh)},Bh=function(b,O,W){b.appendChild(O),W&&(O.style.position=Rm)},Yq=function(H,A){A.split||(A+="");for(var j,X=A.split("\n"),u=0,t=X.length,M=0;t>M;M++){var R=bi(H.font,X[M]);R.width>u&&(u=R.width),j||(j=R.height)}return H.ss=X,{width:u,height:j*t}},wj=function(){var Q=$?rs().getContext("2d"):q;return function(s,R,p,v,$,q){var r=s.split("\n"),w=[],L=bi(p,s).height;return v||(v=0),Q.font=p,Q.textBaseline=vg,r.forEach(function(D){for(var x=0,M=1,A=0,b=D.length;b>=M;M++){var m=D.substring(x,M),o=$?Q.measureText(D[M]):bi(p,m);$&&(A+=o.fontBoundingBoxDescent||L);var i=$?A+(m.length-1)*q:o.width+(m.length-1)*v;i>R&&(M-1===x?(w.push(D.substring(x,M)),x=M):(w.push(D.substring(x,M-1)),x=M-1,M--),A=0)}x!==M-1&&w.push(D.substring(x,M))}),w}}(),np=function(f,y,u,W,N,M,K,L){f.font=u;var A=f.measureText(y);if(f.beginPath(),f.strokeStyle=W,f.lineWidth=1,"underline"===L){var k;k=A.actualBoundingBoxDescent?A.actualBoundingBoxDescent+1:bi(u,y).size/2,f.moveTo(N-K/2,M+k),f.lineTo(N+K/2,M+k)}else if("strikethrough"===L)f.moveTo(N-K/2,M),f.lineTo(N+K/2,M);else if("overline"===L){var k;k=A.fontBoundingBoxAscent?A.fontBoundingBoxAscent:bi(u,y).size/2,f.moveTo(N-K/2,M-k),f.lineTo(N+K/2,M-k)}f.stroke()},rc=function(f,h,z,d,X,s,y,E,R,T,i){var x=X.x,L=X.y,c=X.width,n=X.height;if(h!=q){var G=bi(z,h),O={};R&&(G.width+=(h.length-1)*R),O.y=y&&y!==cq?y===vg?L+G.height/2:L+n-G.height/2:L+n/2,O.x=s&&s!==wk?s===Bj?x+c-G.width/2:x+c/2:x+G.width/2,Nh(f,h,O,z,d,R,T,i),E&&np(f,h,z,d,O.x,O.y,G.width,E)}},Yk=function(r,W,y,S,q,K,i,R,E,l){var s=W.length;if(1===s){var p=W[0];if(Nh(r,p,y,S,q,R,E,l),i){var C=bi(S,p);np(r,p,S,q,y.x+y.width/2,y.y+y.height/2,C.width,i)}}else for(var k=y.height/s,f={x:y.x,y:y.y,width:y.width,height:k},j=0;j<W.length;j++){if(K)rc(r,W[j],S,q,f,K,null,i,R,E,l);else if(Nh(r,W[j],f,S,q,R,E,l),i){var C=bi(S,W[j]);np(r,W[j],S,q,f.x+f.width/2,f.y+f.height/2,C.width,i)}f.y+=k}},Nh=function(O,k,U,T,M,z,E,H){O.font=T?T:vk,O.fillStyle=M?M:Hj,O.textAlign=kl,O.textBaseline=cq;var W,o;U?U.width===A?(W=U.x,o=U.y):(W=U.x+U.width/2,o=U.y+U.height/2):(W=0,o=0);var D=E&&H;if(D&&(O.strokeStyle=H,O.lineWidth=E),z){var K=bi(T,k);W-=(K.width+z*(k.length-1))/2;for(var y=(k+"").length,B=0;y>B;B++){var R=k[B],c=O.measureText(R);D&&O.strokeText(R,N(W+(c.width+4)/2),N(o)),O.fillText(R,N(W+(c.width+4)/2),N(o)),W+=c.width+z}}else D&&O.strokeText(k,N(W),N(o)),O.fillText(k,N(W),N(o))},De=function(H){H.getView&&(H=H.getView());var z=H.offsetWidth||H.scrollWidth;return!z&&H.style.width&&(z=hd(H.style.width)),z},Zi=function(I){I.getView&&(I=I.getView());var u=I.offsetHeight||I.scrollHeight;return!u&&I.style.height&&(u=hd(I.style.height)),u},zc=function(W,I,O){var H=I[0].toUpperCase()+I.substring(1,I.length);W["webkit"+H]=O,W["moz"+H]=O,W["ms"+H]=O,W["o"+H]=O,W[I]=O},uf=function(){var Q=function(L){lr(L),L.stopPropagation()},b=function(x){lr(x)},_=[fs,Yg,cs];return function(H,F){var P=Kn(),C=P.style;return C.backgroundColor=M.disabledBackground,H&&(C.backgroundImage="url("+H+")",C.backgroundPosition="50% 50%",C.backgroundRepeat="no-repeat no-repeat"),F===!1?_.forEach(function(n){X(P,n,b)}):_.forEach(function(y){X(P,y,Q)}),P}}(),bc=function(M){var b=M.getContext("2d");return b.save(),b.lineCap=jo,b.lineJoin=Wl,b},ih=function(n,R,y,w){hi(n,R*Jh,y*Jh),w*=Jh,1!==w&&n.scale(w,w)},hi=function(P,d,E){P.translate(d,E)},Cm=function(o,n){n&&o.rotate(n)},pq=function(M,G,I){G===A&&(G=1),I===A&&(I=1),(1!==G||1!==I)&&M.scale(G,I)},_c=!1,P=up[kc[1]+_p[0]],Rb=function(u){var r=$.activeElement;if($.activeElement!==u){r&&r.forceOnblur&&r.forceOnblur();for(var C=[],J=u.parentNode;J;)C.push([J,J.scrollLeft,J.scrollTop]),J=J.parentNode;if(!_c){var p=[],P=[];try{for(var O=W.parent,w=W;O!==w;)p.push([O,O.scrollX,O.scrollY]),w=O,O=W.parent;var y=W.frameElement;if(y)for(var Y=y.parentNode;Y;)P.push([Y,Y.scrollLeft,Y.scrollTop]),Y=Y.parentNode}catch(h){_c=!0}}if(lf)u.focus();else{var U=Ie(),v=U.target;u.focus(),v.scrollLeft=U.left,v.scrollTop=U.top}C.forEach(function(x){x[0].scrollLeft=x[1],x[0].scrollTop=x[2]}),_c||(p.forEach(function(q){q[0].scrollTo(q[1],q[2])}),P.forEach(function(x){x[0].scrollLeft=x[1],x[0].scrollTop=x[2]}))}},Ir=function(O){return O&&O.getView?O.getView():O},Xn=function(x,I,d,X,D){if(2===arguments.length&&(d=I.y,X=I.width,D=I.height,I=I.x),x.isSelfViewEvent)x.setX(I),x.setY(d),x.setWidth(X),x.setHeight(D);else{var N=Ir(x),L=N.style;if(($.fullscreenElement||$.mozFullScreenElement||$.webkitFullscreenElement||$.msFullscreenElement)!==N)I!==A&&(L.left=I+Zh),d!==A&&(L.top=d+Zh),X!==A&&(L.width=X+Zh),D!==A&&(L.height=D+Zh);else{var P=M.getWindowInfo();L.left=(I=P.left)+Zh,L.top=(d=P.top)+Zh,L.width=(X=P.width)+Zh,L.height=(D=P.height)+Zh}x.endEditing&&!lf&&x.endEditing(),x.redraw&&x.redraw(),x.invalidate&&x.invalidate(),x.onLayouted&&x.onLayouted(I,d,X,D),x.fireViewEvent&&x.fireViewEvent("layout")}},rr=function(r){if(!r.touches)return r;var C=r.touches[0];return C?C:r.changedTouches[0]},Tm=function(f){return Wg(f)?rr(f).target:f.target},Wg=function(q){return q&&"object"==typeof q&&"touches"in q},Th=function(c){M.popup&&M.popup.close(),M.popup=c},Yl=q,ns=function(N){Yl.handleWindowTouchMove(N)},Ai=function(L){Yl.handleWindowTouchEnd(L),F(W,Mg,ns),F(W,gh,Ai),F(W,"blur",Ai),Yl=q},xi=function(Q){Yl.handleWindowMouseMove(Q)},gn=function(B){Yl.handleWindowMouseUp(B),F(W,Mr,xi),F(W,zp,gn),F(W,"blur",gn),Yl=q},Io=function(w){return 1===rn(w)},Bs=function(q,v){return v?v.keyCode===q:qr[q]},jc=function(S){return qp(S)&&Bs(65,S)},hj=function(O){return Bs(46,O)||Bs(8,O)},Sd=function(t){return function(O){return O?O.keyCode===t:qr[t]}},nc=573,Nr=[65,83,68,87,37,38,39,40,32,13,27],xs=Sd(Nr[0]),ld=Sd(Nr[1]),_m=Sd(Nr[2]),xl=Sd(Nr[3]),lp=Sd(Nr[4]),zg=Sd(Nr[5]),Up=Sd(Nr[6]),Pk=Sd(Nr[7]),Yo=Sd(Nr[8]),yn=Sd(Nr[9]),$q=Sd(Nr[10]),Em={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},Vn=[2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,5,5,5,5,5,7,307],Pr=q,nd=q,Pn=function(B,H){Pr||(Pr=rs()),Sk(Pr,B,H,1);var K=bc(Pr);return K.clearRect(0,0,B,H),K},Of=function(t,M,e){if(M&&t){if("override"===e)return M;if("override_rgb"===e){var i=qn(M);return t=Ck(t),"rgba("+N(255*i[0])+","+N(255*i[1])+","+N(255*i[2])+","+t[3]/255+")"}if("override_a"===e){var i=qn(M);return t=Ck(t),"rgba("+t[0]+","+t[1]+","+t[2]+","+i[3]+")"}if("multiply_destinationAtop"===e){var h=Wr(qn(t)),f=h[3],O=Wr(qn(M)),C=O[3],R=Wr(h),Q=R[3],n=h.map(function(L,A){return L*O[A]}),a=1-f,G=1-C,x=G*f+C;return h=h.map(function(e,N){return(C*a*O[N]+C*f*n[N]+G*f*e)/x}),f=x,a=1-f,h=h.map(function(k,i){return(Q*R[i]*a+f*k*Q)/Q}),f=Q,"rgba("+N(255*h[0])+","+N(255*h[1])+","+N(255*h[2])+","+f+")"}var i=qn(M);return t=Ck(t),"rgba("+N(t[0]*i[0])+","+N(t[1]*i[1])+","+N(t[2]*i[2])+","+t[3]/255*i[3]+")"}return t},Ck=function(){var F,f={};for(var e in W){var j=Yf.length;if(e.length==j&&e[0]===Yf[2]&&e[1]===Yc[1]&&e[4]===Yf[3]&&e[5]===Yf[4]&&e.substr(j-2)===Yc[1]+Yc[2]){var _=W[e];for(var I in _)I.length===j&&I.substr(0,3)===Bj[3]+ko[3]+Rh[0]&&I.substr(j-2)===Yf[0]+Mb[3]&&(kr=_[I])}}return function(n){var C,a=f[n];return a||(F||(F=rs(),Sk(F,1,1,1)),C=F.getContext("2d"),C.clearRect(0,0,1,1),Dh(C,0,0,1,1,n),a=C.getImageData(0,0,1,1).data,a=f[n]=[a[0],a[1],a[2],a[3]]),a}}(),qn=function(S){if(!ro(S))return S;var e=Ck(S);return e.CA||(e.CA=[e[0]/255,e[1]/255,e[2]/255,e[3]/255]),e.CA},Xb=function(t,A,e,o,Q){var H=rs();H.width=e,H.height=o;var W=H.getContext("2d");W.drawImage(t,0,0,e,o);try{for(var X=W.getImageData(0,0,e,o),U=X.data,Y=0,a=U.length;a>Y;Y+=4){var f=U[Y+0],h=U[Y+1],C=U[Y+2],M=U[Y+3];"override_a"===Q?U[Y+3]=255*A[3]:"override_rgb"===Q?(U[Y+0]=255*A[0],U[Y+1]=255*A[1],U[Y+2]=255*A[2]):"override"===Q?(U[Y+0]=255*A[0],U[Y+1]=255*A[1],U[Y+2]=255*A[2],U[Y+3]=255*A[3]):(U[Y+0]=A[0]*f,U[Y+1]=A[1]*h,U[Y+2]=A[2]*C,U[Y+3]=A[3]*M)}W.putImageData(X,0,0)}catch(I){return t}return H},ch=function(U,Y,V){return Y&&(Y="miter"===V?8*Y+20:Y+1,U&&Ti(U,Y)),Y},Ej=function(f,g){if(g){var E=new rd(g),w=f.width/2,o=f.height/2,S=vn([E.tf(-w,-o),E.tf(w,-o),E.tf(w,o),E.tf(-w,o)]);return S.x+=f.x+w,S.y+=f.y+o,S}return f},jf=function(p,r,B,F,f,O,y,R){F*=Math.PI/180;var J={x:Math.cos(F)*(p.x-y.x)/2+Math.sin(F)*(p.y-y.y)/2,y:-Math.sin(F)*(p.x-y.x)/2+Math.cos(F)*(p.y-y.y)/2},Z=Math.pow(J.x,2)/Math.pow(r,2)+Math.pow(J.y,2)/Math.pow(B,2);Z>1&&(r*=Math.sqrt(Z),B*=Math.sqrt(Z));var I=(f==O?-1:1)*Math.sqrt((Math.pow(r,2)*Math.pow(B,2)-Math.pow(r,2)*Math.pow(J.y,2)-Math.pow(B,2)*Math.pow(J.x,2))/(Math.pow(r,2)*Math.pow(J.y,2)+Math.pow(B,2)*Math.pow(J.x,2)));isNaN(I)&&(I=0);var k={x:I*r*J.y/B,y:I*-B*J.x/r},u={x:(p.x+y.x)/2+Math.cos(F)*k.x-Math.sin(F)*k.y,y:(p.y+y.y)/2+Math.sin(F)*k.x+Math.cos(F)*k.y},e=function(l){return Math.sqrt(Math.pow(l[0],2)+Math.pow(l[1],2))},Y=function(B,g){return(B[0]*g[0]+B[1]*g[1])/(e(B)*e(g))},t=function(p,s){return(p[0]*s[1]<p[1]*s[0]?-1:1)*Math.acos(Y(p,s))},K=t([1,0],[(J.x-k.x)/r,(J.y-k.y)/B]),A=[(J.x-k.x)/r,(J.y-k.y)/B],S=[(-J.x-k.x)/r,(-J.y-k.y)/B],H=t(A,S);Y(A,S)<=-1&&(H=Math.PI),Y(A,S)>=1&&(H=0);var Y=r>B?r:B,C=r>B?1:r/B,q=r>B?B/r:1;if(null==R){var P={x:0,y:0,width:0,height:0};Ti(P,Y),P.x*=C,P.width*=C,P.y*=q,P.height*=q;var x=new rd(F);return P=vn([x.tf(P.x,P.y),x.tf(P.x+P.width,P.y),x.tf(P.x+P.width,P.y+P.height),x.tf(P.x,P.y+P.height)]),P.x+=u.x,P.y+=u.y,[{x:P.x,y:P.y},{x:P.x+P.width,y:P.y},{x:P.x+P.width,y:P.y+P.height},{x:P.x,y:P.y+P.height}]}R.translate(u.x,u.y),R.rotate(F),R.scale(C,q),R.arc(0,0,Y,K,K+H,1-O),R.scale(1/C,1/q),R.rotate(-F),R.translate(-u.x,-u.y)},xg=function(L,B){L&&L.beginPath();for(var z,O,n,x=[],i=function(Q){for(var h,_=/(\-{0,1}[\d\.]+)/gi,e=[];h=_.exec(Q);)e.push(parseFloat(h[0]));return e},g=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,I={x:0,y:0};z=g.exec(B);){var f=z[0],d=f.substr(0,1);if("M"===d||"m"===d){for(var G=i(f),c=0;c<G.length;c+=2){var p=G[c],y=G[c+1];"m"===d&&(p+=I.x,y+=I.y),L&&L.moveTo(p,y),x.push({x:p,y:y}),I.x=p,I.y=y}O=n=null}else if("H"===d||"h"===d){for(var G=i(f),c=0;c<G.length;c+=1){var p=G[c];"h"===d&&(p+=I.x),L&&L.lineTo(p,I.y),x.push({x:p,y:I.y}),I.x=p}O=n=null}else if("C"===d||"c"===d){for(var G=i(f),c=0;c<G.length;c+=6){var j=G[c],T=G[c+1],C=G[c+2],k=G[c+3],p=G[c+4],y=G[c+5];"c"===d&&(j+=I.x,T+=I.y,C+=I.x,k+=I.y,p+=I.x,y+=I.y),L&&L.bezierCurveTo(j,T,C,k,p,y),x.push({x:j,y:T}),x.push({x:C,y:k}),x.push({x:p,y:y}),I.x=p,I.y=y}O=[j,T,C,k,p,y],n=null}else if("S"===d||"s"===d){for(var G=i(f),c=0;c<G.length;c+=4){var j,T;O?(j=2*O[4]-O[2],T=2*O[5]-O[3]):(j=I.x,T=I.y);var C=G[c],k=G[c+1],p=G[c+2],y=G[c+3];"s"===d&&(C+=I.x,k+=I.y,p+=I.x,y+=I.y),L&&L.bezierCurveTo(j,T,C,k,p,y),x.push({x:j,y:T}),x.push({x:C,y:k}),x.push({x:p,y:y}),I.x=p,I.y=y}O=[j,T,C,k,p,y],n=null}else if("Q"===d||"q"===d){for(var G=i(f),c=0;c<G.length;c+=4){var j=G[c],T=G[c+1],p=G[c+2],y=G[c+3];"q"===d&&(j+=I.x,T+=I.y,p+=I.x,y+=I.y),L&&L.quadraticCurveTo(j,T,p,y),x.push({x:j,y:T}),x.push({x:p,y:y}),I.x=p,I.y=y}O=null,n=[j,T,p,y]}else if("T"===d||"t"===d){for(var G=i(f),c=0;c<G.length;c+=2){var j,T;n?(j=2*n[2]-n[0],T=2*n[3]-n[1]):(j=I.x,T=I.y);var p=G[c],y=G[c+1];"t"===d&&(p+=I.x,y+=I.y),L&&L.quadraticCurveTo(j,T,p,y),x.push({x:j,y:T}),x.push({x:p,y:y}),I.x=p,I.y=y}O=null,n=[j,T,p,y]}else if("V"===d||"v"===d){for(var G=i(f),c=0;c<G.length;c+=1){var y=G[c];"v"===d&&(y+=I.y),L&&L.lineTo(I.x,y),x.push({x:I.x,y:y}),I.y=y}O=n=null}else if("L"===d||"l"===d){for(var G=i(f),c=0;c<G.length;c+=2){var p=G[c],y=G[c+1];"l"===d&&(p+=I.x,y+=I.y),L&&L.lineTo(p,y),x.push({x:p,y:y}),I.x=p,I.y=y}O=n=null}else if("A"===d||"a"===d){for(var G=i(f),c=0;c<G.length;c+=7){var S=G[c],Q=G[c+1],o=G[c+2],r=G[c+3],W=G[c+4],p=G[c+5],y=G[c+6];"a"===d&&(p+=I.x,y+=I.y);var q=jf(I,S,Q,o,r,W,{x:p,y:y},L);q&&(x=x.concat(q)),I.x=p,I.y=y}O=n=null}var w=f.substr(f.length-1);("z"===w||"Z"===w)&&L&&L.closePath()}return x},mc=function(g,e,p,w,h){var j,H=e[0];if(g.save(),bj(e))if(H&&1===H.length){var Q,o="L"===e[0],s=e.length;o?(g.transform(e[5],e[6],e[7],e[8],e[9],e[10]),j=g.createLinearGradient(e[1],e[2],e[3],e[4]),Q=11):(g.transform(e[7],e[8],e[9],e[10],e[11],e[12]),j=g.createRadialGradient(e[1],e[2],e[3],e[4],e[5],e[6]),Q=13);for(var i=g.compGray;s>Q;){var N=e[Q+1];N=p(N),j.addColorStop(e[Q],i?M.toGrayColor(N):N),Q+=2}}else{var Q,o="linear"===H,I=h.x,f=h.y,l=h.width,P=h.height,s=e.length,i=g.compGray;if(o)j=g.createLinearGradient(I+l*e[1],f+P*e[2],I+l*e[3],f+P*e[4]),Q=5;else{var O=Math.min(l,P),D=e[1]*l+I,U=e[2]*P+f,b=e[3]*O;if(ro(e[5]))j=g.createRadialGradient(D,U,0,D,U,b),Q=4;else{g.transform(e[7],e[8],e[9],e[10],e[11]+D,e[12]+U);var q=e[4]*l+I-D,u=e[5]*P+f-U,K=e[6]*O;j=g.createRadialGradient(0,0,b,q,u,K),Q=13}}for(;s>Q;){var N=e[Q+1];N=p(N),j.addColorStop(e[Q],i?M.toGrayColor(N):N),Q+=2}}else j=e;return w?g.strokeStyle=j:g.fillStyle=j,j},Uc=function(){function V(b,N){var f=b.length,v=b[0];if(ro(b)||v&&1!==v.length)return b;for(var J=new Array(f),k=0;f>k;k++)J[k]=b[k];var u,W,p,x,z,P,e,d,j,m,R,C,$,q="L"===J[0];return u=q?5:7,W=J[u],p=J[u+1],x=J[u+2],z=J[u+3],P=J[u+4],e=J[u+5],d=N[0],j=N[1],m=N[2],R=N[3],C=N[4],$=N[5],J[u]=d*W+m*p,J[u+1]=j*W+R*p,J[u+2]=d*x+m*z,J[u+3]=j*x+R*z,J[u+4]=d*P+m*e+C,J[u+5]=j*P+R*e+$,J}return function(Y,q){var E;(E=Y.s("shape.gradient.pack"))&&Y.s("shape.gradient.pack",V(E,q)),(E=Y.s("shape.border.gradient.pack"))&&Y.s("shape.border.gradient.pack",V(E,q))}}(),Bg=function(w,R,U,n){var a=!1;if(w.beginPath?w.beginPath():a=!0,Bd(R)&&(R=R._as),Bd(U)&&(U=U._as),U&&U.length){for(var W,F,I,Z,z=0,c=0,T=U.length;T>c;c++)W=U[c],1===W?(F=R[z++],w.moveTo(F.x,a?-F.y:F.y)):2===W?(F=R[z++],w.lineTo(F.x,a?-F.y:F.y)):3===W?(F=R[z++],I=R[z++],w.quadraticCurveTo(F.x,a?-F.y:F.y,I.x,a?-I.y:I.y)):4===W?(F=R[z++],I=R[z++],Z=R[z++],w.bezierCurveTo(F.x,a?-F.y:F.y,I.x,a?-I.y:I.y,Z.x,a?-Z.y:Z.y)):5===W&&w.closePath();n&&5!==W&&w.closePath()}else{var r,G,O,b=R.length;if(b>0){for(r=R[0],w.moveTo(r.x,a?-r.y:r.y),G=1;b>G;G++)O=R[G],w.lineTo(O.x,a?-O.y:O.y);n&&w.closePath()}}},gi=function(O,U,E,y){if(Bd(O)&&(O=O._as),Bd(U)&&(U=U._as),U&&U.length){E=E||dp;for(var d,C,X,b,V,l,e,A,W=[],L=q,Q=0,s=0,$=U.length;$>s;s++)if(d=U[s],1===d)W.push(L=[]),L.push(O[Q++]);else if(2===d)L.push(O[Q++]);else if(3===d){for(C=L[L.length-1],X=O[Q++],b=O[Q++],l=1;E>l;l++)e=Af(l/E,C.x,X.x,b.x),A=Af(l/E,C.y,X.y,b.y),L.push({x:e,y:A,b:!0});
L.push(b)}else if(4===d){for(C=L[L.length-1],X=O[Q++],b=O[Q++],V=O[Q++],l=1;E>l;l++)e=Hl(l/E,C.x,X.x,b.x,V.x),A=Hl(l/E,C.y,X.y,b.y,V.y),L.push({x:e,y:A,b:!0});L.push(V)}else 5===d&&L.push(L[0]);return y&&5!==d&&L&&L.length>2&&L.push(L[0]),W}return y&&O.length>2&&(O=O.slice(),O.push(O[0])),O?[O]:[]},Gm=function(N,_,h,w,j,B){var J,U,q,D=Ck(_),l=w,M=D[0],k=D[1],$=D[2];if(h){var S=Ck(h);J=S[0]-M,U=S[1]-k,q=S[2]-$}else J=255-M,U=255-k,q=255-$;for(B||(B=w>10?1:.5,B=1>j?e(B/j,2):B),N.save(),N.shadowOffsetX=0,N.shadowOffsetY=0,N.shadowBlur=0,N.shadowColor=0;(w-=B)>0;){var Q=1-w/l,E=M+J*Q,A=k+U*Q,T=$+q*Q;E=e(y(E),255),A=e(y(A),255),T=e(y(T),255),N.strokeStyle="rgb("+E+","+A+","+T+")",N.lineWidth=w,N.stroke()}N.restore()},Qf=function(){if($b&&f){var U=f+""||ys;In=U.indexOf(Cc.substr(0,2))>0&&U.indexOf(vg+vg.substr(1,1))>1?!0:!1}var Z={};return function(D,u){var s=D+"-"+u,r=Z[s];if(r)return r;var B,W,Y,K=Ck(D);return 0>u?(u=(100+u)/100,B=y(K[0]*u),W=y(K[1]*u),Y=y(K[2]*u)):(u/=100,B=K[0],W=K[1],Y=K[2],B+=(255-B)*u,W+=(255-W)*u,Y+=(255-Y)*u,B=e(y(B),255),W=e(y(W),255),Y=e(y(Y),255)),Z[s]="rgb("+B+","+W+","+Y+")"}}(),Dh=function(Y,u,F,q,w,j){j&&(Y.fillStyle=j),Y.beginPath(),Y.rect(u,F,q,w),Y.fill()},Ep=function(J,x,L,k,s,f,o){J.beginPath(),Zg[x](J,L.x,L.y,L.width,L.height,k,s,f,o)},mg=function(z,b,C,S,B){var c=Zg[C];z.fillStyle=c?c(z,b,S?S:bm,B.x,B.y,B.width,B.height):b},fk=function(z,W,y,F,I,n){z.fillStyle=Qh(z,W,y,F,I,n)},_h=function(a,q,b,s,N,S){a.strokeStyle=Qh(a,q,b,s,N,S)},Qh=function(z,_,C,o,J,l){var W;try{if(!_.tagName&&_.comps){_._cacheImage_||(_._cacheImage_={});var S;S="override"===o?"colors_override":"override_rgb"===o?"colors_override_rgb":"override_a"===o?"colors_override_a":"colors",_._cacheImage_[S]||(_._cacheImage_[S]={__count__:0});var a=_._cacheImage_[S][C];a||(_._cacheImage_[S].__count__>M.imageCacheThreshold&&(_._cacheImage_[S]={__count__:0}),a=x.Default.toCanvas(_,Wq(_),pm(_),null,J,l,C,null,o),_._cacheImage_[S][C]=a,_._cacheImage_[S].__count__++),_=a}W=z.createPattern(_,"repeat")}catch(u){W="black"}return W},Go=function(e){var G,l,g=[],j=0,d=e.length;for(G=0;65>G;G++)g[G]=G;for(G=0;65>G;G++)j=(j+g[G]+e.charCodeAt(G%d))%65,l=g[G],g[G]=g[j],g[j]=l;for(G=0;65>G;G++)g[G]=Rd[g[G]];return g.join("")},Bb=function(K){for(var L=8+Mh.randomInt(8),I=Rd[8*Mh.randomInt(8)+(L-8)],R="",P=0;L>P;P++)R+=Rd[Mh.randomInt(64)];var Z=Go(R+H+_r+ap);return I+R+wh.encode(K,Z)},ee=function(c){var k=c[0],R=Rd.indexOf(k);if(0>R)return"";R=8+(7&R);var h=c.slice(1,1+R),d=Go(h+H+_r+ap);return wh.decode(c,d,1+R)},xm=function(W,T,G,t,$,H,B){W.save(),W.translate(T,G),W.scale(1,B/H),W.arc(0,0,H,t,$),W.restore()},mj=function(h,u,T,r,U,g,K,X){var x,k,G,F,v,d,z,j,a,M,A;if(D(U)>2*Y&&(U=2*Y),v=y(D(U)/(Y/4)),x=U/v,k=-x,G=-r,v>0){d=u+O(r)*g,z=T+o(-r)*K,X?h.lineTo(d,z):h.moveTo(d,z);for(var I=0;v>I;I++)G+=k,F=G-k/2,j=u+O(G)*g,a=T+o(G)*K,M=u+O(F)*(g/O(k/2)),A=T+o(F)*(K/O(k/2)),h.quadraticCurveTo(M,A,j,a)}},$r=function(t,x,g,q,c,U,k,b,m){6===arguments.length&&(bj(U)?(b=U[1],m=U[2],k=U[3],U=U[0]):(k=U,b=U,m=U));var F=x+q,Z=g+c,W=c>q?2*q:2*c;return U=W>U?U:W,k=W>k?k:W,b=W>b?b:W,m=W>m?m:W,t.roundRect?(t.roundRect(x,g,q,c,[U,k,m,b]),void 0):(t.moveTo(x+q/2,g),t.arcTo(F,g,F,Z,k),t.arcTo(F,Z,x,Z,m),t.arcTo(x,Z,x,g,b),t.arcTo(x,g,F,g,U),t.lineTo(x+q/2,g),void 0)},Co=function(v,O,W,t,X,c,Z){O&&(W=N(W),t=N(t),Z||(Z=1),v.fillStyle=O,v.beginPath(),v.rect(W,t,Z,c),v.rect(W,t,X,Z),c-Z>0&&v.rect(W,t+c-Z,X,Z),X-Z>0&&v.rect(W+X-Z,t,Z,c),v.fill())},Zk=function(i,s,E,t){var S=t.x,a=t.y,n=t.width,f=t.height;if(!(!s||!E||0>=n||0>=f)){var V,w=hq(s),L=yp(s),J=E>0;1===E||-1===E?(i.fillStyle=J?w:L,i.beginPath(),i.rect(S,a,1,f),i.rect(S,a,n,1),i.fill(),i.fillStyle=J?L:w,i.beginPath(),i.rect(S,a+f-1,n,1),i.rect(S+n-1,a,1,f),i.fill()):(E=e(D(E),e(n/2,f/2)),V=i.createLinearGradient(S,a,S+E,a),V.addColorStop(0,J?w:L),V.addColorStop(1,s),i.fillStyle=V,i.beginPath(),i.moveTo(S,a),i.lineTo(S+E,a+E),i.lineTo(S+E,a+f-E),i.lineTo(S,a+f),i.lineTo(S,a),i.fill(),V=i.createLinearGradient(S,a,S,a+E),V.addColorStop(0,J?w:L),V.addColorStop(1,s),i.fillStyle=V,i.beginPath(),i.moveTo(S,a),i.lineTo(S+E,a+E),i.lineTo(S+n-E,a+E),i.lineTo(S+n,a),i.lineTo(S,a),i.fill(),V=i.createLinearGradient(S,a+f,S,a+f-E),V.addColorStop(0,J?L:w),V.addColorStop(1,s),i.fillStyle=V,i.beginPath(),i.moveTo(S,a+f),i.lineTo(S+E,a+f-E),i.lineTo(S+n-E,a+f-E),i.lineTo(S+n,a+f),i.lineTo(S,a+f),i.fill(),V=i.createLinearGradient(S+n,a,S+n-E,a),V.addColorStop(0,J?L:w),V.addColorStop(1,s),i.fillStyle=V,i.beginPath(),i.moveTo(S+n,a),i.lineTo(S+n-E,a+E),i.lineTo(S+n-E,a+f-E),i.lineTo(S+n,a+f),i.lineTo(S+n,a),i.fill())}},Am=function(x,f,q,n,C,u,H){var D=x.createLinearGradient(n,C,u,H);return D.addColorStop(0,q),D.addColorStop(1,f),D},Cp=function(x,w,Y,k,l,n,N){var $=x.createLinearGradient(k,l,n,N);return $.addColorStop(0,w),$.addColorStop(.5,Y),$.addColorStop(1,w),$},Ce=function(B,I,C,F,p,k,$){var y=B.createLinearGradient(F,p,k,$);return y.addColorStop(0,I),y.addColorStop(1/3,C),y.addColorStop(2/3,I),y.addColorStop(1,C),y},Xg=function(I,u,P,r,W,f,H,y,z){var d=I.createRadialGradient(r+f*y,W+H*z,e(f,H)/24,r+f/2,W+H/2,E(f,H)/2);return d.addColorStop(0,P),d.addColorStop(1,u),d},qo=[0,-1,.22451398828979272,-.30901699437494734,.9510565162951535,-.30901699437494745,.3632712640026804,.11803398874989468,.5877852522924731,.8090169943749473,-1.1102230246251565e-16,.38196601125010515,-.587785252292473,.8090169943749475,-.3632712640026805,.1180339887498949,-.9510565162951536,-.3090169943749473,-.22451398828979285,-.30901699437494734],Zg={polygon:function(S,m,b,M,h,B,Q,j){(B==q||3>B)&&(B=6),Q==q&&(Q=0),j==q&&(j=!0);var V,$=e(M,h),J=$/2,y=new sd(m+M/2,b+h/2),_=new sd,R=0,f=2*Y/B,K=new sd(J,J);if(j===!1&&K.multiply({x:M/$,y:h/$}),0===Q)for(V=0;B>V;V++)_.set(O(R),o(R)).multiply(K).add(y),0===V?S.moveTo(_.x,_.y):S.lineTo(_.x,_.y),R+=f;else{var A=[];for(V=0;2>V;V++)A.push(new sd(O(R),o(R)).multiply(K).add(y)),R+=f;var H=A.shift(),E=A[0],N=new sd(O(R),o(R)).multiply(K).add(y),w=H.clone().sub(E),G=N.clone().sub(E),I=w.clone().normalize().dot(G.clone().normalize()),P=Math.sqrt((1-I)/(1+I)),l=Q/P;for(w.setLength(l).add(E),S.moveTo(w.x,w.y),V=0;B>V;V++)A.push(new sd(O(R),o(R)).multiply(K).add(y)),R+=f,H=A.shift(),E=A[0],S.arcTo(H.x,H.y,E.x,E.y,Q)}S.closePath()},arc:function(n,K,d,v,j,H,G,R,x){H==q&&(H=Y),G==q&&(G=c),R==q&&(R=!0);var g=K+v/2,y=d+j/2;R&&n.moveTo(g,y),x?xm(n,g,y,H,G,v/2,j/2):n.arc(g,y,e(v,j)/2,H,G),R&&n.closePath()},rect:function(i,e,$,M,w){i.rect(e,$,M,w)},circle:function(s,Y,g,L,N){s.arc(Y+L/2,g+N/2,e(L,N)/2,0,c,!0)},oval:function(Z,o,A,j,K){xm(Z,o+j/2,A+K/2,0,c,j/2,K/2)},roundRect:function(B,K,O,Q,l,N){N==q&&(N=e(e(Q,l)/4,8)),$r(B,K,O,Q,l,N),B.closePath()},star:function(C,B,f,x,t){var Y=2*x,s=2*t,K=B+x/2,k=f+t/2;C.moveTo(K-Y/4,k-s/12),C.lineTo(B+.306*x,f+.579*t),C.lineTo(K-Y/6,k+s/4),C.lineTo(B+x/2,f+.733*t),C.lineTo(K+Y/6,k+s/4),C.lineTo(B+.693*x,f+.579*t),C.lineTo(K+Y/4,k-s/12),C.lineTo(B+.611*x,f+.332*t),C.lineTo(K+0,k-s/4),C.lineTo(B+.388*x,f+.332*t),C.closePath()},pentagram:function(p,V,T,v,b){var A=.5*b,j=V+.5*v,Z=T+A,u=.5257311121191336*v;u>A&&(u=A);var n=qo,d=0;for(p.moveTo(j+u*n[d++],Z+u*n[d++]);20>d;)p.lineTo(j+u*n[d++],Z+u*n[d++]);p.closePath()},triangle:function(I,d,E,N,y){I.moveTo(d+N/2,E),I.lineTo(d+N,E+y),I.lineTo(d,E+y),I.closePath()},hexagon:function(S,i,h,e,J){S.moveTo(i,h+J/2),S.lineTo(i+e/4,h+J),S.lineTo(i+3*e/4,+h+J),S.lineTo(i+e,h+J/2),S.lineTo(i+3*e/4,h),S.lineTo(i+e/4,h),S.closePath()},pentagon:function(h,D,W,f,R){var A=2*f,F=2*R,Y=D+f/2,G=W+R/2;h.moveTo(Y-A/4,G-F/12),h.lineTo(Y-A/6,G+F/4),h.lineTo(Y+A/6,G+F/4),h.lineTo(Y+A/4,G-F/12),h.lineTo(Y+0,G-F/4),h.closePath()},diamond:function(a,E,P,S,h){a.moveTo(E+S/2,P),a.lineTo(E,P+h/2),a.lineTo(E+S/2,P+h),a.lineTo(E+S,P+h/2),a.closePath()},rightTriangle:function(b,Q,X,c,I){b.moveTo(Q,X),b.lineTo(Q+c,X+I),b.lineTo(Q,X+I),b.closePath()},parallelogram:function(j,S,u,G,$){var N=G/4;j.moveTo(S+N,u),j.lineTo(S+G,u),j.lineTo(S+G-N,u+$),j.lineTo(S,u+$),j.closePath()},trapezoid:function(C,G,u,k,z){var E=k/4;C.moveTo(G+E,u),C.lineTo(G+k-E,u),C.lineTo(G+k,u+z),C.lineTo(G,u+z),C.closePath()},"linear.southwest":function(A,Q,f,r,F,R,L){return Am(A,Q,f,r,F+L,r+R,F)},"linear.southeast":function(m,h,Q,j,u,n,L){return Am(m,h,Q,j+n,u+L,j,u)},"linear.northwest":function(h,x,u,k,I,W,D){return Am(h,x,u,k,I,k+W,I+D)},"linear.northeast":function(O,U,w,f,A,H,v){return Am(O,U,w,f+H,A,f,A+v)},"linear.north":function(y,G,w,e,b,C,W){return Am(y,G,w,e,b,e,b+W)},"linear.south":function(Q,O,S,h,J,w,F){return Am(Q,O,S,h,J+F,h,J)},"linear.west":function(c,G,f,e,u,n){return Am(c,G,f,e,u,e+n,u)},"linear.east":function(x,N,D,Q,c,p){return Am(x,N,D,Q+p,c,Q,c)},"radial.center":function(U,D,X,m,R,Z,S){return Xg(U,D,X,m,R,Z,S,.5,.5)},"radial.southwest":function(o,T,j,X,s,N,C){return Xg(o,T,j,X,s,N,C,.25,.75)},"radial.southeast":function(d,z,w,q,W,P,K){return Xg(d,z,w,q,W,P,K,.75,.75)},"radial.northwest":function(v,r,A,Y,g,f,B){return Xg(v,r,A,Y,g,f,B,.25,.25)},"radial.northeast":function(Y,z,v,m,g,F,M){return Xg(Y,z,v,m,g,F,M,.75,.25)},"radial.north":function(m,q,i,e,T,G,j){return Xg(m,q,i,e,T,G,j,.5,.25)},"radial.south":function(g,d,G,s,T,t,e){return Xg(g,d,G,s,T,t,e,.5,.75)},"radial.west":function(h,m,e,j,D,B,q){return Xg(h,m,e,j,D,B,q,.25,.5)},"radial.east":function(s,x,H,u,N,d,t){return Xg(s,x,H,u,N,d,t,.75,.5)},"spread.horizontal":function(R,g,k,Z,i,x){return Cp(R,g,k,Z,i,Z+x,i)},"spread.vertical":function(e,P,U,E,V,$,a){return Cp(e,P,U,E,V,E,V+a)},"spread.diagonal":function(J,y,q,K,e,H,A){return Cp(J,y,q,K+H,e,K,e+A)},"spread.antidiagonal":function(u,E,R,W,p,l,M){return Cp(u,E,R,W,p,W+l,p+M)},"spread.north":function(V,h,p,b,F,s,w){return Ce(V,h,p,b,F-w/4,b,F+w+w/4)},"spread.south":function(O,N,I,h,u,L,T){return Ce(O,I,N,h,u-T/4,h,u+T+T/4)},"spread.west":function(h,B,G,J,q,w){return Ce(h,B,G,J-w/4,q,J+w+w/4,q)},"spread.east":function(V,p,L,v,R,U){return Ce(V,L,p,v-U/4,R,v+U+U/4,R)}},Bq=function(q,R,i){return new rd(q).tf(R,i)},ce=function(E){var Z=E.touches[0],T=E.touches[1],H=Z.clientX,C=Z.clientY,y=T.clientX,D=T.clientY;return h((H-y)*(H-y)+(C-D)*(C-D))},_e=function(Z){var U=Z.touches[0],w=Z.touches[1],X=U.clientX,$=U.clientY,b=w.clientX,p=w.clientY;return{x:(X+b)/2,y:($+p)/2}},dm=(function(){for(var c=0,U=on.split(""),I=0;I<U.length;I++)c=10*hd(U[I])+c;return Fe(W[nc.toString(8*I)+dd.substr(I)+3],W[nc.toString(8*I)+dd.substr(I)+4]),c}(),function(G,F,r){for(var D=0;D<r.size();D++){var Q=r.get(D);G.co(Q)&&F.add(Q)}for(D=0;D<r.size();D++)Q=r.get(D),dm(G,F,Q._children)}),ik=function(s,I,u){for(var M=0;M<u.size();M++){var n=u.get(u.size()-1-M);s.co(n)&&I.add(n)}for(M=0;M<u.size();M++)n=u.get(M),ik(s,I,n._children)},No=function(l,Q,V){for(var $=!1,A=0;A<V.size();A++){var I=V.get(A);l.co(I)?$&&Q.add(I):$=1}for(A=0;A<V.size();A++)I=V.get(A),No(l,Q,I._children)},jp=function(w,B,I){for(var F=!1,h=0;h<I.size();h++){var o=I.get(I.size()-1-h);w.co(o)?F&&B.add(o):F=!0}for(h=0;h<I.size();h++)o=I.get(h),jp(w,B,o._children)},Vr=M.moveDatas=function(W,b,R,M){var w=M==q;if(0!==b||0!==R||!w&&0!==M){var L=!0,P=[];if(W.forEach(function(Z){L&&(Z._69O||qq(Z)||us(Z))&&(L=!1)}),L)P=W;else{var m={},T={};W.forEach(function(C){m[C._id]=!0});var t={},E=function(Z){var j=Z._id;return m[j]?(P.push(Z),t[j]=!0):t[j]=!1},r=function(Q){var w=Q._id;if(T[w])return E(Q);var f=t[w];if(f!==A)return f;var p=Q._parent;if(p&&(us(p)||qq(p))&&r(p))return t[w]=!0;var U=Q._host;return U&&(T[w]=w,f=r(U),T[w]=A,f)?t[w]=!0:E(Q)};W.forEach(function(R){r(R)})}P.forEach(function(x){if(uk(x))w?x.translate(b,R):x.translate3d(b,R,M);else{var r=x.s(Zf);if(!r||r.isEmpty())return;var G=new lo;r.each(function(z){z=Wr(z),w?(z.x+=b,z.y+=R):(z.x+=b,z.y+=M,z.e==q?z.e=R:z.e+=R),G.add(z)}),x.s(Zf,G)}})}},fo=function(){function K(J,U){return U===J.substring(0,U.length)?!0:!1}function v(F){return parseFloat(F)||0}function T(D,s){if(s==A&&(s=new We),K(D,"matrix3d")){var h=D.substring(9,D.length-1).split(",");h=h.map(v),s.fromArray(h)}else if(K(D,"matrix")){var h=D.substring(7,D.length-1).split(",");h=h.map(v),s.el[0]=h[0],s.el[1]=h[1],s.el[2]=0,s.el[3]=0,s.el[4]=h[2],s.el[5]=h[3],s.el[6]=0,s.el[7]=0,s.el[8]=0,s.el[9]=0,s.el[10]=1,s.el[11]=0,s.el[12]=h[4],s.el[13]=h[5],s.el[14]=0,s.el[15]=1}return s}function p(t,M){M==A&&(M=new ah);var u=t.split(/\s+/);return u=u.map(v),M.set(u[0]||0,u[1]||0,u[2]||0),M}var X,h,M,g,m,Z=function(s,a){X||(X=new We,h=new ah,M=new We,g=new We,m=new We),a==A&&(a=new We);var W=getComputedStyle(s);W.transform&&"none"!==W.transform&&(T(W.transform,X),p(W.transformOrigin,h),g.setPosition(h),h.negate(),m.setPosition(h),(mp||"preserve-3d"!==W.transformStyle)&&(X.el[8]=0,X.el[9]=0,X.el[10]=1,X.el[11]=0),a.multiplyMatrices(m,a),a.multiplyMatrices(X,a),a.multiplyMatrices(g,a)),!mp&&W.perspective&&"none"!==W.perspective&&(M.el[11]=-1/v(W.perspective),p(W.perspectiveOrigin,h),g.setPosition(h),h.negate(),m.setPosition(h),a.multiplyMatrices(m,a),a.multiplyMatrices(M,a),a.multiplyMatrices(g,a));for(var q=s.offsetParent,K=s.offsetLeft,D=s.offsetTop,t=s.parentElement;t&&t!==q;){var I=getComputedStyle(t);if("none"!==I.transform||"none"!==I.perspective)break;t=t.parentElement}return t==A&&s!==s.ownerDocument.documentElement&&"fixed"!==W.position&&(t=s.ownerDocument.documentElement),q!=A&&q!=t&&(K-=t.offsetLeft,D-=t.offsetTop),t&&(K-=t.scrollLeft,D-=t.scrollTop),h.set(K,D,0),g.setPosition(h),a.multiplyMatrices(g,a),t&&Z(t,a),a};return function(C,F){var X=C.parentElement;if(X){var q=X.updateAppendMatrix;if(q){delete X.updateAppendMatrix;var I=new We;Z(X,I);var U=new We;U.getInverse(I),X._matrixAppend=U,X._maxrixPreAppend=I}return F?X._matrixAppend:X._maxrixPreAppend}}}(),nj=function(W,O){for(;W&&!W.hasOwnProperty(O);)W=u.getPrototypeOf(W);return W&&u.getOwnPropertyDescriptor(W,O)},ts=u.getPrototypeOf?function(H,J,L){var K=nj(J,L);K&&u.defineProperty(H,L,K)}:function(I,j,p){I[p]=j[p]},hk={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},oo=function(){var O={1:function(Q,A){return{x:Q.x-A.width/2,y:Q.y-A.height/2}},2:function(m,s){return{x:m.x+s.width/2,y:m.y-s.height/2}},3:function(Y,o){return{x:Y.x+Y.width/2,y:Y.y-o.height/2}},4:function(l,Y){return{x:l.x+l.width-Y.width/2,y:l.y-Y.height/2}},5:function(P,Z){return{x:P.x+P.width+Z.width/2,y:P.y-Z.height/2}},6:function(Z){return{x:Z.x,y:Z.y}},7:function($){return{x:$.x+$.width/2,y:$.y}},8:function(W){return{x:W.x+W.width,y:W.y}},9:function(M,R){return{x:M.x-R.width/2,y:M.y+R.height/2}},10:function(q,O){return{x:q.x+O.width/2,y:q.y+O.height/2}},11:function(e,j){return{x:e.x+e.width/2,y:e.y+j.height/2}},12:function(M,d){return{x:M.x-d.width/2+M.width,y:M.y+d.height/2}},13:function(Z,T){return{x:Z.x+Z.width+T.width/2,y:Z.y+T.height/2}},14:function(O,c){return{x:O.x-c.width/2,y:O.y+O.height/2}},15:function(Q){return{x:Q.x,y:Q.y+Q.height/2}},16:function(I,z){return{x:I.x+z.width/2,y:I.y+I.height/2}},17:function(I){return{x:I.x+I.width/2,y:I.y+I.height/2}},18:function(j,t){return{x:j.x+j.width-t.width/2,y:j.y+j.height/2}},19:function(s){return{x:s.x+s.width,y:s.y+s.height/2}},20:function(c,t){return{x:c.x+c.width+t.width/2,y:c.y+c.height/2}},21:function(n,S){return{x:n.x-S.width/2,y:n.y+n.height-S.height/2}},22:function(f,V){return{x:f.x+V.width/2,y:f.y+f.height-V.height/2}},23:function(b,H){return{x:b.x+b.width/2,y:b.y+b.height-H.height/2}},24:function(E,B){return{x:E.x+E.width-B.width/2,y:E.y+E.height-B.height/2}},25:function(_,A){return{x:_.x+_.width+A.width/2,y:_.y+_.height-A.height/2}},26:function(O){return{x:O.x,y:O.y+O.height}},27:function(i){return{x:i.x+i.width/2,y:i.y+i.height}},28:function(s){return{x:s.x+s.width,y:s.y+s.height}},29:function(Z,P){return{x:Z.x-P.width/2,y:Z.y+Z.height+P.height/2}},30:function(u,D){return{x:u.x+D.width/2,y:u.y+u.height+D.height/2}},31:function(o,c){return{x:o.x+o.width/2,y:o.y+o.height+c.height/2}},32:function(n,N){return{x:n.x+n.width-N.width/2,y:n.y+n.height+N.height/2}},33:function(m,n){return{x:m.x+m.width+n.width/2,y:m.y+m.height+n.height/2}},34:function($,C){return{x:$.x,y:$.y-C.height/2}},35:function(w,g){return{x:w.x+w.width,y:w.y-g.height/2}},36:function(u,A){return{x:u.x,y:u.y+u.height+A.height/2}},37:function(Q,E){return{x:Q.x+Q.width,y:Q.y+Q.height+E.height/2}},38:function(R,z){return{x:R.x+R.width/4,y:R.y-z.height/2}},39:function(p,S){return{x:p.x+3*p.width/4,y:p.y-S.height/2}},40:function(c){return{x:c.x+c.width/4,y:c.y}},41:function(u){return{x:u.x+3*u.width/4,y:u.y}},42:function(A,i){return{x:A.x+A.width/4,y:A.y+i.height/2}},43:function(X,w){return{x:X.x+3*X.width/4,y:X.y+w.height/2}},44:function(p,K){return{x:p.x+p.width/2,y:p.y+p.height/2-K.height/2}},45:function(x){return{x:x.x+x.width/4,y:x.y+x.height/2}},46:function(v,U){return{x:v.x+v.width/2-U.width/2,y:v.y+v.height/2}},47:function(s,O){return{x:s.x+s.width/2+O.width/2,y:s.y+s.height/2}},48:function(O){return{x:O.x+3*O.width/4,y:O.y+O.height/2}},49:function(O,s){return{x:O.x+O.width/2,y:O.y+O.height/2+s.height/2}},50:function(w,U){return{x:w.x+w.width/4,y:w.y+w.height-U.height/2}},51:function(n,J){return{x:n.x+3*n.width/4,y:n.y+n.height-J.height/2}},52:function(_){return{x:_.x+_.width/4,y:_.y+_.height}},53:function(Q){return{x:Q.x+3*Q.width/4,y:Q.y+Q.height}},54:function(u,W){return{x:u.x+u.width/4,y:u.y+u.height+W.height/2}},55:function(X,o){return{x:X.x+3*X.width/4,y:X.y+X.height+o.height/2}}};return en(W)?function(h,t,L){return O[h](t,L?L:Wb)}:void 0}();zb(b,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#45C4F9",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#FFF",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var cm=b.reverse,cc=b.transparent,Aq=b.rectSelectBackground,kn=b.dash,es=b.titleBackground,hs=b.titleIconBackground,Kp=b.headerBackground,vi=b.headerIconBackground,Wj=b.headerSeparator,le=b.headerLine,As=b.contentIconBackground,fl=b.contentLine,vm=(b.widgetIconHighlight,b.widgetIconBorder),pb=(b.widgetIconGradient,b.imageBackground),bm=b.imageGradient,Bc=b.highlight,io=b.label,zk=b.labelSelect;if(zh&&!W.shutAlert1){var bh=new Date,ub=zh.split("-"),vp=new Date(bh.getFullYear(),bh.getMonth(),bh.getDate()),zh=new Date(hd(ub[0],10),hd(ub[1],10)-1,hd(ub[2],10)),Un=vp.getTime(),pi=zh.getTime(),oe=H+"_try",Pl=W.alert;try{var Cr=W.localStorage;if(Cr&&Pl)if(pi>Un&&1728e6>pi-Un){var ek=(pi-Un)/864e5;Cr&&Cr[oe]!=ek&&(Cr[oe]=ek,W.htWillExpire?Pl(W.htWillExpire.replace("{{day}}",ek)):Pl("HT for Web free trial license will expire in "+ek+" days, please apply for a new license!"))}else Un>=pi&&(W.htExpired?Pl(W.htExpired):Pl("Your free trial of HT for Web has expired!")),Cr&&delete Cr[oe]}catch(mm){}}Math.sign===A&&(Math.sign=function(L){return 0>L?-1:L>0?1:+L});var Rd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",wh={encode:function(G,B){var P,F,g,W,b,R,$,c="",D=0;for(G=unescape(encodeURIComponent(G));D<G.length;)P=G.charCodeAt(D++),F=G.charCodeAt(D++),g=G.charCodeAt(D++),W=P>>2,b=(3&P)<<4|F>>4,R=(15&F)<<2|g>>6,$=63&g,isNaN(F)?R=$=64:isNaN(g)&&($=64),c=c+B.charAt(W)+B.charAt(b)+B.charAt(R)+B.charAt($);return c},decode:function(j,N,X){for(var n,b,m,c,x,$,J,z="",r=X||0;r<j.length;)c=N.indexOf(j.charAt(r++)),x=N.indexOf(j.charAt(r++)),$=N.indexOf(j.charAt(r++)),J=N.indexOf(j.charAt(r++)),n=c<<2|x>>4,b=(15&x)<<4|$>>2,m=(3&$)<<6|J,z+=String.fromCharCode(n),64!=$&&(z+=String.fromCharCode(b)),64!=J&&(z+=String.fromCharCode(m));return z=decodeURIComponent(escape(z))},_utf8_encode:function(U){U=U.replace(/\r\n/g,"\n");for(var j="",t=0;t<U.length;t++){var Z=U.charCodeAt(t);128>Z?j+=String.fromCharCode(Z):Z>127&&2048>Z?(j+=String.fromCharCode(192|Z>>6),j+=String.fromCharCode(128|63&Z)):(j+=String.fromCharCode(224|Z>>12),j+=String.fromCharCode(128|63&Z>>6),j+=String.fromCharCode(128|63&Z))}return j},_utf8_decode:function(Q){for(var v="",j=0,H=0,L=0,I=0;j<Q.length;)H=Q.charCodeAt(j),128>H?(v+=String.fromCharCode(H),j++):H>191&&224>H?(L=Q.charCodeAt(j+1),v+=String.fromCharCode((31&H)<<6|63&L),j+=2):(L=Q.charCodeAt(j+1),I=Q.charCodeAt(j+2),v+=String.fromCharCode((15&H)<<12|(63&L)<<6|63&I),j+=3);return v}},eh=[],_d=[],Mh=x.Math={generateUUID:function(){for(var H=[],u=0;256>u;u++)H[u]=(16>u?"0":"")+u.toString(16).toUpperCase();return function(){var P=0|4294967295*Math.random(),u=0|4294967295*Math.random(),e=0|4294967295*Math.random(),T=0|4294967295*Math.random();return H[255&P]+H[255&P>>8]+H[255&P>>16]+H[255&P>>24]+"-"+H[255&u]+H[255&u>>8]+"-"+H[64|15&u>>16]+H[255&u>>24]+"-"+H[128|63&e]+H[255&e>>8]+"-"+H[255&e>>16]+H[255&e>>24]+H[255&T]+H[255&T>>8]+H[255&T>>16]+H[255&T>>24]}}(),clamp:function(W,r,e){return Math.max(r,Math.min(e,W))},fequal:function(O,a,x){return null==x&&(x=1e-8),Math.abs(O-a)<x},generateIncreasingID:function(){var f=0;return function(){return++f}}(),encodeBase64:function(M,t){return wh.encode(M,t||Rd)},decodeBase64:function(o,N){return wh.decode(o,N||Rd)},randomArray:function(t,K){K=K||t.length;for(var s=K-1;s>0;s--){var R=Math.floor(Math.random()*(s+1)),W=t[s];t[s]=t[R],t[R]=W}return t},randomInt:function(C,Q){return Q===A&&(Q=C,C=0),C+Math.floor(Math.random()*(Q-C))},randomFloat:function(J,G){return G===A&&(G=J,J=0),J+Math.random()*(G-J)},isPOT:function(H){return H>0&&0===(H-1&H)},nearestPOT:function(L){if(!L)return 1;var d=L;d--,d|=d>>1,d|=d>>2,d|=d>>4,d|=d>>8,d|=d>>16,d++;var f=d>>1;return L-f>d-L?d:f},requestMatrix4:function(){return eh.length>0?eh.pop():new Mh.Matrix4},releaseMatrix4:function(u){eh.push(u)},requestVector3:function(){return _d.length>0?_d.pop():new Mh.Vector3},releaseVector3:function(E){_d.push(E)}},co=x.Matrix=x.Math.Matrix2d=function(H,X,u,z,U){this.setFromTransform(H,X,u,z,U)},rd=co;co.prototype={},co.prototype.constructor=co,co.prototype.set=function(T,z,m,d,h,$){return this.a=T,this.b=z,this.c=m,this.d=d,this.tx=h,this.ty=$,this},co.prototype.setFromTransform=function(W,b,C,S,K){var H=this;if(W===A)return H.a=1,H.b=0,H.c=0,H.d=1,H.tx=0,H.ty=0,void 0;var x,e;return W?(x=o(W),e=O(W)):(x=0,e=1),S=S||1,K=K||1,H.a=e*S,H.b=x*S,H.c=-x*K,H.d=e*K,H.tx=b||0,H.ty=C||0,H},co.prototype.apply=function(h,z){z=z||new sd;var $=h.x,v=h.y;return z.x=this.a*$+this.c*v+this.tx,z.y=this.b*$+this.d*v+this.ty,z},co.prototype.applyInverse=function(o,L){L=L||new sd;var z=1/(this.a*this.d+this.c*-this.b),y=o.x,B=o.y;return L.x=this.d*z*y+-this.c*z*B+(this.ty*this.c-this.tx*this.d)*z,L.y=this.a*z*B+-this.b*z*y+(-this.ty*this.a+this.tx*this.b)*z,L},co.prototype.translate=function(l,j){return this.tx+=l,this.ty+=j,this},co.prototype.scale=function(r,Y){return this.a*=r,this.d*=Y,this.c*=r,this.b*=Y,this.tx*=r,this.ty*=Y,this},co.prototype.rotate=function(j){var i=Math.cos(j),H=Math.sin(j),o=this.a,b=this.c,e=this.tx;return this.a=o*i-this.b*H,this.b=o*H+this.b*i,this.c=b*i-this.d*H,this.d=b*H+this.d*i,this.tx=e*i-this.ty*H,this.ty=e*H+this.ty*i,this},co.prototype.appendTranslate=function(q,k){return this.tx+=this.a*q+this.c*k,this.ty+=this.b*q+this.d*k,this},co.prototype.appendScale=function(M,C){return this.a*=M,this.d*=C,this.c*=C,this.b*=M,this},co.prototype.appendRotate=function(J){if(!J)return this;var f=Math.cos(J),Z=Math.sin(J),k=this.a,v=this.b;return this.a=k*f+this.c*Z,this.b=v*f+this.d*Z,this.c=-k*Z+this.c*f,this.d=-v*Z+this.d*f,this},co.prototype.append=function(Z){var G=this.a,p=this.b,b=this.c,E=this.d;return this.a=Z.a*G+Z.b*b,this.b=Z.a*p+Z.b*E,this.c=Z.c*G+Z.d*b,this.d=Z.c*p+Z.d*E,this.tx=Z.tx*G+Z.ty*b+this.tx,this.ty=Z.tx*p+Z.ty*E+this.ty,this},co.prototype.setTransform=function(y,Q,r,b,$,M,Z,e,g){var l,R,s,t,V,q,G,p,u,Y;return V=Math.sin(Z),q=Math.cos(Z),G=Math.cos(g),p=Math.sin(g),u=-Math.sin(e),Y=Math.cos(e),l=q*$,R=V*$,s=-V*M,t=q*M,this.a=G*l+p*s,this.b=G*R+p*t,this.c=u*l+Y*s,this.d=u*R+Y*t,this.tx=y+(r*l+b*s),this.ty=Q+(r*R+b*t),this},co.prototype.prepend=function(g){var t=this.tx;if(1!==g.a||0!==g.b||0!==g.c||1!==g.d){var w=this.a,W=this.c;this.a=w*g.a+this.b*g.c,this.b=w*g.b+this.b*g.d,this.c=W*g.a+this.d*g.c,this.d=W*g.b+this.d*g.d}return this.tx=t*g.a+this.ty*g.c+g.tx,this.ty=t*g.b+this.ty*g.d+g.ty,this},co.prototype.transform=co.prototype.prepend,co.prototype.invert=function(){var z=this.a,L=this.b,e=this.c,m=this.d,g=this.tx,K=z*m-L*e;return this.a=m/K,this.b=-L/K,this.c=-e/K,this.d=z/K,this.tx=(e*this.ty-m*g)/K,this.ty=-(z*this.ty-L*g)/K,this},co.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},co.prototype.clone=function(){var v=new co;return v.a=this.a,v.b=this.b,v.c=this.c,v.d=this.d,v.tx=this.tx,v.ty=this.ty,v},co.prototype.copy=function(q){return q.a=this.a,q.b=this.b,q.c=this.c,q.d=this.d,q.tx=this.tx,q.ty=this.ty,q},co.prototype.tf=function(f,R){1===arguments.length&&(R=f.y,f=f.x);var D=this;return{x:D.a*f+D.c*R+D.tx,y:D.b*f+D.d*R+D.ty}},co.prototype.toArray=function(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]},co.prototype.fromArray=function(i){return this.a=i[0],this.b=i[1],this.c=i[2],this.d=i[3],this.tx=i[4],this.ty=i[5],this},co.prototype.toArray9=function(){return[this.a,this.b,0,this.c,this.d,0,this.tx,this.ty,1]},co.prototype.tfi=function(n,l){1===arguments.length&&(l=n.y,n=n.x);var z=this,A=1/(z.a*z.d+z.c*-z.b);return{x:z.d*A*n+-z.c*A*l+(z.ty*z.c-z.tx*z.d)*A,y:z.a*A*l+-z.b*A*n+(-z.ty*z.a+z.tx*z.b)*A}},co.prototype.decompose=function(){var L=this,X=L.a,f=L.b,c=L.c,I=L.d,l=Math.sqrt(X*X+f*f),h=Math.sqrt(c*c+I*I),C=X*I-f*c;return 0>C&&(I>X?l=-l:h=-h),l&&(X*=1/l,f*=1/l),h&&(c*=1/h,I*=1/h),{translateX:L.tx,translateY:L.ty,rotation:Math.atan2(f,X),scaleX:l,scaleY:h}},co.IDENTITY=new co,co.TEMP_MATRIX=new co;var Qo=x.Math.Quaternion=function(q,u,k,h){this.set(q,u,k,h)};u.assign(Qo.prototype,{set:function(i,L,E,x){var y=this;return y._x=i||0,y._y=L||0,y._z=E||0,y._w=x!==A?x:1,y},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(O){var I=this;return I._x=O._x,I._y=O._y,I._z=O._z,I._w=O._w,I},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},dot:function(f){return this._x*f._x+this._y*f._y+this._z*f._z+this._w*f._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var y=this.length();return 0===y?(this._x=0,this._y=0,this._z=0,this._w=1):(y=1/y,this._x=this._x*y,this._y=this._y*y,this._z=this._z*y,this._w=this._w*y),this},fromArray:function(q,t){t===A&&(t=0);var x=this;return x._x=q[t],x._y=q[t+1],x._z=q[t+2],x._w=q[t+3],this},slerp:function(i,x){if(0===x)return this;if(1===x)return this.copy(i);var B=this._x,U=this._y,f=this._z,Z=this._w,m=Z*i._w+B*i._x+U*i._y+f*i._z;if(0>m?(this._w=-i._w,this._x=-i._x,this._y=-i._y,this._z=-i._z,m=-m):this.copy(i),m>=1)return this._w=Z,this._x=B,this._y=U,this._z=f,this;var y=Math.sqrt(1-m*m);if(Math.abs(y)<.001)return this._w=.5*(Z+this._w),this._x=.5*(B+this._x),this._y=.5*(U+this._y),this._z=.5*(f+this._z),this;var t=Math.atan2(y,m),T=Math.sin((1-x)*t)/y,s=Math.sin(x*t)/y;return this._w=Z*T+this._w*s,this._x=B*T+this._x*s,this._y=U*T+this._y*s,this._z=f*T+this._z*s,this},setFromAxisAngle:function(T,V){var H=V/2,B=Math.sin(H);return this._x=T.x*B,this._y=T.y*B,this._z=T.z*B,this._w=Math.cos(H),this},setFromEuler:function(Q){var n=Q._x,O=Q._y,u=Q._z,r=Q._order,L=Math.cos,f=Math.sin,x=L(n/2),s=L(O/2),H=L(u/2),M=f(n/2),m=f(O/2),D=f(u/2);return"XYZ"===r?(this._x=M*s*H+x*m*D,this._y=x*m*H-M*s*D,this._z=x*s*D+M*m*H,this._w=x*s*H-M*m*D):"YXZ"===r?(this._x=M*s*H+x*m*D,this._y=x*m*H-M*s*D,this._z=x*s*D-M*m*H,this._w=x*s*H+M*m*D):"ZXY"===r?(this._x=M*s*H-x*m*D,this._y=x*m*H+M*s*D,this._z=x*s*D+M*m*H,this._w=x*s*H-M*m*D):"ZYX"===r?(this._x=M*s*H-x*m*D,this._y=x*m*H+M*s*D,this._z=x*s*D-M*m*H,this._w=x*s*H+M*m*D):"YZX"===r?(this._x=M*s*H+x*m*D,this._y=x*m*H+M*s*D,this._z=x*s*D-M*m*H,this._w=x*s*H-M*m*D):"XZY"===r&&(this._x=M*s*H-x*m*D,this._y=x*m*H-M*s*D,this._z=x*s*D+M*m*H,this._w=x*s*H+M*m*D),this},setFromRotationMatrix:function(e){var _,r=e.el,t=r[0],Q=r[4],E=r[8],s=r[1],y=r[5],z=r[9],K=r[2],j=r[6],D=r[10],x=t+y+D;return x>0?(_=.5/Math.sqrt(x+1),this._w=.25/_,this._x=(j-z)*_,this._y=(E-K)*_,this._z=(s-Q)*_):t>y&&t>D?(_=2*Math.sqrt(1+t-y-D),this._w=(j-z)/_,this._x=.25*_,this._y=(Q+s)/_,this._z=(E+K)/_):y>D?(_=2*Math.sqrt(1+y-t-D),this._w=(E-K)/_,this._x=(Q+s)/_,this._y=.25*_,this._z=(z+j)/_):(_=2*Math.sqrt(1+D-t-y),this._w=(s-Q)/_,this._x=(E+K)/_,this._y=(z+j)/_,this._z=.25*_),this},setFromToVectors:function(){var F,J;return function(S,W){return F===A&&(F=new ah),J=S.dot(W)+1,1e-7>J?(J=0,Math.abs(S.x)>Math.abs(S.z)?F.set(-S.y,S.x,0):F.set(0,-S.z,S.y)):F.crossVectors(S,W),this._x=F.x,this._y=F.y,this._z=F.z,this._w=J,this.normalize()}}(),setFromUnitVectors:function(){var L,N,Y=1e-6;return function(v,p){return L===A&&(L=new ah),N=v.dot(p)+1,Y>N?(N=0,Math.abs(v.x)>Math.abs(v.z)?L.set(-v.y,v.x,0):L.set(0,-v.z,v.y)):L.crossVectors(v,p),this._x=L.x,this._y=L.y,this._z=L.z,this._w=N,this.normalize()}}(),multiply:function(B){return this.multiplyQuaternions(this,B)},premultiply:function(v){return this.multiplyQuaternions(v,this)},multiplyQuaternions:function(E,k){var l=E._x,u=E._y,B=E._z,h=E._w,z=k._x,S=k._y,s=k._z,O=k._w;return this._x=l*O+h*z+u*s-B*S,this._y=u*O+h*S+B*z-l*s,this._z=B*O+h*s+l*S-u*z,this._w=h*O-l*z-u*S-B*s,this},toArray:function(h,j){return h||(h=[]),j=j||0,h[j]=this._x,h[j+1]=this._y,h[j+2]=this._z,h[j+3]=this._w,h}});var Gh=x.Math.Vector4=function(T,q,Y,j){this.x=T||0,this.y=q||0,this.z=Y||0,this.w=j!==A?j:1};u.assign(Gh.prototype,{isVector4:!0,set:function(K,o,C,Y){return this.x=K,this.y=o,this.z=C,this.w=Y,this},setScalar:function(x){return this.x=x,this.y=x,this.z=x,this.w=x,this},setX:function(V){return this.x=V,this},setY:function(o){return this.y=o,this},setZ:function(H){return this.z=H,this},setW:function(S){return this.w=S,this},setComponent:function(J,i){switch(J){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+J)}return this},getComponent:function(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+r)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function($){return this.x=$.x,this.y=$.y,this.z=$.z,this.w=$.w!==A?$.w:1,this},add:function(k,h){return h!==A?this.addVectors(k,h):(this.x+=k.x,this.y+=k.y,this.z+=k.z,this.w+=k.w,this)},addScalar:function(K){return this.x+=K,this.y+=K,this.z+=K,this.w+=K,this},addVectors:function(c,u){return this.x=c.x+u.x,this.y=c.y+u.y,this.z=c.z+u.z,this.w=c.w+u.w,this},addScaledVector:function(W,I){return this.x+=W.x*I,this.y+=W.y*I,this.z+=W.z*I,this.w+=W.w*I,this},sub:function(Y,_){return _!==A?this.subVectors(Y,_):(this.x-=Y.x,this.y-=Y.y,this.z-=Y.z,this.w-=Y.w,this)},subScalar:function(J){return this.x-=J,this.y-=J,this.z-=J,this.w-=J,this},subVectors:function(P,x){return this.x=P.x-x.x,this.y=P.y-x.y,this.z=P.z-x.z,this.w=P.w-x.w,this},multiplyScalar:function(J){return this.x*=J,this.y*=J,this.z*=J,this.w*=J,this},applyMatrix4:function(x){var m=this.x,n=this.y,B=this.z,r=this.w,E=x.el;
return this.x=E[0]*m+E[4]*n+E[8]*B+E[12]*r,this.y=E[1]*m+E[5]*n+E[9]*B+E[13]*r,this.z=E[2]*m+E[6]*n+E[10]*B+E[14]*r,this.w=E[3]*m+E[7]*n+E[11]*B+E[15]*r,this},divideScalar:function(N){return this.multiplyScalar(1/N)},setAxisAngleFromQuaternion:function(f){this.w=2*Math.acos(f.w);var L=Math.sqrt(1-f.w*f.w);return 1e-4>L?(this.x=1,this.y=0,this.z=0):(this.x=f.x/L,this.y=f.y/L,this.z=f.z/L),this},setAxisAngleFromRotationMatrix:function(W){var c,a,G,I,y=.01,T=.1,U=W.el,O=U[0],p=U[4],u=U[8],f=U[1],A=U[5],e=U[9],d=U[2],x=U[6],R=U[10];if(Math.abs(p-f)<y&&Math.abs(u-d)<y&&Math.abs(e-x)<y){if(Math.abs(p+f)<T&&Math.abs(u+d)<T&&Math.abs(e+x)<T&&Math.abs(O+A+R-3)<T)return this.set(1,0,0,0),this;c=Math.PI;var o=(O+1)/2,P=(A+1)/2,n=(R+1)/2,S=(p+f)/4,L=(u+d)/4,M=(e+x)/4;return o>P&&o>n?y>o?(a=0,G=.707106781,I=.707106781):(a=Math.sqrt(o),G=S/a,I=L/a):P>n?y>P?(a=.707106781,G=0,I=.707106781):(G=Math.sqrt(P),a=S/G,I=M/G):y>n?(a=.707106781,G=.707106781,I=0):(I=Math.sqrt(n),a=L/I,G=M/I),this.set(a,G,I,c),this}var D=Math.sqrt((x-e)*(x-e)+(u-d)*(u-d)+(f-p)*(f-p));return Math.abs(D)<.001&&(D=1),this.x=(x-e)/D,this.y=(u-d)/D,this.z=(f-p)/D,this.w=Math.acos((O+A+R-1)/2),this},min:function(k){return this.x=Math.min(this.x,k.x),this.y=Math.min(this.y,k.y),this.z=Math.min(this.z,k.z),this.w=Math.min(this.w,k.w),this},max:function(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this.w=Math.max(this.w,r.w),this},clamp:function(T,c){return this.x=Math.max(T.x,Math.min(c.x,this.x)),this.y=Math.max(T.y,Math.min(c.y,this.y)),this.z=Math.max(T.z,Math.min(c.z,this.z)),this.w=Math.max(T.w,Math.min(c.w,this.w)),this},clampScalar:function(){var w,o;return function(s,J){return w===A&&(w=new Gh,o=new Gh),w.set(s,s,s,s),o.set(J,J,J,J),this.clamp(w,o)}}(),clampLength:function(S,p){var y=this.length();return this.divideScalar(y||1).multiplyScalar(Math.max(S,Math.min(p,y)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(J){return this.x*J.x+this.y*J.y+this.z*J.z+this.w*J.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(D){return this.normalize().multiplyScalar(D)},lerp:function(m,Z){return this.x+=(m.x-this.x)*Z,this.y+=(m.y-this.y)*Z,this.z+=(m.z-this.z)*Z,this.w+=(m.w-this.w)*Z,this},lerpVectors:function(H,d,W){return this.subVectors(d,H).multiplyScalar(W).add(H)},equals:function(n){return n.x===this.x&&n.y===this.y&&n.z===this.z&&n.w===this.w},fromArray:function(K,v){return v===A&&(v=0),this.x=K[v],this.y=K[v+1],this.z=K[v+2],this.w=K[v+3],this},toArray:function(u,l){return u===A&&(u=[]),l===A&&(l=0),u[l]=this.x,u[l+1]=this.y,u[l+2]=this.z,u[l+3]=this.w,u},fromBufferAttribute:function(H,R){return this.x=H.getX(R),this.y=H.getY(R),this.z=H.getZ(R),this.w=H.getW(R),this}});var ah=x.Math.Vector3=function(i,O,J){i===A?(this.x=0,this.y=0,this.z=0):"object"==typeof i?this.copy(i):this.set(i,O==A?i:O,J==A?i:J)},Ko=x.Math.Vector3;u.assign(ah.prototype,{isNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},set:function(K,B,n){return this.x=K,this.y=B,this.z=n,this},equals:function(E){return E&&this.x===E.x&&this.y===E.y&&this.z===E.z},setScalar:function(m){return this.x=m,this.y=m,this.z=m,this},setX:function(q){return this.x=q,this},setY:function(l){return this.y=l,this},setZ:function(B){return this.z=B,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(S){return S.x===A?(this.x=S[0],this.y=S[1],this.z=S[2]):(this.x=S.x,this.y=S.y,this.z=S.z||0),this},add:function(m){return this.x+=m.x,this.y+=m.y,this.z+=m.z,this},addScalar:function(w){return this.x+=w,this.y+=w,this.z+=w,this},addVectors:function(R,Y){return this.x=R.x+Y.x,this.y=R.y+Y.y,this.z=R.z+Y.z,this},addScaledVector:function(H,S){return this.x+=H.x*S,this.y+=H.y*S,this.z+=H.z*S,this},sub:function(x){return this.x-=x.x,this.y-=x.y,this.z-=x.z,this},subScalar:function(Q){return this.x-=Q,this.y-=Q,this.z-=Q,this},subVectors:function(C,V){return this.x=C.x-V.x,this.y=C.y-V.y,this.z=C.z-V.z,this},divide:function(n){return this.x/=n.x,this.y/=n.y,this.z/=n.z,this},multiply:function(V){return this.x*=V.x,this.y*=V.y,this.z*=V.z,this},multiplyScalar:function(K){return this.x*=K,this.y*=K,this.z*=K,this},divideScalar:function(J){if(0!==J){var b=1/J;this.x*=b,this.y*=b,this.z*=b}else this.x=0,this.y=0,this.z=0;return this},distanceTo:function(q){return Math.sqrt(this.distanceToSquared(q))},distanceToSquared:function(B){var X=this.x-B.x,L=this.y-B.y,R=this.z-B.z;return X*X+L*L+R*R},distanceToSquared2:function(L){var Y=this.x-L[0],m=this.y-L[1],O=this.z-L[2];return Y*Y+m*m+O*O},divideVectors:function(o,T){return this.x=o.x/T.x,this.y=o.y/T.y,this.z=o.z/T.z,this},multiplyVectors:function(P,w){return this.x=P.x*w.x,this.y=P.y*w.y,this.z=P.z*w.z,this},transformDirection:function(T){var h=this.x,V=this.y,L=this.z,o=T.el;return this.x=o[0]*h+o[4]*V+o[8]*L,this.y=o[1]*h+o[5]*V+o[9]*L,this.z=o[2]*h+o[6]*V+o[10]*L,this.normalize()},applyAxisAngle:function(){var k=new Qo;return function(p,i){return this.applyQuaternion(k.setFromAxisAngle(p,i))}}(),applyEuler:function(){var u=new Qo;return function(p){return this.applyQuaternion(u.setFromEuler(p))}}(),applyQuaternion:function(m){var K=this.x,S=this.y,Q=this.z,W=m._x,n=m._y,e=m._z,z=m._w,F=z*K+n*Q-e*S,t=z*S+e*K-W*Q,k=z*Q+W*S-n*K,D=-W*K-n*S-e*Q;return this.x=F*z+D*-W+t*-e-k*-n,this.y=t*z+D*-n+k*-W-F*-e,this.z=k*z+D*-e+F*-n-t*-W,this},applyMatrix4:function(C){var l=this.x,y=this.y,q=this.z,s=C.el,$=1/(s[3]*l+s[7]*y+s[11]*q+s[15]);return this.x=(s[0]*l+s[4]*y+s[8]*q+s[12])*$,this.y=(s[1]*l+s[5]*y+s[9]*q+s[13])*$,this.z=(s[2]*l+s[6]*y+s[10]*q+s[14])*$,this},applyMatrix3:function(m){var w=this.x,v=this.y,M=this.z,s=m.el;return this.x=s[0]*w+s[3]*v+s[6]*M,this.y=s[1]*w+s[4]*v+s[7]*M,this.z=s[2]*w+s[5]*v+s[8]*M,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},reflect:function(){var z=new ah;return function(E){return this.sub(z.copy(E).multiplyScalar(2*this.dot(E)))}}(),dot:function(U){return this.x*U.x+this.y*U.y+this.z*U.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var m=this.length();return m?this.multiplyScalar(1/m):this},setLength:function(N){return this.normalize().multiplyScalar(N)},fromArray:function(C,X){return X===A&&(X=0),this.x=C[X],this.y=C[X+1],this.z=C[X+2],this},toArray:function(H,u){return H===A&&(H=[0,0,0]),u===A&&(u=0),H[u]=this.x,H[u+1]=this.y,H[u+2]=this.z,H},cross:function(U){return this.crossVectors(this,U)},angleTo:function(s){var X=this.dot(s)/Math.sqrt(this.lengthSq()*s.lengthSq());return X>1||-1>X?0:Math.acos(X)},lerp:function(i,f){return this.x+=(i.x-this.x)*f,this.y+=(i.y-this.y)*f,this.z+=(i.z-this.z)*f,this},lerpVectors:function(U,y,Q){return this.subVectors(y,U).multiplyScalar(Q).add(U)},crossVectors:function(q,P){var Y=q.x,Z=q.y,D=q.z,h=P.x,B=P.y,S=P.z;return this.x=Z*S-D*B,this.y=D*h-Y*S,this.z=Y*B-Z*h,this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this},setFromMatrixPosition:function(D){return this.setFromMatrixColumn(D,3)},setFromMatrixScale:function(r){var f=this.setFromMatrixColumn(r,0).length(),R=this.setFromMatrixColumn(r,1).length(),p=this.setFromMatrixColumn(r,2).length();return this.x=f,this.y=R,this.z=p,this},setFromMatrixColumn:function(M,C){return this.fromArray(M.el,4*C)}}),ah.UP=new ah(0,1,0),ah.AxisX=new ah(1,0,0),ah.AxisY=new ah(0,1,0),ah.AxisZ=new ah(0,0,1),ah.normalizeArray=function(){var _=new ah;return function(s){return _.copy(s).normalize().toArray()}}();var sd=x.Math.Vector2=function(S,n,k){"object"==typeof S&&(S.x!=A?(n=S.y,k=S.e,S=S.x):(k=S[2],n=S[1],S=S[0])),this.set(S||0,n||0,k)};sd.prototype={},sd.prototype.constructor=sd;var Nj=sd;u.defineProperties(sd.prototype,{width:{get:function(){return this.x},set:function(T){this.x=T}},height:{get:function(){return this.y},set:function(V){this.y=V}}}),sd.prototype.clone=function(){return new sd(this.x,this.y,this.e)},sd.prototype.copy=function(J){return this.set(J.x,J.y,J.e),this},sd.prototype.equals=function(B){return B.x===this.x&&B.y===this.y&&B.e===this.e},sd.prototype.set=function(H,c,V){return this.x=H||0,this.y=c||(0!==c?this.x:0),V!=A&&(this.e=V),this},sd.prototype.setScalar=function(M){return this.x=M,this.y=M,this.e=M,this},sd.prototype.setX=function(K){return this.x=K||0,this},sd.prototype.setY=function(P){return this.y=P||0,this},sd.prototype.setE=function(R){return this.e=R||0,this},sd.prototype.add=function(R){return this.x+=R.x,this.y+=R.y,this},sd.prototype.addVectors=function(z,Z){return this.x=z.x+Z.x,this.y=z.y+Z.y,this},sd.prototype.addScalar=function(b){return this.x+=b,this.y+=b,this},sd.prototype.addScaledVector=function(Q,n){return this.x+=Q.x*n,this.y+=Q.y*n,this},sd.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},sd.prototype.subScalar=function(n){return this.x-=n,this.y-=n,this},sd.prototype.subVectors=function(V,C){return this.x=V.x-C.x,this.y=V.y-C.y,this},sd.prototype.multiply=function(y){return this.x*=y.x,this.y*=y.y,this},sd.prototype.multiplyScalar=function(m){return this.x*=m,this.y*=m,this},sd.prototype.divide=function(k){return this.x/=k.x,this.y/=k.y,this},sd.prototype.divideScalar=function(B){return this.multiplyScalar(1/B)},sd.prototype.min=function(G){return this.x=Math.min(this.x,G.x),this.y=Math.min(this.y,G.y),this},sd.prototype.max=function(x){return this.x=Math.max(this.x,x.x),this.y=Math.max(this.y,x.y),this},sd.prototype.fromArray=function(w,W){return W===A&&(W=0),this.x=w[W],this.y=w[W+1],this},sd.prototype.clamp=function(T,Z){return this.x=Math.max(T.x,Math.min(Z.x,this.x)),this.y=Math.max(T.y,Math.min(Z.y,this.y)),this},sd.prototype.clampScalar=function(){var n,m;return function(t,$){return n===A&&(n=new sd,m=new sd),n.set(t,t),m.set($,$),this.clamp(n,m)}}(),sd.prototype.clampLength=function(u,Z){var w=this.length();return this.multiplyScalar(Math.max(u,Math.min(Z,w))/w)},sd.prototype.dot=function(X){return this.x*X.x+this.y*X.y},sd.prototype.cross=function(M){return this.x*M.y-this.y*M.x},sd.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},sd.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},sd.prototype.normalize=function(){return this.divideScalar(this.length())},sd.prototype.angle=function(){var Z=Math.atan2(this.y,this.x);return 0>Z&&(Z+=2*Math.PI),Z},sd.prototype.distanceTo=function(v){return Math.sqrt(this.distanceToSquared(v))},sd.prototype.distanceToSquared=function(i){var M=this.x-i.x,a=this.y-i.y;return M*M+a*a},sd.prototype.isNearEnough=function(Y){return this.distanceToSquared(Y)<1e-8},sd.prototype.setLength=function(g){var A=this.length();return A?this.multiplyScalar(g/A):this},sd.prototype.lerp=function(H,u){return this.x+=(H.x-this.x)*u,this.y+=(H.y-this.y)*u,"number"==typeof H.e&&"number"==typeof this.e&&(this.e+=(H.e-this.e)*u),this},sd.prototype.lerpVectors=function(K,R,X){return this.subVectors(R,K).multiplyScalar(X).add(K)},sd.prototype.rotateAround=function(m,C){var L=m?m.x:0,E=m?m.y:0,S=Math.cos(C),g=Math.sin(C),w=this.x-L,h=this.y-E;return this.x=w*S-h*g+L,this.y=w*g+h*S+E,this};var Ke=x.Math.Matrix3=function(){this.el=[1,0,0,0,1,0,0,0,1]};u.assign(Ke.prototype,{isMatrix3:!0,set:function(q,R,s,v,o,Q,S,w,L){var O=this.el;return O[0]=q,O[1]=v,O[2]=S,O[3]=R,O[4]=o,O[5]=w,O[6]=s,O[7]=Q,O[8]=L,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.el)},copy:function(I){var Y=this.el,x=I.el;return Y[0]=x[0],Y[1]=x[1],Y[2]=x[2],Y[3]=x[3],Y[4]=x[4],Y[5]=x[5],Y[6]=x[6],Y[7]=x[7],Y[8]=x[8],this},setFromMatrix4:function(t){var U=t.el;return this.set(U[0],U[4],U[8],U[1],U[5],U[9],U[2],U[6],U[10]),this},applyToBufferAttribute:function(){var E=new ah;return function(q){for(var j=0,P=q.count;P>j;j++)E.x=q.getX(j),E.y=q.getY(j),E.z=q.getZ(j),E.applyMatrix3(this),q.setXYZ(j,E.x,E.y,E.z);return q}}(),multiply:function(j){return this.multiplyMatrices(this,j)},premultiply:function(l){return this.multiplyMatrices(l,this)},multiplyMatrices:function(A,T){var m=A.el,s=T.el,Z=this.el,w=m[0],D=m[3],t=m[6],c=m[1],L=m[4],E=m[7],h=m[2],a=m[5],y=m[8],x=s[0],_=s[3],H=s[6],p=s[1],V=s[4],K=s[7],i=s[2],M=s[5],n=s[8];return Z[0]=w*x+D*p+t*i,Z[3]=w*_+D*V+t*M,Z[6]=w*H+D*K+t*n,Z[1]=c*x+L*p+E*i,Z[4]=c*_+L*V+E*M,Z[7]=c*H+L*K+E*n,Z[2]=h*x+a*p+y*i,Z[5]=h*_+a*V+y*M,Z[8]=h*H+a*K+y*n,this},multiplyScalar:function(H){var z=this.el;return z[0]*=H,z[3]*=H,z[6]*=H,z[1]*=H,z[4]*=H,z[7]*=H,z[2]*=H,z[5]*=H,z[8]*=H,this},determinant:function(){var r=this.el,G=r[0],j=r[1],o=r[2],Y=r[3],K=r[4],n=r[5],t=r[6],s=r[7],R=r[8];return G*K*R-G*n*s-j*Y*R+j*n*t+o*Y*s-o*K*t},getInverse:function(V){var J=V.el,c=this.el,b=J[0],B=J[1],x=J[2],_=J[3],L=J[4],A=J[5],R=J[6],r=J[7],O=J[8],W=O*L-A*r,Q=A*R-O*_,Y=r*_-L*R,E=b*W+B*Q+x*Y;if(0===E)return this.identity();var C=1/E;return c[0]=W*C,c[1]=(x*r-O*B)*C,c[2]=(A*B-x*L)*C,c[3]=Q*C,c[4]=(O*b-x*R)*C,c[5]=(x*_-A*b)*C,c[6]=Y*C,c[7]=(B*R-r*b)*C,c[8]=(L*b-B*_)*C,this},transpose:function(){var $,s=this.el;return $=s[1],s[1]=s[3],s[3]=$,$=s[2],s[2]=s[6],s[6]=$,$=s[5],s[5]=s[7],s[7]=$,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(a){var T=this.el;return a[0]=T[0],a[1]=T[3],a[2]=T[6],a[3]=T[1],a[4]=T[4],a[5]=T[7],a[6]=T[2],a[7]=T[5],a[8]=T[8],this},setUvTransform:function(z,N,I,v,f,m,A){var G=Math.cos(f),i=Math.sin(f);this.set(I*G,I*i,-I*(G*m+i*A)+m+z,-v*i,v*G,-v*(-i*m+G*A)+A+N,0,0,1)},scale:function(W,l){var o=this.el;return o[0]*=W,o[3]*=W,o[6]*=W,o[1]*=l,o[4]*=l,o[7]*=l,this},rotate:function(E){var x=Math.cos(E),W=Math.sin(E),h=this.el,j=h[0],Q=h[3],G=h[6],m=h[1],b=h[4],u=h[7];return h[0]=x*j+W*m,h[3]=x*Q+W*b,h[6]=x*G+W*u,h[1]=-W*j+x*m,h[4]=-W*Q+x*b,h[7]=-W*G+x*u,this},translate:function(j,A){var L=this.el;return L[0]+=j*L[2],L[3]+=j*L[5],L[6]+=j*L[8],L[1]+=A*L[2],L[4]+=A*L[5],L[7]+=A*L[8],this},equals:function(A){for(var q=this.el,t=A.el,d=0;9>d;d++)if(q[d]!==t[d])return!1;return!0},fromArray:function(M,Y){Y===A&&(Y=0);for(var H=0;9>H;H++)this.el[H]=M[H+Y];return this},toArray:function(C,o){C===A&&(C=[]),o===A&&(o=0);var W=this.el;return C[o]=W[0],C[o+1]=W[1],C[o+2]=W[2],C[o+3]=W[3],C[o+4]=W[4],C[o+5]=W[5],C[o+6]=W[6],C[o+7]=W[7],C[o+8]=W[8],C}});var Pp=x.Math.Plane=function(e,n){this.normal=e!==A?e:new ah(1,0,0),this.constant=n!==A?n:0};u.assign(Pp.prototype,{set:function(O,c){return this.normal.copy(O),this.constant=c,this},setComponents:function(G,C,g,u){return this.normal.set(G,C,g),this.constant=u,this},setFromNormalAndCoplanarPoint:function(L,k){return this.normal.copy(L),this.constant=-k.dot(this.normal),this},setFromCoplanarPoints:function(){var n=new ah,L=new ah;return function(T,j,A){var F=n.subVectors(A,j).cross(L.subVectors(T,j)).normalize();return this.setFromNormalAndCoplanarPoint(F,T),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(d){return this.normal.copy(d.normal),this.constant=d.constant,this},normalize:function(){var R=1/this.normal.length();return this.normal.multiplyScalar(R),this.constant*=R,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(h){return this.normal.dot(h)+this.constant},distanceToSphere:function(A){return this.distanceToPoint(A.center)-A.radius},projectPoint:function(R,W){return W===A&&(W=new ah),W.copy(this.normal).multiplyScalar(-this.distanceToPoint(R)).add(R)},intersectLine:function(){var i=new ah;return function(k,b){b===A&&(b=new ah);var h=k.delta(i),p=this.normal.dot(h);if(0===p)return 0===this.distanceToPoint(k.start)?b.copy(k.start):A;var P=-(k.start.dot(this.normal)+this.constant)/p;return 0>P||P>1?A:b.copy(h).multiplyScalar(P).add(k.start)}}(),intersectsLine:function(n){var C=this.distanceToPoint(n.start),E=this.distanceToPoint(n.end);return 0>C&&E>0||0>E&&C>0},intersectsBox:function(n){return n.intersectsPlane(this)},intersectsSphere:function(c){return c.intersectsPlane(this)},coplanarPoint:function(c){return c===A&&(c=new ah),c.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var D=new ah,L=new Ke;return function(b,e){var y=e||L.getNormalMatrix(b),X=this.coplanarPoint(D).applyMatrix4(b),u=this.normal.applyMatrix3(y).normalize();return this.constant=-X.dot(u),this}}(),translate:function(H){return this.constant-=H.dot(this.normal),this},equals:function(j){return j.normal.equals(this.normal)&&j.constant===this.constant}});var zs=x.Math.Ray=function(P,e){this.origin=P!==A?P.clone():new ah,this.direction=e!==A?e.clone():new ah};u.assign(zs.prototype,{set:function(M,q){return this.origin.copy(M),this.direction.copy(q),this},clone:function(){return(new this.constructor).copy(this)},copy:function(R){return this.origin.copy(R.origin),this.direction.copy(R.direction),this.maxHitLen=R.maxHitLen,this},at:function(p,y){var W=y||new ah;return W.copy(this.direction).multiplyScalar(p).add(this.origin)},setMaxHitLength:function(d){this.maxHitLen=d},lookAt:function(G){return this.direction.copy(G).sub(this.origin).normalize(),this},applyMatrix4:function(B){var V=this.maxHitLen;if(V){var S=this.direction.clone().multiplyScalar(V).add(this.origin);S.applyMatrix4(B)}return this.origin.applyMatrix4(B),this.direction.transformDirection(B),V&&(this.maxHitLen=this.origin.distanceTo(S)),this},distanceToPlane:function(Q){var r=Q.normal.dot(this.direction);if(0===r)return 0===Q.distanceToPoint(this.origin)?0:null;var L=-(this.origin.dot(Q.normal)+Q.constant)/r;return L>=0?L:null},intersectPlane:function(Z,i){var Y=this.distanceToPlane(Z);return null===Y?null:this.at(Y,i)},intersectSphere:function(){var M=new ah;return function(H,j){M.subVectors(H.center,this.origin);var K=M.dot(this.direction),D=M.dot(M)-K*K,A=H.radius*H.radius;if(D>A)return null;var p=Math.sqrt(A-D),C=K-p,i=K+p;return 0>C&&0>i?null:0>C?this.at(i,j):this.at(C,j)}}(),intersectEllipsoid:function(){var v=new ah,p=new ah;return function(z,R){v.subVectors(z.center,this.origin),v.divide(z.radius),p.divideVectors(this.direction,z.radius);var T=p.lengthSq(),M=v.dot(p),G=v.dot(v)*T-M*M;if(G>T)return null;var J=Math.sqrt(T-G),e=(M-J)/T,t=(M+J)/T;return 0>e&&0>t?null:0>e?this.at(t,R):this.at(e,R)}}(),intersectBox:function(z,H){var p,t,F,A,y,a,O=1/this.direction.x,m=1/this.direction.y,l=1/this.direction.z,Z=this.origin;if(O>=0?(p=(z.min.x-Z.x)*O,t=(z.max.x-Z.x)*O):(p=(z.max.x-Z.x)*O,t=(z.min.x-Z.x)*O),m>=0?(F=(z.min.y-Z.y)*m,A=(z.max.y-Z.y)*m):(F=(z.max.y-Z.y)*m,A=(z.min.y-Z.y)*m),p>A||F>t)return null;if((F>p||p!==p)&&(p=F),(t>A||t!==t)&&(t=A),l>=0?(y=(z.min.z-Z.z)*l,a=(z.max.z-Z.z)*l):(y=(z.max.z-Z.z)*l,a=(z.min.z-Z.z)*l),p>a||y>t)return null;if((y>p||p!==p)&&(p=y),(t>a||t!==t)&&(t=a),0>t)return null;var C=p>=0?p:t,b=this.maxHitLen;return b&&C>b?null:this.at(C,H)},intersectTriangle:function(){var r=new ah,t=new ah,P=new ah,y=new ah;return function(c,Z,F,h,G){t.subVectors(Z,c),P.subVectors(F,c),y.crossVectors(t,P);var j,J=this.direction.dot(y);if(J>0){if(h)return null;j=1}else{if(!(0>J))return null;j=-1,J=-J}r.subVectors(this.origin,c);var T=j*this.direction.dot(P.crossVectors(r,P));if(0>T)return null;var O=j*this.direction.dot(t.cross(r));if(0>O||T+O>J)return null;var K=-j*r.dot(y);if(0>K)return null;var m=K/J,C=this.maxHitLen;return C&&m>C?null:this.at(m,G)}}()});var hl=x.Math.Box3=function(b,w){this.min=b!==A?b:new ah(1/0,1/0,1/0),this.max=w!==A?w:new ah(-1/0,-1/0,-1/0)};u.assign(hl.prototype,{set:function(y,j){return this.min.copy(y),this.max.copy(j),this},setFromArray:function(x){for(var n=1/0,d=1/0,M=1/0,E=-1/0,z=-1/0,q=-1/0,R=0,o=x.length;o>R;R+=3){var V=x[R],y=x[R+1],p=x[R+2];n>V&&(n=V),d>y&&(d=y),M>p&&(M=p),V>E&&(E=V),y>z&&(z=y),p>q&&(q=p)}return this.min.set(n,d,M),this.max.set(E,z,q),this},setFromPoints:function(E){this.makeEmpty();for(var a=0,m=E.length;m>a;a++)this.expandByPoint(E[a]);return this},clone:function(){return(new this.constructor).copy(this)},intersectsBox:function(G){return G.max.x<this.min.x||G.min.x>this.max.x||G.max.y<this.min.y||G.min.y>this.max.y||G.max.z<this.min.z||G.min.z>this.max.z?!1:!0},copy:function(R){return this.min.copy(R.min),this.max.copy(R.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(R){return this.min.min(R),this.max.max(R),this},expandByBox:function(B){return this.min.min(B.min),this.max.max(B.max),this},applyMatrix4:function(){var x=[new ah,new ah,new ah,new ah,new ah,new ah,new ah,new ah];return function(w){return this.isEmpty()?this:(x[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(w),x[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(w),x[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(w),x[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(w),x[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(w),x[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(w),x[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(w),x[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(w),this.setFromPoints(x),this)}}()});var ib=x.Math.Sphere=function(N,Y){this.center=N!==A?N:new ah,this.radius=Y!==A?Y:0};u.assign(ib.prototype,{set:function(c,m){return this.center.copy(c),this.radius=m,this},setFromPoints:function(){var G=new hl;return function(h,F){var D=this.center;F!==A?D.copy(F):G.setFromPoints(h).getCenter(D);for(var J=0,Y=0,b=h.length;b>Y;Y++)J=Math.max(J,D.distanceToSquared(h[Y]));return this.radius=Math.sqrt(J),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(J){return this.center.copy(J.center),this.radius=J.radius,this},empty:function(){return this.radius<=0},containsPoint:function(n){return n.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(F){return F.distanceTo(this.center)-this.radius},intersectsSphere:function($){var o=this.radius+$.radius;return $.center.distanceToSquared(this.center)<=o*o},intersectsBox:function(n){return n.intersectsSphere(this)},intersectsPlane:function(y){return Math.abs(y.distanceToPoint(this.center))<=this.radius},clampPoint:function(l,j){var d=this.center.distanceToSquared(l);return j===A&&(j=new ah),j.copy(l),d>this.radius*this.radius&&(j.sub(this.center).normalize(),j.multiplyScalar(this.radius).add(this.center)),j},getBoundingBox:function(D){return D===A&&(D=new hl),D.set(this.center,this.center),D.expandByScalar(this.radius),D},applyMatrix4:function(j){return this.center.applyMatrix4(j),this.radius=this.radius*j.getMaxScaleOnAxis(),this},translate:function(g){return this.center.add(g),this},equals:function(b){return b.center.equals(this.center)&&b.radius===this.radius}});var dg=x.Math.Frustum=function(S,q,j,T,p,G){this.planes=[S!==A?S:new Pp,q!==A?q:new Pp,j!==A?j:new Pp,T!==A?T:new Pp,p!==A?p:new Pp,G!==A?G:new Pp]};u.assign(dg.prototype,{set:function(r,w,z,L,C,N){var o=this.planes;return o[0].copy(r),o[1].copy(w),o[2].copy(z),o[3].copy(L),o[4].copy(C),o[5].copy(N),this},clone:function(){return(new this.constructor).copy(this)},copy:function(o){for(var P=this.planes,e=0;6>e;e++)P[e].copy(o.planes[e]);return this},setFromMatrix:function(B){var W=this.planes,o=B.el,R=o[0],i=o[1],K=o[2],b=o[3],L=o[4],N=o[5],E=o[6],O=o[7],U=o[8],w=o[9],y=o[10],C=o[11],H=o[12],t=o[13],I=o[14],_=o[15];return W[0].setComponents(b-R,O-L,C-U,_-H).normalize(),W[1].setComponents(b+R,O+L,C+U,_+H).normalize(),W[2].setComponents(b+i,O+N,C+w,_+t).normalize(),W[3].setComponents(b-i,O-N,C-w,_-t).normalize(),W[4].setComponents(b-K,O-E,C-y,_-I).normalize(),W[5].setComponents(b+K,O+E,C+y,_+I).normalize(),this},intersectsObject:function(){var k=new ib;return function(r){var w=r.geometry;return null===w.boundingSphere&&w.computeBoundingSphere(),k.copy(w.boundingSphere).applyMatrix4(r.matrixWorld),this.intersectsSphere(k)}}(),intersectsSprite:function(){var Z=new ib;return function(V){return Z.center.set(0,0,0),Z.radius=.7071067811865476,Z.applyMatrix4(V.matrixWorld),this.intersectsSphere(Z)}}(),intersectsSphere:function(S){for(var R=this.planes,j=S.center,K=-S.radius,A=0;6>A;A++){var o=R[A].distanceToPoint(j);if(K>o)return!1}return!0},intersectsBox:function(){var Q=new ah;return function(I){for(var Z=this.planes,L=0;6>L;L++){var K=Z[L];if(Q.x=K.normal.x>0?I.max.x:I.min.x,Q.y=K.normal.y>0?I.max.y:I.min.y,Q.z=K.normal.z>0?I.max.z:I.min.z,K.distanceToPoint(Q)<0)return!1}return!0}}(),containsPoint:function(F){for(var s=this.planes,R=0;6>R;R++)if(s[R].distanceToPoint(F)<0)return!1;return!0}});var We=x.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};u.assign(We.prototype,{isMatrix4:!0,set:function(P,G,n,i,y,Q,N,J,T,t,v,x,u,q,W,F){var X=this.el;return X[0]=P,X[4]=G,X[8]=n,X[12]=i,X[1]=y,X[5]=Q,X[9]=N,X[13]=J,X[2]=T,X[6]=t,X[10]=v,X[14]=x,X[3]=u,X[7]=q,X[11]=W,X[15]=F,this},clone:function(){return(new We).fromArray(this.el)},fromArray:function(w,g){g===A&&(g=0);for(var $=this.el,T=0;16>T;T++)$[T]=w[T+g];return this},getElements:function(){return this.el},scale:function(k){var q=this.el,e=k.x,h=k.y,y=k.z;return q[0]*=e,q[4]*=h,q[8]*=y,q[1]*=e,q[5]*=h,q[9]*=y,q[2]*=e,q[6]*=h,q[10]*=y,q[3]*=e,q[7]*=h,q[11]*=y,this},translate:function(D){var H=this.el,A=D.x||0,f=D.y||0,J=D.z||0;return H[12]+=H[0]*A+H[4]*f+H[8]*J,H[13]+=H[1]*A+H[5]*f+H[9]*J,H[14]+=H[2]*A+H[6]*f+H[10]*J,H[15]+=H[3]*A+H[7]*f+H[11]*J,this},makeRotationFromEuler:function(R){var a=this.el,j=R._x,K=R._y,F=R._z,W=R._order,d=Math.cos(j),i=Math.sin(j),g=Math.cos(K),A=Math.sin(K),w=Math.cos(F),S=Math.sin(F);if("XYZ"===W){var u=d*w,Z=d*S,P=i*w,n=i*S;a[0]=g*w,a[4]=-g*S,a[8]=A,a[1]=Z+P*A,a[5]=u-n*A,a[9]=-i*g,a[2]=n-u*A,a[6]=P+Z*A,a[10]=d*g}else if("YXZ"===W){var t=g*w,X=g*S,s=A*w,h=A*S;a[0]=t+h*i,a[4]=s*i-X,a[8]=d*A,a[1]=d*S,a[5]=d*w,a[9]=-i,a[2]=X*i-s,a[6]=h+t*i,a[10]=d*g}else if("ZXY"===W){var t=g*w,X=g*S,s=A*w,h=A*S;a[0]=t-h*i,a[4]=-d*S,a[8]=s+X*i,a[1]=X+s*i,a[5]=d*w,a[9]=h-t*i,a[2]=-d*A,a[6]=i,a[10]=d*g}else if("ZYX"===W){var u=d*w,Z=d*S,P=i*w,n=i*S;a[0]=g*w,a[4]=P*A-Z,a[8]=u*A+n,a[1]=g*S,a[5]=n*A+u,a[9]=Z*A-P,a[2]=-A,a[6]=i*g,a[10]=d*g}else if("YZX"===W){var C=d*g,U=d*A,p=i*g,Q=i*A;a[0]=g*w,a[4]=Q-C*S,a[8]=p*S+U,a[1]=S,a[5]=d*w,a[9]=-i*w,a[2]=-A*w,a[6]=U*S+p,a[10]=C-Q*S}else if("XZY"===W){var C=d*g,U=d*A,p=i*g,Q=i*A;a[0]=g*w,a[4]=-S,a[8]=A*w,a[1]=C*S+Q,a[5]=d*w,a[9]=U*S-p,a[2]=p*S-U,a[6]=i*w,a[10]=Q*S+C}return a[3]=0,a[7]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this},makeRotationFromQuaternion:function(S){var y=this.el,B=S._x,Y=S._y,q=S._z,l=S._w,A=B+B,s=Y+Y,f=q+q,d=B*A,k=B*s,p=B*f,G=Y*s,$=Y*f,N=q*f,c=l*A,u=l*s,z=l*f;return y[0]=1-(G+N),y[4]=k-z,y[8]=p+u,y[1]=k+z,y[5]=1-(d+N),y[9]=$-c,y[2]=p-u,y[6]=$+c,y[10]=1-(d+G),y[3]=0,y[7]=0,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(j){var U=this.el,H=j.el,q=H[0],m=H[1],Q=H[2],t=H[3],c=H[4],K=H[5],G=H[6],i=H[7],N=H[8],r=H[9],w=H[10],D=H[11],W=H[12],e=H[13],Z=H[14],O=H[15],f=r*Z*i-e*w*i+e*G*D-K*Z*D-r*G*O+K*w*O,I=W*w*i-N*Z*i-W*G*D+c*Z*D+N*G*O-c*w*O,y=N*e*i-W*r*i+W*K*D-c*e*D-N*K*O+c*r*O,b=W*r*G-N*e*G-W*K*w+c*e*w+N*K*Z-c*r*Z,x=q*f+m*I+Q*y+t*b;if(0===x)return this.identity();var d=1/x;return U[0]=f*d,U[1]=(e*w*t-r*Z*t-e*Q*D+m*Z*D+r*Q*O-m*w*O)*d,U[2]=(K*Z*t-e*G*t+e*Q*i-m*Z*i-K*Q*O+m*G*O)*d,U[3]=(r*G*t-K*w*t-r*Q*i+m*w*i+K*Q*D-m*G*D)*d,U[4]=I*d,U[5]=(N*Z*t-W*w*t+W*Q*D-q*Z*D-N*Q*O+q*w*O)*d,U[6]=(W*G*t-c*Z*t-W*Q*i+q*Z*i+c*Q*O-q*G*O)*d,U[7]=(c*w*t-N*G*t+N*Q*i-q*w*i-c*Q*D+q*G*D)*d,U[8]=y*d,U[9]=(W*r*t-N*e*t-W*m*D+q*e*D+N*m*O-q*r*O)*d,U[10]=(c*e*t-W*K*t+W*m*i-q*e*i-c*m*O+q*K*O)*d,U[11]=(N*K*t-c*r*t-N*m*i+q*r*i+c*m*D-q*K*D)*d,U[12]=b*d,U[13]=(N*e*Q-W*r*Q+W*m*w-q*e*w-N*m*Z+q*r*Z)*d,U[14]=(W*K*Q-c*e*Q-W*m*G+q*e*G+c*m*Z-q*K*Z)*d,U[15]=(c*r*Q-N*K*Q+N*m*G-q*r*G-c*m*w+q*K*w)*d,this},invert:function(){return this.getInverse(this)},makeRotationAxis:function(h,B){var I=Math.cos(B),$=Math.sin(B),u=1-I,l=h.x,c=h.y,v=h.z,U=u*l,b=u*c;return this.set(U*l+I,U*c-$*v,U*v+$*c,0,U*c+$*v,b*c+I,b*v-$*l,0,U*v-$*c,b*v+$*l,u*v*v+I,0,0,0,0,1),this},multiply:function(M){return this.multiplyMatrices(this,M)},premultiply:function(p){return this.multiplyMatrices(p,this)},multiplyMatrices:function(x,a){var h=x.el,q=a.el,n=this.el,r=h[0],k=h[4],M=h[8],g=h[12],o=h[1],H=h[5],R=h[9],J=h[13],l=h[2],Q=h[6],m=h[10],t=h[14],e=h[3],j=h[7],U=h[11],D=h[15],G=q[0],$=q[4],W=q[8],S=q[12],s=q[1],X=q[5],T=q[9],y=q[13],_=q[2],B=q[6],P=q[10],L=q[14],E=q[3],Z=q[7],Y=q[11],i=q[15];return n[0]=r*G+k*s+M*_+g*E,n[4]=r*$+k*X+M*B+g*Z,n[8]=r*W+k*T+M*P+g*Y,n[12]=r*S+k*y+M*L+g*i,n[1]=o*G+H*s+R*_+J*E,n[5]=o*$+H*X+R*B+J*Z,n[9]=o*W+H*T+R*P+J*Y,n[13]=o*S+H*y+R*L+J*i,n[2]=l*G+Q*s+m*_+t*E,n[6]=l*$+Q*X+m*B+t*Z,n[10]=l*W+Q*T+m*P+t*Y,n[14]=l*S+Q*y+m*L+t*i,n[3]=e*G+j*s+U*_+D*E,n[7]=e*$+j*X+U*B+D*Z,n[11]=e*W+j*T+U*P+D*Y,n[15]=e*S+j*y+U*L+D*i,this},lookAt:function(){var c=new ah;return function(l,H,A){return c.subVectors(l,H),this.lookAtDirection(c,A)}}(),lookAtDirection:function(){var J=new ah,T=new ah,Z=new ah;return function(d,l){l||(l=ah.UP);var r=this.el;return Z.copy(d),0===Z.lengthSq()&&(Z.z=1),Z.normalize(),J.crossVectors(l,Z),0===J.lengthSq()&&(1===Math.abs(l.z)?Z.x+=1e-4:Z.z+=1e-4,Z.normalize(),J.crossVectors(l,Z)),J.normalize(),T.crossVectors(Z,J),r[0]=J.x,r[4]=T.x,r[8]=Z.x,r[1]=J.y,r[5]=T.y,r[9]=Z.y,r[2]=J.z,r[6]=T.z,r[10]=Z.z,this}}(),extractScale:function(){var z;return function(q){z===A&&(z=new ah),q===A&&(q=new ah);var V=z.setFromMatrixColumn(this,0).length(),u=z.setFromMatrixColumn(this,1).length(),c=z.setFromMatrixColumn(this,2).length();return q.set(V,u,c),q}}(),extractRotation:function(){var k;return function(u){k===A&&(k=new ah),u===A&&(u=new We);var P=this.el,x=u.el,z=1/k.setFromMatrixColumn(u,0).length(),Q=1/k.setFromMatrixColumn(u,1).length(),E=1/k.setFromMatrixColumn(u,2).length();return P[0]=x[0]*z,P[1]=x[1]*z,P[2]=x[2]*z,P[4]=x[4]*Q,P[5]=x[5]*Q,P[6]=x[6]*Q,P[8]=x[8]*E,P[9]=x[9]*E,P[10]=x[10]*E,this}}(),multiplyScalar:function(k){var l=this.el;return l[0]*=k,l[4]*=k,l[8]*=k,l[12]*=k,l[1]*=k,l[5]*=k,l[9]*=k,l[13]*=k,l[2]*=k,l[6]*=k,l[10]*=k,l[14]*=k,l[3]*=k,l[7]*=k,l[11]*=k,l[15]*=k,this},getPosition:function(T){return T===A&&(T=new ah),T.setFromMatrixColumn(this,3)},setPosition:function(b){var G=this.el;return G[12]=b.x,G[13]=b.y,G[14]=b.z,this},copyPosition:function(T){var L=this.el,H=T.el;return L[12]=H[12],L[13]=H[13],L[14]=H[14],this},toArray:function(X,g){X===A&&(X=[]),g===A&&(g=0);var H=this.el;return X[g]=H[0],X[g+1]=H[1],X[g+2]=H[2],X[g+3]=H[3],X[g+4]=H[4],X[g+5]=H[5],X[g+6]=H[6],X[g+7]=H[7],X[g+8]=H[8],X[g+9]=H[9],X[g+10]=H[10],X[g+11]=H[11],X[g+12]=H[12],X[g+13]=H[13],X[g+14]=H[14],X[g+15]=H[15],X},determinant:function(){var $=this.el,q=$[0],f=$[4],Z=$[8],K=$[12],r=$[1],y=$[5],W=$[9],T=$[13],h=$[2],w=$[6],t=$[10],F=$[14],k=$[3],X=$[7],U=$[11],z=$[15];
return k*(+K*W*w-Z*T*w-K*y*t+f*T*t+Z*y*F-f*W*F)+X*(+q*W*F-q*T*t+K*r*t-Z*r*F+Z*T*h-K*W*h)+U*(+q*T*w-q*y*F-K*r*w+f*r*F+K*y*h-f*T*h)+z*(-Z*y*h-q*W*w+q*y*t+Z*r*w-f*r*t+f*W*h)},copy:function(y){var L=this.el,j=y.el;return L[0]=j[0],L[1]=j[1],L[2]=j[2],L[3]=j[3],L[4]=j[4],L[5]=j[5],L[6]=j[6],L[7]=j[7],L[8]=j[8],L[9]=j[9],L[10]=j[10],L[11]=j[11],L[12]=j[12],L[13]=j[13],L[14]=j[14],L[15]=j[15],this},compose:function(I,F,S){var s=this.el,O=F._x,u=F._y,x=F._z,w=F._w,Y=O+O,P=u+u,y=x+x,M=O*Y,f=O*P,$=O*y,V=u*P,c=u*y,n=x*y,_=w*Y,U=w*P,h=w*y,D=S.x,z=S.y,p=S.z;return s[0]=(1-(V+n))*D,s[1]=(f+h)*D,s[2]=($-U)*D,s[3]=0,s[4]=(f-h)*z,s[5]=(1-(M+n))*z,s[6]=(c+_)*z,s[7]=0,s[8]=($+U)*p,s[9]=(c-_)*p,s[10]=(1-(M+V))*p,s[11]=0,s[12]=I.x,s[13]=I.y,s[14]=I.z,s[15]=1,this},decompose:function(){var K=new ah,q=new We;return function(I,$,_){var V=this.el,o=K.set(V[0],V[1],V[2]).length(),J=K.set(V[4],V[5],V[6]).length(),A=K.set(V[8],V[9],V[10]).length(),k=this.determinant();0>k&&(o=-o),I.x=V[12],I.y=V[13],I.z=V[14],q.copy(this);var G=1/o,S=1/J,Y=1/A;return q.el[0]*=G,q.el[1]*=G,q.el[2]*=G,q.el[4]*=S,q.el[5]*=S,q.el[6]*=S,q.el[8]*=Y,q.el[9]*=Y,q.el[10]*=Y,$.setFromRotationMatrix(q),_.x=o,_.y=J,_.z=A,this}}(),equals:function(c){for(var V=this.el,z=c.el,u=0;16>u;u++)if(V[u]!==z[u])return!1;return!0}}),new We,new We;var Fc=x.Math.Triangle=function(n,H,I){this.a=n!==A?n:new ah,this.b=H!==A?H:new ah,this.c=I!==A?I:new ah};u.assign(Fc,{barycoordFromPoint:function(){var h=new ah,a=new ah,J=new ah;return function(K,$,i,M,j){h.subVectors(M,$),a.subVectors(i,$),J.subVectors(K,$);var D=h.dot(h),m=h.dot(a),u=h.dot(J),B=a.dot(a),C=a.dot(J),t=D*B-m*m,f=j||new ah;if(0===t)return f.set(-2,-1,-1);var N=1/t,T=(B*u-m*C)*N,w=(D*C-m*u)*N;return f.set(1-T-w,w,T)}}(),uvIntersection:function(){var F=new ah;return function(r,d,m,B,o,J,C){return Fc.barycoordFromPoint(r,d,m,B,F),o.multiplyScalar(F.x),J.multiplyScalar(F.y),C.multiplyScalar(F.z),o.add(J).add(C),o.clone()}}()});var nm=x.Math.Euler=function(c,m,e,q,d){this.set(c,m,e,q,d)};nm.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],nm.DefaultOrder="XYZ",nm.ReverseOrder=function(){var V={xyz:"ZYX",xzy:"YZX",yxz:"ZXY",yzx:"XZY",zxy:"YXZ",zyx:"XYZ"};return function(D){return V[D]}}(),u.defineProperties(nm.prototype,{x:{get:function(){return this._x},set:function(z){this._x=z,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(P){this._y=P,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(E){this._z=E,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(y){this._order=y,this.onChangeCallback()}}}),u.assign(nm.prototype,{set:function($,p,D,Q,c){return bj($)&&(c=D,Q=p,D=$[2],p=$[1],$=$[0]),Q?c&&(Q=nm.ReverseOrder(Q)):Q="ZYX",this._x=$||0,this._y=p||0,this._z=D||0,this._order=Q||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(y){return this._x=y._x,this._y=y._y,this._z=y._z,this._order=y._order,this.onChangeCallback(),this},setFromRotationMatrix:function(y,r,A){var Z=x.Math.clamp,S=y.el||y,m=S[0],q=S[4],N=S[8],g=S[1],B=S[5],M=S[9],o=S[2],h=S[6],E=S[10];return r=r||this._order,"XYZ"===r?(this._y=Math.asin(Z(N,-1,1)),Math.abs(N)<.99999?(this._x=Math.atan2(-M,E),this._z=Math.atan2(-q,m)):(this._x=Math.atan2(h,B),this._z=0)):"YXZ"===r?(this._x=Math.asin(-Z(M,-1,1)),Math.abs(M)<.99999?(this._y=Math.atan2(N,E),this._z=Math.atan2(g,B)):(this._y=Math.atan2(-o,m),this._z=0)):"ZXY"===r?(this._x=Math.asin(Z(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(-o,E),this._z=Math.atan2(-q,B)):(this._y=0,this._z=Math.atan2(g,m))):"ZYX"===r?(this._y=Math.asin(-Z(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(h,E),this._z=Math.atan2(g,m)):(this._x=0,this._z=Math.atan2(-q,B))):"YZX"===r?(this._z=Math.asin(Z(g,-1,1)),Math.abs(g)<.99999?(this._x=Math.atan2(-M,B),this._y=Math.atan2(-o,m)):(this._x=0,this._y=Math.atan2(N,E))):"XZY"===r?(this._z=Math.asin(-Z(q,-1,1)),Math.abs(q)<.99999?(this._x=Math.atan2(h,B),this._y=Math.atan2(N,m)):(this._x=Math.atan2(-M,E),this._y=0)):console.warn("unsupported order: "+r),this._order=r,A!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var k=new We;return function(o,V,l){return k.makeRotationFromQuaternion(o),this.setFromRotationMatrix(k,V,l)}}(),setFromVector3:function(U,f){return this.set(U.x,U.y,U.z,f||this._order)},reorder:function(){var S=new Qo;return function(U){return S.setFromEuler(this),this.setFromQuaternion(S,U)}}(),equals:function(E){return E._x===this._x&&E._y===this._y&&E._z===this._z&&E._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==A&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(O,W){return O===A&&(O=[]),W===A&&(W=0),O[W]=this._x,O[W+1]=this._y,O[W+2]=this._z,O[W+3]=this._order,O},toVector3:function(f){return f?f.set(this._x,this._y,this._z):new ah(this._x,this._y,this._z)},onChange:function(N){return this.onChangeCallback=N,this},onChangeCallback:function(){}});var Mp={ms_ac:function(A,h){for(var s=h.ms_ac,Q=0;Q<s.length;Q++)yf(A,s[Q])},ms_listener:function($){$.addListeners=function(){var o=this,X=lb;M.mockTouch&&(X=og.concat(kq).concat(Rp)),o.__events__=X;for(var i=0,J=X.length;J>i;i++){var c=X[i];"wheel"===c&&!o.handle_wheel&&o.handle_mousewheel&&(o.handle_wheel=function(C){Ab(o,C)}),o["handle_"+c]&&Bl(c,o.getView(),o)}},$.removeListeners=function(){var h=this,J=h.__events__;if(J){h.__events__=A;for(var i=0,d=J.length;d>i;i++)h["handle_"+J[i]]&&js(J[i],h.getView(),h)}}},ms_fire:function(m){m.mp=function(t,p,b){this.addPropertyChangeListener(t,p,b)},m.ump=function(r,U){this.removePropertyChangeListener(r,U)},m.fp=function(Q,I,i,U,l){return this.firePropertyChange(Q,I,i,U,l)},m.addPropertyChangeListener=function(K,b,Z){var y=this;y._62I||(y._62I=new Ee),y._62I.add(K,b,Z)},m.removePropertyChangeListener=function(p,k){this._62I&&this._62I.remove(p,k)},m.firePropertyChange=function(p,R,S,i,k){if(i){if(i(R,S))return!1}else if(R===S)return!1;var q=this,P=k||{};return P.property=p,P.oldValue=R,P.newValue=S,P.source=q,P.data=q,q._62I&&q._62I.fire(P),q.onPropertyChanged&&q.onPropertyChanged(P),!0}},ms_attr:function(G){G.a=function(v,P){var I=this;if(2===arguments.length)I.setAttr(v,P);else{if(!fg(v))return I.getAttr(v);for(var W in v)I.setAttr(W,v[W])}return I},G.getAttr=function(F,h){if(h===A&&(h=1),this._attrObject&&F in this._attrObject)return this._attrObject[F];if(this.getImage){var P=this.getImage();if(ro(P)&&(P=zl[P]),fg(P)&&"dataBindings"in P)for(var E=P.dataBindings,w=E.length-1;w>=0;w--){var n=E[w];if(n.attr===F){if("defaultValue"in n)return n.defaultValue;break}}}return h?B[F]:A},G.setAttr=function(X,y){var r=this;r._attrObject||(r._attrObject={});var C=r._attrObject[X];y===A?delete r._attrObject[X]:r._attrObject[X]=y,r.fp&&r.fp("a:"+X,C,y)&&r.onAttrChanged&&r.onAttrChanged(X,C,y)},G.getSerializableAttrs=function(){var d,h={};for(d in this._attrObject)h[d]=1;return h}},ms_bnb:function(q){q.getBodyColor=function(H){return H.s("body.color")},q.getBorderColor=function(b){return b.s("border.color")}},_51o:function(h){h.mi=function(n,z,$){this.addInteractorListener(n,z,$)},h.umi=function(S,B){this.removeInteractorListener(S,B)},h.fi=function(v){this.fireInteractorEvent(v)},h.addInteractorListener=function(k,z,K){var m=this;m._63I||(m._63I=new Ee),m._63I.add(k,z,K)},h.removeInteractorListener=function(c,K){this._63I&&this._63I.remove(c,K)},h.fireInteractorEvent=function(A){this._63I&&this._63I.fire(A)},h.setInteractors=function(_){var q=this,E=q._interactors;E&&E.each(function(v){v.tearDown()}),bj(_)&&(_=new lo(_)),q._interactors=_,_&&_.each(function(Q){Q.setUp()}),q.fp("interactors",E,_),q.invalidateSelection()},h.getInteractors=function(){return this._interactors}},_49o:function(V){V._44O=q,V._45O=q,V.getTopPainters=function(){return this._44O},V.getBottomPainters=function(){return this._45O},V.addTopPainter=function(p){var Q=this;Q._44O||(Q._44O=new lo),Q._44O.contains(p)||(Q._44O.add(p),Q.redraw&&Q.redraw())},V.removeTopPainter=function(S){var v=this;v._44O&&(v._44O.remove(S),v.redraw&&v.redraw())},V.addBottomPainter=function(c){var v=this;v._45O||(v._45O=new lo),v._45O.contains(c)||(v._45O.add(c),v.redraw&&v.redraw())},V.removeBottomPainter=function(J){var d=this;d._45O&&(d._45O.remove(J),d.redraw&&d.redraw())},V._93db=function(J,i){var c=this;c._45O&&c._45O.each(function(k){k.draw?k.draw(J,i):k.call(c,J,i)})},V._92db=function(W,F){var H=this;H._44O&&H._44O.each(function(X){X.draw?X.draw(W,F):X.call(H,W,F)})}},ms_sm:function(a){a.sm=function(){return this.getSelectionModel()},a.setSelectableFunc=function(A){this.sm().setFilterFunc(A)},a.getSelectableFunc=function(){return this.sm().getFilterFunc()},a.getSelectionModel=function(){var V=this;return V._selectionModel?V._selectionModel:V.dm().sm()},a.isSelectionModelShared=function(){return!this._selectionModel},a.setSelectionModelShared=function(P){var Q=this,v=Q.sm(),D=!Q._selectionModel,l=Q.handleSelectionChange,z=Q.dm();D!==P&&(Q.invalidateSelection&&Q.invalidateSelection(),P?(z.sm().ms(l,Q),Q._selectionModel.ums(l,Q),Q._selectionModel.dispose(),Q._selectionModel=q):(z.sm().ums(l,Q),Q._selectionModel=new xc(z),Q._selectionModel.ms(l,Q)),Q.onSelectionModelSharedChanged(),Q.fp("selectionModelShared",D,P),Q.fireViewEvent({kind:"selectionModelSharedChange",oldValue:D,newValue:P,oldSelectionModel:v,newSelectionModel:Q.sm()}))},a.onSelectionModelSharedChanged=function(){var P=this;P.redraw(),P.invalidateSelection&&P.invalidateSelection()},a.removeSelection=function(){var $=this.dm();$.beginTransaction(),this.sm().toSelection().each($.remove,$),$.endTransaction()},a.selectAll=function(){var r=this;r.sm().ss(r.dm().toDatas(function(S){return r.isVisible(S)&&r.isSelectable(S)}))},a.isSelected=function(N){return this.sm().co(N)},a.isSelectedById=function(r){var W=this.dm().getDataById(r);return W?this.isSelected(W):!1},a.isSelectable=function(c){return this.sm().isSelectable(c)}},ms_tx:function(Z){Z._64I=0,Z._65O=0,Z.isScrollable=function(){return this.getWidth()<this._64I},Z._40o=function(){return this.isScrollable()},Z.getLogicalPoint=function(W){return Hk(W,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},Z.tx=function(R){return R===A?this.getTranslateX():(this.setTranslateX(R),void 0)},Z.getTranslateX=function(){return this._65O},Z.setTranslateX=function(f){var X=this,D=X.getWidth()-X._64I;D>f&&(f=D),f>0&&(f=0),f=N(f);var P=X._65O;X._65O=f,X.fp(_p,P,f)}},ms_ty:function(u){u._23Q=0,u._66O=0,u._41o=function(){return this.getHeight()<this._23Q},u.getLogicalPoint=function(m){return Hk(m,this._canvas||this._view,this.tx?this.tx():0,this.ty())},u.ty=function(r){return r===A?this.getTranslateY():(this.setTranslateY(r),void 0)},u.getTranslateY=function(){return this._66O},u.setTranslateY=function(L){var s=this,G=s.getHeight()-s._23Q;G>L&&(L=G),L>0&&(L=0),L=N(L);var d=s._66O;s._66O=L,s.fp(Fd,d,L)}},ms_txy:function(y){y._65O=0,y._66O=0,y.tx=function(u){return u===A?this.getTranslateX():(this.setTranslateX(u),void 0)},y.ty=function(j){return j===A?this.getTranslateY():(this.setTranslateY(j),void 0)},y.onTranslateEnded=function(){},y.setTranslate=function(k,B,N){var w=this;if(N=En(N)){w._65I&&w._65I.stop(!0);var R=w.tx(),f=w.ty();N.action=function(L){w.setTranslate(R+(k-R)*L,f+(B-f)*L)},N._37o=function(){delete w._66I,delete w._65I,w.onTranslateEnded()},w._66I=1,w._65I=Mq(N)}else w.tx(k),w.ty(B)},y.getTranslateX=function(){return this._65O},y.setTranslateX=function(v){var o=this;v=o.adjustTranslateX(v);var M=o._65O;o._65O=v,o.fp(_p,M,v)},y.getTranslateY=function(){return this._66O},y.setTranslateY=function(p){var r=this;p=r.adjustTranslateY(p);var h=r._66O;r._66O=p,r.fp(Fd,h,p)},y.adjustTranslateX=function(z){return N(z)},y.adjustTranslateY=function(g){return N(g)},y.translate=function(m,Z,f){this.setTranslate(this.tx()+m,this.ty()+Z,f)},y.getLogicalPoint=function(J){var z=this;return Hk(J,this._canvas||z._view,z.tx(),z.ty())}},ms_dm:function(C){C.dm=function(l){return l?(this.setDataModel(l),void 0):this.getDataModel()},C.getDataModel=function(){return this._dataModel}},ms_lp:function(C){C.lp=function(W){return this.getLogicalPoint(W)}},ms_v:function(e){e._disabled=!1,e.setDisabled=function(O,u){var c=this,C=c._disabled;C!==O&&(C&&(Qn(c._63O),delete c._63O),O&&(Bh(c._view,c._63O=uf(u)),c.iv()),c._disabled=O,c.fp("disabled",C,O))},e.isDisabled=function(){return this._disabled},e.getDisabledDiv=function(){return this._63O},e.getView=function(){return this._view},e.addToDOM=function(s){var a=this,E=a.getView(),S=E.style;s=s||$.body,s.appendChild(E),S.left="0",S.right="0",S.top="0",S.bottom="0",X(W,"resize",function(){a.iv()}),a.iv()},e.setCursor=function(R){"default"===R&&(R=this._defaultCursor||R);var v=this.getView().style;v.cursor=R,v.cursor="-webkit-"+R,v.cursor="-moz-"+R},e.getWidth=function(){return this._view.clientWidth},e.getHeight=function(){return this._view.clientHeight},e.setWidth=function(Z){var A=this;A._view.style.width=Z+Zh,A.iv(),A.fp&&A.fp(xj,q,Z)},e.setHeight=function(d){var Y=this;Y._view.style.height=d+Zh,Y.iv(),Y.fp&&Y.fp(ii,q,d)},e.setFocus=function(k){var E=this,F=E._currentEditor;return k&&F&&(F.getView&&(F=F.getView()),F.contains(k.target))?!1:(Rb(E._view),E.endEditing&&E.endEditing(),E.fireViewEvent("focus"),!0)},e.iv=function(l){this.invalidate(l)},e.invalidate=function(A){var X=this;X._68I||(X._68I=1,X._ivTimerId=Mi(X._validateImpl,X,q,A),X._ivTimerDelay=A,X.onInvalidated&&X.onInvalidated(),X.fireViewEvent("invalidate"))},e.validate=function(){var c=this._ivTimerId,$=this._ivTimerDelay;this._validateImpl()!==!1&&c&&is(c,$)},e._validateImpl=function(){var O=this,m=O._view;if(!O._68I)return!1;if(delete O._68I,m.parentNode)if(0===m.offsetWidth&&0===m.offsetHeight&&O._67I!==q)O._67I===A&&(O._67I=M.reinvalidateCount),O._67I>0?O._67I--:O._67I=q,O.iv();else{O.fireViewEvent("beginValidate"),O.validateImpl(),O.onValidated&&O.onValidated(),O.fireViewEvent("validate");var f=O._63O;f&&(m.lastChild!==f&&(Qn(f),Bh(m,f)),Xn(f,0,0,O.getWidth(),O.getHeight())),zq(O),Sm(O),gm(O)}},e.layout=function(g,a,M,x){1===arguments.length?Xn(this,g):Xn(this,g,a,M,x)},e.addViewListener=function(K,l,c){var j=this;j._67O||(j._67O=new Ee),j._67O.add(K,l,c)},e.removeViewListener=function($,F){this._67O.remove($,F)},e.fireViewEvent=function(I){var b=this;b._67O&&(ro(I)&&(I={kind:I}),b._67O.fire(I)),M.viewListener&&M.viewListener(b,I)}},ms_tip:function(V){V.setToolTipEnabled=function(x){var a=this;x?lf||a._13o||(a.enableToolTip(),a.fp("toolTipEnabled",!1,!0)):a._13o&&(a.disableToolTip(),a.fp("toolTipEnabled",!0,!1))},V.isToolTipEnabled=function(){return!!this._13o},V.enableToolTip=function(){var p=this;if(!lf&&!p._13o){p._13o=function(B){if(!B.toolTipView){B.toolTipView=p;var L=p.getToolTip(B);L!=q?(M.toolTipContinual&&M.isToolTipShowing()?Rn(B,L):(Sn(),ac={timeout:Zl(wp,Kl),e:B,info:L}),nl={e:B,view:p}):Sn()}};var o=p.getView();X(o,Mr,p._13o),X(o,"mouseleave",M.hideToolTip)}},V.disableToolTip=function(){var s=this;if(s._13o){var u=s.getView();F(u,Mr,s._13o),F(u,"mouseleave",M.hideToolTip),delete s._13o}},V.getToolTip=function(d){var g=this;if(g.getDataAt){var I=g.getDataAt(d);return I?I.getToolTip():q}return g.getValue?g.getValue():void 0}},_52o:function(u){u._zoom=1,u._29I=Wb,u.zoomIn=function(l,r){this.setZoom(this._zoom*Gi,l,r)},u.zoomOut=function(y,c){this.setZoom(this._zoom/Gi,y,c)},u.zoomReset=function(H,r){this.setZoom(1,H,r)},u.scrollZoomIn=function(g){this.setZoom(this._zoom*jg,q,g)},u.scrollZoomOut=function(U){this.setZoom(this._zoom/jg,q,U)},u.pinchZoomIn=function(u){this.setZoom(this._zoom*wb,q,u)},u.pinchZoomOut=function(f){this.setZoom(this._zoom/wb,q,f)},u.adjustZoom=function(D){return ab>D?ab:D>el?el:D},u.getZoom=function(){return this._zoom},u.setZoom=function(l,C,y){var N=this;if(C=En(C)){N._14o&&N._14o.stop(!0);var a=N._zoom;C.action=function(b){N._96O(a+(l-a)*b,y)},C._37o=function(){delete N._zooming,delete N._14o,N.onZoomEnded()},N._zooming=1,N._14o=Mq(C)}else N._96O(l,y)},u._96O=function(Y,V){var f=this;if(Y=f.adjustZoom(Y),Y!==f._zoom){f.validate();var e=f._29I,v=f._zoom;0!==e.width&&0!==e.height&&(V=V?V:{x:e.x+e.width/2,y:e.y+e.height/2},f.tx((V.x-e.x)*v-V.x*Y),f.ty((V.y-e.y)*v-V.y*Y)),f._zoom=Y,f.fp("zoom",v,Y)}}},ms_edge:function(l){l._2I=function(l){var C=this;C._44I||(C._44I=new lo),C._42I||(C._42I=new lo),C._44I.add(l),C._42I.add(l),C._20I()},l._4I=function(B){var m=this;m._44I||(m._44I=new lo),m._43I||(m._43I=new lo),m._44I.add(B),m._43I.add(B),m._20I()},l._16I=function(K){var r=this;r._44I.remove(K),r._42I.remove(K),r._44I.isEmpty()&&delete r._44I,r._42I.isEmpty()&&delete r._42I,r._20I()},l._18I=function(E){var c=this;c._44I.remove(E),c._43I.remove(E),c._44I.isEmpty()&&delete c._44I,c._43I.isEmpty()&&delete c._43I,c._20I()},l._20I=function(){var k=this;if(delete k._45I,!k._44I||k._44I.isEmpty())return delete k._70O,void 0;var f;k._44I.each(function(j){j.isLooped()&&(f||(f={}),f[j._id]||(k._45I||(k._45I=new lo),k._45I.add(j),f[j._id]=j))}),f?(k._70O=new lo,k._44I.each(function(c){f[c._id]?"A"===f[c._id]||(f[c._id]="A",k._70O.add(c)):k._70O.add(c)})):k._70O=k._44I},l.hasAgentEdges=function(){return!!this._49I&&!this._49I.isEmpty()},l.getSourceAgentEdges=function(){return this._46I},l.getTargetAgentEdges=function(){return this._47I},l._1I=function(w){var m=this;m._46I||(m._46I=new lo),m._48I||(m._48I=new lo),m._46I.add(w),m._48I.add(w),m._19I()},l._3I=function(V){var p=this;p._47I||(p._47I=new lo),p._48I||(p._48I=new lo),p._47I.add(V),p._48I.add(V),p._19I()},l._15I=function(U){var k=this;k._46I.remove(U),k._48I.remove(U),k._46I.isEmpty()&&delete k._46I,k._48I.isEmpty()&&delete k._48I,k._19I()},l._17I=function(J){var g=this;g._47I.remove(J),g._48I.remove(J),g._47I.isEmpty()&&delete g._47I,g._48I.isEmpty()&&delete g._48I,g._19I()},l._19I=function(){var D=this;delete D._49I;var $=D._48I;if($&&!$.isEmpty()){var f={};$.each(function($){f[$._id]?D._49I||(D._49I=new lo):f[$._id]=$}),D._49I?$.each(function(S){f[S._id]&&(D._49I.add(S),delete f[S._id])}):D._49I=$}},l.getLoopedEdges=function(){return this._45I},l.getEdges=function(){return this._70O},l.getAgentEdges=function(){return this._49I},l.getSourceEdges=function(){return this._42I},l.getTargetEdges=function(){return this._43I},l._8I=function(){this._70O&&this._70O.each(function(L){L._7I()})}}};zb(M,{getVersion:function(){return"7.3.2"}},!0);var kj=function(M){return M.devicePixelRatio?M.devicePixelRatio:M.screen&&M.screen.logicalXDPI?M.screen.deviceXDPI/M.screen.logicalXDPI:1};zb(M,{numberDigits:5,crossOrigin:"",baseZIndex:A,isTouchable:lf,mockTouch:!0,devicePixelRatio:kj(W),reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:b.disabledBackground,forceHierarchicalSerialization:!0,extractBatchTranslation:!1,extractShapeTranslation:!1,extractPolylineTranslation:!1,extractVerticesTranslation:!1,envmapProbeMinWaitTime:300,envmapProbeMaxWaitTime:25e3,EnvmapTextureSize:1024,hoverDelay:600,clickDelay:200,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return Yl},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],blockMinSize:1,textExtraWidth:4,encodeStringKey:null,doubleClickSpeed:500,doubleClickRange:1,doubleTouchRange:20,touchMoveThreshold:10,animDuration:200,animEasing:function(k){return k*k},labelColor:io,labelSelectColor:zk,labelFont:"12px arial, sans-serif",widgetIndent:lf?30:20,widgetRowHeight:lf?30:20,widgetHeaderHeight:lf?32:22,widgetTitleHeight:lf?34:24,scrollBarColor:cc,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:lf?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,pinchZoomThreshold:1,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:fb,intersectionLineLine:Tg,isEnter:yn,isEsc:$q,isDelete:hj,isSpace:Yo,isLeft:lp,isUp:zg,isRight:Up,isDown:Pk,isTouchEvent:Wg,getTarget:Tm,isString:ro,isNumber:xe,isBoolean:_k,isArray:bj,isSelectAll:jc,isFunction:hc,isObject:fg,getPropertyValue:Gc,setPropertyValue:Ed,addMethod:zb,createGradient:function(r,u,R,d,F,S,v,m){var D=Zg[u];return D(r,R,d,F,S,v,m)},appendToScreen:function(i){i=i.getView?i.getView():i,($.fullscreenElement||$.mozFullScreenElement||$.webkitFullscreenElement||$.msFullscreenElement||$.body).appendChild(i)},encodeString:function(r){return x.Math.encodeBase64(r,M.encodeStringKey)},decodeString:function(p){return x.Math.decodeBase64(p,M.encodeStringKey)},findView:function(R){var r=function(m,Z){var Q=Z._ht;Q&&m.push(Q);var $=Z.children,R=$.length;if(R)for(var s=0;R>s;s++)r(m,$[s])},D=[];r(D,$.body);var v=function(i,n){for(var k="2d"===n?Tq.GraphView:Kr.Graph3dView,z=0,h=i.length;h>z;z++)if(i[z]instanceof k)return D[z];return null};return"all"===R?D:"2d"===R?v(D,"2d"):"3d"===R?v(D,"3d"):v(D,"3d")||v(D,"2d")},toggleFullscreen:function(N){var A=N.getView();if($.fullscreenElement||$.mozFullScreenElement||$.webkitFullscreenElement||$.msFullscreenElement)$.exitFullscreen?$.exitFullscreen():$.msExitFullscreen?$.msExitFullscreen():$.mozCancelFullScreen?$.mozCancelFullScreen():$.webkitExitFullscreen&&$.webkitExitFullscreen();else{var p=!0;if(N.isSelfViewEvent){var w=N.getX(),T=N.getY(),d=N.getWidth(),C=N.getHeight(),R=A.style.background,z=A.style.backgroundColor;R||z||(A.style.backgroundColor="white"),A.requestFullscreen?A.requestFullscreen():A.msRequestFullscreen?A.msRequestFullscreen():A.mozRequestFullScreen?A.mozRequestFullScreen():A.webkitRequestFullscreen&&A.webkitRequestFullscreen();var Y=setInterval(function(){if(A!==($.fullscreenElement||$.mozFullScreenElement||$.webkitFullscreenElement||$.msFullscreenElement))clearInterval(Y),N.setX(w),N.setY(T),N.setWidth(d),N.setHeight(C),N._fullscreen=!1,A.style.oldBackgroundColor=z,N.iv();else{var M=x.Default.getWindowInfo();(p||M.width!==N.getWidth()||M.height!==N.getHeight())&&(N.setX(M.left),N.setY(M.top),N.setWidth(M.width),N.setHeight(M.height),N._fullscreen=!0,N.iv(),p=!1)}},500)}else{var W=A.style.left,H=A.style.top,d=A.style.width,C=A.style.height,R=A.style.background,z=A.style.backgroundColor;R||z||(A.style.backgroundColor="white"),A.requestFullscreen?A.requestFullscreen():A.msRequestFullscreen?A.msRequestFullscreen():A.mozRequestFullScreen?A.mozRequestFullScreen():A.webkitRequestFullscreen&&A.webkitRequestFullscreen();var Y=setInterval(function(){if(A!==($.fullscreenElement||$.mozFullScreenElement||$.webkitFullscreenElement||$.msFullscreenElement))clearInterval(Y),A.style.left=W,A.style.top=H,A.style.width=d,A.style.height=C,A.style.oldBackgroundColor=z,N.iv();else{var T=x.Default.getWindowInfo();(p||T.width!==N.getWidth()||T.height!==N.getHeight())&&(Xn(N),p=!1)}},500)}}},appendTimeStamp:function(E){return E},setCompType:function(I,P){ro(P)&&P.substr(0,12)==Tb&&(P=M.parse(P)),hc(P)||fg(P)?Fi[I]=P:Hd(I)},getCompType:function(S){var M=Fi[S];return M===A&&ve.test(S)&&Hd(S),M},getCompTypeMap:function(){return Fi},drawCompType:function(J,r,Z,$,Q,p){J(r,Z,$,Q,p)},numberListener:function(){var O={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(b){var J=b.keyCode;O[J]||65===J&&M.isCtrlDown(b)||86===J&&M.isCtrlDown(b)||67===J&&M.isCtrlDown(b)||88===J&&M.isCtrlDown(b)||J>=35&&40>=J||(b.shiftKey||48>J||J>57)&&(96>J||J>105)&&b.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(a){var J=a.target.tagName;("DIV"===J||"CANVAS"===J)&&!(M.ignoreKeyCodes.indexOf(a.keyCode)>=0)&&("keydown"!==a.type||lp(a)||Up(a)||zg(a)||Pk(a)||hj(a)||65===a.keyCode&&(a.metaKey||a.ctrlKey))&&a.cancelable===!0&&(a.preventDefault(),a.preventManipulation&&a.preventManipulation())},getWindowInfo:function(){var c=$.documentElement,T=c&&(c.scrollLeft||c.scrollTop)?c:$.body;return{target:T,left:T.scrollLeft,top:T.scrollTop,width:W.innerWidth||T.clientWidth,height:W.innerHeight||T.clientHeight}},isDragging:function(){return!!Yl},isLeftButton:function(U){return Wg(U)?!0:0===U.button},isMiddleButton:function(t){return Wg(t)?!1:t&&(1===t.button||4&(t.buttons||0))},isRightButton:function(j){return Wg(j)?!1:j&&(2===j.button||2&(j.buttons||0))},isInput:function(E){if(!E)return!1;var A=E.tagName;return"INPUT"===A||"TEXTAREA"===A||"SELECT"===A},getTouchCount:function(e){return Wg(e)?e.touches.length:1},isDoubleClick:function(){function e(i){i.details=0,i.timeout=null,i.lastPoint=null}var f={};return se=new rq,jh=se.getTime(),function(H){if(rn(H)>1)return!1;var O=H.button==q?"":H.button,L=H.type+O,m=L+"_isDoubleClick",U=f[L];if(U||(U=f[L]={details:0,timeout:null,lastPoint:null}),H[m]===A){H[m]=!0;var Y=Yi(H);U.timeout&&(hh(U.timeout),U.timeout=null);var j=Wg(H)?M.doubleTouchRange:M.doubleClickRange;U.lastPoint&&Hh(U.lastPoint,Y)>j&&e(U),U.lastPoint=Y,U.details++,U.timeout=Zl(function(){e(this)}.bind(U),M.doubleClickSpeed)}return 2===U.details}}(),isShiftDown:function(Z){return Z?Z.shiftKey:qr["16"]},isCtrlDown:function(E){return E?$g?E.metaKey:E.ctrlKey:$g?qr["91"]:qr["17"]},getClientPoint:function(u){return Wg(u)&&(u=rr(u)),{x:u.clientX,y:u.clientY}},isMouseEvent:function(b){return b instanceof MouseEvent||0===b.type.indexOf("mouse")},getTargetElement:function(u){var y,c=Ri(u);if(y=M.isMouseEvent(u)||!$.elementFromPoint?u.target:$.elementFromPoint(c.x,c.y),mp&&$.elementFromPoint){for(var W=[],j=[];"none"===y.style.pointerEvents;)W.push(y),j.push(y.style.display||""),y.style.display="none",y=$.elementFromPoint(c.x,c.y);W.forEach(function(Z,z){Z.style.display=j[z]})}return y},getPagePoint:function(T){return Wg(T)&&(T=rr(T)),{x:T.pageX,y:T.pageY}},createObject:function(n,F){var Q=new n;for(var p in F){var T=F[p];if(hc(T))Q[p]=T;else if(0===p.indexOf("s:"))Q.s(p.substr(2),F[p]);else if(0===p.indexOf("a:"))Q.a(p.substr(2),F[p]);else{var J=Lg(p),T=F[p];Q[J]?(Q[J](T),"setToolTip"===J&&Q.enableToolTip&&Q.enableToolTip()):Q[p]=T}}return Q},setImage:function(g,j,V,B){var n=arguments.length;4===n?Md(g,B,j,V):2===n?ro(j)?j.substr(0,12)==Tb?tm(g,M.parse(j)):Md(g,j):tm(g,j):1===n&&Md(g,g)},getImage:function(E,c,N){var T;if(E==q)return q;if(fg(E)?T=E:(T=zl[E],E&&T===A&&(vb&&vb[E]||Md(E,E))),c&&T&&T.tagName){var j;j="override"===N?"colors_override":"override_rgb"===N?"colors_override_rgb":"override_a"===N?"colors_override_a":"colors",T[j]||(T[j]={__count__:0});var I=T[j][c];return I||(T[j].__count__>M.imageCacheThreshold&&(T[j]={__count__:0}),I=Xb(T,qn(c),T.width,T.height,N),T[j][c]=I,T[j].__count__++),I}return T},isImageComplete:function(Q,L,z){var p=yd(Q);if(!p)return!1;if(p.tagName)return p.complete;for(var T,Q,k,w=p.comps,F=!0,X=0,c=w.length;c>X;X++)if(T=w[X],k=T.type,"image"===T.type){Q=T.name,Q&&Q.func&&(Q=gl(Q,L));var u=_j(Q,L,z);if(!u){F=!1;break}}else if(ve.test(k)&&M.getCompType(k)===A){F=!1,Hd(k);break}return F},getId:function(){var y=1;return function(){return++y}}(),callLater:function(E,y,$,P){var F=function(){E.apply(y,$)};return P?Zl(F,P):W.requestAnimationFrame(F)},cancelLater:function(q,O){O?hh(q):W.cancelAnimationFrame(q)},clone:function(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date){var X=new Date;return X.setTime(t.getTime()),X}if(t instanceof Array){for(var X=[],K=0,Z=t.length;Z>K;K++)X[K]=Wr(t[K]);return X}if(t instanceof lo){for(var X=new lo,K=0,Z=t.length;Z>K;K++)X.set(K,Wr(t.get(K)));return X}if(t instanceof Vp)return t;if(t instanceof Xl){var X=new Xl;return X.deserialize(t.serialize()),X}if(t instanceof u){var X={};for(var C in t)t.hasOwnProperty(C)&&(X[C]=Wr(t[C]));return X}return t},callWhenLoaded:function(Z,C){C=C||100;var i=yl(Z,C);El||(El={}),El[i]={tick:i,cb:Z,delay:C}},beforeLoadURL:function(V,k){if(El){var K={};for(var k in El){var t=El[k];hh(t.tick);var j=yl(t.cb,t.delay);K[j]={tick:j,delay:t.delay,cb:t.cb}}El=K}return M.convertURL?M.convertURL(V,k):V},convertURL:function(v){return v},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return M.getImage("default_blank")},resizeImage:function(f,y,A,K){A||(A=y),K||(K=rs());var P=K.getContext("2d");return Sk(K,y,A,1),P.drawImage(f,0,0,y,A),K},resizeImagePOT:function(L,x,E){if(!L||!L.tagName)return L;var A=L.width,w=L.height;if(!A||!w)return L;if(Mh.isPOT(A)&&Mh.isPOT(w)&&(!x||A===w))return L;var v,Q;return x?Q=v=Mh.nearestPOT(Math.min(A,w)):(v=Mh.nearestPOT(A),Q=Mh.nearestPOT(w)),M.resizeImage(L,v,Q,E)},sortFunc:function(S,H){if(S===H)return 0;if(S==q&&H!=q)return 1;if(S!=q&&H==q)return-1;if(S==q&&H==q)return 0;var M,d=typeof S,J=typeof H;return d===ss&&J===ss?M=S.localeCompare(H):d===Oo&&J===Oo&&(M=S-H),M===A&&(M=(""+S).localeCompare(""+H)),M>0?1:0>M?-1:0},getClassMap:function(){return $p},getClass:function(a){if(ro(a)){var D,z=$p[a];if(!z){D=a.split("."),z=W;for(var O=0;O<D.length;O++)z=z[D[O]];$p[a]=z}return z}return a},def:function(Q,n,u){var s,K,X,U=function(){};if(U.prototype=n.prototype,s=new U,ro(Q)){if($p[Q])throw"'"+Q+"' already defined";X=jq(Q),s.getClassName=function(){return Q}}else X=Q;if(s.constructor=X,s.getClass=function(){return X},s.getSuperClass=function(){return n},u)for(K in u)Mp[K]&&Mp.hasOwnProperty(K)?Mp[K](s,u):ts(s,u,K);X.prototype=s,X.superClass=n.prototype},startAnim:function(){var C=function(f){f.duration&&(f.startTime=oj()),f.timeId=Mi(f.tick,q,q,f.interval)};return function(w){return w=Wr(w),w.easing=w.easing||M.animEasing,w.duration||w.frames||(w.duration=M.animDuration),w.t=0,w.duration?w.interval=0:(w.frame=0,w.interval=w.interval||10),w.tick=function(){if(w.duration){var i=(oj()-w.startTime)/w.duration;if(i>1&&(i=1),w.t=i,w.action(w.easing(i),i),!w.isRunning())return;1===i?w.stop():w._isPaused||(w.timeId=Mi(w.tick))}else{if(w.frame++,i=w.t=w.frame/w.frames,w.action(w.easing(i),i),!w.isRunning())return;w.frame<w.frames?w._isPaused||(w.timeId=Mi(w.tick,q,q,w.interval)):w.stop()}},w.resume=function(){w._isPaused&&(delete w._isPaused,w.duration?w.t<1&&(w.startTime=oj()-w.duration*w.t,w.timeId=Mi(w.tick)):w.frame<w.frames&&(w.timeId=Mi(w.tick,q,q,w.interval)))},w.pause=function(){is(w.timeId,!w.duration),w._isPaused=!0},w.isPaused=function(){return this._isPaused},w.stop=function(R){w.isRunning()&&(is(w.timeId,!w.duration),delete w.timeId,w.duration?w.t<1&&R&&(w.t=1,w.action(w.easing(1),1)):w.frame<w.frames&&R&&(w.frame=w.frames,w.action(w.easing(1),1)),w._37o&&w._37o(),w.finishFunc&&w.finishFunc())},w.isRunning=function(){return w.timeId!=q},w.delay?Mi(C,q,[w],w.delay):C(w),w}}(),getTextSize:function(){var E={},c=$?rs().getContext("2d"):q;return function(P,l){c.font=P?P:vk;var $=E[c.font];return $||($=2*c.measureText("e").width+4,E[c.font]=$),{width:c.measureText(l).width+M.textExtraWidth,height:$}}}(),drawText:function(v,G,m,o,p,y,T,E,e,z,d){if(G!=q){var X=bi(m,G),I={};I.y=z&&z!==cq?z===vg?y+X.height/2:y+E-X.height/2:y+E/2,I.x=e&&e!==wk?e===Bj?p+T-X.width/2:p+T/2:p+X.width/2,Nh(v,G,I,m,o),d&&np(v,G,m,o,I.x,I.y,X.width,d)}},getDistance:function(T,S){var c=T.length;return S?3===c?h(Zm(T[0]-S[0])+Zm(T[1]-S[1])+Zm(T[2]-S[2])):2===c?h(Zm(T[0]-S[0])+Zm(T[1]-S[1])):T.z===A?h(Zm(S.x-T.x)+Zm(S.y-T.y)):h(Zm(S.x-T.x)+Zm(S.y-T.y)+Zm(S.z-T.z)):3===c?h(Zm(T[0])+Zm(T[1])+Zm(T[2])):2===c?h(Zm(T[0])+Zm(T[1])):void 0},brighter:function(Q,H){return 0>H&&(H=-H),Qf(Q,H?H:40)},darker:function(N,S){return S>0&&(S=-S),Qf(N,S?S:-40)},unionPoint:function(C,p){if(!C)return q;if(2===arguments.length)return C&&p?{x:e(C.x,p.x),y:e(C.y,p.y),width:D(C.x-p.x),height:D(C.y-p.y)}:q;var t=C;if(t._as&&(t=t._as),t.length===A)return q;var h=t.length;if(0>=h)return q;for(var y=1,c=t[0],G={x:c.x,y:c.y,width:0,height:0};h>y;y++){c=t[y];var I=e(G.x,c.x),b=E(G.x+G.width,c.x),K=e(G.y,c.y),r=E(G.y+G.height,c.y);G.x=I,G.y=K,G.width=b-I,G.height=r-K}return G},unionRect:function(O,c){if(O&&!c)return Wr(O);if(!O&&c)return Wr(c);if(O&&c){var H={x:e(O.x,c.x),y:e(O.y,c.y)};return H.width=E(O.x+O.width,c.x+c.width)-H.x,H.height=E(O.y+O.height,c.y+c.height)-H.y,H}return q},containsPoint:function(x,h,s,n){if(n!=q&&1!==n){var I=x.x+x.width/2,J=x.y+x.height/2;x={x:I-x.width/2*n,y:J-x.height/2*n,width:x.width*n,height:x.height*n}}if(s){var y=x.width/2,b=x.height/2,M=o(-s),v=O(-s),N=h.x-x.x-y,a=h.y-x.y-b;
return h={x:v*N-M*a,y:M*N+v*a},Do({x:-y,y:-b,width:x.width,height:x.height},h)}return!(!x||h.x<x.x||h.y<x.y||h.x>x.x+x.width||h.y>x.y+x.height)},containsRect:function(q,u){if(!q||!u)return!1;var e=u.x,P=u.y,h=u.width,i=u.height,j=q.width,w=q.height;if(0>(j|w|h|i))return!1;var b=q.x,a=q.y;if(b>e||a>P)return!1;if(j+=b,h+=e,e>=h){if(j>=b||h>j)return!1}else if(j>=b&&h>j)return!1;if(w+=a,i+=P,P>=i){if(w>=a||i>w)return!1}else if(w>=a&&i>w)return!1;return!0},intersectsRect:function(m,j){if(!m||!j)return!1;var w=j.width,W=j.height,N=m.width,l=m.height;if(0>=N||0>=l||0>=w||0>=W)return!1;var h=j.x,z=j.y,H=m.x,X=m.y;return N+=H,l+=X,w+=h,W+=z,N>h&&l>z&&w>H&&W>X},intersection:function(u,l){if(!u||!l)return q;var $=l.x,c=l.y,Z=u.x,e=u.y,b=$,B=c,H=Z,M=e;return b+=l.width,B+=l.height,H+=u.width,M+=u.height,Z>$&&($=Z),e>c&&(c=e),b>H&&(b=H),B>M&&(B=M),b-=$,B-=c,0>=b||0>=B?q:{x:$,y:c,width:b,height:B}},grow:function(R,v,l){l===A&&(l=v),R.x-=v,R.y-=l,R.width=R.width+2*v,R.height=R.height+2*l},getScreenPoint:function(T,M,a,C,U,D,h){var f=a.getBoundingClientRect(),O=T*(D||1)-a.scrollLeft+(C||0),_=M*(h||1)-a.scrollTop+(U||0),W=fo(a,!1);if(W){var Z=new ah(O,_,0);return Z.applyMatrix4(W),console.log(Z),{x:Z.x,y:Z.y}}return{x:O+f.left,y:_+f.top}},getLogicalPoint:function(P,S,t,m,V,v){var F,r,O=S.getBoundingClientRect();P.target?(qp(P)?$g?qr["91"]=!0:qr["17"]=!0:$g?qr["91"]=!1:qr["17"]=!1,qr["16"]=ck(P)?!0:!1,P=Wg(P)?rr(P):P,F=P.clientX,r=P.clientY):(F=P.x,r=P.y);var L=fo(S,!0);if(L){var H=new ah(F,r,0);H.applyMatrix4(L);do{if(Math.abs(H.z)<=1e-6)break;var G=new ah(F,r,1);if(G.applyMatrix4(matrix),Math.abs(G.z)<=1e-6){H=G;break}if(G.sub(H),Math.abs(G.z)<=1e-6)break;H.addScaledVector(G,-H.z/G.z)}while(!1);return{x:(H.x+S.scrollLeft-(t||0))/(V||1),y:(H.y+S.scrollTop-(m||0))/(v||1)}}return{x:(F-O.left+S.scrollLeft-(t||0))/(V||1),y:(r-O.top+S.scrollTop-(m||0))/(v||1)}},removeHTML:function(){var D;return function(i){return i&&i.getView&&(i=i.getView()),i&&i.parentNode?D===i?!0:(D=i,i.parentNode.removeChild(i),D=q,!0):!1}}(),getToolTipDiv:function(){if(!Pi){Pi=Kn(),Uk=Kn();var $=Pi.style;M.baseZIndex!=q&&($.zIndex=hd(M.baseZIndex)+3+""),$.whiteSpace="nowrap",$.color=M.toolTipLabelColor,$.background=M.toolTipBackground,$.font=M.toolTipLabelFont,$.padding="5px",$.boxShadow="0px 0px 3px "+M.toolTipShadowColor}return Pi},isToolTipShowing:function(){return Pi&&Pi.parentNode?!0:Uk&&Uk.parentNode?!0:!1},updateToolTipContent:function(X,g){if(M.isToolTipShowing()&&(g||(g=nl&&nl.view),X===A&&g&&nl.e&&(X=g.getToolTip(nl.e)),X!=q)){var b;X.html?(X=X.html,b=Uk):b=Pi,b.innerHTML=X}},hideToolTip:function(){if(aq(),M.isToolTipShowing()){Qn(Pi),Qn(Uk);var X=nl&&nl.view;X&&X.onHideToolTip&&X.onHideToolTip(),nl=q}},showToolTip:function(W,m,a){if(!W||m==q)return Sn(),void 0;M.getToolTipDiv();var T,X;if(m.html?(m=m.html,T=Uk,Qn(Pi)):(T=Pi,Qn(Uk)),X=T.style,T.innerHTML="",m instanceof HTMLElement?T.appendChild(m):T.innerHTML=m,T.parentNode||x.Default.appendToScreen(T),W.target){W=Ri(W);var y=Ie(),k=W.x,$=W.y,O=lf?60:12;if(lf){var n=T.getBoundingClientRect();X.left=k-n.width/2+Zh,X.top=$-n.height-O<y.top?$+O+Zh:$-n.height-O+Zh}else{X.left=k+O+Zh,X.top=$+O+Zh;var n=T.getBoundingClientRect();n.left+n.width>y.width&&(X.left=k-O-n.width+Zh),n.top+n.height>y.height&&(X.top=$-O-n.height+Zh),n.left<0&&(X.left=k+O+Zh),n.top<0&&(X.top=$+O+Zh)}}else X.left=W.x+Zh,X.top=W.y+Zh;aq(),a===A?a=nl&&nl.view:nl={e:W,view:a},a&&a.onShowToolTip&&a.onShowToolTip()},startDragging:function(L,H,m){m==A&&(m=!0),L!==Yl&&(Yl?m&&(Wg(H)?Yl.handleWindowTouchEnd(H):Yl.handleWindowMouseUp(H)):Wg(H)?(X(W,Mg,ns),X(W,gh,Ai),X(W,"blur",Ai)):(X(W,Mr,xi),X(W,zp,gn),X(W,"blur",gn)),Yl=L)},getImageMap:function(){return zl},toBoundaries:function(t,F,m,h){var g=[];return gi(t,F,m,h).forEach(function(Q){var x=[];Q.forEach(function(K){x.push(K.x,K.y)}),g.push(x)}),g},getCurrentKeyCodeMap:function(){return qr},drawCenterImage:function(g,a,e,J,j,C,T,O){!j&&C&&C.isSelfViewEvent&&(j=C);var Q=Wq(a,j,C),G=pm(a,j,C);xb(g,a,N(e-Q/2),N(J-G/2),Q,G,j,C,T,O)},drawStretchImage:function(i,Y,q,F,u,K,x,D,c,I,X,r){!D&&c&&c.isSelfViewEvent&&(D=c);var C,W=Wq(Y,D,c,K),Q=pm(Y,D,c,x);"uniform"===q?(C=e(K/W,x/Q),W*=C,Q*=C,F+=N((K-W)/2),u+=N((x-Q)/2),K=W,x=Q):"centerUniform"===q&&((W>K||Q>x)&&(C=e(K/W,x/Q),W*=C,Q*=C),F+=N((K-W)/2),u+=N((x-Q)/2),K=W,x=Q);var B=i.interactiveInfo;if(B){var z;if(z="center"===q?{x:F+K/2-W/2,y:u+x/2-Q/2,width:W,height:Q}:{x:F,y:u,width:K,height:x},B.rect){var E=B.compInfos,k=E.length;k&&(E[k-1].rect.image=Y)}else B.rect=z}if("center"===q){var G=X!==!1&&(W>K||Q>x);G&&(i.save(),i.beginPath(),i.rect(F,u,K,x),i.clip()),xb(i,Y,F+K/2-W/2,u+x/2-Q/2,W,Q,D,c,I,r),G&&i.restore()}else xb(i,Y,F,u,K,x,D,c,I,r)},toCanvas:function(s,Q,P,g,l,z,J,u,S){s=yd(s,J),Q=Q||Wq(s,l),P=P||pm(s,l);var k=rs(),Y=bc(k);return u?(Sk(k,Q,P,u),Y.scale(u,u)):Sk(k,Q,P,1),jl(Y,s,g,0,0,Q,P,l,z,J,S),s&&s.clampToEdge&&(k.clampToEdge=s.clampToEdge),Y.restore(),k},toGrayColor:function(z){if(!z)return z;var W=Ck(z),i=N(.299*W[0]+.587*W[1]+.114*W[2]);return"rgba("+i+","+i+","+i+","+W[3]/255+")"},createGradientImage:function(q,p,V,d){for(var k=["L",0,0,q,0,1,0,0,1,0,0],Q=0,i=Math.min(p.length,V.length);i>Q;Q++)k.push(V[Q],p[Q]);var B=x.Default.toCanvas({width:q,height:q,clampToEdge:!0,comps:[{type:"shape",rotation:d||0,points:[0,0,q,0,q,q,0,q],background:"#ffffff",gradientPack:k}]});return B},createElement:function(r,J,V,v){var n=$.createElement(r);return Sp(n,J||b.widgetBorder,2),n.style.font=V?V:vk,v!=q&&(n.value=v),M.onElementCreated&&M.onElementCreated(n),n},containedInView:function(F,q){var i=Ir(q).getBoundingClientRect();return Do({x:i.left,y:i.top,width:i.width,height:i.height},Yi(F))},isIsolating:function(){return Lc>0},setIsolating:function(S){S?Lc++:Lc--},getMSMap:function(){return Mp},stringify:function(N,u,h){var n=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var U=Xl.prototype.toJSON;Xl.prototype.toJSON=function(){return"__ht__dataModel"+this.serialize(0)},u=h?0:u==q?2:u;var Q=JSON.stringify(N,function(Z,q){return"function"==typeof q?"__ht__"+(q.__ht__||q.toString()):xe(q)?Br(q):q instanceof x.List?"__ht__list"+(q.__ht__list||M.stringify(q._as)):q},u);return Date.prototype.toJSON=n,Xl.prototype.toJSON=U,h&&(Q=Tb+Bb(Q)),Q},parse:function(P,s){return ro(P)?P.substr(0,12)!=Tb||(P=ee(P.substr(12)),ro(P))?(s=s||{},JSON.parse(P,function(g,m){if(ro(m))if(s.ignoreFunction||"__ht__function"!=m.substr(0,14)){if(!s.ignoreDate&&"__ht__date"==m.substr(0,10))return new Date(hd(m.substr(10)));if("__ht__list"===m.substr(0,10))return new lo(M.parse(m.substr(10)));if(!s.ignoreDataModel&&"__ht__dataModel"===m.substr(0,15)){var r=new Xl;return r.deserialize(M.parse(m.substr(15))),r}}else{var d=m.indexOf("{")+1,L=m.lastIndexOf("}"),D=m.indexOf("(")+1,h=m.indexOf(")");if(d&&L&&D&&h)try{var I=new Function(m.substring(D,h),m.substring(d,L));return I.__ht__=m.substr(6),I}catch(R){throw console.info("=== SyntaxError ===\n",m),R}}return m})):P:P},loadJS:function(F,O){O&&F.push(O);var c=F.shift();if(bj(c))F=c.contact(F),M.loadJS(F);else if(hc(c))c(),M.loadJS(F);else if(ro(c)){var a=$.createElement("script");a.onload=function(){M.loadJS(F)},a.setAttribute("src",c),$.getElementsByTagName("head")[0].appendChild(a)}else F.length&&M.loadJS(F)},extendClass:function(W,L){var k=W.prototype;for(var U in L)Mp[U]&&Mp.hasOwnProperty(U)?Mp[U](k,L):k[U]=L[U]},toRoundedCorner:function(){function N(Q,e,f){Q.x=e.x,Q.y=e.e||f,Q.z=e.y}var D=new ah,C=new ah,O=new ah,u=new ah;return function(R,o){var r,_=0;R.getPoints&&(_=R.getElevation(),R=R.getPoints()),r=R instanceof lo?R:new lo(R);var I=r.size();if(0>=o)return{points:r};var E=new lo,e=new lo,y=r.get(0);N(D,y,_),E.add(y),e.add(1);for(var P=1;I>P;P++)if(I>P+1){var K=r.get(P),H=r.get(P+1);N(C,K,_),N(O,H,_),u.subVectors(D,C).setLength(Math.min(.99*u.length(),o)).add(C),K.e!==A||y.e!==A?E.add({x:u.x,y:u.z,e:u.y}):E.add({x:u.x,y:u.z}),E.add(K),u.subVectors(O,C).setLength(Math.min(.99*u.length(),o)).add(C),K.e!==A||H.e!==A?E.add(y={x:u.x,y:u.z,e:u.y}):E.add(y={x:u.x,y:u.z}),D.copy(u),e.addAll([2,3])}else E.add(r.get(P)),e.add(2);return{points:E,segments:e}}}(),toColorData:Ck,setCanvas:Sk,createDiv:Kn,createDisabledDiv:uf,createView:bn,createCanvas:rs,appendChild:Bh,initContext:bc,checkLoadingImage:zq,translateAndScale:ih,layout:Xn,getPosition:oo,drawPoints:Bg,drawRoundRect:$r,drawBorder:Co,setFocus:Rb,getter:Ld,setter:Lg,isEmptyObject:Er,cameraPriority:function(){var P={skybox:0,main:1e4,top:1e7,infinity:1/0};return u.seal(u.defineProperties({},{skybox:{configurable:!1,enumerable:!1,get:function(){return P.skybox},set:function(b){if(b>=P.main)throw new RangeError("Skybox camera must have lower priority than the main camera.");P.skybox=Number(b)}},main:{configurable:!1,enumerable:!1,get:function(){return P.main},set:function(j){if(j<=P.skybox)throw new RangeError("Main camera must have higher priority than the skybox camera.");if(j>=P.top)throw new RangeError("Main camera must have lower priority than the top camera.");P.main=Number(j)}},top:{configurable:!1,enumerable:!1,get:function(){return P.top},set:function(G){if(G<=P.main)throw new RangeError("Top camera must have higher priority than the main camera.");P.top=Number(G)}}}))}(),addFontFace:function(){function N(e){var B=e.substr(e.lastIndexOf(".")+1);e=M.convertURL?M.convertURL(e):e;var X=g[B]||B;return{postfix:B,url:"url("+e+') format("'+X+'")'}}function y($,M){return I[$.postfix]-I[M.postfix]}var g={ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},I={eot:0,woff2:1,woff:2,ttf:3,otf:4};return function(c,a,G,d){if(c){d&&M.removeFontFace(c,!0);var B;if(B=tc[c])return B.parentNode||$.head.appendChild(B),G&&G(B),void 0;if(ro(a)&&(a=[a]),a=a.filter(function(v){return ro(v)?v.length>0:!1}),0!==a.length){a=a.map(N);var Y="";a.sort(y).forEach(function(F){Y+=", "+F.url}),Y=Y.substr(2);var B=$.createElement("style");B.innerText='@font-face{font-family: "'+c+'";src: '+Y+";}",$.head.appendChild(B),tc[c]=B,G&&G(B)}}}}(),clearFontFace:function(){if(!Er(tc)){for(var X in tc)M.removeFontFace(X);tc={}}},removeFontFace:function(C,I){if(C){var p=C;if(p.tagName){if(Qn(p),I){var O=[];for(var n in tc)tc[n]===p&&O.push(n);var U=O.length;if(U>0)for(var K=0,U=O.length;U>K;K++)delete tc[O[K]]}}else(p=tc[C])&&(Qn(p),I&&delete tc[C])}},getFontFaceMap:function(){return tc},handleFontFacesLoaded:function(){}},!0),$&&$.fonts&&$.fonts.addEventListener&&$.fonts.addEventListener("loadingdone",function(b){M.handleFontFacesLoaded(b.fontfaces),M.findView("all").forEach(function(Z){Z.redraw?Z.redraw():Z.iv()})}),zb(v,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var ud=M.disabledOpacity,Kl=M.toolTipDelay,Jh=M.devicePixelRatio,_f=M.autoMakeVisible,yi=M.autoHideScrollBar,Dl=M.imageGradient,Rn=M.showToolTip,Sn=M.hideToolTip,Qr=M.dashPattern,jo=M.lineCap,Wl=M.lineJoin,Hj=M.labelColor,Sf=M.labelSelectColor,vk=M.labelFont,Ro=M.widgetIndent,Zq=M.widgetRowHeight,Nb=M.widgetHeaderHeight,Qi=M.widgetTitleHeight,lg=M.scrollBarColor,Jp=M.scrollBarSize,nh=M.scrollBarTimeout,Eh=M.scrollBarMinLength,Ym=M.scrollBarInteractiveSize,Gi=M.zoomIncrement,jg=M.scrollZoomIncrement,wb=M.pinchZoomIncrement,el=M.zoomMax,ab=M.zoomMin,hb=M.createObject,lr=M.preventDefault,Ef=M.setImage,yd=M.getImage,_j=M.isImageComplete,Zb=M.drawCenterImage,jl=M.drawStretchImage,Fq=M.getId,Mi=M.callLater,is=M.cancelLater,rg=M.sortFunc,Wr=M.clone,jq=M.getClass,Mq=M.startAnim,hq=M.brighter,yp=M.darker,Se=M.drawText,bi=M.getTextSize,$h=M.isLeftButton,$i=M.isMiddleButton,Je=M.isRightButton,rn=M.getTouchCount,zr=M.isDoubleClick,ck=M.isShiftDown,qp=M.isCtrlDown,Yi=M.getClientPoint,Ri=M.getPagePoint,Hh=M.getDistance,vn=M.unionPoint,sm=M.unionRect,Do=M.containsPoint,Yr=M.containsRect,op=M.intersectsRect,hp=M.intersection,Ie=M.getWindowInfo,Ti=M.grow,Hk=M.getLogicalPoint,me=M.getScreenPoint,Tl=M.startDragging,Qn=M.removeHTML,Nf=M.createElement,dp=M.segmentResolution,ae=M.shapeResolution,Ze=M.shapeSide,uj=M.def,Qq=function(D,U,r){uj(H+"."+D,U,r)},Lk=function(R,H){R.childNodes.forEach(function(c){H(c),Lk(c,H)})};zb(M,{toolTipLabelColor:Hj,toolTipLabelFont:vk,toolTipBackground:b.toolTipBackground,toolTipShadowColor:cc,debugTipLabelFont:vk,debugTipLabelColor:Hj,debugTipBackground:b.toolTipBackground,drawBreakableText:Yk,setDevicePixelRatio:function(E){Jh=M.devicePixelRatio="number"==typeof E?E:kj(W),Lk($.body,function(Z){var W=Z._ht;W&&W._canvas&&(Sk(W._canvas,W.getWidth(),W.getHeight()),W.redraw?W.redraw():W.iv())})},getPosition3dGap:function(){return sc()}},!0);var Qd=1e-6,gb="undefined"!=typeof Uint16Array?Uint16Array:Array,Ih="undefined"!=typeof Uint32Array?Uint32Array:gb,yk="undefined"!=typeof Float32Array?Float32Array:Array,Dk=function(J,S,c){var X=[J[0]-S[0],J[1]-S[1],J[2]-S[2]];if(c){var O=Hh(X);O>0&&(X[0]/=O,X[1]/=O,X[2]/=O)}return X},qj=function(){var M="charCodeAt",w=2*(2*Rm.length+1);for(var N in W)if(N===H+wk[0]+(Zh.length+2)){var v=W[N];if(!v)break;for(var P=v.length,D=0;P>D;D++)if(v[D][M](0)===w&&v[D+1]!=q&&v[D+1]===Zh[0]&&v[D+2]!=q&&v[D+2][M](0)===w){for(var g=D+3;P>g;g++)if(v[g][M](0)===w){if(0==v[g+1])for(var _,k=g+2;P>k;k++){if(v[k][M](0)===w){0==v[k-1]&&_&&(wc=_.substr(0,_.length-1));break}_==q?_=v[k]:_+=v[k]}break}break}break}return function(N){return[-N[0],-N[1],-N[2]]}}(),Tp=function(n,Q){return 3===n.length?n[0]*Q[0]+n[1]*Q[1]+n[2]*Q[2]:n[0]*Q[0]+n[1]*Q[1]},Sj=function(){var z=new Array(16);return z[0]=1,z[1]=0,z[2]=0,z[3]=0,z[4]=0,z[5]=1,z[6]=0,z[7]=0,z[8]=0,z[9]=0,z[10]=1,z[11]=0,z[12]=0,z[13]=0,z[14]=0,z[15]=1,z},Gl=Sj(),li=function(Q){var r=new Array(16);return r[0]=Q[0],r[1]=Q[1],r[2]=Q[2],r[3]=Q[3],r[4]=Q[4],r[5]=Q[5],r[6]=Q[6],r[7]=Q[7],r[8]=Q[8],r[9]=Q[9],r[10]=Q[10],r[11]=Q[11],r[12]=Q[12],r[13]=Q[13],r[14]=Q[14],r[15]=Q[15],r},Vm=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l[9]=d[9],l[10]=d[10],l[11]=d[11],l[12]=d[12],l[13]=d[13],l[14]=d[14],l[15]=d[15],l},Nl=function(b){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Vk=function(N,x){var n=N[0],p=N[1],J=N[2];return N[0]=x[0]*n+x[4]*p+x[8]*J+x[12],N[1]=x[1]*n+x[5]*p+x[9]*J+x[13],N[2]=x[2]*n+x[6]*p+x[10]*J+x[14],N},Ji=function(p,X){var z=p[0],f=p[1],Z=p[2],P=p[3];return p[0]=X[0]*z+X[4]*f+X[8]*Z+X[12]*P,p[1]=X[1]*z+X[5]*f+X[9]*Z+X[13]*P,p[2]=X[2]*z+X[6]*f+X[10]*Z+X[14]*P,p[3]=X[3]*z+X[7]*f+X[11]*Z+X[15]*P,p},eq=function(){var E,T,B,q,i=ag(Nr[1]+Nr[7]),y=ag(Nr[0]+Nr[3]-Nr[10]),G=ag(Nr[8]+2),V=function(){return T=B.charAt(E),E+=1,T},e=function(){var t="";if(T===G)for(;V();){if(T===G)return V(),t;t+=T}else V()},g=function(){for(;T&&" ">=T;)V()},Y=function(){var t,l={};if(T===i){if(V(),g(),T===y)return V(),l;for(;T;){if(t=e(),g(),V(),l[t]=q(),g(),T===y)return V(),l;V(),g()}}};return q=function(){switch(g(),T){case i:return Y();default:return e()}},function(Y){if(U={},Y){var s;if(B=Y,E=0,T=" ",s=q(),g(),!T)return s}}}(),Xc=function(r,T){if(T){var N=o(T),p=O(T),Q=r[4],Y=r[5],M=r[6],c=r[7],y=r[8],H=r[9],w=r[10],L=r[11];r[4]=Q*p+y*N,r[5]=Y*p+H*N,r[6]=M*p+w*N,r[7]=c*p+L*N,r[8]=y*p-Q*N,r[9]=H*p-Y*N,r[10]=w*p-M*N,r[11]=L*p-c*N}},ai=function(l,D){if(D){var L=o(D),M=O(D),b=l[0],x=l[1],G=l[2],B=l[3],Z=l[8],y=l[9],s=l[10],H=l[11];l[0]=b*M-Z*L,l[1]=x*M-y*L,l[2]=G*M-s*L,l[3]=B*M-H*L,l[8]=b*L+Z*M,l[9]=x*L+y*M,l[10]=G*L+s*M,l[11]=B*L+H*M}},mi=function(T,y){if(y){var M=o(y),h=O(y),c=T[0],k=T[1],J=T[2],N=T[3],Y=T[4],L=T[5],t=T[6],g=T[7];T[0]=c*h+Y*M,T[1]=k*h+L*M,T[2]=J*h+t*M,T[3]=N*h+g*M,T[4]=Y*h-c*M,T[5]=L*h-k*M,T[6]=t*h-J*M,T[7]=g*h-N*M}},bg=function(G,S,F){return vl(q,F===!1?q:G.getFinalScale3d(),G.getFinalRotation3d(),G.getRotationMode(),G.p3(),q,S)},vl=function(f,u,b,q,y,p,x){return p||(p=Sj()),y&&Um(p,y),Ah(p,b,q),x&&ds(p,p,x),u&&xh(p,u),f&&ds(p,p,f),p},an=function(v,Y,g){Y=hd(Y),g=hd(g);var L=this;L.g=v,L._84O=Y,L._85O=g,L._70I=!0,L.F=0,L._83O=Y+g,L.pen={x:0,y:0}},wq="lineDashOffset",Ob="setLineDash",Kk=function(W){for(var z in W)1===z.length&&(wq=W[z]);return z?1:0},Jr=function(C,l,N){return ob(l)?C:C[Ob]?(C[Ob](l),N&&(C.lineDashOffset=N),C):new an(C,l[0],l.length>1?l[1]:l[0])},Ui=function(d,V){!ob(V)&&d[Ob]&&(d[Ob](Gb),d.lineDashOffset=0)};uj(an,u,{_69I:6,moveTo:function(G,M){var f=this,g=f.pen;g.x=G,g.y=M,f.g.moveTo(G,M),f.start||(f.start={x:G,y:M})},lineTo:function(_,f){var J=this,F=J.pen,I=_-F.x,u=f-F.y,B=Cl(u,I),A=O(B),K=o(B),P=J._23O(F.x,F.y,_,f),x=J._85O,W=J._84O,d=J._83O;if(J.F){if(J.F>P)return J._70I?J._72I(_,f):J.moveTo(_,f),J.F-=P,void 0;if(J._70I?J._72I(F.x+A*J.F,F.y+K*J.F):J.moveTo(F.x+A*J.F,F.y+K*J.F),P-=J.F,J.F=0,J._70I=!J._70I,!P)return}var q=L(P/d);if(q){for(var k=A*W,w=K*W,Z=A*x,l=K*x,C=0;q>C;C++)J._70I?(J._72I(F.x+k,F.y+w),J.moveTo(F.x+Z,F.y+l)):(J.moveTo(F.x+Z,F.y+l),J._72I(F.x+k,F.y+w));P-=d*q}J._70I?P>W?(J._72I(F.x+A*W,F.y+K*W),J.moveTo(_,f),J.F=x-(P-W),J._70I=!1):(J._72I(_,f),P===W?(J.F=0,J._70I=!J._70I):(J.F=W-P,J.moveTo(_,f))):P>x?(J.moveTo(F.x+A*x,F.y+K*x),J._72I(_,f),J.F=W-(P-x),J._70I=!0):(J.moveTo(_,f),P===x?(J.F=0,J._70I=!J._70I):J.F=x-P)},quadraticCurveTo:function(j,g,V,n){var A,q=this,U=q.pen,M=U.x,P=U.y,f=q._22O(M,P,j,g,V,n),s=0,E=0,G=q._85O,i=q._84O;if(q.F){if(q.F>f)return q._70I?q._71I(j,g,V,n):q.moveTo(V,n),q.F-=f,void 0;if(s=q.F/f,A=q._20O(M,P,j,g,V,n,s),q._70I?q._71I(A[2],A[3],A[4],A[5]):q.moveTo(A[4],A[5]),q.F=0,q._70I=!q._70I,!f)return}var T=f-f*s,v=L(T/q._83O),F=i/f,c=G/f;if(v)for(var l=0;v>l;l++)q._70I?(E=s+F,A=q._21O(M,P,j,g,V,n,s,E),q._71I(A[2],A[3],A[4],A[5]),s=E,E=s+c,A=q._21O(M,P,j,g,V,n,s,E),q.moveTo(A[4],A[5])):(E=s+c,A=q._21O(M,P,j,g,V,n,s,E),q.moveTo(A[4],A[5]),s=E,E=s+F,A=q._21O(M,P,j,g,V,n,s,E),q._71I(A[2],A[3],A[4],A[5])),s=E;T=f-f*s,q._70I?T>i?(E=s+F,A=q._21O(M,P,j,g,V,n,s,E),q._71I(A[2],A[3],A[4],A[5]),q.moveTo(V,n),q.F=G-(T-i),q._70I=!1):(A=q._19O(M,P,j,g,V,n,s),q._71I(A[2],A[3],A[4],A[5]),f===i?(q.F=0,q._70I=!q._70I):(q.F=i-T,q.moveTo(V,n))):T>G?(E=s+c,A=q._21O(M,P,j,g,V,n,s,E),q.moveTo(A[4],A[5]),A=q._19O(M,P,j,g,V,n,E),q._71I(A[2],A[3],A[4],A[5]),q.F=i-(T-G),q._70I=!0):(q.moveTo(V,n),T===G?(q.F=0,q._70I=!q._70I):q.F=G-T)},bezierCurveTo:function(){var V=arguments;this.pen={x:V[4],y:V[5]},this.g.bezierCurveTo(V[0],V[1],V[2],V[3],V[4],V[5])},arc:function(G,r,m,V,K,b){b||(V=-V,K=-K),mj(this,G,r,V,K-V,m,m,!1)},rect:function(E,e,q,V){var L=this;L.pen={x:E,y:e},L.moveTo(E,e),L.lineTo(E,e+V),L.lineTo(E+q,e+V),L.lineTo(E+q,e),L.lineTo(E,e)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(x,q,I,v){var u=I-x,U=v-q;return h(u*u+U*U)},_22O:function(N,Y,p,T,Q,t,r){for(var W,R,l,O,V,z,v,Z=0,c=N,F=Y,H=r>0?r:this._69I,C=1;H>=C;C++)l=C/H,O=1-l,V=O*O,z=2*l*O,v=l*l,W=V*N+z*p+v*Q,R=V*Y+z*T+v*t,Z+=this._23O(c,F,W,R),c=W,F=R;return Z},_21O:function(N,w,O,z,Z,G,f,E){var T=this;if(0===f)return T._20O(N,w,O,z,Z,G,E);if(1===E)return T._19O(N,w,O,z,Z,G,f);var b=T._20O(N,w,O,z,Z,G,E);return b.push(f/E),T._19O.apply(T,b)},_20O:function(R,H,g,C,S,i,E){if(1!==E){var A=g+(S-g)*E,m=C+(i-C)*E;g=R+(g-R)*E,C=H+(C-H)*E,S=g+(A-g)*E,i=C+(m-C)*E}return[R,H,g,C,S,i]},_19O:function(G,s,O,Y,n,j,C){if(1!==C){var V=G+(O-G)*C,K=s+(Y-s)*C;O+=(n-O)*C,Y+=(j-Y)*C,G=V+(O-V)*C,s=K+(Y-K)*C}return[G,s,O,Y,n,j]},_72I:function(P,h){var k=this.pen;(P!==k.x||h!==k.y)&&(k.x=P,k.y=h,this.g.lineTo(P,h))},_71I:function(N,E,B,s){var W=this.pen;(N!==B||E!==s||B!==W.x||s!==W.y)&&(W.x=B,W.y=s,this.g.quadraticCurveTo(N,E,B,s))}}),Mp.ms_quickVisible=function(l){l._4BQ=!1,l._4CQ=function(n){var x=n._4EQ;return x!==A?x:x=n._4EQ=this._4FQ(n)},l._4DQ=function(U){if(!U)return this.dm().each(function(f){f._4EQ=A}),void 0;U._4EQ=A;var J=this;if(U instanceof df||qq(U)||U instanceof bo||U.ISubGraph)U.eachChild(function(A){J.invalidateQuickVisible(A)});else if(U.getEdges){var z=U.getEdges();z&&z.each(function(r){J.invalidateQuickVisible(r)})}},l.enableQuickVisibleMode=function(){this._4BQ||(this._4BQ=!0,this._4FQ=this.isVisible,this.isVisible=this._4CQ,this.invalidateQuickVisible=this._4DQ)},l.disableQuickVisibleMode=function(){this._4BQ&&(this._4BQ=!1,this.isVisible=this._4FQ,this.invalidateQuickVisible=pr)},l.isQuickVisibleMode=function(){return this._4BQ},l.invalidateQuickVisible=pr},Ec=ol()+1,Gr&&W.console&&Ec&&!1&&(W.navigator&&W.navigator.userAgent.toLowerCase().indexOf("chrome")>-1?W.console.log.apply(console,["Hightopo - Version："+x.Default.getVersion()+" - %cTrial：http://hightopo.com/request.html","color: #f00;"]):W.console.log("Hightopo - Version："+x.Default.getVersion()+" - Trial：http://hightopo.com/request.html"));var nr=q,sq=q,Sm=M.checkLoadingCompType=function(J){nr&&!J._72O_&&(sq||(sq={}),sq[J._72O_=Fq()]=J)},Hd=function(U,t){if(t||(t=U),t&&(nr||(nr={}),!nr[U])){var v=new Gd;if(nr[t]={request:v,url:t},t=M.beforeLoadURL(t,U),t.data){var S=M.parse(t.data);wi(U,S),M.handleCompTypeLoaded(U,S)}else{v.onload=function(){if(200===this.status||0===this.status){var H=M.parse(v.getResponseText());wi(U,H),M.handleCompTypeLoaded(U,H)}else wi(U,q)},v.onerror=function(){wi(U,q)};var p={};p.url=encodeURI(t),p.sync=!1,v.send(p)}}},wi=function(T,h){if(Fi[T]=h,delete nr[T],Er(nr)&&(nr=q,sq)){for(var E in sq){var G=sq[E];G.invalidateAll&&G.invalidateAll(A,"compTypeLoaded",T),G.redraw&&G.redraw(),G.iv(),delete G._72O_}sq=q}if(h&&sq)for(var E in sq){var G=sq[E];G.invalidateAll&&G.invalidateAll(A,"compTypeLoading",T),G.redraw&&G.redraw(),G.iv()}},yg=b.chart,Lp="",Jo=!0,Rf=M.compStack=[],ej=/^style@/,Lo=/^attr@/,Jl=/^field@/,te={x:.5,y:.5},qs=function(){Jo=!0},Ap=function(){return Jo},ls=function(E,k,r){if(!E)return!1;var T;return r&&r.isImageFitSize&&(T=r.isImageFitSize(k,E)),T==q&&(T=gl(E.fitSize,k,r)),T},Wq=function(A,H,j,K){if(!A)return 0;if(ls(A,H,j)&&K)return K;var a=gl(A.width,H,j);return null==a?20:a},pm=function(p,y,L,U){if(!p)return 0;if(ls(p,y,L)&&U)return U;var g=gl(p.height,y,L);return null==g?20:g},gl=function(c,V,G){if(!c||!c.func)return c;var p,D=c.func,g=c.value;return p=hc(D)?G&&G.vectorDataBindingDisabled&&!c.isSafeFunc?g:D(V,G):V instanceof Vp||(x.ui?V instanceof x.ui.View:0)?Lo.test(D)?V.a(Lp+D.slice(5)):ej.test(D)?V.s(Lp+D.slice(6)):Jl.test(D)?V[D.slice(6)]:V[D]?V[D](G):g:g,g!==A&&p==q?g:p},xb=M.drawImage=function(){var X,G,Y,K,s,R,u=3,n=6,m=function(z,d){z.getValue&&z.getValue.compType===d||(z.getValue=function(k){var g=y(z,k);if(g===A&&d.properties){var C=d.properties[k];C&&(g=C.defaultValue)}return g},z.getColor=function(A,d){return d===!0?f(A):f(z.getValue(A))},z.getValue.compType=d)},y=function($,o,U){var X,l=!1;if($.prefix&&G instanceof Vp){var B=G.a(Lp+o);B!==A&&(l=!0,X=B)}return X===A&&(X=$[o]),X&&X.func&&(l=!0,X=gl(X,G,Y)),U&&(X=U(X),l||($[o]=X)),X},f=function(K,h){var x;return x=h?y(K,h):K,X&&X.compGray&&x?M.toGrayColor(x):s&&x?Of(x,s,R):x},h=function(G){if(bj(G)){for(var X=new lo,H=G.length,W=0;H>W;W+=2)X.add({x:G[W],y:G[W+1]});G=X}return G},F=function(a){var T=y(a,"anchorX"),h=y(a,"anchorY");if(T!==A||h!==A)return{x:T===A?te.x:T,y:h===A?te.y:h};var g=y(a,"type"),r=y(a,"name");if("image"!==g||!r)return te;var L=yd(r);return L&&L.anchorX!==A&&L.anchorY!==A?{x:L.anchorX,y:L.anchorY}:te},w=function(R,H){var E=y(R,jk),n=F(R);if(bj(E)){var g=E.length,o=y(R,"relative"),B=H.width,_=H.height;if(4===g)E={x:E[0],y:E[1],width:E[2],height:E[3]},o&&(E.x*=B,E.y*=_,E.width*=B,E.height*=_);else if(3===g){var K=E[0];E={width:E[1],height:E[2]},o&&(E.width*=B,E.height*=_),"object"==typeof K?K.length&&(K={x:K[0],y:K[1]}):K=oo(K,H,E),E.x=K.x-E.width*n.x,E.y=K.y-E.height*n.y}E.x+=y(R,"offsetX")||0,E.y+=y(R,"offsetY")||0,!o&&H.fitSize&&(E=T(R,E,H))}return E},T=function(D,P,J){if(P){var Y,k,g,x={x:P.x,y:P.y,width:P.width,height:P.height},d=F(D),M=y(D,"layoutH"),p=y(D,"layoutV"),H=1,e=1,U=0,Z=0,A=1,w=1;switch(M){case"left":break;case"right":x.x+=J.width-J.rw;break;case"center":x.x+=.5*(J.width-J.rw);break;case"scale":case"leftright":default:Y=y(D,Ci)||0,Y&&(U=Math.abs(Z=Math.sin(Y)),A=Math.abs(w=Math.cos(Y))),"leftright"!==M?(H+=A*(J.widthScale-1),e+=U*(J.widthScale-1)):(H+=x.width?A*(J.width-J.rw)/x.width:0,e+=x.height?U*(J.width-J.rw)/x.height:0,k=-Math.min(-d.x*w+d.y*Z,-d.x*w-(1-d.y)*Z,(1-d.x)*w+d.y*Z,(1-d.x)*w-(1-d.y)*Z))}switch(p){case"top":break;case"bottom":x.y+=J.height-J.rh;break;case"center":x.y+=.5*(J.height-J.rh);break;case"scale":case"topbottom":default:Y==q&&(Y=y(D,Ci),Y&&(U=Math.abs(Z=Math.sin(Y)),A=Math.abs(w=Math.cos(Y)))),"topbottom"!==p?(H+=U*(J.heightScale-1),e+=A*(J.heightScale-1)):(H+=x.width?U*(J.height-J.rh)/x.width:0,e+=x.height?A*(J.height-J.rh)/x.height:0,g=-Math.min(-d.x*Z-d.y*w,-d.x*Z+(1-d.y)*w,(1-d.x)*Z-d.y*w,(1-d.x)*Z+(1-d.y)*w))}return(1!==H||1!==e)&&("scale"!==M&&M?"leftright"===M&&(x.x+=x.width*(1-H)*d.x+k*(J.width-J.rw)):x.x+=x.x*(J.widthScale-1)+d.x*x.width*(J.widthScale-H),"scale"!==p&&p?"topbottom"===p&&(x.y+=x.height*(1-e)*d.y+g*(J.height-J.rh)):x.y+=x.y*(J.heightScale-1)+d.y*x.height*(J.heightScale-e),x.width*=H,x.height*=e),x.width<0&&(x.width=0),x.height<0&&(x.height=0),x}},S=function(X){return bj(X)?new lo(X):X},j=function(r,R,S,e,E,G,p){var x=X.interactiveInfo,I=r.transform;if(I)return X.save(),X.setTransform(I.a,I.b,I.c,I.d,I.tx,I.ty),x&&x.compInfos.push({comp:r,rect:R,matrix:I.clone(),prefix:Lp,refRect:x.refRect}),!0;E===A&&(E=1),G===A&&(G=1);var i=y(r,"clipPercentage"),g=Uj(S,R);if(g&&!e&&1===E&&1===G&&i==A)return x&&x.compInfos.push({comp:r,rect:R,matrix:x.matrix.clone(),prefix:Lp,refRect:x.refRect}),!1;p=p||te;var W=R.x+R.width*p.x,V=R.y+R.height*p.y,C=S.x+S.width*p.x,t=S.y+S.height*p.y,m=S.width?E*(R.width/S.width):1,_=S.height?G*(R.height/S.height):1;if(X.save(),x&&(x.matrix.appendTranslate(W,V).appendRotate(e).appendScale(m,_).appendTranslate(-C,-t),x.compInfos.push({comp:r,rect:R,matrix:x.matrix.clone(),prefix:Lp,refRect:x.refRect})),hi(X,W,V),Cm(X,e||0),pq(X,m,_),hi(X,-C,-t),i!=A){var k=jj(S,y(r,"clipDirection"),i);X.beginPath(),X.rect(k.x,k.y,k.width,k.height),X.clip()}return!0},C=function(){X.restore()},P=function(V,v,I){var L=y(V,"path"),J=y(V,Ci),o=y(V,"scaleX"),P=y(V,"scaleY"),h=F(V),d=q,B=xg(null,L);if(I||(I=V.unionRect,I||(I=vn(B),V.path.func||(V.unionRect=I)),d=I),I){d||(d=V.unionRect,d||(d=vn(B),V.path.func||(V.unionRect=d)));var i=j(V,I,d,J,o,P,h),A=y(V,"borderPattern"),E=Jr(X,A),e=f(V,"background"),m=f(V,"borderColor"),H=y(V,"borderWidth"),w=y(V,"gradient"),b=f(V,"gradientColor"),u=y(V,"border3d"),D=f(V,"border3dColor"),M=y(V,"border3dAccuracy"),a=X.lineJoin,W=X.lineCap;X.lineJoin=y(V,"borderJoin")||Wl,X.lineCap=y(V,"borderCap")||jo,e?(mg(X,e,w,b,d),xg(X,L),X.fill(),E!==X&&xg(X,L)):xg(X,L);var S=y(V,"borderWidthAbsolute");if(S&&(X.save(),X.setTransform(1,0,0,1,0,0)),H&&m&&(X.lineWidth=H,X.strokeStyle=m,X.stroke(),u&&Gm(X,m,D,H,K,M)),Ui(X,A),y(V,"dash")){var p=y(V,"dashWidth")||H;if(p>0){A=y(V,"dashPattern")||Qr;var E=Jr(X,A,y(V,"dashOffset")),R=f(V,"dashColor")||f(kn);E!==X&&xg(X,L),X.strokeStyle=R,X.lineWidth=p,X.stroke(),y(V,"dash3d")&&Gm(X,R,f(V,"dash3dColor"),p,K,y(V,"dash3dAccuracy")),Ui(X,A)}}S&&X.restore(),v===jk&&Zk(X,e,y(V,"depth"),d),X.lineJoin=a,X.lineCap=W,i&&C()}},D=function(g,u,x,_){var E=y(g,kh,h),z=y(g,Ci),l=F(g);if(E&&_.fitSize){var i=new lo,w=vn(E),v=T(g,w,_),M=w.x+l.x*w.width,e=w.y+l.y*w.height,c=v.x+l.x*v.width,H=v.y+l.y*v.height,r=w.width?v.width/w.width:1,d=w.height?v.height/w.height:1;E.each(function(s){i.add({x:c+(s.x-M)*r,y:H+(s.y-e)*d})}),E=i,g.unionRect=null}var t=y(g,"scaleX"),a=y(g,"scaleY"),I=u===Xi,D=q;if(!x&&I&&(x=g.unionRect,x||(x=vn(E),g.points.func||(g.unionRect=x)),D=x),x){I?D||(D=g.unionRect,D||(D=vn(E),g.points.func||(g.unionRect=D))):D=x;var W,m,P,k,N=j(g,x,D,z,t,a,l),U=y(g,"borderPattern"),Q=Jr(X,U),L=f(g,"background"),n=yd(y(g,"repeatImage"),s,R),J=y(g,"gradientPack"),B=y(g,"borderGradientPack"),p=f(g,"borderColor"),o=y(g,"borderWidth"),O=yd(y(g,"borderRepeatImage"),s,R),Z=y(g,"segments",S),V=y(g,"gradient"),$=f(g,"gradientColor"),b=y(g,"border3d"),Tf=f(g,"border3dColor"),Uc=y(g,"border3dAccuracy"),ej=y(g,"closePath"),as=y(g,"fillRule")||"nonzero",Nr=X.lineJoin,Fi=X.lineCap;if(X.lineJoin=y(g,"borderJoin")||Wl,X.lineCap=y(g,"borderCap")||jo,I)if(L||n||J){var Ao=y(g,"fillClipPercentage");if(Ao!=A){var Xj=jj(D,y(g,"fillClipDirection"),Ao);X.save(),X.beginPath(),X.rect(Xj.x,Xj.y,Xj.width,Xj.height),X.clip()}Bg(X,E,Z,ej),J?mc(X,J,f,!1,D):n?fk(X,n,s,R,G,Y):mg(X,L,V,$,D),X.fill(as),J&&X.restore(),Ao!=A&&X.restore(),Q!==X&&Bg(Q,E,Z,ej)}else Bg(Q,E,Z,ej);else if("roundRect"===u?W=y(g,"cornerRadius"):"polygon"===u?(W=y(g,"polygonSide"),m=y(g,"cornerRadius"),P=y(g,"regular")):"arc"===u&&(W=y(g,"arcFrom"),m=y(g,"arcTo"),P=y(g,"arcClose"),k=y(g,"arcOval")),L||n||J){var Ao=y(g,"fillClipPercentage");if(Ao!=A){var Xj=jj(D,y(g,"fillClipDirection"),Ao);X.save(),X.beginPath(),X.rect(Xj.x,Xj.y,Xj.width,Xj.height),X.clip()}Ep(X,u,D,W,m,P,k),J?mc(X,J,f,!1,D):n?fk(X,n,s,R,G,Y):mg(X,L,V,$,D),X.fill(as),J&&X.restore(),Ao!=A&&X.restore(),X!==Q&&Ep(Q,u,D,W,m,P,k)}else Ep(Q,u,D,W,m,P,k);var $l=y(g,"borderWidthAbsolute");if($l&&(X.save(),X.setTransform(1,0,0,1,0,0)),o&&(p||O||B)&&(X.lineWidth=o,B?mc(X,B,f,!0,D):O?_h(X,O,s,R,G,Y):X.strokeStyle=p,X.stroke(),B&&X.restore(),b&&Gm(X,p,Tf,o,K,Uc)),Ui(X,U),y(g,"dash")){var Xb=y(g,"dashWidth")||o;if(Xb>0){U=y(g,"dashPattern")||Qr;var Q=Jr(X,U,y(g,"dashOffset")),jh=f(g,"dashColor")||f(kn);Q!==X&&(I?Bg(Q,E,Z,ej):Ep(Q,u,D,W,m,P,k)),X.strokeStyle=jh,X.lineWidth=Xb,X.stroke(),y(g,"dash3d")&&Gm(X,jh,f(g,"dash3dColor"),Xb,K,y(g,"dash3dAccuracy")),Ui(X,U)}}$l&&X.restore(),u===jk&&Zk(X,L,y(g,"depth"),D),X.lineJoin=Nr,X.lineCap=Fi,N&&C()}},$=function(g,E){var w=s||y(g,_n),k=R||y(g,"blendMode"),t=y(g,"name"),f=yd(t,w,k);f&&f.cacheRule!=q&&(f=Pg(X,f,y(g,"stretch"),E.width,E.height,G,Y,w)),f?jl(X,f,y(g,"stretch"),E.x,E.y,E.width,E.height,G,Y,w,null,k):Jo=!1},r=function(W,Q){var C=y(W,"text");if(C!=q){C+="";var S,w=y(W,"gradientPack"),B=y(W,"gradient"),U=f(W,"gradientColor"),R=y(W,"font"),P=y(W,"vertical"),o=y(W,"verticalGap")||0,i=y(W,"align"),v=y(W,"vAlign"),O=y(W,"decoration"),g=y(W,"letterGap")||0,z=y(W,"wrap"),Y=y(W,"borderWidth"),t=y(W,"borderColor"),D=bi(R,C);if(w?(S=mc(X,w,f,!1,Q),X.restore()):S=f(W,_n),!w&&B&&(S=M.createGradient(X,B,S||M.labelColor,U||b.imageGradient,Q.x,Q.y,Q.width,Q.height)),Y&&bj(t)&&(t=mc(X,t,f,!1,Q),X.restore()),P){null==o&&(o=1);var n,H,A,I=[],$=[];n=z?wj(C,Q.height,R,g,P,o):[C],X.textBaseline=vg,X.font=R,n.forEach(function(S){for(var c=S.length,z=0,p=(c-1)*o,Z=0;c>Z;Z++){var r=X.measureText(S[Z]);I.push(r),p+=r.fontBoundingBoxDescent||D.height,z=E(z,r.width)}$.push({width:z,height:p})});var h=(n.length-1)*g;$.forEach(function(F){h+=F.width}),H=i&&i!==wk?i===Bj?Q.x+Q.width-h:Q.x+(Q.width-h)/2:Q.x;var F=0;n.forEach(function(V,n){var K=$[n],y=V.length;A=v&&v!==cq?v===vg?Q.y:Q.y+Q.height-K.height:Q.y+(Q.height-K.height)/2;for(var L=0;y>L;L++){var M=V[L],Z=I[F],r=Z.fontBoundingBoxDescent||D.height;rc(X,M,R,S,{x:H,y:A,width:K.width,height:r},kl,v,O,g,Y,t),A+=r+o,F++}H+=K.width+g})}else{var n=z?wj(C,Q.width,R,g,P,o):C.split("\n"),V=n.length;if(V>1){var a=bi(R,C),u=a.height,K=V*u+o*(V-1),p=Wr(Q);return v&&v!==cq?v===rj&&(p.y=Q.y+Q.height-K):p.y=Q.y+(Q.height-K)/2,p.height=K,Yk(X,n,p,R,S,i||wk,O,g,Y,t),void 0}rc(X,C,R,S,Q,i,v,O,g,Y,t)}}},Z=function(w,P){Co(X,f(w,_n),P.x,P.y,P.width,P.height,y(w,"width"))},k=function(V,I){var Z=y(V,Pm),r=0;if(Z&&(Z.forEach(function(l){r+=l}),r>0)){for(var g=y(V,"colors")||yg,D=y(V,"startAngle")||0,l=y(V,"hollow"),L=y(V,dd),S=y(V,we),T=y(V,Cg),m=L?new lo:q,f=I.x,N=I.y,C=I.width,s=I.height,M=f+C/2,t=N+s/2,z=e(C,s)/2,A=0,R=0;R<Z.length;R++){var a=Z[R],_=c*a/r,K=D+_;if(X.fillStyle=g[A++],A===g.length&&(A=0),X.beginPath(),l){var h=M+O(D)*z/2,Q=t+o(D)*z/2,U=M+O(K)*z,B=t+o(K)*z;X.moveTo(h,Q),X.arc(M,t,z/2,D,K,!1),X.lineTo(U,B),X.arc(M,t,z,K,D,!0)}else X.moveTo(M,t),X.arc(M,t,z,K,D,!0);m&&(_=(D+K)/2,m.add({text:hc(L)?L(a,R,r,G):a,x:M+.75*O(_)*z,y:t+.75*o(_)*z})),X.closePath(),X.fill(),D=K}m&&m.each(function(w){Se(X,w.text,S,T,w.x,w.y,0,0,kl)})}},Q=function(u,P){var k=y(u,ij);if(k&&k.length>0){var L=k.length,h=y(u,dd),T=y(u,we),e=y(u,Cg),z=h?new lo:q,V=y(u,"minValue")||0,M=y(u,"maxValue");
if(M==q&&(M=0,k.forEach(function(k){y(k,Pm).forEach(function(i){M=E(M,i)})})),V===M)return;for(var C=P.height/(M-V),W=P.y+M*C,I=y(k[0],Pm).length,H=P.width/(3*I+1),Z=2*H/L,_=0,l=0;L>l;l++)for(var i=k[l],Q=y(i,_n),c=y(i,"colors"),Y=y(i,Pm),D=0;I>D;D++){c?X.fillStyle=c[D]:Q?X.fillStyle=Q:(X.fillStyle=yg[_++],_===yg.length&&(_=0));var b=Y[D],A=b*C,f=P.x+(1+3*D)*H+l*Z;if(Dh(X,f,W-A,Z,A),z){var x=hc(h)?h(b,D,i,G):b,s=bi(T,x).height;z.add({x:f,y:W-A-s,width:Z,height:s,text:x})}}z&&z.each(function(H){Se(X,H.text,T,e,H.x,H.y,H.width,H.height,kl)})}},l=function(d,M){var S=y(d,ij);if(S&&S.length>0){var m=S.length,c=y(S[0],Pm).length,T=M.width/(3*c+1),O=0,u=y(d,"maxValue"),N=y(d,dd),o=y(d,we),Q=y(d,Cg),x=N?new lo:q;if(u==q){u=0;for(var r=0;c>r;r++){for(var s=0,w=0;m>w;w++)s+=y(S[w],Pm)[r];u=E(u,s)}}if(u>0){for(var r=0;c>r;r++)for(var k=M.y+M.height,w=0;m>w;w++){var C=S[w],W=y(C,_n),B=y(C,Pm)[r],R=B/u*M.height;W?X.fillStyle=W:(X.fillStyle=yg[O++],O===yg.length&&(O=0)),k-=R;var Y={x:M.x+(1+3*r)*T,y:k,width:2*T,height:R};Dh(X,Y.x,Y.y,Y.width,Y.height),x&&(Y.text=hc(N)?N(B,r,C,G):B,x.add(Y))}x&&x.each(function(i){Se(X,i.text,o,Q,i.x,i.y,i.width,i.height,kl)})}}},i=function(D,F){var e=y(D,ij);if(e&&e.length>0){for(var t=e.length,r=y(e[0],Pm).length,w=F.width/(3*r+1),L=0,H=y(D,dd),d=y(D,we),K=y(D,Cg),a=H?new lo:q,k=0;r>k;k++){for(var T=0,V=0;t>V;V++)T+=y(e[V],Pm)[k];if(T>0){var A=F.y+F.height;for(V=0;t>V;V++){var I=e[V],Z=y(I,_n),C=y(I,Pm)[k],O=C/T*F.height;Z?X.fillStyle=Z:(X.fillStyle=yg[L++],L===yg.length&&(L=0)),A-=O;var s={x:F.x+(1+3*k)*w,y:A,width:2*w,height:O};Dh(X,s.x,s.y,s.width,s.height),a&&(s.text=hc(H)?H(C,k,I,G):C,a.add(s))}}}a&&a.each(function(H){Se(X,H.text,d,K,H.x,H.y,H.width,H.height,kl)})}},J=function(b,l){var J=y(b,ij);if(J&&J.length>0){var k=J.length,x=y(b,"minValue")||0,r=y(b,"maxValue");if(r==q&&(r=0,J.forEach(function(b){y(b,Pm).forEach(function(N){r=E(r,N)})})),x===r)return;for(var f=l.height/(r-x),B=l.y+r*f,s=y(J[0],Pm).length,e=l.width/(3*s+1),Y=0,V=y(b,"lineWidth")||2,_=y(b,"line3d"),A=y(b,"linePoint"),g=y(b,dd),w=y(b,we),a=y(b,Cg),d=0;k>d;d++){var n=J[d],j=y(n,_n),m=y(n,Pm);j?X.strokeStyle=j:(j=X.strokeStyle=yg[Y++],Y===yg.length&&(Y=0)),X.beginPath();for(var R=0;s>R;R++){var C=l.x+(2+3*R)*e,z=B-m[R]*f;0===R?X.moveTo(C,z):X.lineTo(C,z)}if(X.lineWidth=V,X.stroke(),_&&Gm(X,j,q,V,K),A||g){var F,h=V/2+2;for(R=0;s>R;R++){var O=m[R];if(C=l.x+(2+3*R)*e,z=B-O*f,hc(A)?A(X,C,z,j,R,n,G):A&&(X.fillStyle=j,X.beginPath(),X.arc(C,z,h,0,c,!0),X.fill()),hc(g)?F=g(O,R,n,G):g&&(F=O),F){var W=bi(w,F).height,T=X.shadowBlur;if(T){var S=X.shadowOffsetX,v=X.shadowOffsetY,L=X.shadowColor;X.shadowOffsetX=0,X.shadowOffsetY=0,X.shadowBlur=0,X.shadowColor=q}Se(X,F,w,a,C,z-W-h+2,0,W,kl),T&&(X.shadowOffsetX=S,X.shadowOffsetY=v,X.shadowBlur=T,X.shadowColor=L)}}}}}},I=function(A){X=A[0],G=A[1],Y=A[2],K=A[3],s=A[4],R=A[5]},V=function(){return[X,G,Y,K,s,R]},t=function(e,C){var M;Y&&Y.getDrawableState?M=Y.getDrawableState(G):Y&&Y.getState?M=Y.getState(G):(M=G instanceof Vp?G.s(td):null,(M===A||null===M)&&(M=y(e,td)));var N=y(C,td);return N!==A&&null!==N&&N!==M?!1:y(C,Vi)},g={border:Z,image:$,text:r,pieChart:k,columnChart:Q,stackedColumnChart:l,percentageColumnChart:i,lineChart:J};return function(d,_,E,i,p,c,r,T,z,L){if(_&&p&&c){var v=V();X=d,G=r,Y=T,!G&&Y&&Y.isSelfViewEvent&&(G=Y),K=Y?Y._zoom?Y._zoom:1:1,s=z,R=L;var B=p,J=c;if(Uh()){var H,b,O,U,Q,Z,N;0===X[ke]?Uh[0]&&(H=!0):H=!0,X.texureImage2D?Uh[1]&&(b=!0):b=!0,X.texureImage3D?Uh[2]&&(O=!0):O=!0,X.drawDNDState?Uh[3]&&(Q=!0):Q=!0,X.drawRect?Uh[we[2]]&&(N=!0):N=!0,x[Ij[1]+Ig[0]+Oi[1]]?Uh[Ig[0]]&&(Z=!0):Z=!0,tr.widget[0]?Uh[4]&&(U=!0):U=!0,H&&b&&O&&U&&Q&&Z&&N&&(B=E,J=i)}if(_.tagName)return ro(wc)&&!W[wc]||X.drawImage(_,B,J,p,c),I(v),void 0;if(0==y(_,"visible"))return I(v),void 0;s||(s=gl(_.color,G,Y)),L||(R=gl(_.blendMode,G,Y)),ro(wc)&&!W[wc]&&(p=B,c=J);var k=Wq(_,G,Y,p),e=pm(_,G,Y,c),$={x:0,y:0,width:k,height:e,fitSize:ls(_,G,Y)},l=y(_,"clip"),a=y(_,"opacity");if($.fitSize){var o=$.rw=gl(_.width,G,Y)||20;$.widthScale=k/o;var lc=$.rh=gl(_.height,G,Y)||20;$.heightScale=e/lc}if(X.save(),X.interactiveInfo){var Do=X.interactiveInfo.matrix,Ee=Do.clone();Do.appendTranslate(B,J).appendScale(p/k,c/e),X.interactiveInfo.refRect=$}hi(X,B,J),(k!==p||e!==c)&&X.scale(p/k,c/e),l&&(hc(l)?l(X,k,e,G,Y,_):(X.beginPath(),X.rect(0,0,k,e),X.clip())),a!=q&&(X.globalAlpha*=a),y(_,"comps").forEach(function(Q){if(Q.prefix){var c=Lp,N=gl(Q.prefix,G,Y);N&&(Lp=Lp+N+".")}if(0==t(_,Q))return Q.prefix&&(Lp=c),void 0;if(Rf.splice(0,0,Q),X.interactiveInfo)var z=X.interactiveInfo.matrix.clone();var O=y(Q,"opacity"),E=y(Q,"shadow"),V=y(Q,"type"),B=y(Q,"refRect")||$,p=w(Q,B);if(O!=q){var b=X.globalAlpha;X.globalAlpha*=O}if(E){var l=K*M.devicePixelRatio,i=X.shadowOffsetX,U=X.shadowOffsetY,T=X.shadowBlur,W=X.shadowColor,J=y(Q,"shadowOffsetX"),H=y(Q,"shadowOffsetY"),s=y(Q,"shadowBlur"),I=f(Q,"shadowColor");X.shadowOffsetX=(J==q?u:J)*l,X.shadowOffsetY=(H==q?u:H)*l,X.shadowBlur=(s==q?n:s)*l,X.shadowColor=I||f(Bc)}if("save"===V)X.save();else if("endClip"===V||"restore"===V)X.restore();else if("clip"===V)X.save(),Bg(X,y(Q,"points",h),y(Q,"segments",S),!0),X.clip();else if(Zg[V]){if(p=p||{x:0,y:0,width:B.width,height:B.height},D(Q,V,p,B),Q.prefix&&0===Q.prefix.indexOf("ui.")&&Y&&x.ui&&Y instanceof x.ui.View){Y._vectorCompInfo||(Y._vectorCompInfo=[]);for(var e=!1,a=0;a<Y._vectorCompInfo.length;a++){var L=Y._vectorCompInfo[a];if(Q.prefix===L.comp.prefix&&r===L.data){Y._vectorCompInfo[a]={comp:Q,type:V,rect:p,compRefRect:B,data:r,image:_,transform:X.getTransform()},e=!0;break}}e||Y._vectorCompInfo.push({comp:Q,type:V,rect:p,compRefRect:B,data:r,image:_,transform:X.getTransform()})}}else if(V===Xi)D(Q,V,p,B);else if("SVGPath"===V)P(Q,V,p);else{p=p||{x:0,y:0,width:B.width,height:B.height};var v=y(Q,Ci),k=y(Q,"scaleX"),d=y(Q,"scaleY"),o=F(Q),R=j(Q,p,p,v,k,d,o);if(hc(V))m(Q,V),M.drawCompType(V,X,p,Q,G,Y);else if(M.getCompType(V)){var Z=M.getCompType(V),Cn=Z.func||Z;m(Q,Z),M.drawCompType(Cn,X,p,Q,G,Y)}else g[V]?g[V](Q,p):M.getCompType(V)===A&&ve.test(V)&&(Hd(V),Jo=!1);R&&C()}E&&(X.shadowOffsetX=i,X.shadowOffsetY=U,X.shadowBlur=T,X.shadowColor=W),O!=q&&(X.globalAlpha=b),X.interactiveInfo&&(X.interactiveInfo.matrix=z),Q.prefix&&(Lp=c),Rf.splice(0,1)}),X.interactiveInfo&&(X.interactiveInfo.matrix=Ee),X.restore(),I(v)}}}();M.getCurrentComp=function(){return Rf[0]},M.getParentComp=function(){return Rf[1]},M.getInternal=function(){return{isEnter:yn,isEsc:$q,isSpace:Yo,isLeft:lp,isUp:zg,isRight:Up,isDown:Pk,addMethod:zb,superCall:Vq,toPointsArray:gi,translateAndScale:ih,appendArray:Te,createWorldMatrix:vl,vec3TransformMat4:Vk,setCanvas:Sk,createDiv:Kn,createView:bn,createCanvas:rs,createImage:sn,initContext:bc,layout:Xn,fillRect:Dh,Mat:rd,drawBorder:Co,isString:ro,setBorder:Sp,getPropertyValue:Gc,setPropertyValue:Ed,drawVerticalLine:cb,draw3DRect:Zk,getPinchDist:ce,isSameRect:Uj,getPosition:oo,intersectionLineRect:fb,getNodeRect:fm,getEdgeAgentPosition:fp,getEdgeHostPosition:Ye,getImageWidth:Wq,getImageHeight:pm,initItemElement:tg,drawPoints:Bg,createG2:Jr,closePopup:Th,isH:Gj,createAnim:En,createNormalMatrix:jn,makeUVMatrix:ps,toColorArray:qn,createNormals:am,toFloatArray:ok,glMV:Gq,glPop:Kh,batchShape:Ag,createNodeMatrix:bg,getShapeModel:Hf,getFaceInfo:tn,transformAppend:Hc,drawFaceInfo:If,glUploadData:Id,glUploadElementData:ho,glDrawArray:nf,glDrawElement:ei,glBindTexture:kf,pickValueToColor:Ws,to3dPointsArray:mh,setGLDebugMode:function(L){Jm=L},cube:function(){return{vs:qf,is:he,uv:Ql}},ui:function(){return{DataUI:fd,NodeUI:Xj,EdgeUI:_b,GroupUI:Hg,ShapeUI:Wm,GridUI:or,Data3dUI:kt,Node3dUI:lt,Shape3dUI:ot}},getInternalVersion:function(){return"U2FsdGVkX1/ONslLDoI7jcnTE6Dq993ka5e1+G8To/U="},getDragger:function(){return Yl},addMSMap:function(J){zb(Mp,J)},k:G,overrideTimerFunc:function(C,N){Mi=x.Default.callLater=C,is=x.Default.cancelLater=N},canEnterEditDetailMode:mn,addEventListener:X,removeEventListener:F,createGradientByPackedData:mc}},function(l){function v(F,i){F!=q&&(i==q&&ss!=typeof F?this._54O(F,256):this._54O(F,i))}function x(){return new v(q)}function t(g,K,i,y,Q,q){for(;--q>=0;){var j=K*this[g++]+i[y]+Q;Q=L(j/67108864),i[y++]=67108863&j}return Q}function f(P,Y,w,r,I,Q){for(var E=32767&Y,k=Y>>15;--Q>=0;){var Z=32767&this[P],R=this[P++]>>15,j=k*Z+R*E;Z=E*Z+((32767&j)<<15)+w[r]+(1073741823&I),I=(Z>>>30)+(j>>>15)+k*R+(I>>>30),w[r++]=1073741823&Z}return I}function R(K,C,p,g,O,M){for(var _=16383&C,r=C>>14;--M>=0;){var I=16383&this[K],W=this[K++]>>14,d=r*I+W*_;I=_*I+((16383&d)<<14)+p[g]+O,O=(I>>28)+(d>>14)+r*W,p[g++]=268435455&I}return O}function X(e){return wc.charAt(e)}function S(k,$){var n=Xb[k.charCodeAt($)];return n==q?-1:n}function Y(d){for(var u=this.t-1;u>=0;--u)d[u]=this[u];d.t=this.t,d.s=this.s}function C(G){this.t=1,this.s=0>G?-1:0,G>0?this[0]=G:-1>G?this[0]=G+this.DV:this.t=0}function T(Q){var B=x();return B._58O(Q),B}function I(i,W){var P,j=this;if(16==W)P=4;else if(8==W)P=3;else if(256==W)P=8;else if(2==W)P=1;else if(32==W)P=5;else{if(4!=W)return j.fromRadix(i,W),void 0;P=2}j.t=0,j.s=0;for(var E=i.length,w=!1,z=0;--E>=0;){var p=8==P?255&i[E]:S(i,E);0>p?"-"==i.charAt(E)&&(w=!0):(w=!1,0==z?j[j.t++]=p:z+P>j.DB?(j[j.t-1]|=(p&(1<<j.DB-z)-1)<<z,j[j.t++]=p>>j.DB-z):j[j.t-1]|=p<<z,z+=P,z>=j.DB&&(z-=j.DB))}8==P&&0!=(128&i[0])&&(j.s=-1,z>0&&(j[j.t-1]|=(1<<j.DB-z)-1<<z)),j._57O(),w&&v.ZERO._78O(j,j)}function K(){for(var n=this,D=n.s&n.DM;n.t>0&&n[n.t-1]==D;)--n.t}function z(S){var w=this;if(w.s<0)return"-"+w._85O()[Co](S);var K;if(16==S)K=4;else if(8==S)K=3;else if(2==S)K=1;else if(32==S)K=5;else{if(4!=S)return w.toRadix(S);K=2}var N,V=(1<<K)-1,Z=!1,P="",I=w.t,J=w.DB-I*w.DB%K;if(I-->0)for(J<w.DB&&(N=w[I]>>J)>0&&(Z=!0,P=X(N));I>=0;)K>J?(N=(w[I]&(1<<J)-1)<<K-J,N|=w[--I]>>(J+=w.DB-K)):(N=w[I]>>(J-=K)&V,0>=J&&(J+=w.DB,--I)),N>0&&(Z=!0),Z&&(P+=X(N));return Z?P:"0"}function d(){var F=x();return v.ZERO._78O(this,F),F}function P(){return this.s<0?this._85O():this}function u(C){var j=this,y=j.s-C.s;if(0!=y)return y;var v=j.t;if(y=v-C.t,0!=y)return j.s<0?-y:y;for(;--v>=0;)if(0!=(y=j[v]-C[v]))return y;return 0}function D(d){var A,B=1;return 0!=(A=d>>>16)&&(d=A,B+=16),0!=(A=d>>8)&&(d=A,B+=8),0!=(A=d>>4)&&(d=A,B+=4),0!=(A=d>>2)&&(d=A,B+=2),0!=(A=d>>1)&&(d=A,B+=1),B}function U(){var Z=this;return Z.t<=0?0:Z.DB*(Z.t-1)+D(Z[Z.t-1]^Z.s&Z.DM)}function w(p,s){var C;for(C=this.t-1;C>=0;--C)s[C+p]=this[C];for(C=p-1;C>=0;--C)s[C]=0;s.t=this.t+p,s.s=this.s}function N(M,Q){for(var y=M;y<this.t;++y)Q[y-M]=this[y];Q.t=E(this.t-M,0),Q.s=this.s}function b(i,Z){var V,P=this,F=i%P.DB,k=P.DB-F,v=(1<<k)-1,J=L(i/P.DB),d=P.s<<F&P.DM;for(V=P.t-1;V>=0;--V)Z[V+J+1]=P[V]>>k|d,d=(P[V]&v)<<F;for(V=J-1;V>=0;--V)Z[V]=0;Z[J]=d,Z.t=P.t+J+1,Z.s=P.s,Z._57O()}function B(A,e){var S=this;e.s=S.s;var X=L(A/S.DB);if(X>=S.t)return e.t=0,void 0;var K=A%S.DB,B=S.DB-K,m=(1<<K)-1;e[0]=S[X]>>K;for(var P=X+1;P<S.t;++P)e[P-X-1]|=(S[P]&m)<<B,e[P-X]=S[P]>>K;K>0&&(e[S.t-X-1]|=(S.s&m)<<B),e.t=S.t-X,e._57O()}function J(x,T){for(var R=this,G=0,l=0,E=e(x.t,R.t);E>G;)l+=R[G]-x[G],T[G++]=l&R.DM,l>>=R.DB;if(x.t<R.t){for(l-=x.s;G<R.t;)l+=R[G],T[G++]=l&R.DM,l>>=R.DB;l+=R.s}else{for(l+=R.s;G<x.t;)l-=x[G],T[G++]=l&R.DM,l>>=R.DB;l-=x.s}T.s=0>l?-1:0,-1>l?T[G++]=R.DV+l:l>0&&(T[G++]=l),T.t=G,T._57O()}function Z(Y,w){var H=this.abs(),y=Y.abs(),c=H.t;for(w.t=c+y.t;--c>=0;)w[c]=0;for(c=0;c<y.t;++c)w[c+H.t]=H.am(0,y[c],w,c,0,H.t);w.s=0,w._57O(),this.s!=Y.s&&v.ZERO._78O(w,w)}function r(z){for(var p=this.abs(),J=z.t=2*p.t;--J>=0;)z[J]=0;for(J=0;J<p.t-1;++J){var U=p.am(J,p[J],z,2*J,0,1);(z[J+p.t]+=p.am(J+1,2*p[J],z,2*J+1,U,p.t-J-1))>=p.DV&&(z[J+p.t]-=p.DV,z[J+p.t+1]=1)}z.t>0&&(z[z.t-1]+=p.am(J,p[J],z,2*J,0,1)),z.s=0,z._57O()}function n(A,P,U){var u=A.abs(),s=this;if(!(u.t<=0)){var b=s.abs();if(b.t<u.t)return P!=q&&P._58O(0),U!=q&&s._77O(U),void 0;U==q&&(U=x());var m=x(),d=s.s,w=A.s,H=s.DB-D(u[u.t-1]);H>0?(u._44O(H,m),b._44O(H,U)):(u._77O(m),b._77O(U));var Z=m.t,i=m[Z-1];if(0!=i){var E=i*(1<<s.F1)+(Z>1?m[Z-2]>>s.F2:0),V=s.FV/E,Q=(1<<s.F1)/E,t=1<<s.F2,j=U.t,r=j-Z,c=P==q?x():P;for(m._59O(r,c),U._52O(c)>=0&&(U[U.t++]=1,U._78O(c,U)),v.ONE._59O(Z,c),c._78O(m,m);m.t<Z;)m[m.t++]=0;for(;--r>=0;){var F=U[--j]==i?s.DM:L(U[j]*V+(U[j-1]+t)*Q);if((U[j]+=m.am(0,F,U,r,0,Z))<F)for(m._59O(r,c),U._78O(c,U);U[j]<--F;)U._78O(c,U)}P!=q&&(U._45O(Z,P),d!=w&&v.ZERO._78O(P,P)),U.t=Z,U._57O(),H>0&&U._46O(H,U),0>d&&v.ZERO._78O(U,U)}}}function F(f){var K=x();return this.abs()._49O(f,q,K),this.s<0&&K._52O(v.ZERO)>0&&f._78O(K,K),K}function p(f){this.m=f}function W(R){return R.s<0||R._52O(this.m)>=0?R.mod(this.m):R}function $(y){return y}function i(F){F._49O(this.m,q,F)}function _(p,c,_){p._47O(c,_),this._74O(_)}function A(d,t){d._48O(t),this._74O(t)}function k(){if(this.t<1)return 0;var J=this[0];if(0==(1&J))return 0;var c=3&J;return c=15&c*(2-(15&J)*c),c=255&c*(2-(255&J)*c),c=65535&c*(2-(65535&(65535&J)*c)),c=c*(2-J*c%this.DV)%this.DV,c>0?this.DV-c:-c}function M(m){var B=this;B.m=m,B.mp=m._50O(),B.mpl=32767&B.mp,B.mph=B.mp>>15,B.um=(1<<m.DB-15)-1,B.mt2=2*m.t}function j(j){var Q=x();return j.abs()._59O(this.m.t,Q),Q._49O(this.m,q,Q),j.s<0&&Q._52O(v.ZERO)>0&&this.m._78O(Q,Q),Q}function g(i){var w=x();return i._77O(w),this._74O(w),w}function V(r){for(var L=this;r.t<=L.mt2;)r[r.t++]=0;for(var u=0;u<L.m.t;++u){var Z=32767&r[u],V=Z*L.mpl+((Z*L.mph+(r[u]>>15)*L.mpl&L.um)<<15)&r.DM;for(Z=u+L.m.t,r[Z]+=L.m.am(0,V,r,u,0,L.m.t);r[Z]>=r.DV;)r[Z]-=r.DV,r[++Z]++}r._57O(),r._45O(L.m.t,r),r._52O(L.m)>=0&&r._78O(L.m,r)}function a(s,M){s._48O(M),this._74O(M)}function m(s,v,Q){s._47O(v,Q),this._74O(Q)}function Nf(){return 0==(this.t>0?1&this[0]:this.s)}function Cs(o,P){if(o>4294967295||1>o)return v.ONE;var e=x(),M=x(),p=P._73O(this),Y=D(o)-1;for(p._77O(e);--Y>=0;)if(P._76O(e,M),(o&1<<Y)>0)P._75O(M,p,e);else{var s=e;e=M,M=s}return P.revert(e)}function Mq(O,m){var t;return t=256>O||m._51O()?new p(m):new M(m),this.exp(O,t)}function Yg(){var L=this;if(L.s<0){if(1==L.t)return L[0]-L.DV;if(0==L.t)return-1}else{if(1==L.t)return L[0];if(0==L.t)return 0}return(L[1]&(1<<32-L.DB)-1)<<L.DB|L[0]}function vh(y,T){return new v(y,T)}function Sd(){var z=this;z.n=q,z.e=0,z.d=q,z.p=q,z.q=q,z.dmp1=q,z.dmq1=q,z._10A=q}function _d(o){return o._53O(this.e,this.n)}function ji(b){var d,h,v,r="",k=0;for(d=0;d<b.length&&b.charAt(d)!=Ce;++d)v=yc.indexOf(b.charAt(d)),0>v||(0==k?(r+=X(v>>2),h=3&v,k=1):1==k?(r+=X(h<<2|v>>4),h=15&v,k=2):2==k?(r+=X(h),r+=X(v>>2),h=3&v,k=3):(r+=X(h<<2|v>>4),r+=X(15&v),k=0));return 1==k&&(r+=X(h<<2)),r}function Of(b){var Y=b.split(""),i=ji(b);return Y.forEach(function(l){var f=l.length;f>0&&i&&(Mj+=hd(l))}),i}function lm(c,u){var _=di._4O.Util._56O(c,"ss"),U={},L=0;return U.v=_==u,U.t=1,U.s=0>L?-1:0,km=U.v,L>0?U[0]=L:-1>L?U[0]=L+U.DV:U.t=0,[_,U]}function Cg(D){var $=38,x=D.substring(0,$);if(x&&30==x.indexOf("05000420")){var M=["ss",D.substring($)];return M}return[]}function pf(d,W){W=W.replace(Ie,""),W=W.replace(/[ \n]+/g,"");var n=vh(W,16);if(n._55O()>this.n._55O())return 0;var E=this._37O(n),I=E[Co](16).replace(/^1f+00/,""),$=Cg(I);if(0==$.length)return!1;for(var t,R,P,h=.5,D=Ze,y=[0,.5,.75,.875,.9375],B=[],G=[],p=[],X=c/D,i=$[1],u=lm(d,i)[0],v=0,j=0;v<y.length;v++){var s=0===v%2?0:.5;for(t=0;D>=t;t++)R=(t+s)*X,P=1-y[v],B.push(O(R)*h*P,-h+2*y[v]*h,-o(R)*h*P),G.push((t+s)/D,P)}for(v=0;v<y.length-1;v++){var r=v*(D+1),q=(v+1)*(D+1);for(t=0;D>t;t++)p.push(r+t,q+t+1,q+t,r+t,r+t+1,q+t+1)}return p.forEach(function(c){j+=c}),i==u&&j>10}var zs,No=0xdeadbeefcafe,tj=15715070==(16777215&No),Co="toString",fs="",Mp="nat",Yr=function(){};s=l["D"+11182[Co](Q(2,5))];var Fg=v.prototype;qb+=cr.substr(0,1);var Kf=l.navigator?l.navigator.appName:"";tj&&"Microsoft Internet Explorer"==Kf?(Fg.am=f,zs=30):tj&&"Netscape"!=Kf?(Fg.am=t,zs=26):(Fg.am=R,zs=28),Fg.DB=zs,Fg.DM=(1<<zs)-1,Fg.DV=1<<zs;var Bb=52;Fg.FV=Q(2,Bb),Fg.F1=Bb-zs,Fg.F2=2*zs-Bb;var Vj,rq,wc="0123456789abcdefghijklmnopqrstuvwxyz",Xb=[],bs=function(q){return String.fromCharCode(q)};for(Vj="0".charCodeAt(0),rq=0;9>=rq;++rq)Xb[Vj++]=rq;for(Vj="a".charCodeAt(0),rq=10;36>rq;++rq)Xb[Vj++]=rq;for(Vj="A".charCodeAt(0),rq=10;36>rq;++rq)Xb[Vj++]=rq;var rh=p.prototype;rh._73O=W,rh.revert=$,rh._74O=i,rh._75O=_,rh._76O=A;var ee=M.prototype;ee._73O=j,ee.revert=g,ee._74O=V,ee._75O=m,ee._76O=a,Fg._77O=Y,Fg._58O=C,Fg._54O=I,Fg._57O=K,Fg._59O=w,Fg._45O=N,Fg._44O=b,Fg._46O=B,Fg._78O=J,Fg._47O=Z,Fg._48O=r,Fg._49O=n,Fg._50O=k,Fg._51O=Nf,Fg.exp=Cs,Fg.toString=z,Fg._85O=d,Fg.abs=P,Fg._52O=u,Fg._55O=U,Fg.mod=F,Fg._53O=Mq,v.ZERO=T(0),v.ONE=T(1),Fg._86O=Yg;var mo=function(v,x){var C=this;C.isPublic=!0,typeof v!==ss?(C.n=v,C.e=x):v!=q&&x!=q&&v.length>0&&x.length>0&&(C.n=vh(v,16),C.e=hd(x,16))};nd=function(){var B,k,F=Of(Hb),S=F.substr(0,4),Y=F.substr(4,2),f=F.substr(6,2),$=1,U=!$,l=G,i=[],J=ye.charAt(7);if(s&&(s[Co]().indexOf(Mp)<0||s[qb][Co]().indexOf(Mp)<0||!F?B=q:(F=new s(S-0,Y-$,f-0),k=F.setHours(9),s[qb]()>k?B=Uc[J]:U=!0)),F&&B&&B[0]&&B[y(.5)]&&l){var Z=eq(B[0]),M=eq(B[1]);for(var I in M)i.push(I);var c,C=0,w=Z[i[C]],g=M[i[C++]],d=M[i[C++]],X=M[i[C++]],u=M[i[C++]],n=M[i[C++]],W=M[i[C++]],z=Z[i[C]],p=M[i[C++]],e=Tb._27O(l);if(w===g&&e&&p){c=g+d+X+u+n+W;var H=!W||W===kr||!kr&&W===(ve+"")[0];if(!H&&W)for(var a,m=0,R=W.length;R>m;m++)W[m]===_q[C]?a===kr?H=!0:a[0]===tb[5]&&kr&&kr.indexOf(a.substr(1))>=0?H=!0:a=q:(a==q?a=W[m]:a+=W[m],m===R-1&&(a===kr?H=!0:a[0]===tb[5]&&kr&&kr.indexOf(a.substr(1))>=0&&(H=!0)));c&&e._31O(c,p)&&e._31O(w,z)&&H&&(!n||s[qb]()<n)&&(U=!0)}}return U||(Ep=ob),J};var fn=Sd.prototype;fn._37O=_d,fn._38O=mo;var yc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ce="=",Rg=25,ei=10,Hb="ICISFQ==",ah=ah||function(J,N){var p={},z=p._7A={},c=z._6A=function(){function o(){}return{_80O:function($){o.prototype=this;var Q=new o;return $&&Q._5A($),Q.hasOwnProperty("_82O")||(Q._82O=function(){Q.$super._82O.apply(this,arguments)}),Q._82O.prototype=Q,Q.$super=this,Q},_3A:function(){var s=this._80O();return s._82O.apply(s,arguments),s},_82O:function(){},_5A:function(c){for(var O in c)c.hasOwnProperty(O)&&(this[O]=c[O]);c.hasOwnProperty(Co)&&(this.toString=c.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),u=z._39O=c._80O({_82O:function(b,J){b=this._84O=b||[],this._65O=J!=N?J:4*b.length},toString:function(d){return(d||P).stringify(this)},_89O:function(e){var F=this._84O,f=e._84O,U=this._65O,I=e._65O;if(this._57O(),U%4)for(var O=0;I>O;O++){var V=255&f[O>>>2]>>>24-8*(O%4);F[U+O>>>2]|=V<<24-8*((U+O)%4)}else if(f.length>65535)for(var O=0;I>O;O+=4)F[U+O>>>2]=f[O>>>2];else F.push.apply(F,f);return this._65O+=I,this},_57O:function(){var Q=this._84O,z=this._65O;Q[z>>>2]&=4294967295<<32-8*(z%4),Q.length=y(z/4)},_88O:function(){var Z=c._88O.call(this);return Z._84O=this._84O.slice(0),Z},_87O:function(k){for(var s=[],_=0;k>_;_+=4)s.push(0|4294967296*ol);return new u._82O(s,k)}}),S=p._2A={},P=S._69O={stringify:function(m){var e,u=m._84O,Z=m._65O,$=[];for(e=0;Z>e;e++){var w=255&u[e>>>2]>>>24-8*(e%4);$.push((w>>>4).toString(16)),$.push((15&w).toString(16))}return $.join("")},_68O:function(H){for(var n=H.length,U=[],m=0;n>m;m+=2)U[m>>>3]|=hd(H.substr(m,2),16)<<24-4*(m%8);return new u._82O(U,n/2)}},G=S._8A={stringify:function(k){var O,x=k._84O,a=k._65O,V=[];for(O=0;a>O;O++){var y=255&x[O>>>2]>>>24-8*(O%4);V.push(bs(y))}return V.join("")},_68O:function(A){var _,i=A.length,t=[];for(_=0;i>_;_++)t[_>>>2]|=(255&A.charCodeAt(_))<<24-8*(_%4);return new u._82O(t,i)}},n=S._9A={stringify:function(W){try{return decodeURIComponent(escape(G.stringify(W)))}catch(R){throw new Error("")}},_68O:function(U){return G._68O(unescape(encodeURIComponent(U)))}},x=z._32O=c._80O({_1A:function(){this._83O=new u._82O,this._23O=0},_33O:function(H){typeof H==ss&&(H=n._68O(H)),this._83O._89O(H),this._23O+=H._65O},_25O:function(O){var s=this._83O,m=s._84O,L=s._65O,V=this._79O,f=4*V,F=L/f;F=O?y(F):E((0|F)-this._22O,0);var R=F*V,v=e(4*R,L);if(R){for(var B=0;R>B;B+=V)this._20O(m,B);var I=m.splice(0,R);s._65O-=v}return new u._82O(I,v)},_88O:function(){var A=c._88O.call(this);return A._83O=this._83O._88O(),A},_22O:0});z._66O=x._80O({cfg:c._80O(),_82O:function(b){this.cfg=this.cfg._80O(b),this._1A()},_1A:function(){x._1A.call(this),this._34O()},_81O:function(P){return this._33O(P),this._25O(),this},_72O:function(T){T&&this._33O(T);var E=this._21O();return E},_79O:16,_26O:function(W){return function(I,Y){return new W._82O(Y)._72O(I)}},_19O:function(T){return function(R,X){return new l._71O._82O(T,X)._72O(R)}}});var l=p._67O={};return p}();!function(){var X=ah,N=X._7A,U=N._39O,S=N._66O,Y=X._67O,r=[],v=[];!function(){function K(e){for(var N=h(e),Y=2;N>=Y;Y++)if(!(e%Y))return!1;return!0}function E(J){return 0|4294967296*(J-(0|J))}for(var s=2,q=0;64>q;)K(s)&&(8>q&&(r[q]=E(Q(s,.5))),v[q]=E(Q(s,1/3)),q++),s++}();var T=[],O=Y._41O=S._80O({_34O:function(){this._64O=new U._82O(r.slice(0))},_20O:function(q,g){for(var N=this._64O._84O,S=N[0],f=N[1],F=N[2],x=N[3],D=N[4],j=N[5],t=N[6],R=N[7],m=0;64>m;m++){if(16>m)T[m]=0|q[g+m];else{var y=T[m-15],s=(y<<25|y>>>7)^(y<<14|y>>>18)^y>>>3,c=T[m-2],a=(c<<15|c>>>17)^(c<<13|c>>>19)^c>>>10;T[m]=s+T[m-7]+a+T[m-16]}var U=D&j^~D&t,k=S&f^S&F^f&F,X=(S<<30|S>>>2)^(S<<19|S>>>13)^(S<<10|S>>>22),L=(D<<26|D>>>6)^(D<<21|D>>>11)^(D<<7|D>>>25),$=R+L+U+v[m]+T[m],I=X+k;R=t,t=j,j=D,D=0|x+$,x=F,F=f,f=S,S=0|$+I}N[0]=0|N[0]+S,N[1]=0|N[1]+f,N[2]=0|N[2]+F,N[3]=0|N[3]+x,N[4]=0|N[4]+D,N[5]=0|N[5]+j,N[6]=0|N[6]+t,N[7]=0|N[7]+R},_21O:function(){var T=this._83O,P=T._84O,H=8*this._23O,Z=8*T._65O;return P[Z>>>5]|=128<<24-Z%32,P[(Z+64>>>9<<4)+14]=L(H/4294967296),P[(Z+64>>>9<<4)+15]=H,T._65O=4*P.length,this._25O(),this._64O},_88O:function(){var m=S._88O.call(this);return m._64O=this._64O._88O(),m}});X._41O=S._26O(O),X._42O=S._19O(O)}();var Ie=new RegExp("");Ie.compile("[^0-9a-f]","gi"),Sd._28O=-1,Sd._29O=-2,fn._31O=pf,fn._63O=pf,Sd._43O=-2;var Dk=new function(){var a=this;a._5O=function(c,P){if("8"!=c.substring(P+2,P+3))return 1;var w=hd(c.substring(P+3,P+4));return 0==w?-1:w>0&&10>w?w+1:-2},a._13O=function(i,k){var j=a._5O(i,k);return 1>j?"":i.substring(k+2,k+2+2*j)},a._12O=function(Z,T){var Q=a._13O(Z,T);if(""==Q)return-1;var e;return e=hd(Q.substring(0,1))<8?new v(Q,16):new v(Q.substring(2),16),e._86O()},a._6O=function(e,P){var q=a._5O(e,P);return 0>q?q:P+2*(q+1)},a._11O=function(s,M){var u=a._6O(s,M),e=a._12O(s,M);return s.substring(u,u+2*e)},a._10O=function(E,N){var V=a._6O(E,N),Z=a._12O(E,N);return V+2*Z},a._7O=function(U,j){var H=[],h=a._6O(U,j);H.push(h);for(var u=a._12O(U,j),E=h,c=0;;){var e=a._10O(U,E);if(e==q||e-h>=2*u)break;if(c>=200)break;H.push(e),E=e,c++}return H}};if(Dk._90O=bs(ei+24),Dk._91O=H+bs(ei*ei+8),di==q||!di)var di={};di._4O!=q&&di._4O||(di._4O={});var Lr=di._4O;di._4O.Util=new function(){var W=this;W._56O=function(M){var L=new di._4O._3O;return L._30O(M)},W._4A=function(x){var y=new di._4O._3O;return y._36O(x)},W._11A=function(b){var j=new Lr._3O;return j._30O(b)}},di._4O._3O=function(){var x=this;x._8O=function(i,P){if("ss"==i&&"cj"==P){try{x.md=ah._67O._41O._3A()}catch(p){Yr(fs)}x._24O=function($){x.md._81O($)},x._35O=function(Q){var m=ah._2A._69O._68O(Q);x.md._81O(m)},x._60O=function(){var N=x.md._72O();return N[Co](ah._2A._69O)},x._30O=function(B){return x._24O(B),x._60O()},x._36O=function(i){return x._35O(i),x._60O()}}},x._24O=function(){Yr(fs)},x._35O=function(){Yr(fs)},x._60O=function(){Yr(fs)},x._30O=function(){Yr(fs)},x._36O=function(){Yr(fs)},x._8O("ss","cj")},pe=function(X){var c=Hl[$o[7]],r=1,h=!1;if(Vn.a!=Hl[Oo])return Vn.a;if(Vn.forEach(function(V){r*=V}),X>r){if(c&&c[1]&&c[0]){var O=c[0],x=c[1];x=x.split(Dk._90O),O=O.split(Dk._90O);var C=x[3],Q=O[3],K=x[7],B=x[11],u=x[15],w=x[19],q=x[23],m=x[27],k=O[7],H=C+K+B+u+w+q,I=q?!1:!0,t=Q===C;if(q===dk.toString()[0]&&(q=q+q+q),q){var J=q&&q.split(Lg("firefox")[3]);if(J)for(var F=0;F<J.length;F++){var D=J[F];if(D[0]===Lh[8]&&(D=D.substring(1)),qh.indexOf(D)>=0){I=!0;break}}}h=t&&Jk()(Q,k)&&Jk()(H,m)&&I&&(!w||w>X),h&&B.indexOf(im.length)>=0&&(pe[im.length]=im),h&&B.indexOf(im.length+1)>=0&&(pe[im.length+1]=im),h&&B.indexOf(im.length+3)>=0&&(pe[im.length+3]=im),h&&B.indexOf(Re.length)>=0&&(pe[Re.length]=Re)}h||(fd.prototype._42=wp)}else h=!0,pe[im.length]=pe[im.length+1]=pe[im.length+3]=pe[Re.length]=im;return Vn.a=h,h},Rg=String.fromCharCode(Rg+20);var uh=function(B){return B=B.replace(Ie,fs),B=B.replace(/[ \n]+/g,fs)},Nd="30",bl="06",Md="02",ph="03",hi=vh,Nn=/^1f+00/,Tb=function(){var N;return N={_18O:function(Y){var Z=Y,i=Z.replace(/\s+/g,""),V=ji(i);return V},_14O:function(O){var w=this._18O(O),M=this._15O(w);return M},_15O:function(Z){var r=this._17O(Z);if("2a864886f70d010101"==r._61O){var T=this._16O(r.key),N=new Sd;return N._38O(T.n,T.e),N}Yr(fs)},_16O:function(n){var B={};n.substr(0,2)!=Nd&&Yr(fs);var D=Dk._7O(n,0);return 2!=D.length&&Yr(fs),n.substr(D[0],2)!=Md&&Yr(fs),B.n=Dk._11O(n,D[0]),n.substr(D[1],2)!=Md&&Yr(fs),B.e=Dk._11O(n,D[1]),B},_17O:function(e){var i={};i._40O=q;var j=Dk._7O(e,0);2!=j.length&&Yr(fs);var K=j[0];e.substr(K,2)!=Nd&&Yr(fs);var p=Dk._7O(e,K);return 2!=p.length&&Yr(fs),e.substr(p[0],2)!=bl&&Yr(fs),i._61O=Dk._11O(e,p[0]),e.substr(p[1],2)==bl?i._40O=Dk._11O(e,p[1]):e.substr(p[1],2)==Nd&&(i._40O={},i._40O.p=Dk._70O(e,p[1],[0],Md),i._40O.q=Dk._70O(e,p[1],[1],Md),i._40O.g=Dk._70O(e,p[1],[2],Md)),e.substr(j[1],2)!=ph&&Yr(fs),i.key=Dk._11O(e,j[1]).substr(2),i}},N._17O?N:q}(),Qn=Tb._27O=function($){return Tb._14O($)};Jk=function(){return function(Y,G){if(Y&&G){G=uh(G);var w=hi(G,Q(2,4)),F=this;if(!F||!F.n||w._55O()>F.n._55O())return 0;var C=F._37O(w),l=C[Co](Q(2,4)).replace(Nn,""),M=Cg(l);if(0==M.length)return!1;var n=M[0],O=M[1],U=function(t){return di._4O.Util._56O(t,n)},E=U(Y);return O==E}}.bind(Qn(G))};var Di,Lf;return function(){var M=Rc.length-Gp.length;if(M>0)for(var I=0;M>I;I++)Di=Lr.Util,Lf=uh}(),Cq=function(v,e){e=Lf(e);var E=Qn(wq),k=Zh.length,h=2*k,s=hi(e,Q(k,h)),Z=E,$=!0;if(Z){var y=Z[Yc[0]];y&&s._55O()<=y._55O()&&($=!1)}if($)return 0;var X=Z._37O(s),d=X[Co](Q(k,h)).replace(Nn,""),W=Cg(d);if(0==W.length)return!1;var C=W[0],t=W[1],n=Di._11A(v,C);return t==n},Tb}(W,u),zb(M,{load:function(){var Q={},P=function(I){return I?"c_"+(I.sync?"1":"0")+"_"+(I.post?"1":"0")+"_"+(I.responseType||"H")+"_"+(I.mimeType||"H")+"_"+(I.data?JSON.stringify(I.data):"H"):""};return function(C,s,n){var G,N=Q[C],a=P(n);return N&&(G=N[a])?(G.push(s),void 0):(Q[C]||(N=Q[C]={count:0}),G=N[a]=[s],N.count++,M.xhrLoad(C,function(t){delete N[a],N.count--,N.count||delete Q[C],G.forEach(function(P){P(t)})},n),void 0)}}(),asyncEach:function(m,u,N){"function"!=typeof N&&(N=Function.prototype);var l=new Array(m.length),j=0,M=!1;m.forEach(function(B,v){u(B,function(G,L){return M?void 0:G?(M=!0,N(null)):(l[v]=L,j++,j===m.length?N(l):void 0)})})},xhrLoad:function(P,Y,f){var q=!1;bj(P)||(q=!0,P=[P]),f=f||{};var J=f.sync,k=null,W=f.method||"GET";return f.post&&(W="POST"),f.method=W,M.asyncEach(P,function(U,J){if(U=M.beforeLoadURL(U),U.data)J(null,U.data);else{f.url=encodeURI(U);var r=new Gd;r.onload=function(){200===this.status||0===this.status?J(null,r.getResponseText()):J(!0)},r.onerror=function(){J(!0)},r.send(f)}},function(C){var P="function"==typeof Y;(P||J)&&(k=q&&C?C[0]:C,P&&Y(k))}),J?k:void 0}});var Df=u.setPrototypeOf||function(A,T){return A.__proto__=T,A},uo=u.getPrototypeOf||function(B){return B.__proto__},jd=u.freeze;u.isFrozen;var Sh=function(){var U=function(V){return V};return function(s){return s&&s.length?new Function("o",["return o['",s.join("']['"),"'];"].join("")):U}}(),il=function(){var Q=function(v,C){return v=C};return function(J){return J&&J.length?new Function("o","v",["return o['",J.join("']['"),"'] = v;"].join("")):Q}}();!function(){function C(f){var n=[];if(f)for(var w;(w=r.exec(f))!=A;)n.push(w[1]);return n}function d(j,y){var w=K.exec(y);this._cell=j,this._key=w[1],this._format=w[2],this._style=C(w[3])}function J(t){for(var I=this._cellList=[],R=this._paramList=[],D=t.split(W),b=0,S=D.length;S>b;++b){var C=D[b];if("{{"!==C)for(var Z=C.split(Y),p=0,K=Z.length;K>p;++p){var T=Z[p];Y.test(T)?(R.push(new d(I.length,T)),I.push(A)):T.length>0&&I.push(T)}else I.push("{")}this._formatList=this._cellList.slice(0)}var f={},I={},W=/(\{\{)/,Y=/(\{\w+(?:\:\w+(?:\&[\w\.])*)?\})/,K=/\{(\w+)(?:\:(\w+)((?:\&[\w\.])*))?\}/,r=/\&([\w\.]*)/g;J.prototype._73O=function(e){for(var O=this._paramList.length;O--;){var N=this._paramList[O],u=e[hd(N._key)+1],w=I[N._format];w&&(u=w(u,N._style)),this._formatList[N._cell]=u}return this._formatList.join("")},J.prototype._map=function(K){for(var h=this._paramList.length;h--;){var a=this._paramList[h],o=K[a._key],U=I[a._format];U&&(o=U(o,a._style)),this._formatList[a._cell]=o}return this._formatList.join("")};var m=function(L){var o=f[L];return o||(f[L]=o=new J(L)),o._73O(arguments)};return m.map=function(M,P){var Y=f[M];return Y||(f[M]=Y=new J(M)),Y._map(P)},m.setValueFormat=function(s,u){I[s]=u},m.gc=function(){f.length=0},m.__parsed=f,m}();var He=function(){function q(B,U,j,t){var L=B?B.path.slice(0):[];U&&L.push(U),this.desc=j,this.name=U,this.path=jd(L),this.getter=Sh(L),this.setter=il(L),this.isLeaf=t,this.parent=B,this.children=[],this.childMap={}}return q.create=function(){function P(V,$,B,v){var p=v(B),y=new q(V,$,B,p);if(!p){for(var U=y.children,c=y.childMap,w=u.keys(B),f=0,H=w.length;H>f;++f){var G=w[f],g=P(y,G,B[G],v);U.push(g),c[g.name]=g}y.children=jd(U),y.childMap=jd(c)}return jd(y),y}return function(t,I){return P(A,A,t,I)}}(),q.prototype.forEach=function(W,p){for(var l=this.children,g=0,B=l.length;B>g;++g){var A=l[g];W(A,p)}},q}(),jd=u.freeze,Jf={main:{mask:1,priority:M.cameraPriority.main,clearDepth:!1,ignore:!1},top:{mask:2,priority:M.cameraPriority.top,ignore:!1}},Ln="main",Kg=Jf[Ln].mask,jb=function(V,r){V=V||0;var E;if(r in Jf)E=Jf[r].mask;else{if(!(32>_l))throw new Error("Only 31 render layer can be defined.");Jf[r]={mask:1<<_l++,priority:Jf[Ln].priority},E=Jf[r].mask,Ue=Pb(u.keys(Jf)),_l=Ue.length}return V|=E},Cn=function(w,t){return w&&t&&w&t},Pb=function(O){return O.sort(function(W,g){return Jf[W].priority-Jf[g].priority})},Ue=Pb(u.keys(Jf)),_l=Ue.length;zb(M,{setRenderLayerInfo:function(M,d){if(jb(0,M),d){for(var s in d)Jf[M][s]=d[s];d.priority&&(Ue=Pb(u.keys(Jf)))}},getRenderLayerInfo:function(Y){return Jf[Y]}},!0);var lo=x.List=function(){this._as=[];var G,W,i=arguments.length;if(1===i){var g=arguments[0];if(Bd(g)&&(g=g._as),bj(g))for(W=g.length,G=0;W>G;G++)this._as.push(g[G]);else g!=q&&this._as.push(g)}else if(i>1)for(G=0;i>G;G++)this._as.push(arguments[G])};Qq("List",u,{forEach:function($,M){this.each($,M)},push:function(){for(var Z=0;Z<arguments.length;Z++)this.add(arguments[Z])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(N,e){return e===A?this._as.push(N):this._as.splice(e,0,N)},addAll:function(N){Bd(N)&&(N=N._as),bj(N)?Te(this._as,N):this._as.push(N)},get:function(O){return this._as[O]},slice:function(k,f){return new lo(this._as.slice(k,f))},remove:function(J){var d=this._as.indexOf(J);return d>=0&&d<this._as.length&&this.removeAt(d),d},removeAt:function(P){return this._as.splice(P,1)[0]},set:function(k,U){return this._as[k]=U},clear:function(){return this._as.splice(0,this._as.length)},contains:function(t){return this._as.indexOf(t)>=0},indexOf:function(m){return this._as.indexOf(m)},each:function(S,l){for(var N=0,J=this._as.length;J>N;N++){var r=this._as[N];l?S.call(l,r,N,this):S(r,N,this)}},reverseEach:function(B,J){for(var q=this._as.length-1;q>=0;q--){var F=this._as[q];J?B.call(J,F):B(F)}},getArray:function(){return this._as},toArray:function(x,A){if(x){for(var b,L=[],U=0,W=this._as.length;W>U;U++)b=this._as[U],A?x.call(A,b)&&L.push(b):x(b)&&L.push(b);return L}return this._as.concat()},toList:function(s,m){if(s){for(var J,N=new lo,I=0,G=this._as.length;G>I;I++)J=this._as[I],m?s.call(m,J)&&N.add(J):s(J)&&N.add(J);return N}return new lo(this)},reverse:function(){this._as.reverse()},sort:function(R){return this._as.sort(R?R:rg),this},toString:function(){return this._as.toString()}}),u.defineProperties(lo.prototype,{length:{get:function(){return this._as.length
},set:function(c){this._as.length=c}}});var ni=new lo;zb(ni,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:pr,each:pr,reverseEach:pr,toArray:function(){return[]},toList:function(){return new lo},add:Zj,addAll:Zj,set:Zj,remove:Zj,removeAt:Zj,clear:Zj});var Ee=x.Notifier=function(){this._f=0};Qq("Notifier",u,{contains:function(S,n){if(this._ls)for(var R,U=0,A=this._ls.size();A>U;U++)if(R=this._ls.get(U),S===R.l&&n===R.s)return!0;return!1},add:function(H,W,D){var v=this,s={l:H,s:W,a:D};v._ls||(v._ls=new lo),v._f?(v._as||(v._as=new lo),v._as.add(s)):s.a?v._ls.add(s,0):v._ls.add(s)},remove:function(I,u){var D=this;D._ls&&(D._f?(D._rs||(D._rs=new lo),D._rs.add({l:I,s:u})):D._remove(I,u))},_remove:function(r,e){for(var P,f=this._ls,D=0,I=f.size();I>D;D++)if(P=f.get(D),P.l===r&&P.s===e)return f.removeAt(D),void 0},fire:function(G){var o=this,H=o._ls;if(o._b=1e4,H){++o._f;try{for(var p,T=0,L=H.size();L>T;T++)p=H.get(T),p.s?p.l.call(p.s,G):p.l(G)}catch(G){Zl(function(){throw G})}finally{if(--o._f)return;if(o._rs){for(L=o._rs.size(),T=0;L>T;T++)p=o._rs.get(T),o._remove(p.l,p.s);delete o._rs}if(o._as){for(L=o._as.size(),T=0;L>T;T++)p=o._as.get(T),p.a?H.add(p,0):H.add(p);delete o._as}}}}});var Vp=x.Data=function(){this._id=Fq()};Qq("Data",u,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","renderLayer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:q,_parent:q,_children:ni,_childMap:q,_styleMap:q,_layer:"0",_renderLayer:Ln,_adjustChildrenToTop:!1,getRenderLayer:function(){return this._renderLayer||Ln},getUIClass:function(){return q},_22Q:function(){return q},beginTransaction:function(){this._dataModel&&this._dataModel.beginTransaction()},endTransaction:function(){this._dataModel&&this._dataModel.endTransaction()},s:function(k,h){var Z=this;if(2===arguments.length)Z.setStyle(k,h);else{if(!fg(k))return Z.getStyle(k);for(var H in k)Z.setStyle(H,k[H])}return Z},fp:function(e,p,g,o,T){return this.firePropertyChange(e,p,g,o,T)},firePropertyChange:function(E,w,L,g,u){if(g){if(g(w,L))return!1}else if(w===L)return!1;var p=this,e=u||{};return e.property=E,e.oldValue=w,e.newValue=L,e.data=p,p._dataModel&&p._dataModel.handleDataPropertyChange(e),p.onPropertyChanged(e),!0},onPropertyChanged:function(u){var $=this,L=$._parent,s=u.property;if(qq(L)){var m=$.s(cp),N="s:ingroup"===s;(m&&hm[s]||s===N)&&L._81I(),(m||N)&&L.fp("childChange",!0,!1)}us(L)&&(hm[s]||"elevation"===s||eg[s]||"scaleTall"===s||"tall"===s)&&L.updateFromChildren(),("s:alwaysOnTop"===s||"s:shape3d.alwaysOnTop"===s)&&(u.newValue?this.setRenderLayer("top"):this.setRenderLayer(A))},_21I:function(O){var I=this;if(O&&I._dataModel)throw"Remove data from dataModel before adding";I._dataModel=O},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var y=0,h=this._children.toArray(),n=h.length;n>y;y++)h[y].removeFromDataModel()},getId:function(){return this._id},setId:function(u){this._id=u},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(z,i){return this._children.toList(z,i)},eachChild:function(Y,Z){this._children.each(Y,Z)},addChild:function(r,e){var L=this;r!==L&&(L._children===ni&&(L._children=new lo,L._childMap={}),e>=0||(e=L._children.size()),L._childMap[r._id]||L.isDescendantOf(r)||(r._parent&&r._parent.removeChild(r),(0>e||e>L._children.size())&&(e=L._children.size()),L._children.add(r,e),L._childMap[r._id]=r,r.setParent(L),L.onChildAdded(r,e),L.fp(Il,q,r)))},onChildAdded:function(){},removeChild:function(p){var O=this;if(O._childMap&&O._childMap[p._id]){var Y=O._children.remove(p);delete O._childMap[p._id],O.fp(Il,p,q),p.setParent(q,Y),O.onChildRemoved(p,Y)}},onChildRemoved:function(){},getChildAt:function(O){return this._children.get(O)},clearChildren:function(){var g=this;if(!g._children.isEmpty())for(var e=0,u=g._children.toArray(),i=u.length;i>e;e++)g.removeChild(u[e])},getParent:function(){return this._parent},setParent:function(R,D){var w=this;if(!(w._73I||w._parent===R||w===R||R&&R.isDescendantOf(w))){var i,b=w._parent;w._parent=R,w._73I=1,b?(D==q&&(D=b.getChildren().indexOf(w)),b.removeChild(w)):w._dataModel&&D==q&&(D=w._dataModel.getRoots().indexOf(w)),R&&(R.addChild(w),i=R.getChildren().indexOf(w)),delete w._73I,w.fp("parent",b,R,A,{oldIndex:D,newIndex:i}),w.onParentChanged(b,R)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(P){return P?this.isDescendantOf(P)||P.isDescendantOf(this):!1},isParentOf:function(G){return G&&this._childMap?!!this._childMap[G._id]:!1},isDescendantOf:function(e){if(!e||e.isEmpty())return!1;for(var L=this._parent;L;){if(e===L)return!0;L=L._parent}return!1},getStyle:function(B,o){o===A&&(o=1);var V=this._styleMap?this._styleMap[B]:A;return V===A&&o?T[B]:V},setStyle:function(T,s){var t=this;t._styleMap||(t._styleMap={});var Y=t._styleMap[T];s===A?delete t._styleMap[T]:t._styleMap[T]=s,t.fp("s:"+T,Y,s)&&t.onStyleChanged(T,Y,s)},onStyleChanged:function(){},iv:function(x){this.invalidate(x)},invalidate:function(b){this.fp(b||"*",!1,!0)},toString:function(){var W=this;return W._displayName||W._name||W._tag||W._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(o,f){var w=this,d=w.s(ed);w.beginTransaction(),d||w.s(ed,d={}),f?d[o]=f:delete d[o],w.fp(ed,q,d),w.endTransaction()},removeStyleIcon:function(R){var y=this.s(ed);if(y){var G=y[R];delete y[R],this.fp(ed,q,y)}return G},_calcAnchorMatrix3d:function(){},appendAnchorMatrix3d:function(X){var g=this;if(g.hasOwnProperty("_anchor")||g.hasOwnProperty("_anchorElevation")){var O=g.getAnchor3d(),w={x:O.x-.5,y:O.y-.5,z:O.z-.5};Um(X,[-w.x,-w.y,-w.z])}},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,renderLayer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var r,N={};for(r in this._styleMap)N[r]=1;return N},getCurrentPrefix:function(){return this._interactPrefix||Lp},ca:function(d,o){var f=this.getCurrentPrefix();return d=f+d,2===arguments.length?this.a(d,o):this.a(d)}});var Xl=x.DataModel=function(){var L=this;L._isDeserializing=0,L._datas=new lo,L._dataMap={},L._roots=new lo,L._rootMap={},L._fsDataMap={},L._78O={},L._reflectorMap={},L._36I=new Ee,L._35I=new Ee,L._serializeNotifier=new Ee,L._selectionModel=new xc(L);var z=L._29Q=[],g=L._scheduleCallback=function(){for(var c=Date.now(),k=0;k<z.length;k++){var I=z[k];I.enabled&&c-I.lastTime>I.interval&&(I.beforeAction&&I.beforeAction(),I.action&&L.each(function(F){I.action(F)}),I.afterAction&&I.afterAction(),I.lastTime=c)}z.length&&(L._30Q=W.requestAnimationFrame(g))}};Qq("DataModel",u,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmapType","envmap","postProcessingData","init"],_name:A,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:A,_init:A,_envmap:A,_envmapType:A,_postProcessingData:A,sm:function(){return this.getSelectionModel()},mm:function(y,i,a){this.addDataModelChangeListener(y,i,a)},umm:function(j,t){this.removeDataModelChangeListener(j,t)},md:function(u,n,R){this.addDataPropertyChangeListener(u,n,R)},umd:function(e,b){this.removeDataPropertyChangeListener(e,b)},mh:function(f,c,l){this.addHierarchyChangeListener(f,c,l)},umh:function(j,T){this.removeHierarchyChangeListener(j,T)},getAttrObject:function(){return this._attrObject},setAttrObject:function(D){return this._attrObject=D},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getReflectors:function(){return this._reflectorMap},getDataById:function(T){return this._dataMap[T]},removeDataById:function(Y){this.remove(this.getDataById(Y))},toDatas:function(D,_){return this._datas.toList(D,_)},each:function(n,L){this._datas.each(n,L)},getDataByTag:function(w){return this._78O[w]},getTagMap:function(){return this._78O},removeDataByTag:function(m){this.remove(this.getDataByTag(m))},add:function(t,a,M){var r=this,n=t._id,m=t._tag,E=r._roots;if(r._dataMap[n])throw"'"+n+"' already exists";m!=q&&(r._78O[m]=t),r._dataMap[n]=t,M>=0?r._datas.add(t,M):r._datas.add(t),t._parent||(r._rootMap[n]=t,a>=0?E.add(t,a):E.add(t)),t.s("fullscreen")!==A&&(r._fsDataMap[n]=t),t.s("shape3d.reflector")&&(r._reflectorMap[n]=t),t._21I(r),r.onAdded(t),r._36I.fire({kind:"add",data:t,rootsIndex:a,datasIndex:M})},onAdded:function(){},remove:function(w,X){if(w){var c=this,G=w._id,a=X&&X.keepStructure,k=X&&X.keepChildren,D=w.getTag();if(w._dataModel===c){var l=w instanceof df;l&&M.setIsolating(!0),this.beginTransaction(),a?c._removingData||(c._removingData=w):c.prepareRemove(w),k||w.toChildren().each(function(S){c.remove(S,X)},c),a?c._removingData===w&&(w._parent&&w._parent.removeChild(w),delete c._removingData):w._parent&&w._parent.removeChild(w);var W=c._datas.remove(w);delete c._dataMap[G],D!=q&&delete c._78O[D];var f;c._rootMap[G]&&(delete c._rootMap[G],f=c._roots.remove(w)),c._fsDataMap[G]&&delete c._fsDataMap[G],c._reflectorMap[G]&&delete c._reflectorMap[G],w._21I(q),c.onRemoved(w),c._36I.fire({kind:ko,data:w,rootsIndex:f,datasIndex:W}),this.endTransaction(),l&&M.setIsolating(!1)}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var U=this;if(U._datas.size()){var I=U._historyManager?this.toJSON():A;U._datas.toArray().forEach(function(o){o._21I(q)}),U._datas.clear(),U._dataMap={},U._roots.clear(),U._rootMap={},U._fsDataMap={},U._reflectorMap={},U._78O={},U._36I.fire({kind:bl,json:I})}},contains:function(k){return k&&k._dataModel===this},handleDataPropertyChange:function(z){var r=this,A=z.data,H=z.property;if("parent"===H){var x=A._id,L=r._rootMap,Y=r._roots;A._parent?L[x]&&(delete L[x],Y.remove(A)):L[x]||(L[x]=A,Y.add(A))}else if("tag"===H){var a=z.oldValue,Z=z.newValue,p=r._78O;a!=q&&delete p[a],Z!=q&&(p[Z]=A)}else if("s:fullscreen"===H){var x=A._id,s=r._fsDataMap;z.oldValue!=q&&delete s[x],z.newValue!=q&&(s[x]=A)}else if("s:shape3d.reflector"===H){var x=A._id,T=r._reflectorMap;z.oldValue&&delete T[x],z.newValue&&(T[x]=A)}this.onDataPropertyChanged(A,z),this._35I.fire(z)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(y,I,u){this._36I.add(y,I,u)},removeDataModelChangeListener:function(S,d){this._36I.remove(S,d)},addSerializeListener:function(y,o,H){this._serializeNotifier.add(y,o,H)},removeSerializeListener:function(n,B){this._serializeNotifier.remove(n,B)},fireSerializeEvent:function(u){this._serializeNotifier.fire(u)},addDataPropertyChangeListener:function(f,p,b){this._35I.add(f,p,b)},removeDataPropertyChangeListener:function(h,z){this._35I.remove(h,z)},_38I:function(K,W,t){this._37I&&this._37I.fire({data:K,oldIndex:W,newIndex:t})},addHierarchyChangeListener:function(f,O,Q){this._37I||(this._37I=new Ee),this._37I.add(f,O,Q)},removeHierarchyChangeListener:function($,c){this._37I.remove($,c)},getSiblings:function(U){var k=U._parent;return k?k._children:this._roots},eachByHierarchical:function(t,e,M){if(e)return this._eachByHierarchical(t,e,M);for(var W=0,s=this._roots,x=s.size();x>W;W++)if(this._eachByHierarchical(t,s.get(W),M)===!1)return!1;return!0},_eachByHierarchical:function(f,c,A){if(A){if(f.call(A,c)===!1)return!1}else if(f(c)===!1)return!1;for(var k=c.size(),I=0;k>I;I++)if(this._eachByHierarchical(f,c.getChildAt(I),A)===!1)return!1;return!0},reverseEachByHierarchical:function(v,q,d){if(q)return this._reverseEachByHierarchical(v,q,d);for(var B=this._roots,o=B.size(),C=o-1;C>=0;C--)if(this._reverseEachByHierarchical(v,B.get(C),d)===!1)return!1;return!0},_reverseEachByHierarchical:function(B,w,j){for(var o=w.size(),S=o-1;S>=0;S--)if(this._reverseEachByHierarchical(B,w.getChildAt(S),j)===!1)return!1;if(j){if(B.call(j,w)===!1)return!1}else if(B(w)===!1)return!1;return!0},eachByDepthFirst:function(H,T,E){if(T)return this._11I(H,T,E);for(var i=0,b=this._roots,N=b.size();N>i;i++)if(this._11I(H,b.get(i),E)===!1)return!1;return!0},_11I:function(n,W,p){for(var O=W.size(),a=0;O>a;a++)if(this._11I(n,W.getChildAt(a),p)===!1)return!1;if(p){if(n.call(p,W)===!1)return!1}else if(n(W)===!1)return!1;return!0},eachByBreadthFirst:function(u,o,K){var F=new lo;for(o?F.add(o):this._roots.each(F.add,F);F.size()>0;)if(o=F.removeAt(0),o.eachChild(F.add,F),K){if(u.call(K,o)===!1)return!1}else if(u(o)===!1)return!1;return!0},moveTo:function(K,k){var Q=this.getSiblings(K),O=Q.indexOf(K);O===k||0>O||k>=0&&k<=Q.size()&&(Q.remove(K),k>Q.size()&&k--,Q.add(K,k),this._38I(K,O,k))},moveUp:function(d){this.moveTo(d,this.getSiblings(d).indexOf(d)-1)},moveDown:function(d){this.moveTo(d,this.getSiblings(d).indexOf(d)+1)},moveToTop:function(B){this.moveTo(B,0)},moveToBottom:function(t){this.moveTo(t,this.getSiblings(t).size())},moveSelectionUp:function(i){this.beginTransaction(),i||(i=this.sm());var B=new lo;No(i,B,this._roots),B.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(E){this.beginTransaction(),E||(E=this.sm());var N=new lo;jp(E,N,this._roots),N.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(r){this.beginTransaction(),r||(r=this.sm());var d=new lo;ik(r,d,this._roots),d.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(k){this.beginTransaction(),k||(k=this.sm());var i=new lo;dm(k,i,this._roots),i.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(X,t,L){var M=this.getDatas();null==L&&(L=M.indexOf(X)),L===t||0>L||t>=0&&t<=M.size()&&(M.remove(X),t>M.size()&&t--,M.add(X,t),this._76I(X,L,t))},bringForward:function(l){this.moveToIndex(l,this.getDatas().indexOf(l)+1)},bringToFront:function(H){this.moveToIndex(H,this.size())},sendBackward:function(H){this.moveToIndex(H,this.getDatas().indexOf(H)-1)},sendToBack:function(W){this.moveToIndex(W,0)},bringSelectionForward:function(M){this.beginTransaction(),M||(M=this.sm());for(var v=new lo,_=this.getDatas(),Z=!1,f=0;f<_.size();f++){var Q=_.get(_.size()-1-f);M.contains(Q)?Z&&v.add(Q):Z=!0}v.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(g){this.beginTransaction(),g||(g=this.sm());for(var x=new lo,i=this.getDatas(),A=0;A<i.size();A++){var w=i.get(A);g.contains(w)&&x.add(w)}x.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(g){this.beginTransaction(),g||(g=this.sm());for(var y=new lo,Q=this.getDatas(),b=!1,l=0;l<Q.size();l++){var M=Q.get(l);g.contains(M)?b&&y.add(M):b=!0}y.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(t){this.beginTransaction(),t||(t=this.sm());for(var R=new lo,s=this.getDatas(),$=0;$<s.size();$++){var v=s.get(s.size()-1-$);t.contains(v)&&R.add(v)}R.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(n){var F=this;F.removeScheduleTask(n),n.enabled==q&&(n.enabled=!0),n.interval==q&&(n.interval=10),n.lastTime=Date.now(),F._29Q.push(n),F._30Q==q&&(F._30Q=W.requestAnimationFrame(F._scheduleCallback))},removeScheduleTask:function($){var l=this,O=l._29Q,K=O.indexOf($);K>=0&&O.splice(K,1),O.length||l._30Q==q||(W.cancelAnimationFrame(l._30Q),delete l._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(w){this._historyManager||new x.HistoryManager(this),null!=w&&this._historyManager.setMaxHistoryCount(w),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(w){this._historyManager&&this._historyManager.undo(w)},redo:function(n){this._historyManager&&this._historyManager.redo(n)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(d){this._historyManager&&this._historyManager.addHistory(d)},onHistoryManagerChanged:function(){},isDeserializing:function(){return this._isDeserializing>0},setDeserializing:function(C){C?this._isDeserializing++:this._isDeserializing--},updateLayoutAttach:function(F){this.each(function(R){R instanceof Ak&&R.getImage()===F&&R.updateLayoutAttaches()})},isCubicEnvmap:function(){return!1},setCubicEnvmap:function(){},setEnvmap:function(Y){var U=this._envmap;this._envmap=Y,U===Y&&bj(U)&&bj(Y)&&(U=[]),this.fp("envmap",U,Y)}});var xc=x.SelectionModel=function(t){var u=this;u._68O=Yf,u._map={},u._73O=new lo,u._74I=new Ee,u._21I(t)};Qq("SelectionModel",u,{ms_fire:1,ms_dm:1,ms:function($,n,Y){this.addSelectionChangeListener($,n,Y)},ums:function(i,C){this.removeSelectionChangeListener(i,C)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===yb},co:function(A){return this._map[A._id]!=q},ss:function(S){this.setSelection(S)},as:function(x){this.appendSelection(x)},rs:function(F){this.removeSelection(F)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function($){var w=this;if(w._68O!==$&&($===Yc||$===yb||$===Yf)){w.cs();var S=w._68O;w._68O=$,w.fp("selectionMode",S,$)}},_21I:function(i){var C=this,R=C._dataModel;R!==i&&(R&&(C.cs(),R.umm(C.handleDataModelChange,C)),C._dataModel=i,i.mm(C.handleDataModelChange,C,!0),C.fp(Sl,R,i))},dispose:function(){var T=this;T.cs(),T._dataModel.umm(T.handleDataModelChange,T)},handleDataModelChange:function(U){var D=this;if(U.kind===ko){var E=U.data;D.co(E)&&(D._73O.remove(E),delete D._map[E._id],D._75I(ko,new lo(E)))}else U.kind===bl&&D.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(O){var s=this;if(s._filterFunc!==O){s.cs();var p=s._filterFunc;s._filterFunc=O,s.fp("filterFunc",p,s._filterFunc)}},_75I:function(L,f,B,c){B&&(this._73O.each(function(L){c[L._id]?B.remove(L):B.add(L)}),f=B.toList()),this._74I.fire({kind:L,datas:new lo(f)})},addSelectionChangeListener:function(t,C,y){this._74I.add(t,C,y)},removeSelectionChangeListener:function(Q,e){this._74I.remove(Q,e)},_97O:function(_,W){for(var A,z=this,a=0,K=new lo(_);a<K.size();a++)A=K.get(a),(z._filterFunc&&!z._filterFunc(A)||W&&z.co(A)||!W&&!z.co(A)||!z._dataModel.contains(A))&&(K.removeAt(a),a--);return K},appendSelection:function(J){var Z=this;if(Z._68O!==Yc){var l,i,G=Z._73O,k=Z._97O(J,!0);k.isEmpty()||(Z.sg()&&(l=new lo(G),i=Z._map,G.clear(),Z._map={},k=new lo(k.get(k.size()-1))),k.each(function(s){G.add(s),Z._map[s._id]=s}),Z._75I("append",k,l,i))}},removeSelection:function(H){var Q=this,w=Q._97O(H),e=0,S=w.size();if(0!==S){for(;S>e;e++){var P=w.get(e);Q._73O.remove(P),delete Q._map[P._id]}Q._75I(ko,w)}},toSelection:function(t,s){return this._73O.toList(t,s)},getSelection:function(){return this._73O},each:function(q,z){this._73O.each(q,z)},setSelection:function(K){var n=this,$=n._73O;if(n._68O!==Yc&&!($.isEmpty()&&!K||1===$.size()&&n.ld()===K)){var z=new lo($),l=n._map;$.clear(),n._map={};var M=n._97O(K,!0);n.sg()&&M.size()>1&&(M=new lo(M.get(M.size()-1))),M.each(function(s){$.add(s),n._map[s._id]=s}),n._75I("set",q,z,l)}},clearSelection:function(){var k=this,Q=k._73O;if(Q.size()>0){var f=Q.toList();Q.clear(),k._map={},k._75I(bl,f)}},selectAll:function(){var j=this;if(j._68O!==Yc){var $,x,D=j._dataModel.toDatas();if(j._filterFunc)for($=0;$<D.size();$++)x=D.get($),j._filterFunc(x)||(D.removeAt($),$--);var l=j._73O,K=new lo(l),z=j._map;l.clear(),j._map={},j.sg()&&D.size()>1&&(D=new lo(D.get(D.size()-1)));var P=D.size();for($=0;P>$;$++)x=D.get($),l.add(x),j._map[x._id]=x;j._75I("all",q,K,z)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(t){return this._map[t._id]!=q},getLastData:function(){var w=this._73O;return w.size()>0?w.get(w.size()-1):q},getFirstData:function(){var M=this._73O;return M.size()>0?M.get(0):q},isSelectable:function(O){var P=this;return O&&P._68O!==Yc?P._filterFunc?P._filterFunc(O):!0:!1},getTopSelection:function(){var s=this,Z=new lo;return s._73O.each(function(h){for(var d=h.getParent();d;){if(s.contains(d)){h=q;break}d=d.parent}h&&Z.add(h)}),Z}});var fm=function(){return de(0),function(I,T){var h;if(Ac(T)){var U=I.getDataUI(T);U&&U._88I&&(h=U._88I.rect)}return h?h:T.getRect()}}();zb(M,{edgeGroupAgentFunc:q,graphViewAutoScrollZone:16,graphViewZoomable:!0,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:b.rectSelectBorder,graphViewRectSelectBackground:Aq,graphViewEditPointSize:lf?17:7,graphViewEditPointBorderColor:b.editPointBorder,graphViewEditPointBackground:b.editPointBackground,setEdgeType:function(U,E,R){Uq[U]=E,mb[U]=R},getEdgeType:function(B){return Uq[B]},getEdgeTypeMap:function(){return Uq},getNodeRect:fm},!0);var $m={"layout.h":A,"layout.v":A,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":A,"2d.attachable":!1,"2d.hostable":!1,interactive:!1,preventDefaultWhenInteractive:!0,disableDoubleClick:!1,"image.stretch":"fill",icons:A,ingroup:!0,"body.color":A,"2d.gray":!1,fullscreen:A,"fullscreen.gap":2,"fullscreen.lock":!1,opacity:A,pixelPerfect:!0,keepAspectRatio:!1,"attach.points":null,"attach.style":null,"attach.close.threshold":16,"vector.layoutable":!1,"clip.direction":"top","clip.percentage":A,"clip.host":!1,"select.color":Bc,"select.width":1,"select.padding":2,"select.type":jk,"shadow.interactable":!0,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,shadow2:!1,"shadow2.color":Bc,"shadow2.blur":6,"shadow2.offset.x":3,"shadow2.offset.y":3,"border.color":A,"border.width":2,"border.padding":2,"border.type":jk,label:A,"label.font":A,"label.color":Hj,"label.background":A,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":A,"label.max":A,"label.opacity":A,"label.scale":1,"label.align":A,"label.selectable":!0,"label.decoration":A,label2:A,"label2.font":A,"label2.color":Hj,"label2.background":A,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":A,"label2.max":A,"label2.opacity":A,"label2.scale":1,"label2.align":A,"label2.selectable":!0,"label2.decoration":A,note:A,"note.expanded":!0,"note.font":A,"note.color":Sf,"note.background":Bc,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":A,"note.toggleable":!0,"note.border.width":1,"note.border.color":A,"note.opacity":A,"note.scale":1,"note.align":A,note2:A,"note2.expanded":!0,"note2.font":A,"note2.color":Sf,"note2.background":Bc,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":A,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":A,"note2.opacity":A,"note2.scale":1,"note2.align":A,"group.type":A,"group.image":A,"group.image.stretch":"fill","group.repeat.image":A,"group.border.repeat.image":A,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":A,"group.title.color":Sf,"group.title.background":b.groupTitleBackground,"group.title.align":wk,"group.title.orientation":vg,"group.background":b.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":A,"group.border.color":pb,"group.border.radius":A,"group.border.cap":jo,"group.border.join":Wl,"group.border.width.absolute":!1,"group.splitLine":!1,"group.gradient":q,"group.gradient.color":"#FFF",shape:A,"shape.background":pb,"shape.repeat.image":A,"shape.border.repeat.image":A,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":pb,"shape.border.3d":!1,"shape.border.3d.color":A,"shape.border.3d.accuracy":A,"shape.border.cap":jo,"shape.border.join":Wl,"shape.border.pattern":A,"shape.gradient":q,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":Qr,"shape.dash.offset":0,"shape.dash.color":kn,"shape.dash.width":A,"shape.dash.3d":!1,"shape.dash.3d.color":A,"shape.dash.3d.accuracy":A,"shape.polygon.side":6,"shape.arc.from":Y,"shape.arc.to":c,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":A,"shape.gradient.pack":A,"shape.border.gradient.pack":A,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":A,"shape.foreground":A,"shape.foreground.gradient":q,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":A,"shape.regular":!0,"autolayout.gap":A,"autolayout.hgap":A,"autolayout.vgap":A,"edge.type":A,"edge.points":A,"edge.segments":A,"edge.color":pb,"edge.width":2,"edge.width.absolute":!1,"edge.repeat.image":null,"edge.offset":0,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":A,"edge.3d.accuracy":A,"edge.cap":jo,"edge.join":Wl,"edge.source.position":17,"edge.source.anchor.x":A,"edge.source.anchor.y":A,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.source.index":-1,"edge.source.percent":0,"edge.target.position":17,"edge.target.anchor.x":A,"edge.target.anchor.y":A,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.target.index":-1,"edge.target.percent":0,"edge.pattern":A,"edge.dash":!1,"edge.dash.pattern":Qr,"edge.dash.offset":0,"edge.dash.color":kn,"edge.dash.width":A,"edge.dash.3d":!1,"edge.dash.3d.color":A,"edge.dash.3d.accuracy":A,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":A,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":A,"grid.column.percents":A,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":b.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":b.gridCellBorderColor,"grid.block":A,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":b.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":Hj,"text.gradient.pack":A,"text.font":vk,"text.shadow":!1,"text.shadow.color":Bc,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1,"text.gradient":A,"text.gradient.color":"#FFF","text.decoration":A,"text.vertical":!1,"text.vertical.gap":1,"text.wrap":!1,"text.letter.gap":null,"text.border.color":Bc,"text.border.width":0,keepPosition:!0};$m[td]=A,zb(T,$m,!0),zb(Xl,{_76I:function(G,r,N){this._39I&&this._39I.fire({data:G,oldIndex:r,newIndex:N})},addIndexChangeListener:function(o,L,x){var t=this;t._39I||(t._39I=new Ee),t._39I.add(o,L,x)},removeIndexChangeListener:function(u,q){this._39I.remove(u,q)},prepareRemove:function(y){dq(y)&&(y.setSource(q),y.setTarget(q)),y._70O&&y._70O.toList().each(this.remove,this),y._69O&&y._69O.toList().each(function(A){A.setHost(q)}),y._host&&y.setHost(q)},onAdded:function(b){this.isAutoAdjustIndex()&&this.adjustIndex(b)},onDataPropertyChanged:function(w,$){Sg[$.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(w)},isAdjustable:function(u){return uk(u)||dq(u)},isAdjustedToBottom:function(o){return qq(o)?o.isExpanded()&&qc(o):!1},adjustIndex:function(K){var B=this;this.isHierarchicalRendering()||(B.isAdjustedToBottom(K)?(B.sendToBottom(K),K.eachChild(B.adjustIndex,B)):B.sendToTop(K))},sendToTop:function(Q){var w=this;if(w.contains(Q)&&w.isAdjustable(Q)){var T=w._datas;if(Q!==T.get(w.size()-1)){var L=T.indexOf(Q);T.removeAt(L),T.add(Q),w._76I(Q,L,w.size()-1)}if(dq(Q)){var A=Q._40I;A&&!w.isAdjustedToBottom(A)&&w.sendToTop(A),A=Q._41I,A&&!w.isAdjustedToBottom(A)&&w.sendToTop(A)}Q._69O&&Q._69O.each(function(l){l.isRelatedTo(Q)||uk(Q)&&l.isLoopedHostOn(Q)||w.sendToTop(l)}),Q.ISubGraph||(!qq(Q)||Q.isExpanded())&&Q._adjustChildrenToTop&&Q.eachChild(function(j){dq(j)||w.sendToTop(j)})}},sendToBottom:function(x,F){var V=this;if(x!==F&&V.contains(x)&&V.isAdjustable(x)&&(!F||V.contains(F))){var _=V._datas,U=_.remove(x),M=F?V._datas.indexOf(F):0;if(_.add(x,M),U!==M){V._76I(x,U,M);var g=x._parent;!g||g.ISubGraph||dq(g)||V.sendToBottom(x._parent,x)}}}}),zb(Mp,{ms_edit:function(A){A._46O=function(A){var v=this,Z=v.gv.dm(),H=v._index,F=v._89I,E=v._node,i=v._shape,z=v._edge,R=v._77I;E&&F?(this.fi({kind:"endEditRect",event:A,data:E,direction:F}),Z.endTransaction()):i&&H>=0?(v.fi({kind:"endEditPoint",event:A,data:i,index:H}),Z.endTransaction()):z&&H>=0?(v.fi({kind:"endEditPoint",event:A,data:z,index:H}),Z.endTransaction()):R&&(v.fi({kind:"endEditRotation",event:A,data:R}),Z.endTransaction())},A._78I=function(j){var X=this;X.autoScroll(j);var k=X.gv.lp(j),v=X._index,l=X._89I,x=X._node,p=X._shape,W=X._edge,Q=X._77I;if(x&&l)X._80O(k),X.fi({kind:"betweenEditRect",event:j,data:x,direction:l});else if(p&&v>=0)k.e=p.getPoints().get(v).e,p.setPoint(v,k),X.fi({kind:"betweenEditPoint",event:j,data:p,index:v});else if(W&&v>=0){var i=W.s(Zf);k.e=i.get(v).e,i.set(v,k),W.fp(Zf,q,i),X.fi({kind:"betweenEditPoint",event:j,data:W,index:v})}else if(Q){var O=Q.p(),z=Q.getScale(),H=Ek+Cl(k.y-O.y,k.x-O.x);z.y<0&&(H+=Y),D(H)<.04&&(H=0),Q.setRotation(H),X.fi({kind:"betweenEditRotation",event:j,data:Q})}},A._80O=function(Q){var k=this,R=k._node,w=k._rect,S=w.x,p=w.y,J=w.width,o=w.height,C=k._89I,K=k._anchor,D=k._matrix,Q=D.tfi(Q);"northwest"===C?w=vn(Q,{x:S+J,y:p+o}):C===im?w=vn({x:S,y:Q.y},{x:S+J,y:p+o}):"northeast"===C?w=vn({x:S,y:Q.y},{x:Q.x,y:p+o}):C===cr?w=vn({x:Q.x,y:p},{x:S+J,y:p+o}):C===yo?w=vn({x:S,y:p},{x:Q.x,y:p+o}):"southwest"===C?w=vn({x:Q.x,y:p},{x:S+J,y:Q.y}):"south"===C?w=vn({x:S,y:p},{x:S+J,y:Q.y}):"southeast"===C&&(w=vn({x:S,y:p},Q)),R.setPosition(D.tf(w.x+w.width*K.x,w.y+w.height*K.y)),R.setWidth(w.width),R.setHeight(w.height)},A._80I=function(i,n,U,M){var D=this,B=D.gv._zoom,z=(D.gv.getEditPointSize()+2)/B;return Do({x:n-z/2,y:U-z/2,width:z,height:z},i)?(D._89I!==M&&(D._89I=M),!0):!1},A._79I=function(d,H,T){var Y=this,Z=Y.gv,s=H?Z.getDataUI(H):q,G=s?s._55O:q;if(G){var S,J,R,r,D=Z._zoom,m=(Z.getEditPointSize()+2)/D,e=Z.lp(d);if(uk(H)){if(G._56O&&uk(H)&&(J=G._98o,Do({x:J.x-m/2,y:J.y-m/2,width:m,height:m},e)))return Y._77I=H,T&&Y.fi({kind:"beginEditRotation",event:d,data:H}),Y.setCursor("crosshair"),!0;if(G._43O&&H instanceof cg)for(R=H.getPoints(),S=R.size()-1;S>=0;S--)if(J=R.get(S),Do({x:J.x-m/2,y:J.y-m/2,width:m,height:m},e))return Y._index=S,Y._shape=H,T&&Y.fi({kind:"beginEditPoint",event:d,data:H,index:S}),Y.setCursor("crosshair"),!0;if(G._42O)for(var v=H.getEditControlPoints(),l=["northwest",-1,-1,cr,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,yo,1,0,"northeast",1,-1,im,0,-1],S=0,r=v.length;r>S;S++){var V=l[3*S],u=v[S];if(Y._80I(e,u.x,u.y,V)){Y._node=H;var N=H.getWidth(),x=H.getHeight(),E=H.getAnchor();Y._rect={x:-N*E.x,y:-x*E.y,width:N,height:x},Y._anchor=E,Y._matrix=H.getMatrix();var w=H.getRotation(),W=O(w),g=o(w),j=l[3*S+1]*Vb(H.getScale().x),t=l[3*S+2]*Vb(H.getScale().y),L=Math.atan2(-g*j-W*t,W*j-g*t),X=(Math.round(L/(Math.PI/4))+8)%8,h=[tf,"nesw-resize",ye,"nwse-resize",tf,"nesw-resize",ye,"nwse-resize"][X];return Y.setCursor(h),T&&Y.fi({kind:"beginEditRect",event:d,data:H,direction:Y._89I}),!0}}}if(G._43O&&dq(H)&&H.s(Oi)===kh&&(R=H.s(Zf)))for(S=R.size()-1;S>=0;S--)if(J=R.get(S),Do({x:J.x-m/2,y:J.y-m/2,width:m,height:m},e))return Y._index=S,Y._edge=H,T&&Y.fi({kind:"beginEditPoint",event:d,data:H,index:S}),Y.setCursor("crosshair"),!0}return!1}},ms_gv:function(T){T._currentSubGraph=q,T._initView=function(){this._fpsInfo={time:0,fps:0,frames:0}},T.upSubGraph=function(){this.setCurrentSubGraph(Le(this._currentSubGraph))
},T.isVisible=function(s){var A=this;if(Le(s)!==A._currentSubGraph)return!1;if(dq(s)){var z=s._40I,f=s._41I;if(!z||!f)return!1;if(!(s.s("edge.independent")||A.isVisible(z)&&A.isVisible(f)))return!1;if(s.isEdgeGroupHidden())return!1}else for(var t=s._parent;t&&!t.ISubGraph;){if(qq(t)&&(!t.isExpanded()||!A.isVisible(t)))return!1;t=t._parent}if(s._parent instanceof df&&!A.isVisible(s._parent))return!1;if(s._refGraph instanceof bo&&!A.isVisible(s._refGraph))return!1;if(A instanceof Gs){if(!s.s("3d.visible"))return!1}else{var R=A.getLayersInfo();if(R){var x=R[s._layer];if(x&&x.visible===!1)return!1}if(!s.s("2d.visible"))return!1}return A._visibleFunc?A._visibleFunc(s):!0},T.handleSelectionChange=function(p){var G=this;p.datas.each(function(u){G.invalidateData(u);var J=u._parent;qq(J)&&uk(u)&&u.s(cp)&&(G.invalidateData(J),J._49I&&J._49I.each(function(I){G.invalidateData(I)}))}),G.onSelectionChanged(p)},T.onSelectionChanged=function($){var i=this,t=i.sm();if(1===t.size()&&("set"===$.kind||"append"===$.kind)){var S=t.ld();i.isAutoMakeVisible()&&i.makeVisible(S),i.adjustIndex&&i._dataModel.isAutoAdjustIndex()&&i.adjustIndex(S)}},T.makeVisible=function(l){if(l){var L=this,W=L.getDataUI?L.getDataUI(l):L.getData3dUI(l);if(W){var w=l,j=Le(l);for(j!==L._currentSubGraph&&L.setCurrentSubGraph(j);(w=w._parent)&&w!==j;)qq(w)&&w.setExpanded(!0);L._23I=l,L.iv()}}},T.getLabel=function(s){var B=s.getStyle(dd);return B===A?s.getName():B},T.getLabelBackground=function(F){return F.getStyle("label.background")},T.getLabelColor=function(p){return p.getStyle("label.color")},T.getLabel2=function(D){return D.getStyle("label2")},T.getLabel2Background=function(p){return p.getStyle("label2.background")},T.getLabel2Color=function(o){return o.getStyle("label2.color")},T.getNote=function(e){return e.getStyle(Mb)},T.getNoteBackground=function(L){return L.getStyle("note.background")},T.getNote2=function(Z){return Z.getStyle(Wh)},T.getNote2Background=function(y){return y.getStyle("note2.background")},T.handleClick=function(j,V,p){var $=this;V?($.fi({kind:"clickData",event:j,data:V,part:p}),$.onDataClicked(V,j)):($.fi({kind:"clickBackground",event:j}),$.onBackgroundClicked(j))},T.handleDoubleClick=function(D,W,G){var o=this;$h(D)&&(W?(o.fi({kind:"doubleClickData",event:D,data:W,part:G}),o.onDataDoubleClicked(W,D,G),o.checkDoubleClickOnNote(D,W,G)||o.checkDoubleClickOnRotation&&o.checkDoubleClickOnRotation(D,W,G)||(dq(W)?o.onEdgeDoubleClicked(W,D,G):W.ISubGraph?o.onSubGraphDoubleClicked(W,D,G):qq(W)?o.onGroupDoubleClicked(W,D,G):W.IDoorWindow?o.onDoorWindowDoubleClicked(W,D,G):W.ICSGBox&&o.onCSGBoxDoubleClicked(W,D,G))):(o.fi({kind:"doubleClickBackground",event:D}),o.onBackgroundDoubleClicked(D)))},T.onSubGraphDoubleClicked=function(f){this.setCurrentSubGraph(f)},T.onEdgeDoubleClicked=function(X,t){this.isEditable(X)||(X.ISubGraph&&!qp(t)?this.setCurrentSubGraph(X):X.s("edge.toggleable")&&X.toggle())},T._39Q=function(q){return this.isInteractive(q)?this.preventDefaultWhenInteractive(q):!1},T.preventDefaultWhenInteractive=function(F){return F.s("preventDefaultWhenInteractive")},T.onGroupDoubleClicked=function(w){w.s("group.toggleable")&&w.toggle()},T.onDoorWindowDoubleClicked=function(t){t.s("dw.toggleable")&&t.toggle(!0)},T.onCSGBoxDoubleClicked=function(P,V){var u=this;if(u instanceof Gs){var M=u.intersectObject(V,P);M&&P.s(M.part+".toggleable")&&P.toggleFace(M.part,!0)}},T.onBackgroundClicked=function(){},T.onBackgroundDoubleClicked=function(){this.upSubGraph()},T.onDataClicked=function(){},T.onDataDoubleClicked=function(){},T.onAutoLayoutEnded=function(){},T.onMoveEnded=function(){},T.onPanEnded=function(){},T.onPinchEnded=function(){},T.onRectSelectEnded=function(){},T.onZoomEnded=function(){},T.serialize=function(W){return this.dm().serialize(W)},T.toJSON=function(){return this.dm().toJSON()},T.deserialize=function(t,g){var T=this;g=g instanceof Vp?{rootParent:g}:_k(g)?{setId:g}:hc(g)?{finishFunc:g}:g||{},g.view=T;var d=T.dm();return g.reset&&(d.setAttrObject({}),d.setLayers(A),d.setName(A),d.setAutoAdjustIndex(!0),d.setHierarchicalRendering(!1),d.setBackground(A),d.setInit(A),d.setPostProcessingData(A),d.setEnvmap(A),d.setEnvmapType(A),T.disableToolTip(),T instanceof x.graph.GraphView?(T.setZoomable(M.graphViewZoomable),T.setPannable(M.graphViewPannable),T.setRectSelectable(M.graphViewRectSelectable)):T instanceof x.graph3d.Graph3dView&&(T.shadowMap.resetProperties(),T.setDashDisabled(M.graph3dViewDashDisabled),T.setUvClipEnabled(M.graph3dViewUvClipEnabled),T.getHighlightHelper().resetProperties(),T.resetHeadlightProperties(),T.resetFogProperties(),T.setBatchInfoMap({}),T.setBatchColorDisabled(M.graph3dViewBatchColorDisabled),T.setBatchInstancedDisabled(M.graph3dViewBatchInstancedDisabled),T.setBatchBlendDisabled(M.graph3dViewBatchBlendDisabled),T.setBatchBrightnessDisabled(M.graph3dViewBatchBrightnessDisabled),T.setFlowBlendMode(M.graph3dViewFlowBlendMode),T.setMoveStep(M.graph3dViewMoveStep),T.setRotateStep(M.graph3dViewRotateStep),T.setSortable(M.graph3dViewSortable),T.setSortFunc(A),T.setSkybox(A),sh(T))),g.__innerHandler__=function(j){if(_k(d.a("toolTipEnable"))&&(d.a("toolTipEnable")?T.enableToolTip():T.disableToolTip()),bj(d.a("fontFaces"))&&d.a("fontFaces").forEach(function(h){M.addFontFace(h.name,h.url)}),T instanceof x.graph.GraphView&&(_k(d.a("zoomable"))&&T.setZoomable&&T.setZoomable(d.a("zoomable")),_k(d.a("pannable"))&&T.setPannable&&T.setPannable(d.a("pannable")),_k(d.a("rectSelectable"))&&T.setRectSelectable&&T.setRectSelectable(d.a("rectSelectable")),d.a("fitContent")===!0&&T.fitContent&&T.fitContent(!0,0)),T instanceof x.graph3d.Graph3dView){var s=j.scene;s&&s.shadow!=q&&T.shadowMap.setShadow(s.shadow,s.shadowParams);var h=d.a("sceneContext");h?(h.eye&&T.setEye(h.eye),h.center&&T.setCenter(h.center),xe(h.far)&&T.setFar(h.far),xe(h.near)&&T.setNear(h.near)):(xe(d.a("sceneNear"))&&T.setNear(d.a("sceneNear")),xe(d.a("sceneFar"))&&T.setFar(d.a("sceneFar")),s&&(s.eye&&T.setEye(s.eye),s.center&&T.setCenter(s.center))),xe(d.a("sceneFovy"))&&T.setFovy(d.a("sceneFovy")),_k(d.a("sceneOrtho"))&&T.setOrtho(d.a("sceneOrtho")),xe(d.a("sceneOrthoWidth"))&&T.setOrthoWidth(d.a("sceneOrthoWidth")),_k(d.a("sceneShadowEnabled"))&&(d.a("sceneShadowEnabled")?T.enableShadow():T.disableShadow()),xe(d.a("sceneShadowDegreeX"))&&T.setShadowDegreeX(d.a("sceneShadowDegreeX")),xe(d.a("sceneShadowDegreeZ"))&&T.setShadowDegreeZ(d.a("sceneShadowDegreeZ")),xe(d.a("sceneShadowIntensity"))&&T.setShadowIntensity(d.a("sceneShadowIntensity")),d.a("sceneShadowQuality")!=q&&T.setShadowQuality(d.a("sceneShadowQuality")),d.a("sceneShadowType")&&T.setShadowType(d.a("sceneShadowType")),xe(d.a("sceneShadowRadius"))&&T.setShadowRadius(d.a("sceneShadowRadius")),xe(d.a("sceneShadowBias"))&&T.setShadowBias(d.a("sceneShadowBias")),_k(d.a("sceneDashEnable"))&&T.setDashDisabled(!d.a("sceneDashEnable")),_k(d.a("sceneUvClipEnabled"))&&T.setUvClipEnabled(d.a("sceneUvClipEnabled")),ro(d.a("sceneHighlightMode"))&&T.setHighlightMode(d.a("sceneHighlightMode")),xe(d.a("sceneHighlightWidth"))&&T.setHighlightWidth(d.a("sceneHighlightWidth")),d.a("sceneHighlightColor")&&T.setHighlightColor(d.a("sceneHighlightColor")),d.a("sceneHighlightType")&&T.setHighlightType(d.a("sceneHighlightType")),d.a("sceneHighlightGlow")&&T.setHighlightGlow(d.a("sceneHighlightGlow")),d.a("sceneHighlightStrength")&&T.setHighlightStrength(d.a("sceneHighlightStrength")),_k(d.a("sceneHeadlightEnable"))&&T.setHeadlightDisabled(!d.a("sceneHeadlightEnable")),d.a("sceneHeadlightDirection")!=q&&T.setHeadlightDirection(d.a("sceneHeadlightDirection")),xe(d.a("sceneHeadlightRange"))&&T.setHeadlightRange(d.a("sceneHeadlightRange")),d.a("sceneHeadlightColor")&&T.setHeadlightColor(d.a("sceneHeadlightColor")),xe(d.a("sceneHeadlightIntensity"))&&T.setHeadlightIntensity(d.a("sceneHeadlightIntensity")),xe(d.a("sceneHeadlightAmbientIntensity"))&&T.setHeadlightAmbientIntensity(d.a("sceneHeadlightAmbientIntensity")),xe(d.a("sceneHeadlightGroup"))&&T.setHeadlightGroup(d.a("sceneHeadlightGroup")),_k(d.a("sceneFogEnable"))&&T.setFogDisabled(!d.a("sceneFogEnable")),d.a("sceneFogMode")&&T.setFogMode(d.a("sceneFogMode")),xe(d.a("sceneFogDensity"))&&T.setFogDensity(d.a("sceneFogDensity")),d.a("sceneFogColor")&&T.setFogColor(d.a("sceneFogColor")),xe(d.a("sceneFogNear"))&&T.setFogNear(d.a("sceneFogNear")),xe(d.a("sceneFogFar"))&&T.setFogFar(d.a("sceneFogFar")),_k(d.a("sceneBatchBrightnessDisabled"))&&T.setBatchBrightnessDisabled(d.a("sceneBatchBrightnessDisabled")),d.a("sceneFlowBlendMode")!==A&&T.setFlowBlendMode(d.a("sceneFlowBlendMode")),_k(d.a("sceneBatchBlendDisabled"))&&T.setBatchBlendDisabled(d.a("sceneBatchBlendDisabled")),_k(d.a("sceneBatchColorDisabled"))&&T.setBatchColorDisabled(d.a("sceneBatchColorDisabled")),_k(d.a("sceneBatchInstancedDisabled"))&&T.setBatchInstancedDisabled(d.a("sceneBatchInstancedDisabled")),d.a("sceneBatchInfoMap")&&T.setBatchInfoMap(d.a("sceneBatchInfoMap")),d.a("sceneRenderLayerInfoMap")&&T.setRenderLayerInfoMap(d.a("sceneRenderLayerInfoMap")),xe(d.a("sceneMoveStep"))&&T.setMoveStep(d.a("sceneMoveStep")),xe(d.a("sceneRotateStep"))&&T.setRotateStep(d.a("sceneRotateStep")),_k(d.a("sceneSortable"))&&T.setSortable(d.a("sceneSortable")),hc(d.a("sceneSortFunc"))&&T.setSortFunc(d.a("sceneSortFunc"));var r=d.a("sceneSkyboxType")||"sphere";if(r!=q){var Y={},S=!1;if("sphere"===r){Y.shape3d=r;var b=d.a("sceneSkyboxImage");b&&(Y["shape3d.image"]=b,S=!0)}else"cube"===r?(Y.shape3d=A,["front","back","left","right","top","bottom"].forEach(function(r){var F=r+".image",q=r.charAt(0).toUpperCase()+r.slice(1),L=d.a("sceneSkybox"+q+"Image");L&&(Y[F]=L,S=!0)})):"color"===r&&(S=!0);if(S){var w=new Ak,V=d.a("sceneSkyboxDiameter");if(xe(V)?w.s3(V,V,V):w.s3(20,20,20),Y["body.color"]=d.a("sceneSkyboxBodyColor"),Y.envmap=d.a("sceneSkyboxEnvmap"),Y["envmap.probe"]=d.a("sceneSkyboxEnvmapProbe"),Y.roughness=d.a("sceneSkyboxRoughness"),Y["shape3d.light"]=Y["all.light"]=d.a("sceneSkyboxLight"),Y["light.mask"]=d.a("sceneSkyboxLightMask"),Y["headlight.ambientIntensity"]=d.a("sceneSkyboxHeadLightAmbientIntensity"),Y["texture.wrap"]="clampToEdge",Y["3d.clipbox.mask"]=dn,Y["effect.flow.mask"]=dn,"color"===r){Y.shape3d="sphere";var z=2,o=1024,b=w.s("shape3d.image"),D=b&&x.Default.getImage(b);D&&"CANVAS"===D.tagName||(D=$.createElement("canvas"),b=x.Math.generateUUID(),x.Default.setImage(b,D)),b&&T.getTextureMap()&&T.deleteTexture(b),x.Default.setCanvas(D,z,o,1);var H=D.getContext("2d");H.clearRect(0,0,z,o),H.beginPath(),H.rect(0,0,z,o),mc(H,d.a("sceneSkyboxColor"),function(I){return I},!1,{x:0,y:0,width:z,height:o}),H.fill(),H.restore(),Y["shape3d.image"]=b}w.s(Y),["X","Y","Z"].forEach(function(t){var r=d.a("sceneSkyboxRotation"+t);xe(r)&&w["setRotation"+t](r)}),T.setSkybox(w)}}}},d.deserialize(t,g.rootParent,g)},T.isDebugTipShowing=function(){return!!this._debugDiv},T.showDebugTip=function(){var D=this,d=D._debugDiv;if(!d){d=D._debugDiv=$.createElement("div"),d.style.position="absolute",d.style.overflow="hidden",d.style.font=M.debugTipLabelFont,d.style.padding="6px",d.style.backgroundColor=M.debugTipBackground,d.style.color=M.debugTipLabelColor;var w=D.getView();D._79O?w.insertBefore(d,D._79O):w.appendChild(d);var I=function(){D.redraw();var r=D._canvas,u="FPS: "+D._fpsInfo.fps+"<br/>"+"Datas: "+D.dm().getDatas().length+(r?"<br/>Size: "+r.width+" * "+r.height:""),F=D.dm()._historyManager;F&&(u+="<br/>Undoes: "+F.getHistories().length+" index: "+F.getHistoryIndex());var e=D.getDebugTip();e&&(u+="<hr>"+e),d.innerHTML=u,D._isDebugging&&requestAnimationFrame(I)};requestAnimationFrame(I),D._isDebugging=!0}},T.hideDebugTip=function(){var b=this,w=b._debugDiv;w&&(delete b._debugDiv,b.getView().removeChild(w),b._isDebugging=!1)},T.updateDOMAppendMatrix=function(){var k=this.getView();k&&(k.updateAppendMatrix=!0)},T.countFrame=function(){if(this._isDebugging){var A=Date.now(),d=this._fpsInfo;A-d.time>1e3?(d.fps=Math.round(1e5*(d.frames+1)/(A-d.time))/100,d.time=A,d.frames=0):d.frames++}}},ms_icons:function(c){c.getRotation=function(x){return x==q?0:x},c._15O=function(){var S=this,Q=S.s(ed);if(Q){var r=S,a=S.data||S._data,A=a.getRotation&&a.getRotation(),_=S._38o={icons:Q,rects:{}};for(var X in Q){var B=Q[X],P=gl(B.shape3d,a,r);if(!(gl(B.visible,a,r)===!1||gl(B.for3d,a,r)&&!S.I3d||P&&!S.I3d)){var f=P?[P]:gl(B.names,a,r),C=f?f.length:0,H=gl(B.position,a,r)||3,l=gl(B.offsetX,a,r)||0,n=gl(B.offsetY,a,r)||0,F=gl(B.direction,a,r)||yo,N=gl(B.gap,a,r),Y=N!=q?N:1,W=gl(B.rotation,a,r),D=gl(B.keepOrien,a,r),I=gl(B.rotationFixed,a,r)?W:S.getRotation(W,D,H),O=q,R=_.rects[X]=new Array(C);xe(A)&&(xe(I)?I+=A:I=A),R.rotation=I;for(var e=0;C>e;e++){var G,u,z,T,o=f[e];if(P)z=0,T=0;else{var p=yd(o);z=gl(B.width,a,r),T=gl(B.height,a,r),z==q&&(z=Wq(p,a)),T==q&&(T=pm(p,a))}if(O?F===yo?l+=z/2:F===cr?l-=z/2:F===im?n-=T/2:n+=T/2:O={width:z,height:T},S.I3d){var x=-z/2,s=-T/2;u={width:z,height:T,mat:S._16O(gl(B.autorotate,a,r),H,O,gl(B.face,a,r)||Ao,gl(B.t3,a,r),gl(B.r3,a,r),gl(B.rotationMode,a,r),l,n),vs:new yk([x,-s,0,x,-s-T,0,x+z,-s-T,0,x+z,-s,0])}}else G=S.getPosition(H,l,n,O,gl(B.positionFixed,a,r)),u={x:G.x-z/2,y:G.y-T/2,width:z,height:T},S._68o(u,I);R[e]=u,F===yo?l+=z/2+Y:F===cr?l-=z/2+Y:F===im?n-=T/2+Y:n+=T/2+Y}}}}}}});var Ii={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},$e={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},vr={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},Sg={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},hm={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},nk={"edge.type":1,"edge.group":1},eg={rotation:1,rotationX:1,rotationZ:1,rotation3d:1},to={rotation:1,position:1,width:1,height:1,anchor:1,scale:1,host:1,"s:vector.layoutable":1,"s:2d.visible":1},Cs={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},rl={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},md={shape:1,thickness:1,position:1,anchor:1,scale:1},Le=function(E){if(!E)return q;if(dq(E)){var h=E._40I,d=E._41I;if(!h||!d)return q;var x=Le(h),k=Le(d);return x===k?x:q}for(var _=E._parent;dq(_)&&!_.ISubGraph;)_=_._parent;return _?_.ISubGraph?_:Le(_):q},bq=function(b,O,q,i){var u=O.getStyle(q)*i;u&&Ti(b,u),u=O.getStyle(q+".left")*i,u&&(b.x-=u,b.width+=u),u=O.getStyle(q+".right")*i,u&&(b.width+=u),u=O.getStyle(q+".top")*i,u&&(b.y-=u,b.height+=u),u=O.getStyle(q+".bottom")*i,u&&(b.height+=u),b.width<0&&(b.width=-b.width,b.x-=b.width),b.height<0&&(b.height=-b.height,b.y-=b.height)},qc=function(K){for(var I,g=0,E=K.size();E>g;g++)if(I=K.getChildAt(g),uk(I)&&qc(I))return!0;return K.hasAgentEdges()},Or=function(l){if(!l)return q;for(var u=l._parent;qq(u);){if(!qq(u._parent))return u.isExpanded()?l:u;u.isExpanded()||(l=u),u=u._parent}return l},Bi=function(l,r){if(!l||!r)return q;var B,e,u,b=Le(l),Q=Le(r);if(b!==Q){for(;Q&&b!==Q;)Q=Le(Q);if(b===Q)return l;B=new lo,B.add(l,0);for(var s=l._parent;uk(s)&&!r.isDescendantOf(s);)B.add(s,0),s=s._parent;for(u=B.size(),e=0;u>e;e++){var y=B.get(e);if(qq(y)&&!y.isExpanded())return y;if(y.ISubGraph)return y}return l}return l},Ub=function(M){if(M.isLooped())return M._source;var H=Or(M._source),l=Or(M._target);return H===l?M._source:Bi(H,l)},ml=function(K){if(K.isLooped())return K._target;var s=Or(K._source),T=Or(K._target);return s===T?K._target:Bi(T,s)},Ye=function(g,B,C){"target"!==C&&(C="source");var U="target"===C?B.getTargetAgent():B.getSourceAgent(),K="edge."+C+".";if(dq(U)){var x=g.getDataUI(U);x._79o();var a=B.s(K+"index");if(a>=0){var M=Hm(x);return M[Math.max(0,Math.min(a,M.length-1))]}var w=B.s(K+"percent")||0;w=Math.max(0,Math.min(w,1));var E=jm(x);return Fp(E,100*w)}return fp(g,U,B.s(K+"position"),B.s(K+"offset.x"),B.s(K+"offset.y"),B.s(K+"anchor.x"),B.s(K+"anchor.y"))},fp=function(i,J,E,k,t,j,K){if(!J)return q;var p,H=J.getRotation?J.getRotation():0;if(j!==A||K!==A){j=j===A?.5:j,K=K===A?.5:K;var a=J.getScale();if(H&&!Ac(J,i)||a.x<0||a.y<0){var F=J.getPosition(),b=J.getWidth(),d=J.getHeight(),S=J.getAnchor(),U=new rd(H,F.x,F.y,a.x,a.y);E=U.tf((j-S.x)*b,(K-S.y)*d)}else p=fm(i,J),E={x:p.x+j*p.width,y:p.y+K*p.height}}else E=oo(E,fm(i,J));if(H){var h=O(H),g=o(H),Y=k*h-t*g;t=k*g+t*h,k=Y}return E.x+=k,E.y+=t,E},Xq=function(t,p){if(!t||!p)return q;var i,N,G,P,D,s;if(t===p){if(P=t.getLoopedEdges(),!P)return q;P=new lo(P)}else{if(D=t.getAgentEdges(),s=p.getAgentEdges(),!D||!s)return q;for(N=D.size(),i=0;N>i;i++)G=D.get(i),s.contains(G)&&(P||(P=new lo),P.add(G))}if(P)for(i=0;i<P.size();i++)G=P.get(i),G.getStyle(Oi)===kh&&(G._22I(q),P.removeAt(i),i--);return P},Ur=function(k,l){var h=Xq(k,l);if(h&&!h.isEmpty()){if(1===h.size())return h.get(0)._22I(q),void 0;var E=new lo,e=new lo;h.each(function(g){var D=g.s("edge.group");E.contains(D)||E.add(D)}),E.sort(),E.each(function(X){e.add(new x.EdgeGroup(h.toList(function(W){return X===W.s("edge.group")}),e))}),e.each(function(n){n.each(function(m){m._22I(n)})})}},sl=function(g,G,M){var x=g._canvas;g._zoom;var v=Hk(G,x),l=Hk(M,x);return{x:v.x-l.x,y:v.y-l.y}},om=function(k,C){if(C){var Z=C.rect,R=C.color,j=C.rotation,K=C.labelWidth,A=C.background,J=C.opacity,d=C.scale,W=d!=q&&1!==d;if(J!=q){var w=k.globalAlpha;k.globalAlpha*=J}if(j||W){k.save();var G=Z.x+Z.width/2,Q=Z.y+Z.height/2;hi(k,G,Q),j&&Cm(k,j),W&&k.scale(d,d),hi(k,-G,-Q)}if(A&&Dh(k,Z.x,Z.y,Z.width,Z.height,A),K){var I=Z.width,$=k.createLinearGradient(Z.x,Z.y,Z.x+I,Z.y);$.addColorStop(0,R),$.addColorStop(.9,R),$.addColorStop(1,Yb),R=$,Z.width=K}Yk(k,C.ss,Z,C.font,R,C.align,C.decoration),K&&(Z.width=I),(j||W)&&k.restore(),J!=q&&(k.globalAlpha=w)}},_i=function(G,s){if(s){var A=s.rect,X=A.x,x=A.y,l=A.width,F=A.height,f=s.background,N=s.backgroundImage,j=s.borderWidth,O=s.borderColor,_=s.labelWidth,D=s.opacity,z=s.scale,K=z!=q&&1!==z;if(D!=q){var h=G.globalAlpha;G.globalAlpha*=D}if(K){G.save();var w=A.x+A.width/2,g=A.y+A.height/2;hi(G,w,g),G.scale(z,z),hi(G,-w,-g)}if(s.expanded){var V=e(8,l/4),u=x+F-8;if(G.fillStyle=f,G.beginPath(),G.moveTo(X,x),G.lineTo(X,u),G.lineTo(X+l/2,u),G.lineTo(X+l/2,x+F),G.lineTo(X+l/2+V,u),G.lineTo(X+l,u),G.lineTo(X+l,x),G.closePath(),G.fill(),j&&(G.lineWidth=j,G.lineJoin="round",G.lineCap="round",O?(G.strokeStyle=O,G.stroke()):(G.strokeStyle=yp(f),G.beginPath(),G.moveTo(X+l,x),G.lineTo(X+l,u),G.lineTo(X+l/2+V,u),G.lineTo(X+l/2,x+F),G.stroke(),G.strokeStyle=hq(f),G.beginPath(),G.moveTo(X+l,x),G.lineTo(X,x),G.lineTo(X,u),G.lineTo(X+l/2,u),G.lineTo(X+l/2,x+F),G.stroke())),N)jl(G,yd(N),Ng,A.x,A.y,A.width,A.height-8,s.data,s.view);else{if(A.height-=8,f=s.color,_){var o=l,n=G.createLinearGradient(X,x,X+o,x);n.addColorStop(0,f),n.addColorStop(.9,f),n.addColorStop(1,Yb),f=n,A.width=_}Yk(G,s.ss,A,s.font,f,s.align),_&&(A.width=o),A.height+=8}}else if(s.icon)xb(G,yd(s.icon),X,x,l,F,s.data,s.view);else{var H=l/2;j&&(G.lineWidth=j,G.lineJoin="round",G.lineCap="round",G.strokeStyle=O?O:yp(f),G.beginPath(),G.arc(X+H,x+H,H,Ek,1.6*Y,!0),G.moveTo(X+H,x+F),G.lineTo(X+l-H/5,x+H),G.stroke(),G.strokeStyle=O?O:hq(f),G.beginPath(),G.arc(X+H,x+H,H,1.6*Y,Ek,!0),G.moveTo(X+H,x+F),G.lineTo(X+H/5,x+H),G.stroke()),G.fillStyle=f,G.beginPath(),G.arc(X+H,x+H,H,0,c,!0),G.moveTo(X+H,x+F),G.lineTo(X+l-H/5,x+H),G.lineTo(X+H/5,x+H),G.closePath(),G.fill(),G.fillStyle=s.color,G.beginPath(),G.arc(X+H,x+H,H/3,0,c,!0),G.fill()}K&&G.restore(),D!=q&&(G.globalAlpha=h)}},Oc=function(E,F){return F>2*E?E:F/2},rm=function(x,J,$,p){if(!x||!J)return 0;var v=Cl(J.y-x.y,J.x-x.x);return $||(v=J.x<x.x?v+Y:v),v+p},Yj=function(h,B,Q,C,O,q,f){f&&(h.x>B.x||h.x===B.x&&h.y>B.y)&&(Q=hk[Q],O=-O);var r=oo(Q,{x:0,y:0,width:Hh(h,B),height:0},q);return r.x+=C,r.y+=O,r=new rd(Cl(B.y-h.y,B.x-h.x)).tf(r),r.x+=h.x,r.y+=h.y,r},Rg=function(O,q,K,j,h){if(O._19Q=!0,!K.getEdgeGroup())return j?K.s("edge.gap"):0;if(dq(K.getSourceAgent())||dq(K.getTargetAgent()))return 0;var g,v=0,N=0,s=0;if(K.getEdgeGroup().getSiblings().each(function(y){y.each(function(i){if(q.isVisible(i)&&i.s(Oi)==h){var S=i.s("edge.gap");g?(N+=s/2+S/2,s=S):(g=i,s=S),i===K&&(v=N)}})}),j)return N-v+s;var p=v-N/2;return g&&K._40I!==g._40I&&(O._19Q=!1),p},mn=function(B){var F=B._getValidSelection();if(1===F.length){var H=F[0],v=H instanceof x.Edge;if(H instanceof x.Shape||v){if(v){var Y=H.s("edge.type");if(Y&&"points"!==Y)return}var c=B.gv;if((!c.isPointEditable||c.isPointEditable(H))&&c.isEditable(H))return H}}},Pf=function(){var Y=function(J){var x=[];return J.forEach(function(C){x.push({x:C.x,y:C.y}),x.push({x:C.x+C.width,y:C.y+C.height}),x.push({x:C.x+C.width,y:C.y}),x.push({x:C.x,y:C.y+C.height})}),x};return function(l,F,k){if("oval"===l){var D=0,C=k.height/k.width,S=C*C,q=k.x+k.width/2,v=k.y+k.height/2,U=Y(F);U.forEach(function(M){var e=M.x-q,G=M.y-v,A=e*e+G*G/S;A>D&&(D=A)}),D=h(D);var s=C*D;return{x:q-D,y:v-s,width:2*D,height:2*s}}if("circle"===l){var T=0,q=k.x+k.width/2,v=k.y+k.height/2,U=Y(F);return U.forEach(function(j){var h=j.x-q,u=j.y-v,l=h*h+u*u;l>T&&(T=l)}),T=h(T),{x:q-T,y:v-T,width:2*T,height:2*T}}return"roundRect"===l?(Ti(k,e(k.width,k.height)/16),k):k}}(),Tq=x.graph={},cl=function(S,g,x){uj(H+".graph."+S,g,x)};x.layout={};var Eg={},Pg=function(n,P,K,C,A,w,L,f){var S=L._zoom;if(!S)return P;if(S!==L._cacheZoom&&(L._cacheZoom=S,L._cacheImage={}),S*=Jh,C=Math.ceil(C),A=Math.ceil(A),C*S>2048||A*S>2048)return P;var Y=[P.uuid,C,A,K].join("_");if(w instanceof x.Data){var B=P.dataBindings;if(B)for(var R=B.length-1;R>=0;R--){var U=w.a(B[R].attr);fg(U)||bj(U)||(Y+="_"+U)}}if(P.cacheRule){var r;r=hc(P.cacheRule)?P.cacheRule(w,L):gl(P.cacheRule,w,L),Y+="_"+r}var Z,T=1;A>=C&&T>C*S?(Z=A/C,C=T/S,A=C*Z):C>=A&&T>A*S&&(Z=C/A,A=T/S,C=A*Z),C=Math.ceil(C),A=Math.ceil(A);var F=L._cacheImage[Y];if(!F){if(qs(),F=x.Default.toCanvas(P,C,A,K,w,L,f,S),!Ap())return P;L._cacheImage[Y]=F}return F};zb(M,{setImageCacheRule:function(Q,s){var q;s||"object"!=typeof Q?(q={},q[Q]=s):q=Q;for(var o in q){var _=q[o];ro(o)?(uj=yd(o),uj?uj.cacheRule=_:Eg[o]=_):o.cacheRule=_}}});var An={comps:[{type:Xi,points:[85,50,70,115,100,71,86,107,88,49,57,48,80,114,86,97,98,57,66,102,107,112,111,57,72,65,85,80,116,67,67,103,85,68,105,101,85,103,85,102,66,118,99,61],borderWidth:1,borderColor:q}]};if(An[xj]=An[ii]=160,W.Image){var sj=new W.Image;sj.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",Ef("default_blank",sj)}Ef("node_image",sn(30,30,[{type:jk,rect:[4,5,22,16],gradient:Dl,gradientColor:bm,background:pb},{type:jk,rect:[2,3,26,20],borderWidth:1,borderColor:pb},{type:jk,rect:[11,23,8,4],background:pb},{type:jk,rect:[6,27,18,2],background:pb}])),Ef("node_icon",sn(16,16,[{type:jk,rect:[2,2,12,10],gradient:Dl,gradientColor:bm,background:pb},{type:Ki,rect:[2,2,12,10],width:1,color:pb},{type:jk,rect:[6,12,4,2],background:pb},{type:jk,rect:[4,14,8,1],background:pb}])),Ef("block_icon",sn(16,16,[{type:Ki,rect:[1,1,14,14],width:1,color:pb}])),Ef("group_image",sn(66,39,[{type:jk,rect:[44.3,18,18.1,12.8],gradient:Dl,gradientColor:bm,background:pb},{type:jk,rect:[3.3,17.8,18.1,12.8],gradient:Dl,gradientColor:bm,background:pb},{type:jk,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:pb,gradient:Dl,gradientColor:bm,background:pb},{type:jk,rect:[26.2,29.4,12.8,4.2],background:pb},{type:jk,rect:[21.3,33.5,22.5,2.3],background:pb},{type:jk,rect:[5.3,32.7,14.1,2.1],background:pb},{type:jk,rect:[9,30.4,6.7,2.4],background:pb},{type:jk,rect:[50,30.7,6.7,2.4],background:pb},{type:jk,rect:[46.3,33,14.1,2.1],background:pb}])),Ef("group_icon",sn(16,16,[{type:jk,rect:[4,12,4,2],background:pb},{type:jk,rect:[2,13,8,1],background:pb},{type:jk,rect:[12,12,2,1],background:pb},{type:jk,rect:[11,13,4,1],background:pb},{type:jk,rect:[10,7,6,5],gradient:Dl,gradientColor:bm,background:pb},{type:jk,rect:[1,2,10,10],gradient:Dl,gradientColor:bm,background:pb},{type:Ki,rect:[1,2,10,10],width:1,color:pb}])),Ef("refGraph_icon",sn(16,16,[{type:"shape",borderWidth:1,borderColor:pb,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:pb,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),Ef("edge_icon",sn(16,16,[{type:jk,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:Dl,gradientColor:bm,background:pb},{type:jk,rect:[10.8,1,4,4],background:pb},{type:jk,rect:[1,11,4,4],background:pb}])),Ef("subGraph_image",sn(72,45,[{type:Xi,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:Dl,gradientColor:bm,background:pb},{type:jk,rect:[29.6,30.7,3.6,1.8],background:pb},{type:jk,rect:[28.4,32.3,6,1.2],background:pb},{type:jk,rect:[37.3,32,10.8,1.8],background:pb},{type:jk,rect:[39.1,29.9,7.2,2.3],background:pb},{type:jk,rect:[26.6,23.7,9.6,7.2],gradient:Dl,gradientColor:bm,background:pb},{type:jk,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:pb,gradient:Dl,gradientColor:bm,background:pb}])),Ef("subGraph_icon",sn(17,17,[{type:Xi,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:Dl,gradientColor:bm,background:pb}])),Ef("shape_icon",sn(16,16,[{type:Xi,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:pb}])),Ef("polyline_icon",sn(16,16,[{type:Xi,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:pb},Qb(7.5,.4),Qb(7.5,6.3),Qb(13.6,6.3),Qb(13.6,14),Qb(.7,13.9),Qb(.7,.3)])),Ef("grid_icon",sn(16,16,[{type:jk,rect:[1,1,4,4],background:pb,gradient:Dl,gradientColor:bm},{type:jk,rect:[6,1,4,4],background:pb,gradient:Dl,gradientColor:bm},{type:jk,rect:[11,1,4,4],background:pb,gradient:Dl,gradientColor:bm},{type:jk,rect:[11,6,4,4],background:pb,gradient:Dl,gradientColor:bm},{type:jk,rect:[6,6,4,4],background:pb,gradient:Dl,gradientColor:bm},{type:jk,rect:[1,6,4,4],background:pb,gradient:Dl,gradientColor:bm},{type:jk,rect:[11,11,4,4],background:pb,gradient:Dl,gradientColor:bm},{type:jk,rect:[6,11,4,4],background:pb,gradient:Dl,gradientColor:bm},{type:jk,rect:[1,11,4,4],background:pb,gradient:Dl,gradientColor:bm}])),Ef("light_icon",sn(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:pb},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:pb,gradient:Dl,gradientColor:bm,background:{func:function(g){var W=g?g.s(pp):q;return bj(W)?"rgb("+hd(255*W[0])+","+hd(255*W[1])+","+hd(255*W[2])+")":W||pb}}}])),Ef("text_icon",sn(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:pb}])),Ef("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),Ef("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),Ef("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),Ef("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var zi=function(u,f,e,a,U,K){var t,$,g,x,S,h,k,c,E,H,D,P=[];if(Math.abs(a)>2*Math.PI&&(a=2*Math.PI),S=Math.ceil(Math.abs(a)/(Math.PI/4)),t=a/S,$=-t,g=-e,S>0){h=u+Math.cos(e)*U,k=f+Math.sin(-e)*K,P.push({x:h,y:k});for(var A=0;S>A;A++)g+=$,x=g-$/2,c=u+Math.cos(g)*U,E=f+Math.sin(g)*K,H=u+Math.cos(x)*(U/Math.cos($/2)),D=f+Math.sin(x)*(K/Math.cos($/2)),P.push({x:H,y:D}),P.push({x:c,y:E})}return P},Lf=function(V){if(V){var r=V._data;if(r instanceof x.Shape)return{points:r.getPoints(),segments:r.getSegments()};var H;if(r instanceof x.Edge&&(H=V._78o)){var m,L,G=H.type,U=H.points,s=H.segments,J=H.edgeTypeInfo;if(!G||U){var z=H.sourcePoint,Y=z.x,d=z.y,M=H.targetPoint,R=M.x,B=M.y;if(G)s?(m=new lo({x:Y,y:d}),m.addAll(U),m.add({x:R,y:B}),L=new lo(s._as)):(m=new lo({x:Y,y:d}),U.each(function(b){m.add(b)}),m.add({x:R,y:B}));else if(H.looped){m=new lo(zi(Y,d,0,2*Math.PI,H.radius,H.radius)),L=new lo([1]);for(var N=0;N<(m.size()-1)/2;N++)L.add(3)}else m=new lo,H.center?(m.add({x:H.c1.x,y:H.c1.y}),m.add({x:Y,y:d}),m.add({x:R,y:B}),m.add({x:H.c2.x,y:H.c2.y})):(m.add({x:Y,y:d}),m.add({x:R,y:B}))}else J&&(m=new lo(J.points._as),J.segments&&(L=new lo(J.segments._as)));return{points:m,segments:L}}}},jm=function(e,O,T){if(null==O){var s=Lf(e);if(!s)return;O=s.points,T=s.segments}if(O){if(Array.isArray(O)&&(O=new lo(O)),"number"==typeof O.get(0)){for(var o=new x.List,j=0;j<O.size();j+=2)o.add({x:O.get(j),y:O.get(j+1)});O=o}if(!T){T=[1];for(var v=O.length-1;v>0;v--)T.push(2)}Array.isArray(T)&&(T=new lo(T));for(var E=gi(O._as,T._as,50),B=E.length,I=[],j=0;B>j;j++){var w=E[j];w.length>1&&I.push(w)}return I}},so=function(R){for(var s=0,y=R.length-1,k=0;y>k;k++){var N=R[k],u=R[k+1],W=u.x-N.x,h=u.y-N.y;s+=Math.sqrt(W*W+h*h)}return s},lq=function(R,A){for(var n=0,k=A.length,B=0;k>B;B++){var V=A[B];if(n+=V,n>R)return B}return Math.min(B,k-1)},Km=function(A,T){for(var X=0,W=0,V=0,Z=A.length-1,Q=0;Z>Q;Q++){var t=A[Q],E=A[Q+1],o=E.x-t.x,n=E.y-t.y;if(V=Math.sqrt(o*o+n*n),X+=V,X>T){X-=V,W=Q;break}}var P=A[W],D=A[W+1],U=Math.atan2(D.y-P.y,D.x-P.x),O=T-X,n=Math.sin(U)*O,o=Math.cos(U)*O;return{x:P.x+o,y:P.y+n}},Fp=function(w,z){if(w){var Z;if(0===z)Z=w[0][0];else if(100===z)w=w[w.length-1],Z=w[w.length-1];else{for(var c=0,T=[],g=w.length,R=0;g>R;R++){var j=w[R],Y=so(j);c+=Y,T.push(Y)}for(var m=c*z/100,J=lq(m,T),K=0,V=0;J>V;V++)K+=T[V];m-=K,Z=Km(w[J],m)}return Z}},Hm=function(i){var u,F;if(i instanceof fd){var G=Lf(i);u=G.points,F=G.segments}else u=arguments[0],F=arguments[1];var Z,n,j,v,X=[],R=-1;for(n=0,j=F?F.length:u.length;j>n;n++){if(Z=F?F.get(n):1,3===Z)v=2;else if(4===Z)v=3;else{if(5===Z)continue;v=1}R+=v,X.push(u.get(R))}return X},ff=function(m,u,Y,o){function S(U){if(U>=0&&1>=U){p=u(U);var i=(m.x-p.x)*(m.x-p.x)+(m.y-p.y)*(m.y-p.y);return w>i?(w=i,a=U,!0):!1}}Y=Y||100,o=o||1e-5;for(var w=1/0,a=0,p=new sd,$=0;Y>$;++$)S($/Y);for(var E=1/(2*Y);E>o;)S(a-E)||S(a+E)||(E/=2);return a};zb(M,{_edgeProtectMethod:{getStraightLinePoints:jm,calculateLineLength:so,calcSegmentIndexByDistance:lq,calculatePointAlongLine:Km,getPercentPosition:Fp,getRealPointsFromDataUI:Hm}});var fc=function(U,$){for(var X=U.vertices,n=0;n<X.length;n++){var P=X[n],G=P.y;P.y=P.z,P.z=-G,$&&(P.y+=$)
}},bs=function(h){for(var w,e,T,Y,Z,X,u=[],S=[],U=[],H=h.faces,l=0,r=0,i=0,E=H.length;E>l;l++,r+=6,i+=9){var z=H[l];1===z.i?(w||(w=[],e=[],T=[]),fr(z,l,r,i,h,w,T,e)):2===z.i?(Y||(Y=[],Z=[],X=[]),fr(z,l,r,i,h,Y,X,Z)):fr(z,l,r,i,h,u,U,S)}return{vs:u,uv:S,ns:U,top_vs:w,top_uv:e,top_ns:T,bottom_vs:Y,bottom_uv:Z,bottom_ns:X}},fr=function(Y,G,O,z,l,h,v,H){var b=l.vertices,f=l.faceVertexUvs,A=b[Y.a],U=b[Y.b],p=b[Y.c];h.push(A.x,A.y,A.z,U.x,U.y,U.z,p.x,p.y,p.z);var q,E,t,j=Y.vertexNormals;3===j.length?(q=j[0],E=j[1],t=j[2]):q=E=t=Y.normal,v.push(q.x,q.y,q.z,E.x,E.y,E.z,t.x,t.y,t.z);var C=f[0][G][0],i=f[0][G][1],n=f[0][G][2];H.push(C.x,C.y,i.x,i.y,n.x,n.y)},kb=function(i){var D;D=bj(i)?i:[i];var c,s,d,G,y,V,Z,L,q=1/0,N=1/0,n=1/0,x=-1/0,u=-1/0,C=-1/0,R=["vs","top_vs","bottom_vs"];for(c=0,s=D.length;s>c;c++)for(L=D[c],d=0,G=R.length;G>d;d++)if(Z=L[R[d]])for(y=0,V=Z.length;V>y;y+=3)q=e(q,Z[y]),N=e(N,Z[y+1]),n=e(n,Z[y+2]),x=E(x,Z[y]),u=E(u,Z[y+1]),C=E(C,Z[y+2]);var Y={min:{x:q,y:N,z:n},max:{x:x,y:u,z:C}};return i.boundingBox=Y,Y},Dm=function(){function Z(q,j){return q.dot(j)>0}function m(m,C,B,k,v,p,G){for(var o,q,X=[C,B,k],M=[v,p,G],H=[],L=X.length,F=!0;L--&&F;){for(var S=X[L],z=M.length,f=!1;z--;)if(S.equals(M[z])){M.splice(z,1),H.push(S),f=!0;break}if(!f){if(o){F=!1;break}o=S}}return F&&2===H.length&&(q=M[0],$.subVectors(o,H[0]),T.subVectors(q,H[0]),t.subVectors(o,H[1]),$.x*t.y*T.z+t.x*T.y*$.z+T.x*$.y*t.z-T.x*t.y*$.z-T.y*t.z*$.x-T.z*t.x*$.y<1e-6&&(W.subVectors(q,H[1]),a.subVectors(H[1],H[0]),Z(a,$)&&Z(a,T)&&(a.negate(),Z(a,t)&&Z(a,W))))?(m.push(H[1].x,H[1].y,H[1].z),m.push(o.x,o.y,o.z),m.push(o.x,o.y,o.z),m.push(H[0].x,H[0].y,H[0].z),m.push(H[0].x,H[0].y,H[0].z),m.push(q.x,q.y,q.z),m.push(q.x,q.y,q.z),m.push(H[1].x,H[1].y,H[1].z),2):(m.push(C.x,C.y,C.z),m.push(B.x,B.y,B.z),m.push(B.x,B.y,B.z),m.push(k.x,k.y,k.z),m.push(k.x,k.y,k.z),m.push(C.x,C.y,C.z),1)}function X(){this._vertexMap={},this._lineMap={},this._lineList=[]}function o(t,O,c,C,S,d,u){var Y=[c,S];t[0]===C&&Y.reverse();var _=[Y[0]._key,Y[1]._key].join("|"),r=t._triangles[_];r||(t._triangles[_]=r={});var z=[d._key,u._key].join("|");r[z]||(r[z]=[d,u])}function x(L,W,S){var v=L._planes[S._key];if(!v)for(var d in L._planes){var Y=L._planes[d];if(Y._normal.angleTo(S)<.001){v=Y;break}}return v?(v._vertices.indexOf(W)<0&&v._vertices.push(W),void 0):(L._planes[S._key]={_normal:S,_vertices:[W]},void 0)}function j(f,M){return 0===M?"0|0|0":1/0===Math.abs(M)?[f.x,f.y,f.z].join("|"):[Math.round(y.angleTo(f)*M),Math.round(w.angleTo(f)*M),Math.round(k.angleTo(f)*M)].join("|")}function E(R,h){var E=R._ctlineModel;if(E||(R._ctlineModel=E=[]),E[0])return E[0];var n;n=bj(R)?R:[R];var M,x,v,U,S,$,D,z,P,Z,C,A,G,I,t,c,e,J,V,Y=["","top_","bottom_"];E=[];var p=[];for(of(n,h,p),M=0,x=p.length;x>M;M++)if(Z=p[M])for(Mk(Z),v=0,U=Y.length;U>v;v++)if(P=Z[Y[v]+"lvs"])for(e=E.length,J=P.length,E.length=e+J,V=0;J>V;++V,++e)E[e]=P[V];else if(D=Z[Y[v]+"vs"]){z=Z[Y[v]+"is"],$=z?z.length:D.length/3;for(var S=0;$-1>S;)z?(C=z[S],A=z[S+1],G=z[S+2],I=z[S+3],t=z[S+4],c=z[S+5]):(C=S,A=S+1,G=S+2,I=S+3,t=S+4,c=S+5),q.fromArray(D,3*C),b.fromArray(D,3*A),N.fromArray(D,3*G),d.fromArray(D,3*I),F.fromArray(D,3*t),s.fromArray(D,3*c),S+=3*m(E,q,b,N,d,F,s);$>S&&(z?(C=z[S],A=z[S+1],G=z[S+2]):(C=S,A=S+1,G=S+2),q.fromArray(D,3*C),b.fromArray(D,3*A),N.fromArray(D,3*G),E.push(q.x,q.y,q.z),E.push(b.x,b.y,b.z),E.push(b.x,b.y,b.z),E.push(N.x,N.y,N.z),E.push(N.x,N.y,N.z),E.push(q.x,q.y,q.z))}return R._ctlineModel[0]=E,E}function v(d,M,J){var l=d._ctlineModel;l||(d._ctlineModel=l=[]);var P=l[1];if(P&&P.epsilon===J)return P;P=[],P.epsilon=J;var Q;Q=bj(d)?d:[d];var N,p,k,m,F,u,j,B,L,t,g,q,o=["","top_","bottom_"],H=new X,S=[];for(of(Q,M,S),N=0,p=S.length;p>N;N++)if(L=S[N])for(Mk(L),k=0,m=o.length;m>k;k++)if(j=L[o[k]+"vs"]){B=L[o[k]+"is"],u=B?B.length:j.length/3;for(var F=0,F=0;u>F;F+=3)B?(t=B[F],g=B[F+1],q=B[F+2]):(t=F,g=F+1,q=F+2),H._addTriangle(j,A,t,g,q,J)}return H._toLineVS(P),d._ctlineModel[1]=P,P}function i(k,Z,h){var N=k._ctlineModel;N||(k._ctlineModel=N=[]);var z=N[2];if(z&&z.epsilon===h)return z;z=[],z.epsilon=h;var $;$=bj(k)?k:[k];var S,T,A,q,W,e,R,y,E,c,d,C,H,u=["","top_","bottom_"],x=new X,t=[];for(of($,Z,t),S=0,T=t.length;T>S;S++)if(c=t[S])for(Mk(c),A=0,q=u.length;q>A;A++)if(R=c[u[A]+"vs"]){y=c[u[A]+"is"],E=c[u[A]+"ns"],e=y?y.length:R.length/3;for(var W=0,W=0;e>W;W+=3)y?(d=y[W],C=y[W+1],H=y[W+2]):(d=W,C=W+1,H=W+2),x._addTriangle(R,E,d,C,H,h)}return x._toLineVS(z),k._ctlineModel[2]=z,z}var q=new ah,b=new ah,N=new ah,d=new ah,F=new ah,s=new ah,$=new ah,t=new ah,T=new ah,W=new ah,a=new ah,H=new ah;X.prototype._findVertex=function(V,s){H.fromArray(V,3*s);var D=[H.x,H.y,H.z].join(","),S=this._vertexMap[D];if(!S){var r=H.clone();r._key=D,this._vertexMap[D]=S=r}return S},X.prototype._findLine=function(H,l){var G=[H,l];H._key>l._key&&G.reverse(),G._key=[G[0]._key,G[1]._key].join("|");var X=this._lineMap[G._key];return X||(this._lineMap[G._key]=X=G,G._triangles={},G._planes={},this._lineList.push(G)),X};var y=new ah(1,0,0),w=new ah(0,1,0),k=new ah(0,0,1),_=new ah,g=new ah;return X.prototype._addTriangle=function(m,Q,E,b,S,h){var v,f,F,y=this._findVertex(m,E),l=this._findVertex(m,b),e=this._findVertex(m,S),G=this._findLine(y,l),d=this._findLine(l,e),Y=this._findLine(e,y);Q?(v=(new ah).fromArray(Q,3*E),v._key=j(v,h),f=(new ah).fromArray(Q,3*b),f._key=j(f,h),F=(new ah).fromArray(Q,3*S),F._key=j(F,h),o(G,y,v,l,f,e,F),o(d,l,f,e,F,y,v),o(Y,e,F,y,v,l,f)):(g.subVectors(e,l),_.subVectors(l,y),v=(new ah).crossVectors(_,g),v._key=j(v,h),x(G,e,v),x(d,y,v),x(Y,l,v))},X.prototype._toLineVS=function(Q){for(var w=this._lineList,O=0,b=w.length;b>O;++O){var e=w[O],P=!1;for(var M in e._triangles)if(1==u.keys(e._triangles[M]).length){Q.push(e[0].x,e[0].y,e[0].z,e[1].x,e[1].y,e[1].z),P=!0;break}if(!P)for(var h in e._planes)if(1==e._planes[h]._vertices.length){Q.push(e[0].x,e[0].y,e[0].z,e[1].x,e[1].y,e[1].z),P=!0;break}}},[E,v,i]}(),Fo=function(J,Q){var N=J._lineModel;if(N)return N;var k;k=bj(J)?J:[J];var S,w,m,g,u,Z,s,R,q,e,d,i,v=["","top_","bottom_"];N=[];var y=[];for(of(J,Q,y),S=0,w=y.length;w>S;S++)if(q=y[S])for(m=0,g=v.length;g>m;m++)if(s=q[v[m]+"vs"]){R=q[v[m]+"is"],Z=R?R.length:s.length/3;for(var u=0;Z>u;u+=3)R?(e=R[u],d=R[u+1],i=R[u+2]):(e=u,d=u+1,i=u+2),e*=3,d*=3,i*=3,N.push(s[e],s[e+1],s[e+2],s[d],s[d+1],s[d+2],s[d],s[d+1],s[d+2],s[i],s[i+1],s[i+2],s[i],s[i+1],s[i+2],s[e],s[e+1],s[e+2])}return J._lineModel=N,N},Dn=function(Q,l,k,H,h,z,f,C,o,j){k==q&&(k=!0),H==q&&(H=!0),f==q&&(f=1),C==q&&(C=0);var B=new id;Bg(B,Q,l,o),B=B.toShapes();var g=A;return j&&(j.length?g={minX:j[0],minY:-j[3],maxX:j[2],maxY:-j[1]}:(g={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},B.forEach(function(X){var W=X.getBoundingBox();g.minX=e(W.minX,g.minX),g.minY=e(W.minY,g.minY),g.maxX=E(W.maxX,g.maxX),g.maxY=E(W.maxY,g.maxY)}))),bs(new gj(B,{top:k,bottom:H,curveSegments:h,amount:f,repeatUVLength:z,boundingBox:g},-f/2+C))},Ne=function(Y,q){this.repeatUVLength=Y,this._bb=q};Ne.prototype={generateTopUV:function(q,B,p,K,V,N,Z){var u,R,x,b,f=q.vertices,I=f[K].x,j=f[K].y,h=f[V].x,r=f[V].y,F=f[N].x,D=f[N].y,E=this.repeatUVLength;if(E)u=0,R=0,x=E,b=E;else{this._bb||(this._bb=B.getBoundingBox());var Q=this._bb;u=Q.minX,R=Q.minY,x=Q.maxX-u,b=Q.maxY-R}return Z?[new Nj((I-u)/x,(j-R)/b),new Nj((h-u)/x,(r-R)/b),new Nj((F-u)/x,(D-R)/b)]:[new Nj((I-u)/x,1-(j-R)/b),new Nj((h-u)/x,1-(r-R)/b),new Nj((F-u)/x,1-(D-R)/b)]},generateBottomUV:function(b,n,i,C,B,d){return this.generateTopUV(b,n,i,C,B,d,!0)},generateSideWallUV:function(K,H,Y,l,C,z,u,F,w,$,A,E){if(!this._cl){for(var p,D,g=[],P=0,O=Y.length,U=0;O>U;U++){p=Y[U],D=Y[(U+1)%O];var e=p.x-D.x,r=p.y-D.y,k=h(e*e+r*r);g.push(P),P+=k}for(var U=0;O>U;U++)g[U]/=P;this._cl=g}var g=this._cl,j=1-w/$,L=1-(w+1)/$,S=g[A],x=g[E];return x>S&&(S+=1),[new Nj(S,j),new Nj(x,j),new Nj(x,L),new Nj(S,L)]}};var po=function(R,s,f,c,g,N){this.a=R,this.b=s,this.c=f,this.i=N,this.normal=c instanceof Ko?c:new Ko,this.vertexNormals=c instanceof Array?c:[]};po.prototype={constructor:po};var Lj=[-8,14,0,7,-5,10,-1,6,-1],Uh=function(){if(Uh[$d]!=q)return Uh[$d];for(var o=ch[$d],k=Lj,g=Vp.prototype.getClassName(),O='"',p=0,u="",B=!1,U=+new(W[g.substr(3,3)+tf[p]]),R=p;R<k.length;R++){var x=k.length-R;u+=R%2===p?k[R]+x+"":k[R]-x+""}for(var R=p;4>R;R++)u+=p;if(u=u*u.length/u.length,U>u){if(o&&o[p]&&o[4/jk.length]){for(var K,r,L,h,w,z,n,c,t=o[0],F=o[1],M="",E=0,R=0;R<F.length;R++)F[R]===O?c?(c=!1,0!==E%2&&(K==q?K=M:r==q?r=M:L==q?L=M:h==q?h=M:w==q?w=M:z==q?z=M:n==q&&(n=M)),E++,M=""):c=!0:c&&(M+=F[R]);for(var H,D,j,Q="",d=0,R=0;R<t.length;R++)t[R]===O?H?(H=!1,0!==d%2&&(D==q?D=Q:j==q&&(j=Q)),d++,Q=""):H=!0:H&&(Q+=t[R]);var $=K+r+L+h+w+z,a=!z||z===kr||!kr&&z===Wp.toString()[0];if(!a&&z)for(var _,R=0,f=z.length;f>R;R++)z[R]===vc[4]?_===kr?a=vj:_[0]===Yh[7]&&kr&&kr.indexOf(_.substr(1))>=0?a=zn:_=q:(_==q?_=z[R]:_+=z[R],R===f-1&&(_===kr?a=vj:_[0]===Yh[7]&&kr&&kr.indexOf(_.substr(1))>=0&&(a=zn)));(B=Cq($,n)&&Cq(D,j)&&D===K&&a&&(!w||w>U))&&L.indexOf(af[0])>=0&&(Uh[af[0]]=1),B&&L.indexOf(1)>=0&&(Uh[1]=1),B&&L.indexOf(3)>=0&&(Uh[2]=1),B&&L.indexOf(4)>=0&&(Uh[3]=1),B&&L.indexOf(7)>=0&&(Uh[4]=1),B&&L.indexOf(Sl[1])>=0&&(Uh[Sl[1]]=1),B&&L.indexOf(th[0])>=0&&(Uh[th[0]]=1)}}else B=!0,Uh[af[0]]=Uh[1]=Uh[2]=Uh[3]=Uh[4]=Uh[Sl[1]]=Uh[th[0]]=1;return Uh[$d]=B,B},Gf=function(){},ul=Gf.prototype;ul.getPointAt=function(T){var I=this.getUtoTmapping(T);return this.getPoint(I)},ul.getPoints=function(R){R||(R=5);var c,t=[];for(c=0;R>=c;c++)t.push(this.getPoint(c/R));return t},ul.getSpacedPoints=function(C){C||(C=5);var N,u=[];for(N=0;C>=N;N++)u.push(this.getPointAt(N/C));return u},ul.getLength=function(){var _=this.getLengths();return _[_.length-1]},ul.getLengths=function(q){if(q||(q=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==q+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b,R,c=[],S=this.getPoint(0),D=0;for(c.push(0),R=1;q>=R;R++)b=this.getPoint(R/q),D+=b.distanceTo(S),c.push(D),S=b;return this.cacheArcLengths=c,c},ul.getUtoTmapping=function(k,e){var N,A=this.getLengths(),W=0,S=A.length;N=e?e:k*A[S-1];for(var F,t=0,o=S-1;o>=t;)if(W=L(t+(o-t)/2),F=A[W]-N,0>F)t=W+1;else{if(!(F>0)){o=W;break}o=W-1}if(W=o,A[W]==N){var B=W/(S-1);return B}var n=A[W],O=A[W+1],Q=O-n,z=(N-n)/Q,B=(W+z)/(S-1);return B},ul.getTangent=function(z){var Q=1e-4,w=z-Q,B=z+Q;0>w&&(w=0),B>1&&(B=1);var s=this.getPoint(w),y=this.getPoint(B),k=y.clone().sub(s);return k.normalize()},ul.getTangentAt=function(i){var t=this.getUtoTmapping(i);return this.getTangent(t)},Gf.create=function(J,W){return J.prototype=ri(Gf.prototype),J.prototype.getPoint=W,J};var Yn=function(){this.curves=[],this.autoClose=!1},Sq=Yn.prototype=ri(ul);Sq.add=function(P){this.curves.push(P)},Sq.closePath=function(){var F=this.curves[0].getPoint(0),O=this.curves[this.curves.length-1].getPoint(1);F.equals(O)||this.curves.push(new sk(O,F))},Sq.getPoint=function($){for(var A,n,H=$*this.getLength(),i=this.getCurveLengths(),O=0;O<i.length;){if(i[O]>=H){A=i[O]-H,n=this.curves[O];var E=1-A/n.getLength();return n.getPointAt(E)}O++}return null},Sq.getLength=function(){var Z=this.getCurveLengths();return Z[Z.length-1]},Sq.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var E,B=[],W=0,f=this.curves.length;for(E=0;f>E;E++)W+=this.curves[E].getLength(),B.push(W);return this.cacheLengths=B,B},Sq.getTransformedPoints=function(y){return this.getPoints(y)},Sq.getBoundingBox=function(){var z,A,j,i,T,B,u=this.getPoints();z=A=Number.NEGATIVE_INFINITY,i=T=Number.POSITIVE_INFINITY;var r,I,h,a,Y=u[0]instanceof Ko;for(a=Y?new Ko:new Nj,I=0,h=u.length;h>I;I++)r=u[I],r.x>z&&(z=r.x),r.x<i&&(i=r.x),r.y>A&&(A=r.y),r.y<T&&(T=r.y),Y&&(r.z>j&&(j=r.z),r.z<B&&(B=r.z)),a.add(r);var w={minX:i,minY:T,maxX:z,maxY:A};return Y&&(w.maxZ=j,w.minZ=B),w};var gf=function(S){Yn.call(this),this.actions=[],S&&this.fromPoints(S)},Nk=gf.prototype=ri(Yn.prototype),Jc="moveTo",_o="lineTo",Ho="quadraticCurveTo",oh="bezierCurveTo",ym="arc",Dc="ellipse";Nk.fromPoints=function(b){this.moveTo(b[0].x,b[0].y);for(var B=1,G=b.length;G>B;B++)this.lineTo(b[B].x,b[B].y)},Nk.moveTo=function(){var U=Array.prototype.slice.call(arguments);this.actions.push({action:Jc,args:U})},Nk.lineTo=function(l,Q){var q=Array.prototype.slice.call(arguments),j=this.actions[this.actions.length-1].args,c=j[j.length-2],z=j[j.length-1],D=new sk(new Nj(c,z),new Nj(l,Q));this.curves.push(D),this.actions.push({action:_o,args:q})},Nk.quadraticCurveTo=function(r,R,a,o){var x=Array.prototype.slice.call(arguments),W=this.actions[this.actions.length-1].args,X=W[W.length-2],g=W[W.length-1],n=new ms(new Nj(X,g),new Nj(r,R),new Nj(a,o));this.curves.push(n),this.actions.push({action:Ho,args:x})},Nk.bezierCurveTo=function(w,s,u,H,B,r){var Q=Array.prototype.slice.call(arguments),W=this.actions[this.actions.length-1].args,L=W[W.length-2],A=W[W.length-1],j=new ar(new Nj(L,A),new Nj(w,s),new Nj(u,H),new Nj(B,r));this.curves.push(j),this.actions.push({action:oh,args:Q})},Nk.arc=function(x,R,w,U,Z,p){var H=this.actions[this.actions.length-1].args,X=H[H.length-2],e=H[H.length-1];this.absarc(x+X,R+e,w,U,Z,p)},Nk.absarc=function(k,r,P,W,z,I){this.absellipse(k,r,P,P,W,z,I)},Nk.ellipse=function(M,f,K,j,z,p,u){var V=this.actions[this.actions.length-1].args,c=V[V.length-2],I=V[V.length-1];this.absellipse(M+c,f+I,K,j,z,p,u)},Nk.absellipse=function(f,N,F,P,h,T,i){var m=Array.prototype.slice.call(arguments),b=new Xf(f,N,F,P,h,T,i);this.curves.push(b);var R=b.getPoint(1);m.push(R.x),m.push(R.y),this.actions.push({action:Dc,args:m})},Nk.getSpacedPoints=function(k){k||(k=40);for(var S=[],O=0;k>O;O++)S.push(this.getPoint(O/k));return S},Nk.getPoints=function(P,Y){P=P||12;var p,G,H,f,J,R,w,C,q,B,L,v,b,k,j,K,E,m,$=[];for(p=0,G=this.actions.length;G>p;p++)switch(H=this.actions[p],f=H.action,J=H.args,f){case Jc:$.push(new Nj(J[0],J[1]));break;case _o:$.push(new Nj(J[0],J[1]));break;case Ho:for(R=J[2],w=J[3],B=J[0],L=J[1],$.length>0?(k=$[$.length-1],v=k.x,b=k.y):(k=this.actions[p-1].args,v=k[k.length-2],b=k[k.length-1]),j=1;P>=j;j++)K=j/P,E=pn.b2(K,v,B,R),m=pn.b2(K,b,L,w),$.push(new Nj(E,m));break;case oh:for(R=J[4],w=J[5],B=J[0],L=J[1],C=J[2],q=J[3],$.length>0?(k=$[$.length-1],v=k.x,b=k.y):(k=this.actions[p-1].args,v=k[k.length-2],b=k[k.length-1]),j=1;P>=j;j++)K=j/P,E=pn.b3(K,v,B,C,R),m=pn.b3(K,b,L,q,w),$.push(new Nj(E,m));break;case ym:var t,S=J[0],u=J[1],y=J[2],c=J[3],x=J[4],g=!!J[5],I=x-c,N=2*P;for(j=1;N>=j;j++)K=j/N,g||(K=1-K),t=c+K*I,E=S+y*O(t),m=u+y*o(t),$.push(new Nj(E,m));break;case Dc:var t,S=J[0],u=J[1],F=J[2],i=J[3],c=J[4],x=J[5],g=!!J[6],I=x-c,N=2*P;for(j=1;N>=j;j++)K=j/N,g||(K=1-K),t=c+K*I,E=S+F*O(t),m=u+i*o(t),$.push(new Nj(E,m))}var Q,d,X=T["shape3d.point.epsilon"],A=!1;for(G=$.length,p=0,G=$.length;G>p;p++)Q=$[p],d=p===G-1?$[0]:$[p+1],Q&&d&&D(Q.x-d.x)<X&&D(Q.y-d.y)<X&&(A=!0,$[p]=null);if(A){var s=[];for(p=0;G>p;p++)$[p]&&s.push($[p]);$=s}return Y&&$.push($[0]),$},Nk.toShapes=function(I,O){function K(s){var d,r,T,h,f,t=[],B=new gf;for(d=0,r=s.length;r>d;d++)T=s[d],f=T.args,h=T.action,h==Jc&&0!=B.actions.length&&(t.push(B),B=new gf),B[h].apply(B,f);return 0!=B.actions.length&&t.push(B),t}function E(D){for(var g=[],P=0,b=D.length;b>P;P++){var c=D[P],j=new id;j.actions=c.actions,j.curves=c.curves,g.push(j)}return g}function k(p,r){for(var c=1e-10,M=r.length,Z=!1,Y=M-1,N=0;M>N;Y=N++){var k=r[Y],G=r[N],g=G.x-k.x,x=G.y-k.y;if(D(x)>c){if(0>x&&(k=r[N],g=-g,G=r[Y],x=-x),p.y<k.y||p.y>G.y)continue;if(p.y==k.y){if(p.x==k.x)return!0}else{var d=x*(p.x-k.x)-g*(p.y-k.y);if(0==d)return!0;if(0>d)continue;Z=!Z}}else{if(p.y!=k.y)continue;if(G.x<=p.x&&p.x<=k.x||k.x<=p.x&&p.x<=G.x)return!0}}return Z}var s=K(this.actions);if(0==s.length)return[];if(O===!0)return E(s);var W,n,o,u=[];if(1==s.length)return n=s[0],o=new id,o.actions=n.actions,o.curves=n.curves,u.push(o),u;var U=!pn.isClockWise(s[0].getPoints());U=I?!U:U;var H,g=[],M=[],J=[],N=0;M[N]=A,J[N]=[];var y,j;for(y=0,j=s.length;j>y;y++)n=s[y],H=n.getPoints(),W=pn.isClockWise(H),W=I?!W:W,W?(!U&&M[N]&&N++,M[N]={s:new id,p:H},M[N].s.actions=n.actions,M[N].s.curves=n.curves,U&&N++,J[N]=[]):J[N].push({h:n,p:H[0]});if(!M[0])return E(s);if(M.length>1){for(var d=!1,G=[],C=0,a=M.length;a>C;C++)g[C]=[];for(var C=0,a=M.length;a>C;C++){M[C];for(var B=J[C],t=0;t<B.length;t++){for(var Y=B[t],x=!0,p=0;p<M.length;p++)k(Y.p,M[p].p)&&(C!=p&&G.push({froms:C,tos:p,hole:t}),x?(x=!1,g[p].push(Y)):d=!0);x&&g[C].push(Y)}}G.length>0&&(d||(J=g))}var X,z,i;for(y=0,j=M.length;j>y;y++)for(o=M[y].s,u.push(o),X=J[y],z=0,i=X.length;i>z;z++)o.holes.push(X[z].h);return u};var id=function(){gf.apply(this,arguments),this.holes=[]},Si=id.prototype=ri(Nk);Si.getPointsHoles=function(W){var U,s=this.holes.length,c=[];for(U=0;s>U;U++)c[U]=this.holes[U].getTransformedPoints(W);return c},Si.extractAllPoints=function(R){return{shape:this.getTransformedPoints(R),holes:this.getPointsHoles(R)}},Si.extractPoints=function(C){return this.extractAllPoints(C)};var pn={triangulateShape:function(I,J){function U(y,Z,w){return y.x!=Z.x?y.x<Z.x?y.x<=w.x&&w.x<=Z.x:Z.x<=w.x&&w.x<=y.x:y.y<Z.y?y.y<=w.y&&w.y<=Z.y:Z.y<=w.y&&w.y<=y.y}function _(t,A,u,_,y){var v=1e-10,c=A.x-t.x,L=A.y-t.y,z=_.x-u.x,K=_.y-u.y,J=t.x-u.x,h=t.y-u.y,V=L*z-c*K,E=L*J-c*h;if(D(V)>v){var W;if(V>0){if(0>E||E>V)return[];if(W=K*J-z*h,0>W||W>V)return[]}else{if(E>0||V>E)return[];if(W=K*J-z*h,W>0||V>W)return[]}if(0==W)return!y||0!=E&&E!=V?[t]:[];if(W==V)return!y||0!=E&&E!=V?[A]:[];if(0==E)return[u];if(E==V)return[_];var Z=W/V;return[{x:t.x+Z*c,y:t.y+Z*L}]}if(0!=E||K*J!=z*h)return[];var m=0==c&&0==L,R=0==z&&0==K;if(m&&R)return t.x!=u.x||t.y!=u.y?[]:[t];if(m)return U(u,_,t)?[t]:[];if(R)return U(t,A,u)?[u]:[];var O,r,g,x,o,X,e,d;return 0!=c?(t.x<A.x?(O=t,g=t.x,r=A,x=A.x):(O=A,g=A.x,r=t,x=t.x),u.x<_.x?(o=u,e=u.x,X=_,d=_.x):(o=_,e=_.x,X=u,d=u.x)):(t.y<A.y?(O=t,g=t.y,r=A,x=A.y):(O=A,g=A.y,r=t,x=t.y),u.y<_.y?(o=u,e=u.y,X=_,d=_.y):(o=_,e=_.y,X=u,d=u.y)),e>=g?e>x?[]:x==e?y?[]:[o]:d>=x?[o,r]:[o,X]:g>d?[]:g==d?y?[]:[O]:d>=x?[O,r]:[O,X]}function t(V,k,E,e){var i=1e-10,F=k.x-V.x,L=k.y-V.y,W=E.x-V.x,h=E.y-V.y,J=e.x-V.x,w=e.y-V.y,v=F*h-L*W,N=F*w-L*J;if(D(v)>i){var j=J*h-w*W;return v>0?N>=0&&j>=0:N>=0||j>=0}return N>0}function V(o,c){function W(i,Q){var G=N.length-1,C=i-1;0>C&&(C=G);var _=i+1;_>G&&(_=0);var B=t(N[i],N[C],N[_],w[Q]);if(!B)return!1;var y=w.length-1,X=Q-1;0>X&&(X=y);var E=Q+1;return E>y&&(E=0),B=t(w[Q],w[X],w[E],N[i]),B?!0:!1}function r(X,R){var h,j,U;for(h=0;h<N.length;h++)if(j=h+1,j%=N.length,U=_(X,R,N[h],N[j],!0),U.length>0)return!0;return!1}function G(O,z){var K,Q,$,S,u;for(K=0;K<Z.length;K++)for(Q=c[Z[K]],$=0;$<Q.length;$++)if(S=$+1,S%=Q.length,u=_(O,z,Q[$],Q[S],!0),u.length>0)return!0;return!1}for(var w,q,I,O,l,d,i,T,k,D,h,N=o.concat(),Z=[],y=[],M=0,n=c.length;n>M;M++)Z.push(M);for(var e=0,J=2*Z.length;Z.length>0&&(J--,!(0>J));)for(I=e;I<N.length;I++){O=N[I],q=-1;for(var M=0;M<Z.length;M++)if(d=Z[M],i=O.x+":"+O.y+":"+d,y[i]===A){w=c[d];for(var C=0;C<w.length;C++)if(l=w[C],W(I,C)&&!r(O,l)&&!G(O,l)){q=C,Z.splice(M,1),T=N.slice(0,I+1),k=N.slice(I),D=w.slice(q),h=w.slice(0,q+1),N=T.concat(D).concat(h).concat(k),e=I;break}if(q>=0)break;y[i]=!0}if(q>=0)break}return N}for(var z,n,L,S,B,G,l={},j=I.concat(),p=0,F=J.length;F>p;p++)Array.prototype.push.apply(j,J[p]);for(z=0,n=j.length;n>z;z++)B=j[z].x+":"+j[z].y,l[B]!==A,l[B]=z;var f=V(I,J),Z=tj.Triangulate(f,!1);for(z=0,n=Z.length;n>z;z++)for(S=Z[z],L=0;3>L;L++)B=S[L].x+":"+S[L].y,G=l[B],G!==A&&(S[L]=G);return Z.concat()},isClockWise:function(N){return tj.Triangulate.area(N)<0},b2p0:function(Q,J){var x=1-Q;return x*x*J},b2p1:function(H,k){return 2*(1-H)*H*k},b2p2:function(E,q){return E*E*q},b2:function(W,_,L,J){return this.b2p0(W,_)+this.b2p1(W,L)+this.b2p2(W,J)},b3p0:function(g,R){var k=1-g;return k*k*k*R},b3p1:function(N,e){var X=1-N;return 3*X*X*N*e},b3p2:function(L,Q){var r=1-L;return 3*r*L*L*Q},b3p3:function(C,y){return C*C*C*y},b3:function(I,k,$,u,A){return this.b3p0(I,k)+this.b3p1(I,$)+this.b3p2(I,u)+this.b3p3(I,A)}},tj={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var J=u.keys(this.faces);return J.length?J[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(X){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var r=e.familyName.toLowerCase(),d=this;return d.faces[r]=d.faces[r]||{},d.faces[r][e.cssFontWeight]=d.faces[r][e.cssFontWeight]||{},d.faces[r][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(W){var N,J=this.getFace(),C=this.size/J.resolution,Y=0,m=String(W).split(""),b=m.length,V=[];for(N=0;b>N;N++){var o=new gf,g=this.extractGlyphPoints(m[N],J,C,Y,o);g&&(Y+=g.offset*this.spacing,V.push(g.path))}var q=Y/2;return{paths:V,offset:q}},extractGlyphPoints:function(d,u,t,A,n){var q,l,f,k,z,T,K,N,R,j,e,H,P,h,J,I,V,i,s,Y=[],C=u.glyphs[d]||u.glyphs["?"];if(C){if(C.o)for(k=C._cachedOutline||(C._cachedOutline=C.o.split(" ")),T=k.length,K=t,N=t,q=0;T>q;)switch(z=k[q++]){case"m":R=k[q++]*K+A,j=k[q++]*N,n.moveTo(R,j);break;case"l":R=k[q++]*K+A,j=k[q++]*N,n.lineTo(R,j);break;case"q":if(e=k[q++]*K+A,H=k[q++]*N,J=k[q++]*K+A,I=k[q++]*N,n.quadraticCurveTo(J,I,e,H),s=Y[Y.length-1])for(P=s.x,h=s.y,l=1,f=this.divisions;f>=l;l++){var r=l/f;pn.b2(r,P,J,e),pn.b2(r,h,I,H)}break;case"b":if(e=k[q++]*K+A,H=k[q++]*N,J=k[q++]*K+A,I=k[q++]*N,V=k[q++]*K+A,i=k[q++]*N,n.bezierCurveTo(J,I,V,i,e,H),s=Y[Y.length-1])for(P=s.x,h=s.y,l=1,f=this.divisions;f>=l;l++){var r=l/f;pn.b3(r,P,J,V,e),pn.b3(r,h,I,i,H)}}return{offset:C.ha*t,path:n}}}};tj.generateShapes=function(E,k){k=k||{};var v=k.font;if(v===A&&(v=tj.getDefaultFont(),!v))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var O=k.size!==A?k.size:1,g=k.curveSegments!==A?k.curveSegments:4,b=k.spacing!==A?k.spacing:1,e=k.weight!==A?k.weight:"normal",W=k.style!==A?k.style:"normal";tj.size=O,tj.divisions=g,tj.face=v,tj.weight=e,tj.style=W,tj.spacing=b;for(var P=tj.drawText(E),u=P.paths,x=[],o=0,L=u.length;L>o;o++)Array.prototype.push.apply(x,u[o].toShapes());return x},function(w){var L=1e-10,r=function(S,v){var B=S.length;if(3>B)return null;var t,s,q,j=[],o=[],K=[];if(Y(S)>0)for(s=0;B>s;s++)o[s]=s;else for(s=0;B>s;s++)o[s]=B-1-s;var R=B,m=2*R;for(s=R-1;R>2;){if(m--<=0)return v?K:j;if(t=s,t>=R&&(t=0),s=t+1,s>=R&&(s=0),q=s+1,q>=R&&(q=0),a(S,t,s,q,R,o)){var L,V,$,z,X;for(L=o[t],V=o[s],$=o[q],j.push([S[L],S[V],S[$]]),K.push([o[t],o[s],o[q]]),z=s,X=s+1;R>X;z++,X++)o[z]=o[X];R--,m=2*R}}return v?K:j},Y=function(k){for(var F=k.length,I=0,n=F-1,l=0;F>l;n=l++)I+=k[n].x*k[l].y-k[l].x*k[n].y;return.5*I},a=function(a,X,b,d,C,r){var e,c,l,v,M,E,D,m,_;if(c=a[r[X]].x,l=a[r[X]].y,v=a[r[b]].x,M=a[r[b]].y,E=a[r[d]].x,D=a[r[d]].y,L>(v-c)*(D-l)-(M-l)*(E-c))return!1;var P,J,n,H,k,j,z,G,U,Z,A,S,N,u,O;for(P=E-v,J=D-M,n=c-E,H=l-D,k=v-c,j=M-l,e=0;C>e;e++)if(m=a[r[e]].x,_=a[r[e]].y,!(m===c&&_===l||m===v&&_===M||m===E&&_===D)&&(z=m-c,G=_-l,U=m-v,Z=_-M,A=m-E,S=_-D,O=P*Z-J*U,N=k*G-j*z,u=n*S-H*A,O>=-L&&u>=-L&&N>=-L))return!1;return!0};return w.Triangulate=r,w.Triangulate.area=Y,w}(tj),W._typeface_js={faces:tj.faces,loadFace:tj.loadFace};var Vg=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},xo=Vg.prototype={constructor:Vg,computeFaceNormals:function(){for(var M=new Ko,S=new Ko,o=0,P=this.faces.length;P>o;o++){var W=this.faces[o],e=this.vertices[W.a],J=this.vertices[W.b],b=this.vertices[W.c];M.subVectors(b,J),S.subVectors(e,J),M.cross(S),M.normalize(),W.normal.copy(M)}},computeVertexNormals:function(P){var h,o,s,Q,z,j;for(j=new Array(this.vertices.length),h=0,o=this.vertices.length;o>h;h++)j[h]=new Ko;if(P){var C,e,D,n=new Ko,y=new Ko;for(s=0,Q=this.faces.length;Q>s;s++)z=this.faces[s],C=this.vertices[z.a],e=this.vertices[z.b],D=this.vertices[z.c],n.subVectors(D,e),y.subVectors(C,e),n.cross(y),j[z.a].add(n),j[z.b].add(n),j[z.c].add(n)}else for(s=0,Q=this.faces.length;Q>s;s++)z=this.faces[s],j[z.a].add(z.normal),j[z.b].add(z.normal),j[z.c].add(z.normal);for(h=0,o=this.vertices.length;o>h;h++)j[h].normalize();for(s=0,Q=this.faces.length;Q>s;s++)z=this.faces[s],z.vertexNormals[0]=j[z.a].clone(),z.vertexNormals[1]=j[z.b].clone(),z.vertexNormals[2]=j[z.c].clone()},mergeVertices:function(){var p,g,$,W,P,Y,V,C,O={},E=[],j=[],R=4,w=Q(10,R);for($=0,W=this.vertices.length;W>$;$++)p=this.vertices[$],g=N(p.x*w)+"_"+N(p.y*w)+"_"+N(p.z*w),O[g]===A?(O[g]=$,E.push(this.vertices[$]),j[$]=E.length-1):j[$]=j[O[g]];var v=[];for($=0,W=this.faces.length;W>$;$++){P=this.faces[$],P.a=j[P.a],P.b=j[P.b],P.c=j[P.c],Y=[P.a,P.b,P.c];for(var y=0;3>y;y++)if(Y[y]==Y[(y+1)%3]){v.push($);break}}for($=v.length-1;$>=0;$--){var I=v[$];for(this.faces.splice(I,1),V=0,C=this.faceVertexUvs.length;C>V;V++)this.faceVertexUvs[V].splice(I,1)}var m=this.vertices.length-E.length;return this.vertices=E,m}},Xf=function(b,B,R,X,H,n,i){this.aX=b,this.aY=B,this.xRadius=R,this.yRadius=X,this.aStartAngle=H,this.aEndAngle=n,this.aClockwise=i};Xf.prototype=ri(ul),Xf.prototype.getPoint=function(i){var S,X=this.aEndAngle-this.aStartAngle;0>X&&(X+=c),X>c&&(X-=c),S=this.aClockwise===!0?this.aEndAngle+(1-i)*(c-X):this.aStartAngle+i*X;var m=this.aX+this.xRadius*O(S),L=this.aY+this.yRadius*o(S);return new Nj(m,L)};var sk=function(y,x){this.v1=y,this.v2=x},Oj=sk.prototype=ri(ul);Oj.getPoint=function(F){var w=this.v2.clone().sub(this.v1);return w.multiplyScalar(F).add(this.v1),w},Oj.getPointAt=function(P){return this.getPoint(P)},Oj.getTangent=function(){var N=this.v2.clone().sub(this.v1);return N.normalize()};var ms=function(C,V,U){this.v0=C,this.v1=V,this.v2=U};ms.prototype=ri(ul),ms.prototype.getPoint=function(H){var p,V;return p=pn.b2(H,this.v0.x,this.v1.x,this.v2.x),V=pn.b2(H,this.v0.y,this.v1.y,this.v2.y),new Nj(p,V)};var ar=function(x,q,M,K){this.v0=x,this.v1=q,this.v2=M,this.v3=K};ar.prototype=ri(ul),ar.prototype.getPoint=function(H){var k,v;return k=pn.b3(H,this.v0.x,this.v1.x,this.v2.x,this.v3.x),v=pn.b3(H,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new Nj(k,v)},Gf.create(function(y,X){this.v1=y,this.v2=X},function(_){var S=new Ko;return S.subVectors(this.v2,this.v1),S.multiplyScalar(_),S.add(this.v1),S});var Fj=Gf.create(function(H,K,E){this.v0=H,this.v1=K,this.v2=E},function(y){var o,e,M;return o=pn.b2(y,this.v0.x,this.v1.x,this.v2.x),e=pn.b2(y,this.v0.y,this.v1.y,this.v2.y),M=pn.b2(y,this.v0.z,this.v1.z,this.v2.z),new Ko(o,e,M)}),Li=Gf.create(function(t,p,F,C){this.v0=t,this.v1=p,this.v2=F,this.v3=C},function(G){var q,h,S;return q=pn.b3(G,this.v0.x,this.v1.x,this.v2.x,this.v3.x),h=pn.b3(G,this.v0.y,this.v1.y,this.v2.y,this.v3.y),S=pn.b3(G,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new Ko(q,h,S)}),Kd=function(l,m,x,E,T,w,F,Q){Vg.call(this),E=E!==A?E:.5,T=T!==A?T:.5,Q=Q!==A?Q:1,l=l||8,w=w||0,F=F||c;var S,g,X=1,e=Q/2,j=[],Y=[],P=this.vertices,k=this.faces,M=this.faceVertexUvs;for(g=0;X>=g;g++){var z=[],$=[],v=g/X,t=v*(T-E)+E;for(S=0;l>=S;S++){var d=S/l,u=new Ko,f=-(d*F+w);u.z=t*o(f),u.y=-v*Q+e,u.x=t*O(f),P.push(u),z.push(P.length-1),$.push(new Nj(d,v))}j.push(z),Y.push($)}var G,N,I=(T-E)/Q;for(S=0;l>S;S++)for(0!==E?(G=P[j[0][S]].clone(),N=P[j[0][S+1]].clone()):(G=P[j[1][S]].clone(),N=P[j[1][S+1]].clone()),G.setY(h(G.x*G.x+G.z*G.z)*I).normalize(),N.setY(h(N.x*N.x+N.z*N.z)*I).normalize(),g=0;X>g;g++){var B=j[g][S],H=j[g+1][S],W=j[g+1][S+1],p=j[g][S+1],R=G.clone(),a=G.clone(),q=N.clone(),_=N.clone(),V=Y[g][S].clone(),L=Y[g+1][S].clone(),D=Y[g+1][S+1].clone(),C=Y[g][S+1].clone();k.push(new po(B,H,p,[R,a,_])),M[0].push([V,L,C]),k.push(new po(H,W,p,[a.clone(),q,_.clone()])),M[0].push([L.clone(),D,C.clone()])}if(m&&E>0)for(this.vertices.push(new Ko(0,e,0)),S=0;l>S;S++){var B=j[0][S],H=j[0][S+1],W=this.vertices.length-1,R=new Ko(0,1,0),a=new Ko(0,1,0),q=new Ko(0,1,0),V=Y[0][S].clone(),L=Y[0][S+1].clone(),D=new Nj(L.x,0);k.push(new po(B,H,W,[R,a,q],null,1));var Z=S/l*c,i=O(Z),y=o(Z),b=(S+1)/l*c,n=O(b),s=o(b);M[0].push([new Nj(.5+.5*i,.5+.5*y),new Nj(.5+.5*n,.5+.5*s),new Nj(.5,.5)])}if(x&&T>0)for(this.vertices.push(new Ko(0,-e,0)),S=0;l>S;S++){var B=j[g][S+1],H=j[g][S],W=P.length-1,R=new Ko(0,-1,0),a=new Ko(0,-1,0),q=new Ko(0,-1,0),V=Y[g][S+1].clone(),L=Y[g][S].clone();k.push(new po(B,H,W,[R,a,q],null,2));var Z=S/l*c,i=O(Z),y=o(Z),b=(S+1)/l*c,n=O(b),s=o(b);M[0].push([new Nj(.5+.5*n,.5-.5*s),new Nj(.5+.5*i,.5-.5*y),new Nj(.5,.5)])}};Kd.prototype=ri(xo);var lk=function(e,b,_,M,h,P,N){Vg.call(this),N=N||.5,e=e||16,b=b||16,_=(_!==A?_:0)-Y,M=M!==A?M:c,h=h!==A?h:0,P=P!==A?P:Y;var k,w,I=[],p=[],x=this.vertices,C=this.faces,R=this.faceVertexUvs;for(w=0;b>=w;w++){var m=[],Q=[];for(k=0;e>=k;k++){var X=k/e,V=w/b,U=new Ko;U.x=-N*O(_+X*M)*o(h+V*P),U.y=N*O(h+V*P),U.z=N*o(_+X*M)*o(h+V*P),x.push(U),m.push(x.length-1),Q.push(new Nj(X,V))}I.push(m),p.push(Q)}for(w=0;b>w;w++)for(k=0;e>k;k++){var l=I[w][k+1],F=I[w][k],K=I[w+1][k],Z=I[w+1][k+1],S=x[l].clone().normalize(),a=x[F].clone().normalize(),n=x[K].clone().normalize(),G=x[Z].clone().normalize(),W=p[w][k+1].clone(),f=p[w][k].clone(),v=p[w+1][k].clone(),J=p[w+1][k+1].clone();D(x[l].y)===N?(W.x=(W.x+f.x)/2,C.push(new po(l,K,Z,[S,n,G])),R[0].push([W,v,J])):D(x[K].y)===N?(v.x=(v.x+J.x)/2,C.push(new po(l,F,K,[S,a,n])),R[0].push([W,f,v])):(C.push(new po(l,F,Z,[S,a,G])),R[0].push([W,f,J]),C.push(new po(F,K,Z,[a.clone(),n,G.clone()])),R[0].push([f.clone(),v,J.clone()]))}};lk.prototype=ri(xo);var db=function(t,Z,A,W,K,D){Vg.call(this),t=t||.33,Z=Z||.17,W=W||8,A=A||6,K=K||0,D=D||c;for(var n=new Ko,U=[],I=[],G=0;W>=G;G++)for(var X=G/W*c+Y,l=0;A>=l;l++){var b=l/A*D+K;n.x=t*O(b),n.z=-t*o(b);var V=new Ko,T=t+Z*O(X);V.x=T*O(b),V.z=-T*o(b),V.y=Z*o(X),this.vertices.push(V),U.push(new Nj(l/A,1-G/W)),I.push(V.clone().sub(n).normalize())}for(var G=1;W>=G;G++)for(var l=1;A>=l;l++){var L=(A+1)*G+l-1,F=(A+1)*(G-1)+l-1,v=(A+1)*(G-1)+l,p=(A+1)*G+l,N=new po(L,F,p,[I[L].clone(),I[F].clone(),I[p].clone()]);this.faces.push(N),this.faceVertexUvs[0].push([U[L].clone(),U[F].clone(),U[p].clone()]),N=new po(F,v,p,[I[F].clone(),I[v].clone(),I[p].clone()]),this.faces.push(N),this.faceVertexUvs[0].push([U[F].clone(),U[v].clone(),U[p].clone()])}this.computeFaceNormals()};db.prototype=ri(xo);var gj=function(l,S,I){return l?(Vg.call(this),l=l instanceof Array?l:[l],this.addShapeList(l,S),S.convertYZ!==!1&&fc(this,I),this.computeFaceNormals(),void 0):(l=[],void 0)},wn=gj.prototype=ri(Vg.prototype);wn.addShapeList=function(r,J){for(var X=r.length,h=0;X>h;h++){var S=r[h];this.addShape(S,J)}},wn.addShape=function(S,m){function c(){if(m.bottom)for(var O=0;g>O;O++)f=o[O],E(f[2],f[1],f[0],!0);if(m.top)for(O=0;g>O;O++)f=o[O],E(f[0]+v*N,f[1]+v*N,f[2]+v*N,!1)}function Q(){var C=0;for(P(e,C),C+=e.length,p=0,F=r.length;F>p;p++)R=r[p],P(R,C),C+=R.length}function P(A,P){for(var a,B,R=A.length;--R>=0;){a=R,B=R-1,0>B&&(B=A.length-1);var D=0,C=N;for(D=0;C>D;D++){var p=v*D,Z=v*(D+1),i=P+a+p,L=P+B+p,Q=P+B+Z,G=P+a+Z;I(i,L,Q,G,A,D,C,a,B)}}}function j(N,C,Z){s.vertices.push(new Ko(N,C,Z))}function E(U,X,P,_){U+=u,X+=u,P+=u,s.faces.push(new po(U,X,P,null,null,_?2:1));var N=_?i.generateBottomUV(s,S,m,U,X,P):i.generateTopUV(s,S,m,U,X,P);s.faceVertexUvs[0].push(N)}function I(F,o,W,f,L,Q,g,I,O){F+=u,o+=u,W+=u,f+=u,s.faces.push(new po(F,o,f)),s.faces.push(new po(o,W,f));var C=i.generateSideWallUV(s,S,L,m,F,o,W,f,Q,g,I,O);s.faceVertexUvs[0].push([C[0],C[1],C[3]]),s.faceVertexUvs[0].push([C[1],C[2],C[3]])}var D,V,O,l,_,d=m.amount,w=m.curveSegments||ae,N=m.steps||1,q=m.extrudePath,Z=!1,i=new Ne(m.repeatUVLength,m.boundingBox);q&&(D=q.getSpacedPoints(N),Z=!0,V=m.frames!==A?m.frames:new fh.FrenetFrames(q,N,!1),O=new Ko,l=new Ko,_=new Ko);var R,p,F,s=this,u=this.vertices.length,U=S.extractPoints(w),$=U.shape,r=U.holes,B=!pn.isClockWise($);if(B){for($=$.reverse(),p=0,F=r.length;F>p;p++)R=r[p],pn.isClockWise(R)&&(r[p]=R.reverse());B=!1}var o=pn.triangulateShape($,r),e=$;for(p=0,F=r.length;F>p;p++)R=r[p],$=$.concat(R);for(var x,f,v=$.length,g=o.length,C=0;v>C;C++)x=$[C],Z?(l.copy(V.normals[0]).multiplyScalar(x.x),O.copy(V.binormals[0]).multiplyScalar(x.y),_.copy(D[0]).add(l).add(O),j(_.x,_.y,_.z)):j(x.x,x.y,0);
var W;for(W=1;N>=W;W++)for(C=0;v>C;C++)x=$[C],Z?(l.copy(V.normals[W]).multiplyScalar(x.x),O.copy(V.binormals[W]).multiplyScalar(x.y),_.copy(D[W]).add(l).add(O),j(_.x,_.y,_.z)):j(x.x,x.y,d/N*W);c(),Q()};var fh=function(J,L,q,w,K){function m(o,p,u){return $.vertices.push(new Ko(o,p,u))-1}Vg.call(this),L=L||64,q=q||1,w=w||8,K=K||!1;var Z,r,k,n,l,M,C,p,V,v,W,j,f,d,y,z,R,P,s,D,H=[],$=this,Y=L+1,u=new Ko,I=new fh.FrenetFrames(J,L,K),x=I.tangents,t=I.normals,b=I.binormals;for(this.tangents=x,this.normals=t,this.binormals=b,V=0;Y>V;V++)for(H[V]=[],n=V/(Y-1),p=J.getPointAt(n),Z=x[V],r=t[V],k=b[V],v=0;w>v;v++)l=v/w*c,M=-q*O(l),C=q*o(l),u.copy(p),u.x+=M*r.x+C*k.x,u.y+=M*r.y+C*k.y,u.z+=M*r.z+C*k.z,H[V][v]=m(u.x,u.y,u.z);for(V=0;L>V;V++)for(v=0;w>v;v++)W=K?(V+1)%L:V+1,j=(v+1)%w,f=H[V][v],d=H[W][v],y=H[W][j],z=H[V][j],R=new Nj(V/L,v/w),P=new Nj((V+1)/L,v/w),s=new Nj((V+1)/L,(v+1)/w),D=new Nj(V/L,(v+1)/w),this.faces.push(new po(f,d,z)),this.faceVertexUvs[0].push([R,P,D]),this.faces.push(new po(d,y,z)),this.faceVertexUvs[0].push([P.clone(),s,D.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};fh.prototype=ri(xo),fh.FrenetFrames=function(H,v,X){function J(){A[0]=new Ko,k[0]=new Ko,S=Number.MAX_VALUE,f=D(L[0].x),Y=D(L[0].y),n=D(L[0].z),S>=f&&(S=f,W.set(1,0,0)),S>=Y&&(S=Y,W.set(0,1,0)),S>=n&&W.set(0,0,1),d.crossVectors(L[0],W).normalize(),A[0].crossVectors(L[0],d),k[0].crossVectors(L[0],A[0])}var G,S,f,Y,n,t,s,W=new Ko,L=[],A=[],k=[],d=new Ko,T=new We,z=v+1,x=1e-4;for(this.tangents=L,this.normals=A,this.binormals=k,t=0;z>t;t++)s=t/(z-1),L[t]=H.getTangentAt(s),L[t].normalize();for(J(),t=1;z>t;t++)A[t]=A[t-1].clone(),k[t]=k[t-1].clone(),d.crossVectors(L[t-1],L[t]),d.length()>x&&(d.normalize(),G=V(Lb(L[t-1].dot(L[t]),-1,1)),A[t].applyMatrix4(T.makeRotationAxis(d,G))),k[t].crossVectors(L[t],A[t]);if(X)for(G=V(Lb(A[0].dot(A[z-1]),-1,1)),G/=z-1,L[0].dot(d.crossVectors(A[0],A[z-1]))>0&&(G=-G),t=1;z>t;t++)A[t].applyMatrix4(T.makeRotationAxis(L[t],G*t)),k[t].crossVectors(L[t],A[t])};var bf=function(s,p,b,L){Vg.call(this),p=p||18,b=b||0,L=L==q?c:L;for(var k=1/(s.length-1),$=1/p,e=0,h=p;h>=e;e++)for(var Q=b+e*$*L,P=O(Q),G=o(Q),z=0,H=s.length;H>z;z++){var F=s[z],C=new Ko;C.x=P*F.x-G*F.y,C.y=G*F.x+P*F.y,C.z=F.z,this.vertices.push(C)}for(var t=s.length,e=0,h=p;h>e;e++)for(var z=0,H=s.length-1;H>z;z++){var M=z+t*e,W=M,E=M+t,P=M+1+t,w=M+1,N=e*$,l=z*k,d=N+$,m=l+k;this.faces.push(new po(W,w,E)),this.faceVertexUvs[0].push([new Nj(N,l),new Nj(N,m),new Nj(d,l)]),this.faces.push(new po(E,w,P)),this.faceVertexUvs[0].push([new Nj(d,l),new Nj(N,m),new Nj(d,m)])}this.mergeVertices(),fc(this),this.computeFaceNormals(),this.computeVertexNormals()};bf.prototype=ri(xo);var sb=function(i,C){C=C||{};var o=tj.generateShapes(i,C);C.amount=C.amount!==A?C.amount:.5,C.convertYZ=!1,C.fill!==!1&&(C.bottom=!0,C.top=!0),gj.call(this,o,C)};sb.prototype=ri(wn);var Ak=x.Node=function(){Vq(Ak,this)},Lq={X:Xc,Y:ai,Z:mi},yj={X:0,Y:1,Z:2},cf={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},Dp=new Qo,ks="xzy",Ah=function(i,q,M){if(q){var R=q[0],u=q[1],d=q[2];"xzy"===M?(ai(i,u),mi(i,d),Xc(i,R)):"xyz"===M?(mi(i,d),ai(i,u),Xc(i,R)):"yxz"===M?(mi(i,d),Xc(i,R),ai(i,u)):"yzx"===M?(Xc(i,R),mi(i,d),ai(i,u)):"zxy"===M?(ai(i,u),Xc(i,R),mi(i,d)):"zyx"===M?(Xc(i,R),ai(i,u),mi(i,d)):(ai(i,u),mi(i,d),Xc(i,R))}};Qq("Node",Vp,{ms_ac:["rotationMode","anchorElevation"],ms_edge:!0,_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:ks,_64O:0,_rotationX:0,_53O:0,_host:q,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return Xj},_22Q:function(){return lt},getX:function(){return this.p().x},setX:function(G){this.p(G,this.p().y)},getY:function(){return this.p().y},setY:function(w){this.p(this.p().x,w)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function($){this.setAnchor($,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(x){this.setAnchor(this.getAnchor().x,x)},getScaleX:function(){return this.getScale().x},setScaleX:function(F){this.setScale(F,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(r){this.setScale(this.getScale().x,r)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},setQuaternion:function(R){var j=(new nm).setFromQuaternion(R,nm.ReverseOrder(this.getRotationMode()));return this._applyClosestR3(j.x,j.y,j.z)},getQuaternion:function(){var G=new nm,T=new nm,d=new Qo;return function(H){return H||(H=new Qo),this.getEuler(G),G.equals(T)?H.copy(d):H.copy(d.setFromEuler(T.copy(G)))}}(),getEuler:function(N){var q=this.r3();return N||(N=new nm),N.set(q[0],q[1],q[2],nm.ReverseOrder(this.getRotationMode()))},setEuler:function(G){return G=G.clone().reorder(nm.ReverseOrder(this.getRotationMode())),this.r3(G.x,G.y,G.z)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(p,P){Vk(p,vl(q,q,this.r3(),this.getRotationMode())),this.translate3d(p[0]*P,p[1]*P,p[2]*P)},translateFront:function(v){this.translate3dBy([0,0,1],v)},translateBack:function(P){this.translate3dBy([0,0,-1],P)},translateLeft:function(L){this.translate3dBy([-1,0,0],L)},translateRight:function(B){this.translate3dBy([1,0,0],B)},translateTop:function(A){this.translate3dBy([0,1,0],A)},translateBottom:function(R){this.translate3dBy([0,-1,0],R)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(t,j,h){1===arguments.length&&(j=t[1],h=t[2],t=t[0]),this.p(t,h),this.setElevation(j)},translate3d:function(y,Q,K){1===arguments.length&&(Q=y[1],K=y[2],y=y[0]),this.translate(y,K),this.setElevation(this._54O+Q)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(l,f,Y){1===arguments.length&&(f=l[1],Y=l[2],l=l[0]),this.setSize(l,Y),this.setTall(f)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(m,B,M){var k=this;if(!k._updatingRotation3d){k._updatingRotation3d=1,1===arguments.length&&(B=m[1],M=m[2],m=m[0]);var l=[k._rotationX,-k._64O,k._53O];k._rotationX=m,k._64O=-B,k._53O=M,k.fp("rotation3d",l,[m,B,M]),delete k._updatingRotation3d}},_applyClosestR3:function(){function J(r){return r%=c,0>r&&(r+=c),r>Y?c-r:r}function O(G,Z){return J(G[0]-Z[0])+J(G[1]-Z[1])+J(G[2]-Z[2])}return function(l,f,k){var G,p,h,q=this.r3(),A=this.getRotationMode();"xzy"===A||"yzx"===A?(G=l>0?l-Y:l+Y,p=f>0?f-Y:f+Y,h=k>0?Y-k:-Y-k):"xyz"===A||"zyx"===A?(G=l>0?l-Y:l+Y,h=k>0?k-Y:k+Y,p=f>0?Y-f:-Y-f):("yxz"===A||"zxy"===A)&&(h=k>0?k-Y:k+Y,p=f>0?f-Y:f+Y,G=l>0?Y-l:-Y-l),O([G,p,h],q)<O([l,f,k],q)?this.r3(G,p,h):this.r3(l,f,k)}}(),setRotationY:function(F){this.setRotation(-F)},getRotationY:function(){return-this._64O},lookAtDirection:function(v,Z){Z=Z||Ao;var s=this,B=Hh(v);Z===Ao?(s.r3([-I(v[1]/B),-Cl(v[2],v[0])+Ek,0]),s.setRotationMode("xzy")):Z===Bj?(s.r3(0,-Cl(v[2],v[0]),I(v[1]/B)),s.setRotationMode("zyx")):Z===wk?(s.r3(0,-Cl(v[2],v[0])+Y,-I(v[1]/B)),s.setRotationMode("zyx")):Z===vg?(s.r3([-I(v[1]/B)+Ek,-Cl(v[2],v[0])+Ek,0]),s.setRotationMode("xzy")):Z===rj&&(s.r3([-I(v[1]/B)-Ek,-Cl(v[2],v[0])+Ek,0]),s.setRotationMode("xzy")),Z===ki&&(s.r3([-I(v[1]/B)+Y,-Cl(v[2],v[0])+Ek,Y]),s.setRotationMode("zxy"))},lookAt:function(q,T){return this.lookAtDirection(Dk(q,this.p3()),T)},lookAtX:function(){var t=new ah,L=new ah,p=new ah,Q=new We,Y=new We,k=new nm;return function(D,i){var M=bg(this);if(Q.fromArray(M),p.copy(this.p3()),t.copy(D).sub(p),!(t.lengthSq()<1e-6)){t.normalize(),i=i||Ao,"string"==typeof i?i===Ao?L.set(0,0,1):i===ki?L.set(0,0,-1):i===wk?L.set(-1,0,0):i===Bj?L.set(1,0,0):i===vg?L.set(0,1,0):i===rj&&L.set(0,-1,0):L.copy(i).normalize(),L.applyMatrix4(Q).sub(p).normalize();var h=Math.acos(t.dot(L));if(h){var B=t.clone().cross(L);B.lengthSq()<1e-6&&(i===vg||i===rj||0===i[0]&&0===i[1]?B.set(0,0,1).applyMatrix4(Q).sub(p):B.set(0,1,0).applyMatrix4(Q).sub(p)),B.normalize(),k.set(this.r3(),this.getRotationMode(),!0),Q.makeRotationFromEuler(k),Y.makeRotationAxis(B,-h),k.setFromRotationMatrix(Y.multiply(Q)),this._applyClosestR3(k.x,k.y,k.z)}}}}(),getHost:function(){return this._host},setHost:function(n){var U=this;if(U!==n&&U._host!==n){var b=U._host;b&&(b._removeAttach(U),b.updateLayoutAttaches()),U._host=n,U._host&&U._host._addAttach(U),U.fp("host",b,n),U.onHostChanged(b,n)}},getAttaches:function(){return this._69O},_addAttach:function(E){var s=this;s._69O||(s._69O=new lo),s._69O.add(E),s.fp("attaches",q,E)},_removeAttach:function(v){var K=this;K._69O.remove(v),K._69O.isEmpty()&&delete K._69O,K.fp("attaches",v,q)},getImage:function(){if(this._pendingCheckImageJSON){var c=M.getImage(this._image);c&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof bo&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(k){var n=this,t=n._image,R=n.getWidth(),$=n.getHeight();if(n._image=k,n.fp("image",t,k)){if(null!=k&&(fg(k)||ro(k)&&/\.json$/i.test(k))&&(this._pendingCheckImageJSON=!0),Lc)return;n.fp(xj,R,n.getWidth()),n.fp(ii,$,n.getHeight())}},getElevation:function(){return this._54O},setElevation:function(w){var A=this;if(!A._50O){A._50O=1;var t=A._54O;A._54O=w,A.fp(Re,t,w),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(N){var M=this;if(!M._49O){M._49O=1;var K=M._64O;M._64O=N,M.fp(Ci,K,N),delete M._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(X){var M=this;if(!M._51O){M._51O=1;var l=M._rotationX;M._rotationX=X,M.fp("rotationX",l,X),delete M._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(A){var x=this;if(!x._52O){x._52O=1;var N=x._53O;x._53O=A,x.fp("rotationZ",N,A),delete x._52O}},getPosition:function(){return this._position},setPosition:function(f,U){var V=this;if(!V._50I){V._50I=1;var F;if(F=2===arguments.length?{x:f,y:U}:f,F.x!==V._position.x||F.y!==V._position.y){var Z=V._position;V._position=F,V.fp(Nn,Z,F)}delete V._50I}},translate:function(f,J){var h=this._position;this.p(h.x+f,h.y+J)},hasInheritedSize:function(){var g=this,G=g.getStyle("shape3d");if(G){var Y=Pd(G);if(Y&&Y.rawS3)return!0;if(("billboard"===G||"plane"===G)&&yd(g.getStyle("shape3d.image")))return!0}return g.hasOwnProperty("_image")&&yd(g._image)?!0:!1},getWidth:function(){var U=this;if(U._width>=0)return U._width;var Y=U.getStyle("shape3d");if(Y){var a=Pd(Y);if(a&&a.rawS3)return a.rawS3[0];if("billboard"===Y||"plane"===Y){var O=yd(U.getStyle("shape3d.image"));return O?Wq(O,U):20}}var O=yd(U._image);return O?Wq(O,U):20},setWidth:function(Y){var W=this,e=W._width;W._width=Y,W.fp(xj,e,Y)},getHeight:function(){var S=this;if(S._height>=0)return S._height;var L=S.getStyle("shape3d");if(L){var C=Pd(L);if(C&&C.rawS3)return C.rawS3[2];if("plane"===L){var Q=yd(S.getStyle("shape3d.image"));return Q?pm(Q,S):20}if("billboard"===L)return 2}var Q=yd(S._image);return Q?pm(Q,S):20},setHeight:function(x){var B=this,p=B._height;B._height=x,B.fp(ii,p,x)},getTall:function(){var u=this;if(u._tall>=0)return u._tall;var F=u.getStyle("shape3d");if(F){var c=Pd(F);if(c&&c.rawS3)return c.rawS3[1];if("billboard"===F){var M=yd(u.getStyle("shape3d.image"));return M?pm(M,u):20}if("plane"===F)return 2}return 20},setTall:function(y){var j=this,k=j._tall;j._tall=y,j.fp("tall",k,y)},setSize:function(n,N){var $=this;2===arguments.length?($.setWidth(n),$.setHeight(N)):($.setWidth(n.width),$.setHeight(n.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},setRect:function(H,E,n,W,g){var I=this,T=I.getAnchor(),K=I.getScale();arguments.length<=2&&(g=E,E=H.y,n=H.width,W=H.height,H=H.x);var Z=g&&K.x<0?1-T.x:T.x,D=g&&K.y<0?1-T.y:T.y;I.p(H+n*Z,E+W*D),g&&(n/=Math.abs(K.x),W/=Math.abs(K.y)),I.setWidth(n),I.setHeight(W)},getMatrix:function(){var y=this,o=y._64O,c=y._position,C=y.getScale();return new rd(o,c.x,c.y,C.x,C.y)},getMatrix4:function(){var p=new ah,W=new Qo,t=new ah;return function(c){return this.getQuaternion(W),p.copy(this.p3()),t.copy(this.getFinalScale3d()),c||(c=new We),c.compose(p,W,t)}}(),getAnchorRect:function(){var A=this,Z=A.getWidth(),h=A.getHeight(),m=A.getAnchor();return{x:-Z*m.x,y:-h*m.y,width:Z,height:h}},toLocal:function(f){return this.getMatrix().tfi(f)},toGlobal:function(n){return this.getMatrix().tf(n)},getAttachPosition:function(){var $=new rd;return function(K,o,T,Z){T=T||0,Z=Z||0;var r=this,V=r.getAnchor(),B=r._64O,X=r._position,w=r.getScale();return $.setFromTransform(B,X.x,X.y).tf({x:T+w.x*r.getWidth()*(K-V.x),y:Z+w.y*r.getHeight()*(o-V.y)})}}(),isInRect:function(M){M=this.toLocal(M);var d=this.getWidth(),N=this.getHeight();return M.x+=d*this.getAnchorX(),M.y+=N*this.getAnchorY(),!(M.x<0||M.y<0||M.x>d||M.y>N)},getRect:function(){var O=this,B=O.getWidth(),X=O.getHeight(),a=O.getAnchor(),v={x:-B*a.x,y:-X*a.y,width:B,height:X},g=O.getMatrix();return v=vn([g.tf(v.x,v.y),g.tf(v.x+v.width,v.y),g.tf(v.x+v.width,v.y+v.height),g.tf(v.x,v.y+v.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var K=this,I=K.getAnchor(),D=K._anchorElevation;return{x:I.x,y:D,z:I.y}},setAnchorElevation:function($){var s=this,v=s._anchorElevation;return v!==$?(s._anchorElevation=$,s.fp("anchorElevation",v,$),!0):!1},setAnchor3d:function(r,z,l,O){var w,u=this;"number"==typeof r?w={x:r,y:z,z:l}:(w=r.length?{x:r[0],y:r[1],z:r[2]}:r,O=z),u.beginTransaction();var D=u.getAnchor3d(),U=u.setAnchor(w.x,w.z);if(u.setAnchorElevation(w.y)&&(U=!0),U&&O&&!Lc){u.getAnchor3d();var V=bg(u),b=Vk([w.x-D.x,w.y-D.y,w.z-D.z],V);u.p3(b)}return u.endTransaction(),U},getAnchor:function(){var j=this;if(j.hasOwnProperty("_anchor"))return j._anchor;var z=yd(j._image);return z&&z.anchorX!==A?{x:z.anchorX,y:z.anchorY}:j._anchor},setAnchor:function(t,M,k){var S,d=this;"number"==typeof t?S={x:t,y:M}:(S=t.length?{x:t[0],y:t[1]}:t,k=M);var g=d.getAnchor();if(g.x!==S.x||g.y!==S.y){if(d.beginTransaction(),d._anchor=S,d.fp("anchor",g,S),k&&!Lc){var B=d.getPosition(),X=d.getSize(),b=d.getRotation(),Z=d.getScale(),E=-X.width*(g.x-S.x)*Z.x,V=-X.height*(g.y-S.y)*Z.y,F=o(b),J=O(b);d.setPosition(B.x+J*E-F*V,B.y+F*E+J*V)}return d.endTransaction(),!0}return!1},getLocalQuaternion:function(q){var Z=this,R=Z.getHost();if(!R)return Z.getQuaternion(q);var s=R.getQuaternion(),d=Z.getQuaternion();return q||(q=new Qo),q.copy(s).inverse().multiply(d)},setLocalQuaternion:function(I){var Q=this,h=Q.getHost();if(!h)return Q.setQuaternion(I);var e=h.getQuaternion();Q.setQuaternion(e.clone().multiply(I))},getLocalEuler:function(){var D=new Qo;return function(F){var i=this,A=i.getHost();return A?(i.getLocalQuaternion(D),F||(F=new nm),F.setFromQuaternion(D,nm.ReverseOrder(this.getRotationMode()))):i.getEuler(F)}}(),setLocalEuler:function(){var J=new Qo;return function(I){var l=this,F=l.getHost();return F?(J.setFromEuler(I),l.setLocalQuaternion(J)):l.setEuler(I)}}(),getLocalPosition3d:function(u){var w=this;u||(u=new ah),u.copy(w.p3());var a=w.getHost();if(!a)return u;var G=a.getMatrix4();return u.applyMatrix4(G.getInverse(G))},setLocalPosition3d:function(N){var q=this,W=q.getHost();if(!W)return N.x!==A?q.p3(N.x,N.y,N.z):q.p3(N),void 0;var n=W.getMatrix4(),H=new ah(N);H.applyMatrix4(n),q.p3(H.x,H.y,H.z)},getScale:function(){return this._scale},setScale:function(b,S){var v,k=this;v=2===arguments.length?{x:b,y:S}:b;var r=k.getScale();(r.x!==v.x||r.y!==v.y)&&(k._scale=v,k.fp("scale",r,v))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var b=this,L=b._scaleTall,J=b.getScale();return[J.x,L,J.y]},getFinalScale3d:function(){var A=this,V=A.s3(),Q=A._dynamicScale3d,C=A.getScale3d();return V&&(C[0]*=V[0],C[1]*=V[1],C[2]*=V[2]),Q&&(C[0]*=Q[0],C[1]*=Q[1],C[2]*=Q[2]),C},getFinalRotation3d:function(){var $=this;return $._dynamicRotation||$.r3()},setScaleTall:function(b){var E=this,o=E._scaleTall;o!==b&&(E._scaleTall=b,E.fp("scaleTall",o,b))},setScale3d:function(m,p,R){var V,j=this;V="number"==typeof m?{x:m,y:p,z:R}:m.length?{x:m[0],y:m[1],z:m[2]}:m,j.setScaleTall(V.y),j.setScale(V.x,V.z)},getCorners:function(i,W){i==q&&(i=0),W==q&&(W=i);var c=this,y=c.getAnchor(),f=c.getWidth(),o=c.getHeight(),J=-f*y.x-i,g=-o*y.y-W,I=f+2*i,H=o+2*W,w=c.getMatrix();return[w.tf(J,g),w.tf(J,g+H),w.tf(J+I,g+H),w.tf(J+I,g)]},getEditControlPoints:function(V,G,R){G==q&&(G=0),R==q&&(R=G);var U=this,g=U.getAnchor(),m=U.getWidth(),C=U.getHeight(),Q=-m*g.x-G,v=-C*g.y-R,X=m+2*G,a=C+2*R;if(V)return[{x:Q,y:v},{x:Q,y:0},{x:Q,y:v+a},{x:0,y:v+a},{x:Q+X,y:v+a},{x:Q+X,y:0},{x:Q+X,y:v},{x:0,y:v}];var p=U.getMatrix();return[p.tf(Q,v),p.tf(Q,0),p.tf(Q,v+a),p.tf(0,v+a),p.tf(Q+X,v+a),p.tf(Q+X,0),p.tf(Q+X,v),p.tf(0,v)]},rotateAt:function(N,D,g){var I=this,Z=I._position,X=I._64O,l=new rd(X,Z.x,Z.y).tf(N,D),J=h(N*N+D*D),d=Cl(Z.y-l.y,Z.x-l.x)+g;I.setRotation(X+g),I.p(l.x+J*O(d),l.y+J*o(d))},rotateAroundAxis:function(N,z){this.setQuaternion(this.getQuaternion().multiply(Dp.setFromAxisAngle(N,z)))},rotateAroundWorldAxis:function(M,b){this.setQuaternion(this.getQuaternion().premultiply(Dp.setFromAxisAngle(M,b)))},rotateX:function(m){return this.rotateAroundAxis(ah.AxisX,m)},rotateY:function(n){return this.rotateAroundAxis(ah.AxisY,n)},rotateZ:function(p){return this.rotateAroundAxis(ah.AxisZ,p)},onParentChanged:function(){Ak.superClass.onParentChanged.apply(this,arguments),this._8I()},onPropertyChanged:function(){var F={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(b){F[b]=!0}),function(W){var d=this;Ak.superClass.onPropertyChanged.call(d,W);var K=W.property;if(F[K]&&!d._layoutUpdating&&d.updateLayoutParameters(null,K),d._69O&&d._69O.each(function(U){U.handleHostPropertyChange(W)}),d._49I&&d._49I.each(function(h){h.fp("agentChange",!0,!1)}),to[K]||"a:layout"===K.substring(0,8)){this.updateLayoutAttaches();var u=d._host;u&&u.updateLayoutAttaches()}("s:shape3d.autorotate"===K||"s:autorotate"===K||"s:shape3d.fixSizeOnScreen"===K||"s:fixSizeOnScreen"===K||"s:hide.overlapping.group"===K)&&(d._47Q=d.s("autorotate")||d.s("shape3d.autorotate")||d.s("fixSizeOnScreen")||d.s("shape3d.fixSizeOnScreen")||d.s("hide.overlapping.group"))}}(),onHostChanged:function(){this.updateAttach(),this.updateLayoutParameters()},handleHostPropertyChange:function(P){this.updateAttach(P)},onStyleChanged:function(e){Ak.superClass.onStyleChanged.apply(this,arguments),rl[e]&&this.updateAttach()},updateLayoutAttaches:function(){if(!Lc&&this.s("vector.layoutable")){var P,q,f=this;return P=yd(f.getImage()),P&&P.layoutAttach&&(q=P.layoutAttach,q&&q(f))?!0:void 0}},updateAttach:function(g){var u=this;return Lc?(u.updateLayoutParameters(),void 0):(u._51I||(u._51I=1,u._71O(g),delete u._51I),void 0)},_71O:function(J){var K,D,b,e,L,R,k=this,I=k._host,Z=J?J.property:q,O=J?J.oldValue:q,M=J?J.newValue:q;if(I instanceof Ak&&(!J||to[Z])){var E;if(E=yd(I.getImage()),E&&E.layoutAttach)return}if(I instanceof x.Grid){if(Z===Re)k.setElevation(k._54O+M-O);else if(!J||Cs[Z]){if(K=k.s("attach.row.index"),D=k.s("attach.column.index"),b=I.getCellRect(K,D),!b)return;e=k.s("attach.row.span"),L=k.s("attach.column.span"),(1!==e||1!==L)&&(b=sm(b,I.getCellRect(K+e-1,D+L-1))),bq(b,k,"attach.padding",1),k.setRect(b)}}else if(I instanceof cg&&(R=k.s("attach.index"))>=0&&(!J||md[Z])){var V=k.s("attach.thickness"),w=I.getScale(),h=Math.max(w.x,w.y);V>0&&k.setHeight(I.getThickness()*V*h);var j=k.s("attach.offset"),N=I.getPoints(),i=N.size();if(i>R){var T=I.getPointsMatrix2d(),u=N.get(R),G=i===R+1?N.get(0):N.get(R+1);u=T.apply(u),G=T.apply(G);var p=[G.x-u.x,G.y-u.y],n=Hh(p);if(n){k.s("attach.offset.relative")&&(j*=n),k.s("attach.offset.opposite")&&(j=n-j);var y={x:u.x+p[0]/n*j,y:u.y+p[1]/n*j},$=k.s("attach.gap");$&&(k.s("attach.gap.relative")&&($*=I.getThickness()*h),y=wr(q,y,G,$)),k.p(y),k.setRotation(Cl(p[1],p[0]))}}}else J&&(Z===Nn?k.translate(M.x-O.x,M.y-O.y):Z===Re?k.setElevation(k._54O+M-O):eg[Z]?"rotation3d"===Z?k.syncRotation3d(I,M,O):k._11Q(I,Z,M-O):("anchor"===Z||"width"===Z||"height"===Z||"scale"===Z)&&k.layout(I))},_11Q:function(){var j=new x.Math.Euler,T=x.Math.Euler.ReverseOrder,L=new x.Math.Vector2,d=new x.Math.Vector2;return function(p,a,r){var R=this,S=p.p3(),Q=p.r3(),Z=R.p3(),I=R.r3();if(a===Ci&&(a="rotationY",r=-r),(a===Ci||"rotationY"===a)&&0===I[0]&&0===I[2]&&0===Q[0]&&0===Q[2]&&0===Z[1]&&0===S[1])return R.setRotation(-I[1]-r),L.set(Z[0],Z[2]).rotateAround(d.set(S[0],S[2]),-r),R.p(L.x,L.y),void 0;var A=cf[p.getRotationMode()],e=A[0],$=A[1],N=A[2],H=Lq[e],C=Lq[$],W=Lq[N],q=Sj();a===Ci+e?(W(q,Q[yj[N]]),C(q,Q[yj[$]]),H(q,r),C(q,-Q[yj[$]]),W(q,-Q[yj[N]])):a===Ci+$?(W(q,Q[yj[N]]),C(q,r),W(q,-Q[yj[N]])):a===Ci+N&&W(q,r);var D=Dk(Z,S);Vk(D,q),R.p3(S[0]+D[0],S[1]+D[1],S[2]+D[2]);var f=R.getRotationMode();Ah(q,R.r3(),f),j.setFromRotationMatrix(q,T(f)),R.r3([j.x,j.y,j.z])}}(),syncRotation3d:function(){var i=new Qo,G=new nm,u=new ah;return function(A,T,x){var z=this;if(x[0]!==T[0]||x[1]!==T[1]||x[2]!==T[2]){var V=nm.ReverseOrder(A.getRotationMode());Dp.setFromEuler(G.set(x[0],x[1],x[2],V)),i.setFromEuler(G.set(T[0],T[1],T[2],V)),i.multiply(Dp.inverse());var B=A.p3(),_=z.p3();u.set(_[0]-B[0],_[1]-B[1],_[2]-B[2]).applyQuaternion(i),z.p3(B[0]+u.x,B[1]+u.y,B[2]+u.z),z.setQuaternion(z.getQuaternion(Dp).premultiply(i))}}}(),isHostOn:function(Y){var y=this;if(y._host&&Y&&Y._69O)for(var U={},F=y._host;F&&F!==y&&!U[F._id];){if(F===Y)return!0;U[F._id]=F,F=F._host}return!1},isLoopedHostOn:function(D){return this.isHostOn(D)&&D.isHostOn(this)},getScaledSize:function(){var u=this.getSize(),A=this.getScale();return u.width*=Math.abs(A.x),u.height*=Math.abs(A.y),u},layout:function(t){if(t=t||this.getHost()){var g=this,b=g.s("layout.h")||"center",W=g.s("layout.v")||"center";if("center"!==b||"center"!==W){var c=new x.Math.Vector2,G=t.getPosition(),O=t.getAnchor(),p=t.getScaledSize();g.getPosition();var Q,D,S,M,X,i=1,Z=1;switch(g._layoutUpdating=!0,b){case"left":c.setX(g._layoutHValue-O.x*p.width);break;case"right":c.setX((1-O.x)*p.width-g._layoutHValue);break;case"leftright":Q=p.width-g._layoutHValue[2],S=g.getRotation()-t.getRotation(),M=Math.abs(Math.sin(S)),X=Math.abs(Math.cos(S)),i+=X*Q/g._layoutHValue[3],Z+=M*Q/g._layoutHValue[4],c.setX(g._layoutHValue[1]+(g._layoutHValue[5]-O.x)*p.width);break;case"center":c.setX((.5-O.x)*p.width-g._layoutHValue);break;case"scale":S=g.getRotation()-t.getRotation(),M=Math.abs(Math.sin(S)),X=Math.abs(Math.cos(S)),c.setX((.5-O.x)*p.width-g._layoutHValue[1]*p.width/g._layoutHValue[0]),D=p.width/g._layoutHValue[2]-1,i+=X*D,Z+=M*D}switch(W){case"top":c.setY(g._layoutVValue-O.y*p.height);break;case"bottom":c.setY((1-O.y)*p.height-g._layoutVValue);break;case"topbottom":S||(S=g.getRotation()-t.getRotation(),M=Math.abs(Math.sin(S)),X=Math.abs(Math.cos(S))),Q=p.height-g._layoutVValue[2],i+=M*Q/g._layoutVValue[3],Z+=X*Q/g._layoutVValue[4],c.setY(g._layoutVValue[1]+(g._layoutVValue[5]-O.y)*p.height);break;case"center":c.setY((.5-O.y)*p.height-g._layoutVValue);break;case"scale":S||(S=g.getRotation()-t.getRotation(),M=Math.abs(Math.sin(S)),X=Math.abs(Math.cos(S))),c.setY((.5-O.y)*p.height-g._layoutVValue[1]*p.height/g._layoutVValue[0]),D=p.height/g._layoutVValue[2]-1,i+=M*D,Z+=X*D}if("leftright"===b||"scale"===b||"topbottom"===W||"scale"===W){var T=this.getScale(),m=Math.abs(T.x),V=Math.abs(T.y);"leftright"===b||"scale"===b?g.setSize(g._layoutHValue[3]*i/m,g._layoutHValue[4]*Z/V):g.setSize(g._layoutVValue[3]*i/m,g._layoutVValue[4]*Z/V)}c.rotateAround(null,t.getRotation()),this.setPosition(c.x+G.x,c.y+G.y),g._layoutUpdating=A}}},updateLayoutParameters:function(q,E){if(q=q||this.getHost()){var G=this,Q=G.s("layout.h"),$=G.s("layout.v");if(Q||$){var V,X,W,T,p,y,z=new x.Math.Vector2,t=q.getPosition(),R=q.getAnchor(),e=q.getScaledSize(),n=G.getPosition(),s=G.getScaledSize();switch(z.set(n.x-t.x,n.y-t.y),z.rotateAround(null,-q.getRotation()),Q){case"left":G._layoutHValue=z.x+R.x*e.width;break;case"right":G._layoutHValue=-z.x+(1-R.x)*e.width;break;case"center":G._layoutHValue=-z.x+(.5-R.x)*e.width;break;case"leftright":case"scale":"scale"===Q?V=-z.x+(.5-R.x)*e.width:(X=G.getAnchor(),W=G.getRotation()-q.getRotation(),T=Math.cos(W),p=Math.sin(W),y=-Math.min(-X.x*T+X.y*p,-X.x*T-(1-X.y)*p,(1-X.x)*T+X.y*p,(1-X.x)*T-(1-X.y)*p),V=z.x-(y-R.x)*e.width),"position"===E&&"object"==typeof G._layoutHValue?(G._layoutHValue[0]=e.width,G._layoutHValue[1]=V):G._layoutHValue=[e.width,V,e.width,s.width,s.height,y]}switch($){case"top":G._layoutVValue=z.y+R.y*e.height;break;case"bottom":G._layoutVValue=-z.y+(1-R.y)*e.height;break;case"center":G._layoutVValue=-z.y+(.5-R.y)*e.height;break;case"topbottom":case"scale":"scale"===$?V=-z.y+(.5-R.y)*e.height:(W||(X=G.getAnchor(),W=G.getRotation()-q.getRotation(),T=Math.cos(W),p=Math.sin(W)),y=-Math.min(-X.x*p-X.y*T,-X.x*p+(1-X.y)*T,(1-X.x)*p-X.y*T,(1-X.x)*p+(1-X.y)*T),V=z.y-(y-R.y)*e.height),"position"===E&&"object"==typeof G._layoutVValue?(G._layoutVValue[0]=e.height,G._layoutVValue[1]=V):G._layoutVValue=[e.height,V,e.height,s.width,s.height,y]}}}},getSerializableProperties:function(){var u=Ak.superClass.getSerializableProperties.call(this);return zb(u,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),u}});var Hr=x.Edge=function(V,J){var Z=this;Vq(Hr,Z),Z.setSource(V),Z.setTarget(J)};Qq("Edge",Vp,{ms_edge:!0,_icon:"edge_icon",getUIClass:function(){return _b},_22Q:function(){return nt},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},canSetSourceTarget:function(M){if(M===this)return!1;if(uk(M))return!0;for(var V,h,F,v,z,w=[this],q=-1,m=0;m>q;)if(q++,V=w[q],h=V._44I)for(h=h.getArray(),v=0,z=h.length;z>v;v++)if(F=h[v],dq(F)&&!(w.indexOf(F)>=0)){if(F===M)return!1;w.push(F),m++}return!0},setSource:function(z){var A=this;if(A._source!==z&&A.canSetSourceTarget(z)){var T=A._source;A._source=z,T&&T._16I(A),z&&z._2I(A),A._7I(),A.fp("source",T,z)}},setTarget:function(Q){var u=this;if(u._target!==Q&&u.canSetSourceTarget(Q)){var G=u._target;u._target=Q,G&&G._18I(u),Q&&Q._4I(u),u._7I(),u.fp("target",G,Q)}},isLooped:function(){var z=this;return z._source===z._target&&uk(z._source)&&uk(z._target)},onPropertyChanged:function(){var z={};return["source","target","sourceAgent","targetAgent","edgeGroup","agentChange","s:edge.width","s:edge.type","s:edge.offset","s:edge.center","s:edge.points","s:edge.segments","s:edge.gap","s:edge.source.t3","s:edge.target.t3","s:edge.color","s:edge.gradient.color","s:edge.pattern","s:edge.dash","s:edge.dash.color","s:edge.dash.pattern","s:edge.dash.offset","s:edge.dash","s:edge.dash","s:repeat.uv.length","s:body.color","s:shape3d","s:shape3d.visible","s:shape3d.image","s:shape3d.smooth","s:shape3d.resolution","s:shape3d.color","s:shape3d.blend","s:shape3d.side","s:shape3d.start.angle","s:shape3d.sweep.angle","s:shape3d.top.cap","s:shape3d.top.image","s:shape3d.top.visible","s:shape3d.top.color","s:shape3d.bottom.cap","s:shape3d.bottom.image","s:shape3d.bottom.visible","s:shape3d.bottom.color","s:shape3d.from.visible","s:shape3d.from.color","s:shape3d.to.visible","s:shape3d.to.color","s:shape3d.uv.union"].forEach(function(X){z[X]=!0}),function(n){var c=this;c._49I&&c._49I.each(function(Y){Y.fp("agentChange",!0,!1)}),("s:alwaysOnTop"===n.property||"s:shape3d.alwaysOnTop"===n.property)&&(n.newValue?this.setRenderLayer("top"):this.setRenderLayer(A)),z[n.property]&&(this._needChangeGeometry=!0)}}(),_7I:function(){var u,J=this,Z=Ub(J);J._40I!==Z&&(u=this._40I,u&&u._15I(J),J._40I=Z,Z&&Z._1I(J),J.fp("sourceAgent",u,Z),Ur(u,J._41I),Ur(Z,J._41I));var N=ml(J);J._41I!==N&&(u=J._41I,u&&u._17I(J),J._41I=N,N&&N._3I(J),J.fp("targetAgent",u,N),Ur(u,J._40I),Ur(N,J._40I))},_22I:function(c){this._52I=c,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var k=this;return k._52I&&k._52I.get(0)!==k&&!k.getStyle(Ge)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var A=this,h=A._52I;return h&&!A.getStyle(Ge)&&h.size()>1&&A===h.get(0)},toggle:function(){this.beginTransaction();var K=this._52I,f=!this.s(Ge);K&&K.size()>1&&(K.each(function(b){b.s(Ge,f)}),K.getSiblings().each(function(E){E!==K&&E.each(function(c){c.fp("edgeGroup",q,E)})})),this.endTransaction()},setStyle:function(g,B){(g===Zf||"edge.segments"===g)&&(B=Ar(B)),Hr.superClass.setStyle.call(this,g,B)},onStyleChanged:function(c){Hr.superClass.onStyleChanged.apply(this,arguments),nk[c]&&Ur(this._41I,this._40I)},getSerializableProperties:function(){var r=Hr.superClass.getSerializableProperties.call(this);return zb(r,{source:1,target:1}),r}});var Om=x.Group=function(){Vq(Om,this)};Qq("Group",Ak,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return Hg},onChildAdded:function(){Om.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){Om.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var H=this;if(!H._54I&&!Lc){var N=H.getChildrenRect();N&&(H._53I=1,H.p(oo(H.s("group.position"),N,H.getSize())),delete H._53I)}},getChildrenRect:function(){var b,v=this;return v.eachChild(function(y){uk(y)&&(b=sm(b,v.getChildRect(y)))}),b},getChildRect:function(Y){var G;return uk(Y)&&Y.s(cp)&&(qq(Y)&&Y.isExpanded()&&Y.eachChild(function(L){G=sm(G,Y.getChildRect(L))}),!G&&Y.getRect&&(G=Y.getRect())),G},setPosition:function(N,j){var P=this;if(!P._54I){var $;$=2===arguments.length?{x:N,y:j}:N,Lc||P._53I||(P._54I=1,Vr(P._children,$.x-P._position.x,$.y-P._position.y),delete P._54I),Om.superClass.setPosition.call(this,$)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(x){var W=this;if(W._57O!==x){var p=W._57O;W._57O=x,W.fp("expanded",p,W._57O),W._fireInvalidateDeep(),W._8I()}},_fireInvalidateDeep:function(){this.eachChild(function(v){qq(v)?v._fireInvalidateDeep():v.iv()})},_8I:function(){Om.superClass._8I.call(this),this.eachChild(function(J){uk(J)&&J._8I()})},onStyleChanged:function(k){Om.superClass.onStyleChanged.apply(this,arguments),"group.position"===k&&this._81I()},getSerializableProperties:function(){var T=Om.superClass.getSerializableProperties.call(this);return T.expanded=1,T}});var tp=x.Camera=function(){Vq(tp,this),this.s({"shadow.cast":!1,"shadow.receive":!1,shape3d:"billboard"}),this._viewMatrix=new Mh.Matrix4,this._projectMatrix=new Mh.Matrix4,this.setScale3d(1,1,-1),this._projectMatrixDirty=!0};tp.CubeDirectionParam=[1,0,0,0,-1,0,-1,0,0,0,-1,0,0,1,0,0,0,1,0,-1,0,0,0,-1,0,0,1,0,-1,0,0,0,-1,0,-1,0],Qq("Camera",Ak,{ms_ac:["cullingMask"],_cullingMask:3,_22Q:function(){return Camera3dUI},attachRenderTarget:function(H){this._projectMatrixDirty=!0,this.renderTarget=H},detachRenderTarget:function(){this._projectMatrixDirty=!0,this.renderTarget=null},isLayerVisible:function($){return Cn(this._cullingMask,$)},isOrtho:function(){return"ortho"===this.s("camera.type")&&!this.isCube()},isCube:function(){return this.renderTarget&&this.renderTarget.isCube()},isPerspective:function(){return!this.isOrtho()},setViewMatrix:function(){var X=new x.Math.Matrix4,k=new x.Math.Euler;return function(R){var E=this;R.isMatrix4?E._viewMatrix.copy(R):E._viewMatrix.fromArray(R),X.getInverse(E._viewMatrix),E.p3(X.getPosition().toArray()),k.set(0,0,0,E.getRotationMode(),!0).setFromRotationMatrix(X),E.r3([k.x,k.y,k.z])}}(),getViewMatrix:function(Z){var b=this,B=vl(null,null,b.r3(),b.getRotationMode(),b.p3()),I=b._viewMatrix;return I.fromArray(B).getInverse(I),I.toArray(Z)},setProjectMatrix:function(K){var R=this;K.isMatrix4?R._projectMatrix.copy(K):R._projectMatrix.fromArray(K),K=R._projectMatrix.getElements(),R.isOrtho()?R.s({"camera.near":(K[14]+1)/K[10],"camera.far":(K[14]-1)/K[10],"camera.ortho.width":2/K[0]}):R.s({"camera.near":K[14]/(K[10]-1),"camera.far":K[14]/(K[10]+1),"camera.fovy":2*Math.atan(1/K[5]),"camera.aspect":K[5]/K[0]}),R._projectMatrixDirty=!1
},onPropertyChanged:function(f){var x=this;tp.superClass.onPropertyChanged.call(x,f);var V=f.property;("s:camera.near"===V||"s:camera.far"===V||"s:camera.fovy"===V||"s:camera.aspect"===V||"s:camera.ortho.width"===V)&&(x._projectMatrixDirty=!0)},getProjectMatrix:function(){var D=this;if(D._projectMatrixDirty){var b=D.gv,p=D.isCube(),x=p?1:D.s("camera.aspect")||(b?b.getAspect():null)||M.graph3dViewAspect,B=D.s("camera.near")||(b?b.getNear():null)||M.graph3dViewNear,l=D.s("camera.far")||(b?b.getFar():null)||M.graph3dViewFar,w=Sj();if(D.isOrtho()){var Q=D.s("camera.ortho.width")||(b?b.getOrthoWidth():null)||M.graph3dViewOrthoWidth,V=Q/2,E=V/x;bk(w,-V,V,-E,E,B,l)}else{var o=p?Math.PI/2:D.s("camera.fovy")||(b?b.getFovy():null)||M.graph3dViewFovy;wl(w,o,x,B,l)}D._projectMatrix.fromArray(w),D._projectMatrixDirty=!1}return D._projectMatrix.toArray()},lookAt:function(l,N){var g=this.p3();return l.x?this.lookAtDirection([l.x-g[0],l.y-g[1],l.z-g[2]],N):this.lookAtDirection([l[0]-g[0],l[1]-g[1],l[2]-g[2]],N)},lookAtDirection:function(){var o=new x.Math.Matrix4,s=new x.Math.Euler,A=new x.Math.Vector3,j=new x.Math.Vector3;return function(T,c){o.lookAtDirection(A.copy(T).multiplyScalar(-1),c?j.copy(c):j.set(0,1,0)),s.set(0,0,0,this.getRotationMode(),!0).setFromRotationMatrix(o),this.r3([s.x,s.y,s.z])}}(),updateAndRender:function(g){return g.syncRenderState(),g.updateScene(),this.render(g)},render:function(y){var P=this,W=y.getGL();if(!W)return!1;var r,O,b=P.renderTarget;if(b)r=b.width,O=b.height;else{var o=y.getDevicePixelRatio();r=y.getWidth()*o,O=y.getHeight()*o}P.gv=y,y._camera=P,y._18Q=null;var i=y._frameState.renderState.glState,Y=i.color.clear.slice(0);Zc(W,P.s("camera.background"));var H=y.getEye;if(y.getEye=function(){return P.p3()},P.isCube())for(var I=tp.CubeDirectionParam,e=0;6>e;e++)b&&b.bind(W,e),P.lookAtDirection([I[6*e+0],I[6*e+1],I[6*e+2]],[I[6*e+3],I[6*e+4],I[6*e+5]]),P.s("camera.clear")!==!1&&W.clear(W.COLOR_BUFFER_BIT),y.setViewport(W,0,0,r,O),P.s("camera.onlySky")?y.renderSky():y.renderScene({renderAxis:P.s("camera.renderAxis"),renderGrid:P.s("camera.renderGrid"),renderEdit:P.s("camera.renderEdit"),renderReflector:!1}),b&&b.unbind(W);else b&&b.bind(W),P.s("camera.clear")!==!1&&W.clear(W.COLOR_BUFFER_BIT),y.overlappingBox.clear(),y.setViewport(W,0,0,r,O),P.s("camera.onlySky")?y.renderSky():y.renderScene({renderAxis:P.s("camera.renderAxis"),renderGrid:P.s("camera.renderGrid"),renderEdit:P.s("camera.renderEdit")}),b&&b.unbind(W);return y.getEye=H,Zc(W,Y),y._18Q=null,y._camera=null,P.gv=null,!0}});var df=x.Block=function(){Vq(df,this),this.s({"shadow.cast":!1,"shadow.receive":!1})};Qq("Block",Ak,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,_scaleMode:"2d",ms_ac:["clickThroughEnabled","syncSize","scaleMode"],getUIClass:function(){return ge},_22Q:function(){return mt},onChildAdded:function(){df.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){df.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},_getBoundingBox:function(){function w(s,K,z){o.fromArray(bg(K));var i=K.getAnchor3d();s.push((new ah).set(0-i.x,0-i.y,0-i.z).applyMatrix4(o).applyMatrix4(z)),s.push((new ah).set(0-i.x,0-i.y,1-i.z).applyMatrix4(o).applyMatrix4(z)),s.push((new ah).set(0-i.x,1-i.y,0-i.z).applyMatrix4(o).applyMatrix4(z)),s.push((new ah).set(0-i.x,1-i.y,1-i.z).applyMatrix4(o).applyMatrix4(z)),s.push((new ah).set(1-i.x,0-i.y,0-i.z).applyMatrix4(o).applyMatrix4(z)),s.push((new ah).set(1-i.x,0-i.y,1-i.z).applyMatrix4(o).applyMatrix4(z)),s.push((new ah).set(1-i.x,1-i.y,0-i.z).applyMatrix4(o).applyMatrix4(z)),s.push((new ah).set(1-i.x,1-i.y,1-i.z).applyMatrix4(o).applyMatrix4(z))}function X(g,v){var P=(new We).makeRotationFromEuler(this.getEuler()).setPosition((new ah).fromArray(this.p3()));P.getInverse(P),g.forEach(function(y){uk(y)&&w(v,y,P)})}var o=new We;return function(t,e){if(t instanceof Ak&&(t=[t]),!t||0===t.length)return q;var e=[];X.call(this,t,e);var V=[1/0,1/0,1/0],x=[-1/0,-1/0,-1/0];return e.forEach(function(I){V[0]=Math.min(I.x,V[0]),V[1]=Math.min(I.y,V[1]),V[2]=Math.min(I.z,V[2]),x[0]=Math.max(I.x,x[0]),x[1]=Math.max(I.y,x[1]),x[2]=Math.max(I.z,x[2])}),{min:V,max:x}}}(),updateFromChildren:function(){var D=this;if(!Lc&&!D._updatingToChildren&&D._syncSize&&0!==D.size()&&!D._freezeSyncFromChildren){var C=this._getBoundingBox(D.toChildren(uk));if(C){D._updatingFromChildren=1;var A=(new ah).fromArray(this.getScale3d()),m=(new ah).fromArray(C.min),$=(new ah).fromArray(C.max),B=M.blockMinSize,a=new ah,G=$.clone().sub(m);0===G.x&&a.setX(.5),0===G.y&&a.setY(.5),0===G.z&&a.setZ(.5);var R=this._width==q||-1===this._width,h=new ah(this.getAnchor3d()),U=A.clone().multiply((new ah).fromArray(this.s3())),V=G.clone();0===V.x&&V.setX(B),0===V.y&&V.setY(B),0===V.z&&V.setZ(B);var x=h.clone().multiply(U),d=x.clone().multiplyScalar(-1).sub(m).divide(V).add(x.divide(V)).add(a),w=this.s("keepPosition");if(R||this._anchorChanged||this._scaleChanged||!w){!R&&w&&(h=d);var s=h.clone().multiply(G).add(m).applyEuler(this.getEuler()).add((new ah).fromArray(this.p3()));this.p3([s.x,s.y,s.z])}else this.setAnchor3d(d.x,d.y,d.z);var J=new ah(1,1,1).divide(A).multiply(G);this.s3(Math.abs(J.x),Math.abs(J.y),Math.abs(J.z)),delete D._updatingFromChildren}}},setPosition:function(N,Y){var M=this;if(!M._updatingToChildren){var A;A=2===arguments.length?{x:N,y:Y}:N,Lc||M._updatingFromChildren||(M._updatingToChildren=1,Vr(M._children,A.x-M._position.x,A.y-M._position.y),delete M._updatingToChildren),df.superClass.setPosition.call(this,A)}},setSize3d:function(){this.beginTransaction(),df.superClass.setSize3d.apply(this,arguments),this.endTransaction()},setTall:function(Y){var U=this;if(!U._updatingToChildren){this.beginTransaction(),Y=E(Y,M.blockMinSize);var K=U.getTall();if(Y!==K&&df.superClass.setTall.call(U,Y),!Lc&&!U._updatingFromChildren){U._updatingToChildren=1;var x=Y/K;U._adjustChildTallOrScale(x,"size"),delete U._updatingToChildren,U.updateFromChildren()}this.endTransaction()}},setWidth:function(F){return this.setSize(F,this.getHeight())},setHeight:function(E){return this.setSize(this.getWidth(),E)},setSize:function(f,T){var U=M.blockMinSize;f=E(f,U),T=E(T,U);var e=this;if(!e._updatingToChildren){2!==arguments.length&&(T=f.height,f=f.width),this.beginTransaction();var X=e.getWidth(),d=e.getHeight();if(f!==X&&df.superClass.setWidth.call(e,f),T!==d&&df.superClass.setHeight.call(e,T),!Lc&&!e._updatingFromChildren){e._updatingToChildren=1;var G=f/X,K=T/d;e._adjustChildScaleOrSize(G,K,"size"),delete e._updatingToChildren,e.updateFromChildren()}this.endTransaction()}},_adjustChildScaleOrSize:function(v,A,g){var y=this;if(y._syncSize){var z=y.getPosition(),f=y.getRotation();y.eachChild(function(d){if(uk(d)){var t=d.getPosition(),R=d.getRotation(),k=d.getWidth(),N=d.getHeight(),r=d.getScale(),n=r.x*k,U=r.y*N;if(0!==n&&0!==U){0>v*A&&d.setRotation(-1*R);var H=new rd(R,t.x,t.y,n,U);H.translate(-z.x,-z.y),H.rotate(-f),R=Cl(H.b*Math.sign(n),H.a*Math.sign(n)),H.scale(v,A);var l,B,W,e=O(R);if(Math.abs(e)<.001?(l=o(R),B=H.b/l,W=-H.c/l):(B=H.a/e,W=H.d/e),"scale"===g)d.setScale(B/k,W/N);else if("size"===g){var h=B/r.x,C=W/r.y;d.setScale(Vb(B)*Math.abs(r.x),Vb(W)*Math.abs(r.y)),d instanceof x.Shape?(d.setWidthForce(Math.max(Math.abs(h),1e-5)),d.setHeightForce(Math.max(Math.abs(C),1e-5))):d.setSize(Math.max(.01,Math.abs(h)),Math.max(.01,Math.abs(C)))}H.rotate(f),H.translate(z.x,z.y),d.setPosition(H.tx,H.ty)}}})}},_calcChangeFactor:function(y,r,u,T){var c,n,O,J;return c=D(y),n=D(u),O=c>n?c/n:n/c,c=D(r),n=D(T),J=c>n?c/n:n/c,E(O,J)},setElevation:function(j){var n=this;if(!n._updatingToChildren){var O=n.getElevation(),v=j-O;0!==v&&(Lc||n._updatingFromChildren||(n._updatingToChildren=1,Vr(n._children,0,v,0),delete n._updatingToChildren),df.superClass.setElevation.apply(n,arguments))}},setScaleTall:function(Q){var d=this;if(!d._updatingToChildren){var b=d.getScaleTall();if(D(Q)<.01&&(Q=.01*(Vb(Q)||Vb(b))),"3d"===d._scaleMode){var x=d.getScale();return d.setScale3d(x.x,Q,x.y),void 0}if(df.superClass.setScaleTall.call(d,Q),!Lc&&!d._updatingFromChildren){d._updatingToChildren=1;var l=Q/b;d._adjustChildTallOrScale(l,"scale"),delete d._updatingToChildren,d._scaleChanged=1,this.updateFromChildren(),delete d._scaleChanged}}},_adjustChildTallOrScale:function(r,m){var $=this;if($._syncSize){var u=$.getElevation();$.eachChild(function(H){if(uk(H)){if("size"===m){var S=H.getTall();0>r&&H.setScaleTall(-1*H.getScaleTall()),H.setTall(Math.max(.01,Math.abs(S*r)))}else{var U=H.getScaleTall();H.setScaleTall(U*r)}H.setElevation(u+(H.getElevation()-u)*r)}})}},setAnchor3d:function(){if(!this._updatingToChildren){this.beginTransaction();var $=df.superClass.setAnchor3d.apply(this,arguments);return $&&!Lc&&!this._updatingFromChildren&&this._syncSize&&(this._anchorChanged=1,this.updateFromChildren(),delete this._anchorChanged),this.endTransaction(),$}},setAnchor:function(){var w=this;if(!w._updatingToChildren){var t=w.getAnchor(),D=df.superClass.setAnchor.apply(w,arguments);if(Lc||w._updatingFromChildren||!w._syncSize)return D;w._updatingToChildren=1;var S=w.getAnchor(),O=w.getSize(),b=O.width*(t.x-S.x),G=O.height*(t.y-S.y),Y=(new We).compose(new ah,this.getQuaternion(),new ah(this.getScale3d())),T=new ah(b,0,G).applyMatrix4(Y);return w.eachChild(function(o){if(uk(o)){var M=new ah(o.p3());o.p3(M.add(T).toArray())}}),delete w._updatingToChildren,D}},setAnchorElevation:function(){var y=this;if(!y._updatingToChildren){var S=y.getAnchorElevation(),$=df.superClass.setAnchorElevation.apply(y,arguments);if(Lc||y._updatingFromChildren||!y._syncSize)return $;y._updatingToChildren=1;var j=y.getAnchorElevation(),f=y.getTall()*(S-j),_=(new We).compose(new ah,this.getQuaternion(),new ah(this.getScale3d())),p=new ah(0,f,0).applyMatrix4(_);return y.eachChild(function(k){if(uk(k)){var P=new ah(k.p3());k.p3(P.add(p).toArray())}}),delete y._updatingToChildren,$}},setRotation:function(l){this._updateChildrenRotation3d("rotation",l)},setRotationX:function(u){this._updateChildrenRotation3d("rotationX",u)},setRotationZ:function(m){this._updateChildrenRotation3d("rotationZ",m)},setRotation3d:function(){var P=this;if(!P._updatingToChildren){var K=P.r3();df.superClass.setRotation3d.apply(P,arguments);var S=P.r3();Lc||P._updatingFromChildren||(P._updatingToChildren=1,P.eachChild(function(y){uk(y)&&y.syncRotation3d(P,S,K)}),delete P._updatingToChildren)}},_updateChildrenRotation3d:function(p,I){var C=this;if(!C._updatingToChildren){var y=C[Ld(p)]();df.superClass[Lg(p)].call(C,I),Lc||C._updatingFromChildren||this._updateRotationToChildren(p,I-y)}},_updateRotationToChildren:function(_,Q){var n=this;n._updatingToChildren=1,n.eachChild(function(k){uk(k)&&k._11Q(n,_,Q)}),delete n._updatingToChildren},setScale:function(T,x){var R=this;if(!R._updatingToChildren){null==x&&(x=T.y,T=T.x);var I=R.getScale();if(D(T)<.01&&(T=.01*(Vb(T)||Vb(I.x))),D(x)<.01&&(x=.01*(Vb(x)||Vb(I.y))),"3d"===R._scaleMode)return R.setScale3d(T,R.getScaleTall(),x),void 0;if(df.superClass.setScale.call(R,T,x),!Lc&&!R._updatingFromChildren){R._updatingToChildren=1;var s=T/I.x,C=x/I.y;R._adjustChildScaleOrSize(s,C,"scale"),delete R._updatingToChildren,R._scaleChanged=1,R.updateFromChildren(),delete R._scaleChanged}}},onPropertyChanged:function(G){df.superClass.onPropertyChanged.call(this,G),"s:3d.visible"===G.property&&this._invalidateChildrenBatch()},_invalidateChildrenBatch:function(){this.eachChild(function(I){(I.s("batch")||I.s("wf.geometry")||I.s("wf.visible"))&&I.iv(),I instanceof df&&I._invalidateChildrenBatch()})},getSerializableProperties:function(){var X=df.superClass.getSerializableProperties.call(this);return X.clickThroughEnabled=1,X.syncSize=1,X.scaleMode=1,X},setScale3d:function(){var c=new ah,l=new ah,n=new ah,t=new We,s=new Qo,o=new ah;return function(q,g,$){var u,i=this;if(u="number"==typeof q?{x:q,y:g,z:$}:q.length?{x:q[0],y:q[1],z:q[2]}:q,"3d"!==i._scaleMode)return df.superClass.setScale3d.apply(i,arguments),void 0;if(i._syncSize&&0!==i.size()){var A=i.getMatrix4();A.getInverse(A),df.superClass.setScaleTall.call(i,u.y),df.superClass.setScale.call(i,u.x,u.z);var O=i.getMatrix4();Lc||i._updatingFromChildren||(i._updatingToChildren=1,i.eachChild(function(v){if(uk(v)){if(l.fromArray(v.s3()),v instanceof x.Polyline){var k=v.getThickness();l.x=l.x||k,l.y=l.y||k,l.z=l.z||k,o.copy(v.getScale3d()).multiplyScalar(k),v.getQuaternion(s),c.copy(v.p3()),n.copy(v.getFinalScale3d()),n.x=n.x||o.x,n.y=n.y||o.y,n.z=n.z||o.z,t.compose(c,s,n)}else v.getMatrix4(t);t.premultiply(A).premultiply(O),t.decompose(c,s,n),n.divide(l),v.setQuaternion(s),v.p3(c.toArray()),v.setScale3d(n.toArray())}}),delete i._updatingToChildren,i._scaleChanged=1,i.updateFromChildren(),delete i._scaleChanged)}}}()});var zj=x.Grid=function(){Vq(x.Grid,this)};Qq("Grid",Ak,{IRotatable:!1,_icon:"grid_icon",_image:q,getUIClass:function(){return or},setRotation:function(){},getCellRect:function(K,$){var m=this,w=m.s("grid.row.count"),e=m.s("grid.column.count");if(0>=w||0>=e||0>K||K>=w||0>$||$>=e)return q;var W,J,G,x=m.getRect(),i=m.s("grid.row.percents"),R=m.s("grid.column.percents");if(bq(x,m,"grid.border",-1),i&&i._as&&(i=i._as),R&&R._as&&(R=R._as),i&&i.length===w){for(G=0,W=0;K>W;W++)G+=x.height*i[W];x.y+=G,x.height=x.height*i[K]}else x.height=x.height/w,x.y+=x.height*K;if(R&&R.length===e){for(J=0,W=0;$>W;W++)J+=x.width*R[W];x.x+=J,x.width=x.width*R[$]}else x.width=x.width/e,x.x+=x.width*$;return Ti(x,-m.s("grid.gap")),x}});var Tn=x.Text=function(){Vq(Tn,this),this.setSize(100,50),this.s("text","TEXT")};Qq("Text",Ak,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return Vl},setWidth:function(J){J||(J=.001),Tn.superClass.setWidth.call(this,J)},setHeight:function(O){O||(O=.001),Tn.superClass.setHeight.call(this,O)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),Ef("__text__",{width:{value:100,isSafeFunc:!0,func:function(h){return h?h._width:100}},height:{value:50,isSafeFunc:!0,func:function(X){return X?X._height:50}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"},gradient:{func:"style@text.gradient"},gradientColor:{func:"style@text.gradient.color"},gradientPack:{func:"style@text.gradient.pack"},decoration:{func:"style@text.decoration"},vertical:{func:"style@text.vertical"},verticalGap:{func:"style@text.vertical.gap"},wrap:{func:"style@text.wrap"},letterGap:{func:"style@text.letter.gap"},borderWidth:{func:"style@text.border.width"},borderColor:{func:"style@text.border.color"}}]});var cg=x.Shape=function(){Vq(cg,this),this._59O=new lo};cg.__de__=An,Qq("Shape",Ak,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return Wm},_22Q:function(){return ot},getLength:function(r){return oi(gi(this._59O,this._58O,r,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var U=this._58O;return U?new lo(U._as.slice(0)):U},setSegments:function(_){var p=this._58O;_=_?bj(_)?new lo(_.slice(0)):new lo(_._as.slice(0)):null,(p&&_&&p._as.join(",")!==_._as.join(",")||p!==_)&&(this._58O=_,this.fp("segments",p,_))},getPoints:function(){return this._59O},toPoints:function(){var E=this._59O;return new lo(E._as.slice(0))},getPointsMatrix2d:function(){var Y=this,k=new Mh.Matrix2d,H=Y.getPosition(),L=Y.getScale(),$=Y.getRotation();return k.translate(-H.x,-H.y).scale(L.x,L.y).rotate($).translate(H.x,H.y),k},getPointsMatrix3d:function(){return function(){var c=this,L=new Mh.Matrix4,l=L.getElements(),Y=c.p3();Um(l,Y),Ah(l,c.getFinalRotation3d(),c.getRotationMode());var J=c.getScale3d(),x=c._dynamicScale3d;return x&&(J[0]*=x[0],J[1]*=x[1],J[2]*=x[2]),xh(l,J),Um(l,qj(Y)),L}}(),setPoints:function(E,U){var u=this,R=u._59O;E=E?bj(E)?new lo(E.slice(0)):new lo(E._as.slice(0)):new lo;var a,k,P,b,V,n;U&&(a=u.getPosition(),n=new rd(u.getRotation(),0,0,u.getScale().x,u.getScale().y)),(R&&E&&R._as.join(",")!==E._as.join(",")||R!==E)&&(u._59O=E,u.fs(),u.fp("points",R,E)),U&&(k=u.getPosition(),P=k.x-a.x,b=k.y-a.y,V=n.tf(P,b),u.setPosition(k.x-P+V.x,k.y-b+V.y))},setPoints3d:function(A,F){var D=new ah(this.p3()),l=this.getPointsMatrix3d();if(l.setPosition(new ah),Oq.superClass.setPoints.call(this,A),F){var M=new ah(this.p3()),y=M.clone().sub(D).applyMatrix4(l);D.add(y),this.p3(D.x,D.y,D.z)}},addPoint:function(M,J,E){var a=this.toPoints();a.add(M,J),this.setPoints(a,E)},setPoint:function(z,p,s){var B=this.toPoints();B.set(z,p),this.setPoints(B,s)},removePointAt:function(a){var y=this.toPoints();y.removeAt(a),this.setPoints(y)},setWidthForce:function(Z){var e=this;if(!e._55I&&!Lc&&e.getWidth()){e._55I=1;var m=e._position.x,U=Z/e.getWidth(),D=e.toPoints(),s=new lo;1!==U&&(D.each(function(L){s.add({x:(L.x-m)*U+m,y:L.y,e:L.e})}),e.setPoints(s),Uc(e,[U,0,0,1,m*(1-U),0]),e.fs()),delete e._55I}cg.superClass.setWidth.call(e,Z)},setWidth:function(B){return this.setWidthForce(Qd>B?Qd:B)},setHeightForce:function(Q){var z=this;if(!z._55I&&!Lc&&z.getHeight()){z._55I=1;var n=z._position.y,a=Q/z.getHeight(),u=z.toPoints(),F=new lo;1!==a&&(u.each(function(Y){F.add({x:Y.x,y:(Y.y-n)*a+n,e:Y.e})}),z.setPoints(F),Uc(z,[1,0,0,a,0,n*(1-a)]),z.fs()),delete z._55I}cg.superClass.setHeight.call(z,Q)},setHeight:function(r){return this.setHeightForce(Qd>r?Qd:r)},setAnchorElevation:function(E){var t=this;t._55I=!0;var s=t._updatingAnchor3d,T=!Lc&&!s;if(T){var Y,m=E,Z=t.getAnchorElevation(),P=t.getTall();Y=P*(Z-m),0!==Y&&t.shiftPointsElevation(Y)}var _=cg.superClass.setAnchorElevation.apply(t,arguments);return s||delete t._55I,_},getShapeElevation:function(){var B=this,P=B._54O;return P-(B.getTall()||0)*(B._anchorElevation-.5)},setAnchor3d:function(G,h,A,q){var M,l=this;if("number"==typeof G?M={x:G,y:h,z:A}:(M=G.length?{x:G[0],y:G[1],z:G[2]}:G,q=h),l._55I=!0,l._updatingAnchor3d=!0,l.beginTransaction(),!Lc){var S=l.getAnchor3d(),T=l.getSize(),r=l.getTall(),z=T.width*(S.x-M.x),P=T.height*(S.z-M.z),k=r*(S.y-M.y);q||l.shiftPoints(z,P,k);var x=l.p3()}var s=cg.superClass.setAnchor3d.apply(l,arguments);if(!Lc&&q){var X=l.p3();l.shiftPoints(X[0]-x[0]+z,X[2]-x[2]+P,X[1]-x[1]+k)}return l.endTransaction(),delete l._updatingAnchor3d,delete l._55I,s},setAnchor:function(M,m,k){var E=this;E._55I=!0;var Z=E._updatingAnchor3d,V=!Lc&&!Z;if(V){var q,J,x;"number"==typeof M?x={x:M,y:m}:(x=M.length?{x:M[0],y:M[1]}:M,k=m);var X=E.getAnchor(),o=E.getSize();q=o.width*(X.x-x.x),J=o.height*(X.y-x.y),k||E.shiftPoints(q,J);var H=E.getPosition()}var I=cg.superClass.setAnchor.apply(E,arguments);if(V){var U=E.getPosition();k&&E.shiftPoints(U.x-H.x+q,U.y-H.y+J)}return Z||delete E._55I,I},shiftPoints:function(K,i,Z){if(K||i||Z){var b=this,Q=b.getElevation()||0,F=b.toPoints(),X=new lo;F.each(function(P){var H=P.e;Z&&(H=(H==q?Q:H)+Z),X.add({x:P.x+K,y:P.y+i,e:H})}),b.setPoints(X),b.fs()}},shiftPointsElevation:function(o){return this.shiftPoints(0,0,o)},setPosition:function(k,A){var q,b=this;if(!b._28Q){if(b._28Q=1,!b._55I&&!Lc){q=2===arguments.length?{x:k,y:A}:k;var Y=q.x-b._position.x,o=q.y-b._position.y;if(0===Y&&0===o)return delete b._28Q,void 0;b._55I=1,b.shiftPoints(Y,o),Uc(b,[1,0,0,1,Y,o]),delete b._55I}cg.superClass.setPosition.apply(b,arguments),delete b._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var Y=this;if(2!==Y._59O.size())return!1;var N=Y._58O;return N?2===N.size()&&1===N.get(0)&&2===N.get(1)?!0:!1:!0},fireShapeChange:function(){var y=this;if(!y._55I&&!Lc){var T=vn(y._59O);T&&(y._55I=1,y.setRect(T),delete y._55I)}y.fp(Xi,!1,!0)},getSerializableProperties:function(){var a=cg.superClass.getSerializableProperties.call(this);return a.segments=1,a.points=1,a.thickness=1,a.closePath=1,a}});var Lr=x.Points=function(){Vq(Lr,this)};Qq("Points",Ak,{_59O:[],_colors:[],_sizes:[],_uvoffsets:[],_22Q:function(){return pt},getPoints:function(){return this._59O},setPoints:function(r){var j=this._59O;r=r?r.slice(0):[];var I=r[0];if(xe(I)){var R=r;r=[];for(var e=0,v=R.length;v>e;e+=3)r.push({x:R[e],e:R[e+1],y:R[e+2]})}this._59O=r,this._pointsDirty=!0,this.fp("points",j,this._59O)},setPoint:function(q,p){var R=this._59O.slice(0);R[q]=p,this.setPoints(R)},addPoint:function(K){this.setPoint(this._59O.length,K)},getColors:function(){return this._colors},setColors:function(W){var H=this._colors;W=W?W.slice(0):[],this._colors=W,this._colorsDirty=!0,this.fp("colors",H,W)},setPointColor:function(O,o){var J=this._colors.slice(0);J[O]=o,this.setColors(J)},getSizes:function(){return this._sizes},setSizes:function(u){var U=this._sizes;u=u?u.slice(0):[],this._sizes=u,this._sizesDirty=!0,this.fp("sizes",U,this._sizes)},setPointSize:function(J,F){var j=this._sizes.slice(0);j[J]=F,this.setSizes(j)},getUvoffsets:function(){return this._uvoffsets},setUvoffsets:function(d){var M=this._uvoffsets;d=d?d.slice(0):[],this._uvoffsets=d,this._offsetsDirty=!0,this.fp("uvoffsets",M,this._uvoffsets)},setPointUvoffset:function(w,n,g){var x;"object"==typeof n?(x=n[0],g=n[1]):x=n;var p=this._uvoffsets.slice(0);p[2*w+0]=x,p[2*w+1]=g,this.setUvoffsets(p)},getPointInfo:function(j){var S=this.getPoints();if(!S||S[j]==q)return q;var I=S[j],$=[I.x,I.e,I.y],K=this.mat||bg(this),X=[$[0],$[1],$[2]];Vk(X,K);var w=this.getColors(),Y=w[j]||this.s("points.color"),u=this.getSizes(),v=u[j];return{size:v==q?this.s("points.size"):v,color:Y,local:$,world:X}},getSerializableProperties:function(){var K=Lr.superClass.getSerializableProperties.call(this);return K.points=1,K.colors=1,K.sizes=1,K.uvoffsets=1,K},onPropertyChanged:function(j){Lr.superClass.onPropertyChanged.call(this,j);var x=j.property;"s:points.color"===x?this._colorsDirty=!0:"s:points.size"===x?this._sizesDirty=!0:"s:points.model"===x&&(this._modelDirty=!0)},getWidth:function(){var e=this;if(e._width>=0)return e._width;var h=e.getStyle("points.model");if(h){var I=Pd(h);if(I&&I.rawS3)return I.rawS3[0]}return 1},getHeight:function(){var l=this;if(l._height>=0)return l._height;var t=l.getStyle("points.model");if(t){var Q=Pd(t);if(Q&&Q.rawS3)return Q.rawS3[2]}return 1},getTall:function(){var D=this;if(D._tall>=0)return D._tall;var J=D.getStyle("points.model");if(J){var i=Pd(J);if(i&&i.rawS3)return i.rawS3[1]}return 1}});var Oq=x.Polyline=function(){Vq(Oq,this),this.s({"shape.background":null,"shape.border.width":2})};Qq("Polyline",cg,{_icon:"polyline_icon",_22Q:function(){return st},getUIClass:function(){return nn},setClosePath:function(){},setTall:function(Y){var j=this;if(j.beginTransaction(),!j._55I&&!j._24Q&&!Lc&&j.getTall()){j._24Q=1;var y=j._54O,n=Y/j.getTall();if(1!==n){var X=j.toPoints(),O=new lo;X.each(function(P){O.add({x:P.x,y:P.y,e:P.e==q?P.e:(P.e-y)*n+y})}),j.setPoints(O),j.fs()}delete j._24Q}Oq.superClass.setTall.call(j,Y),j.endTransaction()},setElevation:function(g){var _=this;if(_.beginTransaction(),!_._55I&&!_._24Q&&!Lc){_._24Q=1;var Q=g-_._54O;0!==Q&&_.shiftPointsElevation(Q),delete _._24Q}Oq.superClass.setElevation.apply(_,arguments),_.endTransaction()},fireShapeChange:function(){var N=this,J=N._59O;if(!N._55I&&!N._24Q&&!Lc){var C=J.size();if(C){var X=1,O=J.get(0),i=N._54O;O.e==q&&(O.e=i);for(var G=O.e,a=0;C>X;X++){O=J.get(X),O.e==q&&(O.e=i);var F=e(G,O.e),v=E(G+a,O.e);G=F,a=v-F}N._24Q=1,N.setTall(a),N.setElevation(G+a*N._anchorElevation),delete N._24Q}}Oq.superClass.fireShapeChange.apply(N,arguments)},onPropertyChanged:function(){var R={};return["points","segments","thickness","position","elevation","rotation","rotationX","rotationZ","rotationMode","scale","scaleTall","s:shape.border.color","s:shape.border.gradient.color","s:shape.border.pattern","s:shape.dash","s:shape.dash.color","s:shape.dash.pattern","s:shape.dash.offset","s:shape.dash","s:shape.dash","s:3d.clip.direction","s:repeat.uv.length","s:body.color","s:shape3d","s:shape3d.visible","s:shape3d.image","s:shape3d.smooth","s:shape3d.resolution","s:shape3d.color","s:shape3d.blend","s:shape3d.side","s:shape3d.start.angle","s:shape3d.sweep.angle","s:shape3d.top.cap","s:shape3d.top.image","s:shape3d.top.visible","s:shape3d.top.color","s:shape3d.bottom.cap","s:shape3d.bottom.image","s:shape3d.bottom.visible","s:shape3d.bottom.color","s:shape3d.from.visible","s:shape3d.from.color","s:shape3d.to.visible","s:shape3d.to.color","s:shape3d.uv.union"].forEach(function(H){R[H]=!0}),function(X){Oq.superClass.onPropertyChanged.call(this,X),R[X.property]&&(this._needChangeGeometry=!0)}}()});var Vj=x.SubGraph=function(){Vq(Vj,this)};Qq("SubGraph",Ak,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){Vj.superClass._8I.call(this),this.eachChild(function(E){uk(E)&&E._8I()})}}),M.loadingRefGraph=0;var bo=x.RefGraph=function(){Vq(bo,this)};Qq("RefGraph",df,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(v){var T=this._ref;this._ref=v,this.fp("ref",T,v),this.updateRef()},_21I:function(){bo.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var B=this;if(M.loadingRefGraph++,B.clearChildrenFromDataModel(),M.loadingRefGraph--,B._ref&&B._dataModel){B._xhrLoadHandler&&(B._xhrLoadHandler.cancel=!0);var L=Lc,J=B._xhrLoadHandler=function(f){if(f&&B._dataModel){M.loadingRefGraph++;var j=B._pendingUpdateInfo={needToRestore:L};L&&(j.p3=B.p3(),j.s3=B.s3(),j.r3=B.r3(),j.anchor3d=B.getAnchor3d(),j.scale3d=B.getScale3d()),B.r3(0,0,0),B.setScale3d(1,1,1),B.setAnchor3d(.5,.5,.5),B.p3(0,0,0);var O=M.parse(f),F=B._dataModel.deserialize(O,B,{justDatas:!0});F.each(function(f){f._refGraph=B}),B.checkPendingUpdateInfo(),M.loadingRefGraph--,M.handleRefGraphLoaded(B,F,O)}};J.xhrLoadCalled=!1,M.load(B._ref,function(i){J.cancel||(J.xhrLoadCalled?J(i):Mi(function(){J(i)}))}),J.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var i=this,o=i._pendingUpdateInfo;if(!o)return i.onPendingUpdated&&(M.loadingRefGraph++,i.onPendingUpdated(),M.loadingRefGraph--),void 0;var t=!0;this.eachChild(function(e){(e._pendingCheckImageJSON||e._pendingUpdateInfo)&&(t=!1)}),t&&(M.loadingRefGraph++,i._pendingUpdateInfo=null,i.updateFromChildren(),o.needToRestore&&(i.setAnchor3d(o.anchor3d),i.setScale3d(o.scale3d),i.r3(o.r3),i.p3(o.p3)),this.getParent()instanceof bo&&this.getParent().checkPendingUpdateInfo(),i.onPendingUpdated&&i.onPendingUpdated(),M.loadingRefGraph--)},getSerializableProperties:function(){var k=bo.superClass.getSerializableProperties.call(this);return k.ref=1,k}}),x.EdgeGroup=function(l,U){this._70O=l,this._siblings=U;for(var E,Y,g=0,v=l.size(),$=T[Ge];v>g;g++)if(E=l.get(g).getStyle(Ge,!1),E!=q){$=E;break}$==q&&($=!0);var u=M.edgeGroupAgentFunc;for(u&&(Y=u(l),Y&&Y!==l.get(0)&&(l.remove(Y),l.add(Y,0))),g=0;v>g;g++)l.get(g).s(Ge,$)},Qq("EdgeGroup",u,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(e){return this._70O.get(e)},indexOf:function(c){return this._70O.indexOf(c)},each:function(n,L){this._70O.each(n,L)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(K,F){this._siblings.each(function(c){c._70O.each(K,F)})}});var aj=function(o,m,u){var O=Ff[o]={type:o,action:m};if(u)for(var k in u)O[k]=u[k]};zb(M,{setConnectAction:aj,getConnectAction:function(X,k){if(!k){if(!X)return null;k=X.getCurrentConnectActionType()}return Ff[k]},doConnectAction:function(J,L,s,p){p=p||J.getCurrentConnectActionType();var V=Ff[p];if(!V)return!1;var c=V.action;return c?(L instanceof hf.Group?J.sm().getSelection().each(function(B){c.call(null,J,B,s)}):c.call(null,J,L,s),!0):!1},doDeleteConnectionAction:function(S,l,M){M=M||S.getCurrentConnectActionType();var A=Ff[M];if(!A||!A.delete)return!1;var W=A.delete.action;return W?(l instanceof hf.Group?S.sm().getSelection().each(function(H){W.call(null,S,H)}):W.call(null,S,l),!0):!1}});var ci=x.JSONSerializer=function(w,S){this.dm=this._dataModel=w,this._hierarchical=M.forceHierarchicalSerialization?!0:S==q?w.isHierarchicalRendering():S};Qq("JSONSerializer",u,{ms_ac:["hierarchical"],serialize:function(A){return M.stringify(this.toJSON(),A)},toJSON:function(){var N,k=this,Y=k.dm,b=Y.getRoots(),z=k.json={v:M.getVersion(),p:{},a:{},d:[]},o=Y.getSerializableAttrs();(N=Y.getInit())&&(z.init=N),(N=Y.getName())&&(z.p.name=N),(N=Y.getBackground())&&(z.p.background=N),(N=Y.getLayers())&&(z.p.layers=N),(N=Y.getEnvmap())&&(z.p.envmap=N),(N=Y.getEnvmapType())&&(z.p.envmapType=N),z.p.autoAdjustIndex=Y.isAutoAdjustIndex(),z.p.hierarchicalRendering=Y.isHierarchicalRendering();for(var r in o){var f=Y.a(r);f!==A&&k[$o](r,f,z.a)}return Er(z.a)&&delete z.a,k._hierarchical?b.each(k.serializeData,this):Y.each(function(M){k.serializeData(M)}),Y.fireSerializeEvent({type:"serialize",json:z}),Y.getPostProcessingData()&&(z.p.postProcessingData=Y.getPostProcessingData()),z},isSerializable:function(){return!0},getProperties:function(n){return n.getSerializableProperties()},getStyles:function(Q){return Q.getSerializableStyles()},getAttrs:function(h){return h.getSerializableAttrs()},serializeData:function(e){var b=this;if(b.isSerializable(e)&&!e._refGraph){var l,O,D,m,V,C,a=jq(e.getClassName())||e.getClass(),n=new a,h={c:e.getClassName(),i:e.getId(),p:{},s:{},a:{}};b.json.d.push(h),l=b.getProperties(e);for(O in l)if(/^_/.test(O)){if(D=e[O],!("_width"!==O&&"_height"!==O||D!=q&&-1!==D)){if(V==A){var Q;C=(e.s("layout.h")||e.s("layout.v"))&&e.getHost()||e instanceof x.Node&&(Q=e.getParent())&&Q instanceof x.Block||e.s("fullscreen"),V=e.hasInheritedSize()}C&&V&&(D=e[O]="_width"===O?e.getWidth():e.getHeight())}D!==n[O]&&b[$o](O.substr(1),D,h.p)}else m=Ld(O),e[m]&&(D=e[m](),D!==n[m]()&&b[$o](O,D,h.p));l=b.getStyles(e);for(O in l)D=e.s(O),D!==n.s(O)&&b[$o](O,D,h.s);l=b.getAttrs(e);for(O in l)D=e.a(O),D!==n.a(O)&&b[$o](O,D,h.a);Er(h.p)&&delete h.p,Er(h.s)&&delete h.s,Er(h.a)&&delete h.a}b._hierarchical&&e.getChildren().each(b.serializeData,b)},serializeValue:function(O,c,h){Bd(c)?c={__a:c._as}:c instanceof Vp?c={__i:c.getId()}:c instanceof Xl&&(c={__dm:c.serialize(0)}),h[O]=c},deserialize:function(V,I,o){var b=this;return ro(V)&&/.json$/.test(V)?(M.xhrLoad(V,function(d){b.deserializeImpl(d,I,o)}),void 0):b.deserializeImpl(V,I,o)},deserializeImpl:function(w,S,c){var B=this,L=B.dm;L.setDeserializing(!0),c=_k(c)?{setId:c}:hc(c)?{finishFunc:c}:c||{},w=B.json=ro(w)?M.parse(w):w,!c.justDatas&&w.a&&w.a.onPreDeserialize&&!c.disableOnPreDeserialize&&w.a.onPreDeserialize(w,L,c.view),L.beginTransaction(),Lc++,B._82I={};var n=new lo,K=new lo,V=0,D=w.d.length;if(c.justDatas||(!c.disableInit&&hc(w.init)&&w.init(L),L.setInit(w.init)),!c.justDatas){for(var m in w.a)L.a(m,B[qe](w.a[m]));for(var W in w.p)L[Lg(W)](w.p[W])}for(;D>V;V++){var U=w.d[V],R=jq(U.c),C=new R,$=U.i;c.setId&&$!=q&&(C._id=$),B._82I[$]=C,n.add(C),K.add(U)}for(V=0;D>V;V++)B.deserializeData(n.get(V),K.get(V));return n.each(function(n){S&&!n.getParent()&&n.setParent(S),L.add(n)}),c.__innerHandler__&&c.__innerHandler__(w,L,c.view,n),L.fireSerializeEvent({type:"deserialize",json:w}),Lc--,vb||L.each(function(T){T instanceof Ak&&T.updateLayoutAttaches()}),L.endTransaction(),!c.justDatas&&w.a&&w.a.onPostDeserialize&&!c.disableOnPostDeserialize&&w.a.onPostDeserialize(w,L,c.view,n),c.finishFunc&&c.finishFunc(w,L,c.view,n),L.setDeserializing(!1),n},deserializeData:function(y,U){for(var B in U.p)y[Lg(B)](this[qe](U.p[B]));for(B in U.s)y.s(B,this[qe](U.s[B]));for(B in U.a)y.a(B,this[qe](U.a[B]))},deserializeValue:function(s){if(fg(s)){var p=s.__i;if(p!=q)return this._82I[p];if(p=s.__dm,p!=q){var A=new x.DataModel;return A.deserialize(p),A}if(p=s.__a,bj(p))return new lo(p)}return s}}),zb(Xl,{serialize:function(Y,T){return new ci(this,T).serialize(Y)},toJSON:function(D){return new ci(this,D).toJSON()},deserialize:function(x,b,c){return new ci(this).deserialize(x,b,c)}});var Xd=x.OverlappingBox=function(o){this.gv=o,this.boxes={}};Qq("OverlappingBox",u,{clear:function(){var $,A,L=this.boxes;
for($ in L)A=L[$],A.length=0},isOverlapping:function(g,f){var l,M,Q=this,d=Q.boxes,T=d[g];T?(l=T.rects,M=T.length):T=d[g]={rects:l=[],length:M=0};var s,J,f;for(s=0;M>s;s++)if(J=l[s],J.x<f.x+f.w&&J.x+J.w>f.x&&J.y<f.y+f.h&&J.h+J.y>f.y)return!0;return l.length<=M?(l.push(f),T.length++):l[T.length++]=f,!1}}),zb(M,{fetch:function(G,_){_=_||{},G.open(_.method||"GET",_.url||"",!(null!=_.sync?_.sync:!1)),"json"===_.dataType&&G.setRequestHeader("Content-Type","application/json"),_.responseType&&(G.responseType=_.responseType),G.send(_.data)},convertImageSrc:function(h,k){k&&"function"==typeof k||(k=function(){}),k(h)}});var Gd=x.Request=function(){};Qq("Request",u,{_mimeType:A,getXhr:function(){return this._xhr||(this._xhr=new XMLHttpRequest,this.overrideMimeType("text/plain")),this._xhr},send:function(v){var n=this.getXhr();v.mimeType&&this.overrideMimeType(v.mimeType),n.onload=this.onload,n.onerror=this.onerror,M.fetch(n,v)},onload:function(){},onerror:function(){},getResponseType:function(){return this.getXhr().responseType},setOverrideMimeType:function(Z){this.overrideMimeType(Z)},getMimeType:function(){return this._mimeType},overrideMimeType:function(e){this.getXhr().overrideMimeType(this._mimeType=e)},getResponseHeader:function(t){return this.getXhr().getResponseHeader(t)},getResponseText:function(){var p=this.getXhr();return p.response||p.responseText},getStatus:function(){return this.getXhr().status}}),Tq.GraphView=function(p){var m=this;m._24I={},m._34I=new lo,m.enableDirtyRect(),m._25I={},m._56I={},m._view=bn(1,m),m._canvas=rs(m._view),m.dm(p?p:new Xl),this._coreInteractor=new nb(this),m.setEditable(!1),m.setScrollBarVisible(M.graphViewScrollBarVisible),m._initView()},cl("GraphView",u,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[Vd,Ij,Ig,Lh,"resettable","editInteractor",Yh,"zoomable","pannable","rectSelectable","autoScrollZone",_q,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_zoomable:M.graphViewZoomable,_resettable:M.graphViewResettable,_pannable:M.graphViewPannable,_rectSelectable:M.graphViewRectSelectable,_autoScrollZone:M.graphViewAutoScrollZone,_rectSelectBackground:M.graphViewRectSelectBackground,_rectSelectBorderColor:M.graphViewRectSelectBorderColor,_editPointSize:M.graphViewEditPointSize,_editPointBorderColor:M.graphViewEditPointBorderColor,_editPointBackground:M.graphViewEditPointBackground,_scrollBarColor:lg,_scrollBarSize:Jp,_autoHideScrollBar:yi,_autoMakeVisible:_f,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(R){this._dataModel.setLayers(R)},setEditable:function(G){var t=this,z=t.__interactorMap__;if(!z){var A=Tq.XEditInteractor;z=t.__interactorMap__={scrollBar:new ef(t),select:new Ol(t),edit:A?new A(t):new wo(t),text:new Hq(t),move:new Pj(t),"default":new Wf(t),touch:new qm(t,{editable:!1})}}G?(t._uieditable=!0,t.setInteractors([z.scrollBar,z.select,z.text,z.edit,z.move,z.default,z.touch])):(t._uieditable=!1,t.setInteractors([z.scrollBar,z.select,z.move,z.default,z.touch]))},getCanvas:function(){return this._canvas},_33I:function(m){var n=m.getUIClass();return n?new n(this,m):q},getDataUI:function(i){var l=this,t=l._25I[i._id];return t===A&&(t=l._33I(i),l._25I[i._id]=t),t},getNodeRect:function(X){return M.getNodeRect(this,X)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(d){var u=this.getDataUI(d);return u?(u._79o(),u._78o):null},getEdgeSourcePosition:function(W){var R=this,Y=R.getDataUI(W),T=Y.s,G=Y._data._40I;return fp(R,G,T("edge.source.position"),T("edge.source.offset.x"),T("edge.source.offset.y"),T("edge.source.anchor.x"),T("edge.source.anchor.y"))},getEdgeTargetPosition:function(s){var k=this,e=k.getDataUI(s),w=e.s,m=e._data._41I;return fp(k,m,w("edge.target.position"),w("edge.target.offset.x"),w("edge.target.offset.y"),w("edge.target.anchor.x"),w("edge.target.anchor.y"))},invalidateAll:function(s){var b=this;if(s){for(var y in b._25I){var z=b._25I[y];z&&z.dispose()}b._25I={},b._56I={},b._24I={},b._34I.clear(),b.redraw()}else b.dm().each(function(y){b.invalidateData(y)})},invalidateSelection:function(){var R=this;R.sm().each(function(V){R.invalidateData(V)})},invalidateData:function(q){var c=this;c._24I[q._id]=q,c._21Q(q),c.iv()},_21Q:function(Y){var z=this,i=z._24I;if(dq(Y)&&mb[Y.s(Oi)]){var j=Y.getSourceAgent();j&&j.getAgentEdges().each(function(D){i[D._id]=D}),j=Y.getTargetAgent(),j&&j.getAgentEdges().each(function(E){i[E._id]=E}),z.iv()}},redraw:function(H){var M=this;M._32I||(H?M._34I.add(H):(M._32I=1,M._34I.clear()),M.iv())},each:function(f,L){var x,J,k,K=0,A=this.getLayers(),o=this._dataModel,m=o._datas._as,d=m.length;if(A){var v,i={};o.isHierarchicalRendering()&&o.eachByHierarchical(function(Y){k=Y._layer,v=i[k],v||(v=i[k]=[]),v.push(Y)});for(var H=A.length;H>K;K++)if(k=A[K],fg(k)&&(k=k.name),o.isHierarchicalRendering()){v=i[k];var n,x,s;if(v&&(n=v.length)>0)for(var $=0;n>$;$++)if(x=v[$],s=L?f.call(L,x):f(x),s===!1)return}else for(var $=0;d>$;$++)if(x=m[$],x._layer===k&&(J=L?f.call(L,x):f(x),J===!1))return}else if(o.isHierarchicalRendering())this._dataModel.eachByHierarchical(f,null,L);else for(;d>K;K++)if(x=m[K],J=L?f.call(L,x):f(x),J===!1)return},reverseEach:function(w,R){var c,y,T,J,B=this._dataModel,H=B._layers,Z=B._datas._as,K=Z.length;if(H){var Y,p={};for(B.isHierarchicalRendering()&&B.reverseEachByHierarchical(function(e){J=e._layer,Y=p[J],Y||(Y=p[J]=[]),Y.push(e)}),c=H.length-1;c>=0;c--)if(J=H[c],fg(J)&&(J=J.name),B.isHierarchicalRendering()){Y=p[J];var k,y,D;if(Y&&(k=Y.length)>0)for(var S=0;k>S;S++)if(y=Y[S],D=R?w.call(R,y):w(y),D===!1)return}else for(var S=K-1;S>=0;S--)if(y=Z[S],y._layer===J&&(T=R?w.call(R,y):w(y),T===!1))return}else if(B.isHierarchicalRendering())B.reverseEachByHierarchical(w,null,R);else for(c=K-1;c>=0;c--)if(y=Z[c],T=R?w.call(R,y):w(y),T===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var E=this,Q=E._84I;if(!Q){var f=this.dm().a("width"),i=this.dm().a("height");f>0&&i>0?E._84I={x:0,y:0,width:f,height:i}:(E.each(function(B){E.isVisible(B)&&(Q=sm(Q,E.getDataUIBounds(B)))}),E._84I=Q?Q:Wb)}return E._84I},getScrollRect:function(){return sm(this.getContentRect(),this._29I)},makeCenter:function(g,K,n){var D=this;if(!D.getWidth()||!D.getHeight())return n||Mi(D.makeCenter,D,[g,K,!0],500),void 0;D.makeVisible(g),D.validate();var Z=D.getDataUIBounds(g);if(Z){var J=D.getWidth(),Y=D.getHeight(),c=Z.x+Z.width/2,d=Z.y+Z.height/2,X=-c*D._zoom+J/2,A=-d*D._zoom+Y/2;D.setTranslate(X,A,K)}},fitData:function(W,X,i,$,f){var J=this;if(!J.getWidth()||!J.getHeight())return f||Mi(J.fitData,J,[W,X,i,$,!0],500),void 0;var y=function(){J.makeVisible(W),J.validate();var t=J.getDataUIBounds(W);t&&(t=Wr(t),Ti(t,i==q?20:i),J.fitRect(t,X,$))};X?M.callWhenLoaded(y):y()},fitContent:function(I,j,p,$){var A=this;if(!A.getWidth()||!A.getHeight())return $||Mi(A.fitContent,A,[I,j,p,!0],500),void 0;var o=function(){A.validate();var G=Wr(A.getContentRect());Ti(G,j==q?20:j),A.fitRect(G,I,p)};I?M.callWhenLoaded(o):o()},fitRect:function(h,X,W){var I=this,T=I.getWidth(),i=I.getHeight(),K=h.x+h.width/2,o=h.y+h.height/2,N=e(T/h.width,i/h.height),E=I._zoom,b=-K*E+T/2,D=-o*E+i/2;0===N||isNaN(N)||(W&&(N=e(1,N)),X?(I._65I&&(delete I._65I.finishFunc,I._65I.stop(!0)),I._14o&&I._14o.stop(!0),I.setTranslate(b,D,{finishFunc:function(){I.setZoom(N,X)}})):(I.setTranslate(b,D),I.setZoom(N)))},fitSelection:function(w,Z,K){var v=this,l=v.sm(),C=null;l.size()&&(l.each(function(z){C=sm(v.getDataUIBounds(z),C)}),w&&Ti(C,w),v.fitRect(C,Z,K))},toCanvas:function(F,H,h){H=H||this._zoom,this.validateImpl();var T=this,C=T.getContentRect();h&&Ti(C,h),C.width||(C.width=10),C.height||(C.height=10);var O=rs(),l=C.x*H,i=C.y*H,S=Math.ceil(C.width*H),P=Math.ceil(C.height*H);Sk(O,S,P,1);var J=bc(O);F=F||this._dataModel.getBackground(),F&&Dh(J,0,0,S,P,F),hi(J,-l,-i),J.scale(H,H);var L=this._zoom;return this._zoom=H,T._42(J),this._zoom=L,J.restore(),O},toDataURL:function(u,v,G,S){return this.toCanvas(u,G,S).toDataURL(v||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(v,Q){var E=this,A=E.dm().getBackground();if(A){var o=E.dm().a("width"),r=E.dm().a("height");o>0&&r>0&&Dh(v,0,0,o,r,A)}var k=E.__htmlOrderList,Y=[],n=E._forcedLayoutHTML;if(E._93db(v,Q),E.each(function(I){var c=E.getDataUI(I);if(c){var S=E._56I[I._id],m=c._htmlView;if(S){var H=c._79o();if(m=c._htmlView,x.HtmlNode&&I instanceof x.HtmlNode)c._42(v);else{var Z=E.getViewRect(),h=m&&m.layoutHTML;!Q||op(Q,H)?(h&&(m.layoutHTML(),c.__outerLayout&&delete c.__outerLayout),c._42(v)):op(Z,H)||!h||c.__outerLayout&&!n||(m.layoutHTML(),c.__outerLayout=!0)}}m&&(Y.push(m),m.getView&&(m=m.getView()),m.style.display=S?"block":Yc)}}),k&&Y.length>0){var y=!1;if(k.length!==Y.length)y=!0;else for(var m=0;m<Y.length;m++)if(Y[m]!==k[m]){y=!0;break}y&&(Y.forEach(function(r){r.autoAdjustIndex!==!1&&E.appendHTML(r,!0)}),this.__htmlOrderList=Y)}else this.__htmlOrderList=Y;E._92db(v,Q)},disableDirtyRect:function(){this._shouldRedrawAll=t},enableDirtyRect:function(){var T=this;T._shouldRedrawAll=function(){return T._32I}},validateImpl:function(){this.tryUpdateRootData();var t,R,B,g,Y,N=this,S=N.tx(),$=N.ty(),a=N._zoom,K=N._canvas,x=this.getWidth(),e=this.getHeight(),q=N._29I,M={x:-S/a,y:-$/a,width:x/a,height:e/a},w={},r=N._34I,s=N._24I,u=N._shouldRedrawAll(),H=N._23I;N._24I={},(x!==K.clientWidth||e!==K.clientHeight)&&(Sk(K,x,e),u=1,N._forcedLayoutHTML=1),u||Uj(M,q)||(u=1,N._forcedLayoutHTML=1),N._29I=M,N.each(function(r){R=r._id;var n=w[R]=N.isVisible(r);n!==N._56I[R]&&(s[R]=r,B=N.getDataUI(s[R]),B&&B._84o(n),N._84o(r,n))},N);for(R in s)B=N.getDataUI(s[R]),B&&(!u&&N._56I[R]&&(Y=B._79o(),Y&&r.add(Y)),B.invalidate()),N._83I=1;if(N._56I=w,!u)for(R in s)w[R]&&(B=N.getDataUI(s[R]),B&&(Y=B._79o(),Y&&r.add(Y)));if(u?g=M:(r.each(function(s){op(M,s)&&(g=sm(g,s))}),g&&(Ti(g,E(1,1/a)),g.x=L(g.x*a)/a,g.y=L(g.y*a)/a,g.width=y(g.width*a)/a,g.height=y(g.height*a)/a,g=hp(M,g))),N._74O=g,g&&0!==g.width&&0!==g.height){t=bc(K);var I=g.x,U=g.y,b=g.width,T=g.height;I=Math.floor((I*a+S)*Jh),U=Math.floor((U*a+$)*Jh),b=Math.ceil(b*a*Jh)+1,T=Math.ceil(T*a*Jh)+1,u||(g.x=(I/Jh-S)/a,g.y=(U/Jh-$)/a,g.width=b/Jh/a,g.height=T/Jh/a),t.beginPath(),t.rect(I,U,b,T),t.clip(),t.clearRect(I,U,b,T),ih(t,S,$,a),N._42(t,g),t.restore(),delete N._74O}if(r.clear(),delete N._32I,delete N._forcedLayoutHTML,H&&x>0&&e>0){var B=N.getDataUI(H);if(B){var Y=B._79o(),d=N._29I,G=d.x,Q=d.y,W=d.width,i=d.height,a=N._zoom;Y&&!op(Y,d)&&(Y.x+Y.width<G&&N.tx(-Y.x*a),Y.x>G+W&&N.tx(-(Y.x+Y.width-W)*a),Y.y+Y.height<Q&&N.ty(-Y.y*a),Y.y>Q+i&&N.ty(-(Y.y+Y.height-i)*a))}delete N._23I}N._83I&&(delete N._83I,delete N._84I),N._98O(),N.countFrame(),Er(N._24I)||Mi(N.iv,N)},isValidGuideLineSource:function(){return!0},tryUpdateRootData:function(){if(!this._rootDataUpdating){this._rootDataUpdating=!0;var Y,Z=this.getFullscreenDatas();for(var z in Z)Y=Z[z],this.scaleRootData(Y);this.onRootDataUpdated&&this.onRootDataUpdated(),this._rootDataUpdating=!1}},scaleRootData:function(G){var C=G.s("fullscreen");if("uniform"===C||"fill"===C){G.getRotation()&&G.setRotation(0);var _=G.s("fullscreen.gap")||0,f=this.getWidth(),J=this.getHeight();if(f&&J){var O,S,R,i=f-2*_,c=J-2*_,w=G.getAnchor(),D=G.getScaledSize(),d=D.width,b=D.height,o=G.s("fullscreen.lock");if(o)return"uniform"===C?i/c>d/b?(O=c/b,d=b*i/c):(O=i/d,b=d*c/i):"v"===o?(O=c/b,d=i/O,G.getWidth()!==d&&G.setWidth(d)):(O=i/d,b=c/O,G.getHeight()!==b&&G.setHeight(b)),this.setZoom(O),S=_-(G.getX()-w.x*d)*O,R=_-(G.getY()-w.y*b)*O,S!==this.tx()&&this.tx(S),R!==this.ty()&&this.ty(R),void 0;S=this.tx(),R=this.ty(),O=this._zoom;var L={x:(-S+_)/O,y:(-R+_)/O,width:i/O,height:c/O};if("uniform"===C){var p=d/b,U=Math.min(L.width,L.height*p),v=U/p;L.x+=.5*(L.width-U),L.y+=.5*(L.height-v),L.width=U,L.height=v}i=L.width/G.getScaleX(),c=L.height/G.getScaleY(),(G.getWidth()!=i||G.getHeight()!==c)&&G.setSize(i,c);var k=L.x+w.x*L.width,Z=L.y+w.y*L.height,u=G.getPosition();(k!==u.x||Z!==u.y)&&G.setPosition(k,Z)}}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(x){var T=this;x!==T.isScrollBarVisible()&&(x?(Bh(T._view,T._79O=Kn()),Bh(T._79O,T._27I=Kn()),Bh(T._79O,T._28I=Kn())):(Qn(T._79O),delete T._79O,delete T._27I,delete T._28I),T.fp("scrollBarVisible",!x,x))},getDebugTip:function(){return""},showScrollBar:function(){var r=this;r._79O&&(r._85I||(Zl(function(){r._86I()},nh),r.iv()),r._85I=new Date)},_86I:function(){var K=this;if(K._85I){var t=new Date,D=t.getTime();D-K._85I.getTime()>=nh?(delete K._85I,K.iv()):Zl(function(){K._86I()},nh)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var x=this,B=this._27I,f=this._28I;if(x._79O){if(x._autoHideScrollBar&&!x._85I)return B.style.visibility=Cc,f.style.visibility=Cc,void 0;var Q=x.getScrollBarColor(),w=x._zoom,g=x.getScrollBarSize(),Z=x.getViewRect(),d=x.getScrollRect(),$=Z.height*w,p=d.height*w,D=Z.width*w-g-2,q=$*((Z.y-d.y)*w/p),o=$*($/p),e=B.style;p-.5>$?(Eh>o&&(q=q+o/2-Eh/2,0>q&&(q=0),q+Eh>$&&(q=$-Eh),o=Eh),Xn(B,D,q,g,o),e.visibility=Vi,e.background=Q,e.borderRadius=g/2+Zh):e.visibility=Cc;var F=Z.width*w,J=d.width*w,q=Z.height*w-g-2,D=F*((Z.x-d.x)*w/J),m=F*(F/J),e=f.style;J-.5>F?(Eh>m&&(D=D+m/2-Eh/2,0>D&&(D=0),D+Eh>F&&(D=F-Eh),m=Eh),Xn(f,D,q,m,g),e.visibility=Vi,e.background=Q,e.borderRadius=g/2+Zh):e.visibility=Cc}},setDataModel:function(H){var e=this,y=e._dataModel,B=e._selectionModel;y!==H&&(y&&(y.ump(e.handleDataModelPropertyChange,e),y.umm(e.handleDataModelChange,e),y.umd(e.handleDataPropertyChange,e),y.removeIndexChangeListener(e._75O,e),y.removeHierarchyChangeListener(e.handleHierarchyChange,e),B||y.sm().ums(e.handleSelectionChange,e)),e._dataModel=H,H.mp(e.handleDataModelPropertyChange,e),H.mm(e.handleDataModelChange,e),H.md(e.handleDataPropertyChange,e),H.addIndexChangeListener(e._75O,e),H.addHierarchyChangeListener(e.handleHierarchyChange,e),B?B._21I(H):H.sm().ms(e.handleSelectionChange,e),e.invalidateAll(!0),e.fp(Sl,y,H),e.updateBackground())},getLayersInfo:function(){if(this._layersInfo===A){var k=this.getLayers();k?(this._layersInfo={},k.forEach(function(w){var Z=fg(w)?w.name:w;this._layersInfo[Z]=w},this)):this._layersInfo=null}return this._layersInfo},calculateEdgePosition:function(j,Q,r){var H,C,R,_,c=this;j instanceof x.Data?(_=c.getDataUI(j),R=jm(_)):(R=jm(null,arguments[0],arguments[1]),Q=arguments[2],r=arguments[3]),2===Q.length&&(Q=new sd(Q[0],Q[1]));var w=ff(Q,function(f){return Fp(R,100*f)},100,.001),I=Fp(R,100*w);if(!r){var z=_?Hm(_):Hm(arguments[0],arguments[1]),$=new sd(I.x,I.y),L=49/(c._zoom*c._zoom);for(H=0,C=z.length;C>H;H++)if($.distanceToSquared(z[H])<L)return{index:H,point:z[H],distance:Math.sqrt((z[H].x-Q.x)*(z[H].x-Q.x)+(z[H].y-Q.y)*(z[H].y-Q.y))}}return{percent:w,point:I,distance:Math.sqrt((I.x-Q.x)*(I.x-Q.x)+(I.y-Q.y)*(I.y-Q.y))}},getPercentPositionOfPath:function(P,b){var F;if(P instanceof x.Data){var T=this.getDataUI(P);F=jm(T)}else F=jm(null,arguments[0],arguments[1]),b=arguments[2];return Fp(F,b)},getNeareastPositionOfPath:function(){return this.calculateEdgePosition.apply(this,arguments)},getPointsOfPath:function(){function H($,f,m,x,j,y){var A=new sd(f.get(m)),S=y.apply(A);$.push({local:A,world:S,type:j,index:m,realIndex:x})}return function(y){var W,M;if(y instanceof x.Data){var h=this.getDataUI(y),L=Lf(h);W=L.points,M=L.segments}else W=arguments[0],M=arguments[1];var E,o,T,J=y instanceof x.Shape?y.getPointsMatrix2d():new Mh.Matrix2d,u=[],Z=-1,G=-1;for(o=0,T=M?M.length:W.length;T>o;o++)E=M?M.get(o):1,5!==E&&(G++,3===E?(H(u,W,Z+1,G,"C",J),H(u,W,Z+2,G,"M",J),Z+=2):4===E?(H(u,W,Z+1,G-1,"R",J),H(u,W,Z+2,G,"L",J),H(u,W,Z+3,G,"M",J),Z+=3):(H(u,W,Z+1,G,"M",J),Z+=1));return u}}(),calculateAttachPoint:function(){var u=new sd,G=new sd,x=new sd;return function(o,i){var m=this.getAttachPoints(o);if(!m||!m.length)return null;x.set(i.x,i.y);for(var H,D,g,l,V,R=1/0,$=0,Q=m.length;Q>$;$++)g=m[$],G.x=g.x,G.y=g.y,u.x=g.offsetX||0,u.y=g.offsetY||0,l=fp(this,o,0,u.x,u.y,G.x,G.y),D=x.distanceToSquared(l),R>D&&(H=$,R=D,V=l);R=Math.sqrt(R);var T=this.getAttachStyle(o);if("close"===T){var C=o.s("attach.close.threshold")/this._zoom;if(R>C)return null}return{index:H,distance:R,info:m[H],point:V}}}(),getAttachPoints:function(Y){var q=Y.s("attach.points");if(q)return q;var J=yd(Y._image);return J?gl(J.attachPoints,Y,this)||null:void 0},getAttachStyle:function(U){var F=U.s("attach.style");if(F)return F;var c=yd(U._image);return c?gl(c.attachStyle,U,this)||"close":void 0},updateLayers:function(){this._layersInfo=A,this.invalidateSelection(),this.redraw()},updateBackground:function(){var m=this.dm().a("width"),w=this.dm().a("height");this._canvas.style.background=m>0&&w>0?"":this.dm().getBackground()||""},handleDataModelPropertyChange:function(m){if("background"===m.property){var F=this._canvas.style.background,I=m.newValue||"";this.updateBackground(),this.fp("canvasBackground",F,I),this.redraw()}else"a:width"===m.property||"a:height"===m.property?(this._83I=1,this.updateBackground(),this.redraw()):"layers"===m.property?this.updateLayers():"hierarchicalRendering"===m.property&&this.redraw()},handleDataPropertyChange:function(d){this.dm().isHierarchicalRendering()&&"parent"===d.property&&d.data.hasChildren()&&this.redraw(),this.invalidateData(d.data)},onPropertyChanged:function(C){var z=this,n=C.property;if(z.redraw(),"zoom"===n){var E=z.sm().getSelection();E.size()&&E.each(function(T){T.invalidate()})}else"dataModel"===n&&(z._83I=1);vr[n]?z.showScrollBar():n===Yh&&z.onCurrentSubGraphChanged(C)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(S){var i=this,y=S.kind,Z=S.data;if(i._83I=1,"add"===y)i.invalidateData(Z),dq(Z)&&Z.getEdgeGroup()&&Z.getEdgeGroup().eachSiblingEdge(i.invalidateData,i),Z.getHost&&Z.getHost()&&Z.getHost().updateLayoutAttaches();else if(y===ko){i._21Q(Z);var L=Z._id,d=i._25I[L];if(d){if(i._56I[L]){var j=d._79o();j&&i.redraw(j)}d.dispose(),delete i._25I[L],delete i._24I[L],delete i._56I[L]}Z===i._currentSubGraph&&i.setCurrentSubGraph(q)}else y===bl&&(i.invalidateAll(!0),i.setCurrentSubGraph(q))},_75O:function(t){this.invalidateData(t.data)},handleHierarchyChange:function(Y){this.dm().isHierarchicalRendering()&&Y.data.hasChildren()&&this.redraw(),this.invalidateData(Y.data)},adjustIndex:function(A){var w=this;if(w.isVisible(A)){w.dm().beginTransaction();for(var L=A;L._parent&&w.isVisible(L._parent);)L=L._parent;L&&L!==A&&w._dataModel.adjustIndex(L),w._dataModel.adjustIndex(A),w.dm().endTransaction()}},getImage:function(m){return m.getImage?m.getImage():A},getSelectWidth:function(D){var I=yd(this.getImage(D));return I&&gl(I.disableSelectedBorder,D,this)?0:D.s("select.width")},getSelectColor:function(D){return D.s("select.color")},isSelectable:function(z,A){if(this.isSelected(z))return!0;if(!A&&z.getParent()instanceof df&&this.isSelectable(z.getParent(),!0)&&z.getParent().isSyncSize())return!1;var q=this.getLayersInfo();if(q){var u=q[z._layer];if(u&&u.selectable===!1)return!1}return z.s("2d.selectable")&&this.sm().isSelectable(z)},isMovable:function(i){var Y=this;if(dq(i)&&i.getStyle(Oi)!==kh)return!1;var V=this.getLayersInfo();if(V){var q=V[i._layer];if(q&&q.movable===!1)return!1}return i.s("2d.movable")?Y._movableFunc?Y._movableFunc(i):!0:!1},isEditable:function(g){var e=this;if(x._uiSerializing)return e._uieditable;if(!e._editInteractor||!e.isSelected(g))return!1;if(qq(g)){var H=e.getDataUI(g);if(!H||H._88I)return!1}if(dq(g)&&g.getStyle(Oi)!==kh)return!1;var U=this.getLayersInfo();if(U){var o=U[g._layer];if(o&&o.editable===!1)return!1}return g.s("2d.editable")?e._editableFunc?e._editableFunc(g):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(L){return uk(L)&&0!==L.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(L):!0},isRectEditable:function(m){return this._rectEditableFunc?this._rectEditableFunc(m):!0},isAnchorEditable:function(t){return this._anchorEditableFunc?this._anchorEditableFunc(t):!0},isRotationEditable:function(K){return K.setRotation&&K.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(K):!0:!1},isSourceTargetEditable:function(){return!0},getRotationPoint:function(A){var Z=A.getAnchor(),m=A.getScale(),O=this._zoom,Y=Bq(A.getRotation(),0,-A.getHeight()*m.y*Z.y-(m.y<0?-1:1)*(lf?32:16)/O),K=A.p();return Y.x+=K.x,Y.y+=K.y,Y},getLogicalPoint:function(E){var Y=this;return Hk(E,Y._canvas,Y.tx(),Y.ty(),Y._zoom,Y._zoom)},getScreenPoint:function(h,x){var T,i=this;return"object"==typeof h?h.x!==A?(T=h.x,x=h.y):(T=h[0],x=h[1]):T=h,me(T,x,i._canvas,i.tx(),i.ty(),i._zoom,i._zoom)},getSelectedDataAt:function(u){var L=this;return this.getDataAt(u,function(w){return L.isSelected(w)})},getDataInfoAt:function(W,E,_){var x,M=this.lp(W),C=this.getDataAt(M,E,_);if(C){var h=this.getDataUI(C);x={data:C,ui:h,point:M};var Z=h._38o;if(Z){var U=Z.icons;for(var z in U){var R=U[z],V=Z.rects[z];if(V)for(var S=gl(R.names,C,this),m=S?S.length:0,H=V.rotation,D=m-1;D>=0;D--){var K=S[D],b=V[D];if(Do(b,M,H))return x.part="icons",x.name=z,x.icon=K,x.rect=b,x.index=D,x.rotation=H,x}}}if(this.isNoteVisible(C)){if(h.note2Info&&Do(h.note2Info.clickRect,M,q,h.note2Info.scale))return x.part="note2",x;if(h.noteInfo&&Do(h.noteInfo.clickRect,M,q,h.noteInfo.scale))return x.part="note",x}if(this.isLabelVisible(C)){if(h.label2Info&&Do(h.label2Info.rect,M,h.label2Info.rotation,h.label2Info.scale))return x.part="label2",x;if(h.labelInfo&&Do(h.labelInfo.rect,M,h.labelInfo.rotation,h.labelInfo.scale))return x.part="label",x}if(C.isInRect&&C.isInRect(M))return x.part="body",x}return x},getDataAt:function(L,y,B){L.target&&(L=this.lp(L));var u,Z=this._zoom;return this.reverseEach(function(S){return(y?y(S):this.isSelectable(S))&&this.rectIntersects(S,Fn(L.x,L.y,B,Z))?(u=S,!1):void 0},this),u},getIconInfoAt:function(k,O){var m=this;if(k.target&&(k=m.lp(k)),O||(O=m.getDataAt(k)),O){var M=m.getDataUI(O);if(M&&M._38o){var _,l=M._38o,y=new lo;for(_ in l.icons)y.add(_);for(var L=y.size()-1;L>=0;L--){_=y.get(L);for(var z=l.rects[_],i=z.rotation,H=z.length-1;H>=0;H--){var b=z[H],B=b.width,$=b.height,P={x:k.x-b.x-B/2,y:k.y-b.y-$/2};i!=q&&(P=Bq(-i,P.x,P.y));var b={x:-B/2,y:-$/2,width:B,height:$};if(Do(b,P))return{key:_,index:H,name:l.icons[_].names[H],rect:z[H],point:k,rotation:i,relativeRect:b,relativePoint:P,data:O}}}}}return q},getDatasInRect:function(H,C,m){m===A&&(m=1);var B=this,K=new lo;return B.reverseEach(function(G){m&&!B.isSelectable(G)||(C?B.rectIntersects(G,H):B.rectContains(G,H))&&K.add(G)}),K},moveSelection:function(p,Q){var V=this;V.dm().beginTransaction(),Vr(V.sm().toSelection(V.isMovable,V),p,Q),V.dm().endTransaction()},moveDatas:function(v,K,d){var F=this;F.dm().beginTransaction(),v instanceof lo||(v=new lo(v)),Vr(v,K,d),F.dm().endTransaction()},getDataUIBounds:function(T){var x=this.getDataUI(T);return x?x._79o():q},drawData:function(k,N,f){var _=this.getDataUI(N);if(_){var M=_._79o();(!f||op(f,M))&&(_._42(k),N instanceof x.Block&&N.eachChild(function(v){this.isVisible(v)&&this.drawData(k,v,f)},this))}},getBoundsForGroup:function(s){return s.s(cp)?this.getDataUIBounds(s):q},isPixelPerfect:function(C){return C.s("pixelPerfect")},rectIntersects:function(U,b){this.validate();var p=q;if(this._56I[U._id]){var s=this._25I[U._id];if(s){var c=s._79o();if(Yr(b,c))p=!0;else if((b=hp(b,c))&&(s.rectIntersects&&(p=s.rectIntersects(b)),p==q)){if(!this.isPixelPerfect(U))return!0;var j=b.x,F=b.y,P=b.width,W=b.height,A=this._zoom,x=M.hitMaxArea,B=P*W*A*A;if(B>x){var K=Math.sqrt(x/B);A*=K}P*=A,W*=A,2>P&&(P=2),2>W&&(W=2),j*=A,F*=A;var e=Pn(P,W);hi(e,-j,-F),e.scale(A,A),this._drawForChecking=!0,this.drawData(e,U,b),this._drawForChecking=!1;try{for(var o=0,h=e.getImageData(0,0,P,W).data;o<h.length;o+=4)if(0!==h[o+3]){p=!0;break}e.restore()}catch(y){Pr=q,p=!1}}}}return p?!0:!1},rectContains:function(T,Q){if(this._56I[T._id]){var K=this._25I[T._id];if(K)return Yr(Q,K._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(n){if(!M.isInput(n.target)){var s=this,_=s._focusData,e=_&&s._25I[_._id],$=0,D=s._dataModel._datas;if(!(_&&_._enabled&&_._editable&&e&&e.onKeyDown&&e.onKeyDown(n)===!0))if(9===n.keyCode&&(_&&($=D.indexOf(_),ck(n)?-1===--$&&($=0):++$===D.size()&&($=0)),s._focusData=_=D.get($),s.sm().setSelection(_)),jc(n)?s.selectAll():Yo(n)&&s.isResettable()&&s.reset(),s.sm().isEmpty()){if(s._editing)return;var x=s.tx(),j=s.ty(),k=!1,p=ck()?100:10;lp(n)&&(x-=p,k=!0),zg(n)&&(j-=p,k=!0),Up(n)&&(x+=p,k=!0),Pk(n)&&(j+=p,k=!0),k&&s.setTranslate(x,j)}else{hj(n)&&s.handleDelete(n);var z=ck()?10:1;lp(n)&&(s.moveSelection(-z,0),s.fi({kind:"moveLeft"})),zg(n)&&(s.moveSelection(0,-z),s.fi({kind:"moveUp"})),Up(n)&&(s.moveSelection(z,0),s.fi({kind:"moveRight"})),Pk(n)&&(s.moveSelection(0,z),s.fi({kind:"moveDown"}))}}},handleScroll:function(w,l){if(lr(w),this.isZoomable()){if(!this.getEditInteractor()){var D=this.getDataAt(w);if(D){var t=yd(this.getImage(D));if(t&&gl(t.scrollable,D,this))return}}var P=this.getFullscreenDatas();for(var O in P)if(P[O].s("fullscreen.lock"))return;var W=this.lp(w);l>0?this.scrollZoomIn(W):0>l&&this.scrollZoomOut(W)}},handlePinch:function(B,x,w){this.isZoomable()&&(Math.abs(x-w)<M.pinchZoomThreshold||(x>w?this.pinchZoomIn(B):this.pinchZoomOut(B)))},checkDoubleClickOnNote:function(G,U){var $=this,T=$.lp(G),R=$.getDataUI(U),g=R.note2Info;return g&&U.s("note2.toggleable")&&Do(g.clickRect,T)?(U.s(rh,!U.s(rh)),$.fi({kind:"toggleNote2",event:G,data:U}),!0):(g=R.noteInfo,g&&U.s("note.toggleable")&&Do(g.clickRect,T)?(U.s(Fk,!U.s(Fk)),$.fi({kind:"toggleNote",event:G,data:U}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(D,N){var U=this,e=U.getAutoScrollZone(),E=e/U.getZoom(),K=e/4,G=U._29I,J=U.lp(D),B={x:U.tx(),y:U.ty()};return J&&e>0&&G&&(J.x-G.x<E?U.translate(K,0):G.x+G.width-J.x<E&&U.translate(-K,0),J.y-G.y<E?U.translate(0,K):G.y+G.height-J.y<E&&U.translate(0,-K)),B.x=U.tx()-B.x,B.y=U.ty()-B.y,N&&(N.x+=B.x,N.y+=B.y),B},getMoveMode:function(Z,$){var P=$.s("2d.move.mode");return P?P:qr["88"]?"x":qr["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(c,Z,u){var f=this;return"currentSubGraph"===Z?{__i:c.getId()}:u.serializeProperty(c,Z,f)},deserializeProperty:function(I,C,F){var A=this;if("currentSubGraph"===C){var k=A.dm(),s=k.__idMap;return s[I.__i]}return F.deserializeProperty(I,C,A)},setDefaultCursor:function(d,U){this._defaultCursor=d,U!==!1&&this.setCursor(d)},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(N){return N===q||M.getConnectAction(null,N)?(this._currentActionType=N,this.redraw(),!0):!1},getEditStyle:function(Y){var $=this.getEditInteractor();return $?$.getStyle(Y):A},setEditStyle:function(I,A,q){var m=this.getEditInteractor();return m?(m.setStyle(I,A,q),!0):!1},isConnectActionVisible:function(b){var U=M.getConnectAction(this);if(!U)return!1;var R=U.visible;return hc(R)&&(R=R(this,b)),R},isInteractive:function(n){if(this._drawForChecking)return!1;var o=yd(this.getImage(n));return o&&gl(o.interactive,n,this)?!0:n.s("interactive")},getRenderingStyleIconName:function(){return So},appendHTML:function(q,T){var r=this.getView();if(!(T||q&&q.parentNode!==r))return!1;var K=q.getView&&q.getView(),k=q.beforeCanvas;if(!T&&K&&K.parentNode===r)return!1;(q.getView||q.isSelfViewEvent)&&(q=q.getView());var M=this.getEditInteractor();return k?r.insertBefore(q,this.getCanvas()):M&&M._canvas?r.insertBefore(q,M._canvas):this.isScrollBarVisible()?r.insertBefore(q,this.getView().lastChild):Bh(r,q),!0},_layoutHTMLImpl:function(I,h,w){if(arguments.length>1){var s,p=this,K=p._zoom;if(h.getView&&(s=h,h=h.getView()),h.style.position="absolute",w){var c=I.getRect();Xn(s||h,p.tx()+c.x*K,p.ty()+c.y*K,c.width*K,c.height*K)}else{var B=new co,c=I.getAnchorRect(),a=I.getPosition(),j=I.getScale(),E=h.style;Xn(s||h,c),B.appendTranslate(p.tx(),p.ty()),B.appendScale(K,K),B.append(new co(I.getRotation(),a.x,a.y,j.x,j.y)),zc(E,"transform","matrix("+B.a.toFixed(5)+", "+B.b.toFixed(5)+", "+B.c.toFixed(5)+",\n    "+B.d.toFixed(5)+", "+B.tx.toFixed(5)+", "+B.ty.toFixed(5)+")"),zc(E,"transformOrigin",(-c.x).toFixed(5)+"px "+(-c.y).toFixed(5)+"px"),h.updateAppendMatrix=!0}}else this._layoutHTML&&this._layoutHTML()},getTextEditInfo:function(v){return v instanceof Tn?{name:"text",accessType:"s",font:v.s("text.font"),isMultiline:!0}:void 0},getState:function(f){var I="state",C=f.s(I);if(C)return C;var i=yd(f._image);return i?gl(i[I],f,this)||null:void 0},getShape:function(A){return A.getStyle(Xi)}}),u.defineProperties(Tq.GraphView.prototype,{layoutHTML:{get:function(){return this._layoutHTMLImplBind||(this._layoutHTMLImplBind=this._layoutHTMLImpl.bind(this)),this._layoutHTMLImplBind},set:function(p){this._layoutHTML=p}}});var fd=function(t,e){var V=this;V.gv=t,V.s=function(n){return e.getStyle(n)},V._data=e,V._87I=new lo},So=q;uj(fd,u,{_6I:q,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var D=this,c=D.gv.isSelected(D._data);return!c||D.isShadowed()?0:D.gv.getSelectWidth(D._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(U){var g=this._data,I=this.gv.getBodyColor(g);return I?I:U?g.getStyle(U):q},_2Q:function(g){return this.s(g)},_1Q:function(x,z,P,A){var n=this.s,S=n("2d.gray"),e=n(z+".dash.color");if(S&&(e=M.toGrayColor(e)),x.strokeStyle=e,x.lineWidth=P,x.stroke(),n(z+".dash.3d")){var H=n(z+".dash.3d.color");Gm(x,e,S?M.toGrayColor(H):H,P,this.gv._zoom,n(z+".dash.3d.accuracy"))}Ui(x,A)},invalidate:function(){this._6I=q},_79o:function(){var A=this;if(!A._6I){var C=A._data,Q=A.gv;A.labelInfo=A.label2Info=A.noteInfo=A.note2Info=A._38o=q,A._87I.clear(),A.interactiveInfo=Q.isInteractive(C)?{}:q,A._3O(),A._55O=Q.isEditable(C)?{_42O:Q.isRectEditable(C),_43O:Q.isPointEditable(C),_56O:Q.isRotationEditable(C)}:q,A._6I=A._81o()}return A._6I},_3O:function(){},getPosition:function(){return Wb},_68o:function(F,f){F&&this._87I.add(Ej(F,f))},_81o:function(){var v=this,X=v.s;v._24O(dd,"getLabel"),v._24O(ip,"getLabel2"),v._26O(Mb,"getNote"),v._26O(Wh,"getNote2"),v._15O(),v._55O&&v._48O();var d;if(v._87I.each(function(F){d=sm(d,F)}),d&&X("shadow.interactable")){var M=v.isShadowed(),w=X("shadow2"),$=Wr(d);w?($.x+=X("shadow2.offset.x"),$.y+=X("shadow2.offset.y"),Ti($,X("shadow2.blur"))):M&&($.x+=X("shadow.offset.x"),$.y+=X("shadow.offset.y"),Ti($,X("shadow.blur"))),d=sm(d,$)}return v._87I.clear(),d},_42:function(v){var c=this,J=c._data,N=c.gv,p=c.s,C=p("opacity"),D=this.isShadowed(),h=p("shadow2");if(D||h){var E=v.shadowOffsetX,O=v.shadowOffsetY,V=v.shadowBlur,b=v.shadowColor,B=N.getZoom()*M.devicePixelRatio,L=D?"shadow":"shadow2";v.shadowOffsetX=p(L+".offset.x")*B,v.shadowOffsetY=p(L+".offset.y")*B,v.shadowBlur=p(L+".blur")*B,v.shadowColor=D?c.getSelectColor():p(L+".color")}if(C!=q){var x=v.globalAlpha;v.globalAlpha=C}c._80o(v),N.isLabelVisible(J)&&((!N._drawForChecking||p("label.selectable"))&&om(v,c.labelInfo),(!N._drawForChecking||p("label2.selectable"))&&om(v,c.label2Info)),N.isNoteVisible(J)&&(_i(v,c.noteInfo),_i(v,c.note2Info)),c._99O(v),C!=q&&(v.globalAlpha=x),(D||h)&&(v.shadowOffsetX=E,v.shadowOffsetY=O,v.shadowBlur=V,v.shadowColor=b)
},_80o:function(){},_47O:function(){},_24O:function(E,I){var n=this,D=n._data,K=n.gv,W=n.s,X=K[I](D);if(X!=q){var V=W(E+".scale"),o=W(E+".max"),m=W(E+".position"),Z=n[E+"Info"]={label:X,scale:V,color:K[I+"Color"](D),font:W(E+".font"),opacity:W(E+".opacity"),align:W(E+".align"),decoration:W(E+".decoration"),rotation:n.getRotation(W(E+".rotation"),!1,m),background:K[I+"Background"](D)},u=Yq(Z,X);o>0&&o<u.width&&(Z.labelWidth=u.width,u.width=o),1!==V&&(u.width*=V,u.height*=V);var N=n.getPosition(m,W(E+".offset.x"),W(E+".offset.y"),u,W(E+".position.fixed"));if(u.x=N.x-u.width/2,u.y=N.y-u.height/2,n._68o(Z.rect=u,Z.rotation),1!==V){var b=u.width/V,v=u.height/V;Z.rect={x:N.x-b/2,y:N.y-v/2,width:b,height:v}}}},_26O:function(M,g){var j=this,w=j.gv,s=j._data,N=j.s,k=w[g](s);if(k!=q){var c,e,R=N(M+".scale"),l=j[M+"Info"]={note:k,scale:R,data:s,view:w,expanded:N(M+".expanded"),font:N(M+".font"),color:N(M+".color"),opacity:N(M+".opacity"),align:N(M+".align"),icon:N(M+".icon"),backgroundImage:N(M+".backgroundImage"),borderWidth:N(M+".border.width"),borderColor:N(M+".border.color"),background:w[g+"Background"](s)},_=j.getPosition(N(M+".position"),N(M+".offset.x"),N(M+".offset.y")),L=_.x,T=_.y;if(l.expanded){var B,C=N(M+".max"),Q=N(M+".backgroundImage");Q?(Q=yd(Q),B={width:Wq(Q,s),height:pm(Q,s)}):B=Yq(l,k),B.width+=6,B.height+=2,C>0&&C<B.width&&(l.labelWidth=B.width,B.width=C),c=B.width,e=B.height+8,l.clickRect={x:L-c*R/2,y:T-e*R,width:c*R,height:e*R*B.height/e}}else{var J=N(M+".icon");J?(J=yd(J),c=Wq(J,s),e=pm(J,s)):(c=12,e=18),l.clickRect={x:L-c*R/2,y:T-e*R,width:c*R,height:e*R}}l.rect={x:L-c/2,y:T-e*R/2-e/2,width:c,height:e};var a=y(l.borderWidth/2)*R;j._68o({x:L-c*R/2-a,y:T-e*R-a,width:c*R+2*a,height:e*R+2*a})}},_48O:function(){},_99O:function(w){var g=this,W=g._38o;if(W){var c=g.gv,z=g._data,J=W.icons,U=g.interactiveInfo;U&&(U._38o={});for(var Z in J){var i=J[Z],P=W.rects[Z];if(P){U&&(U._38o[Z]=[]);var h=gl(i.opacity,z,c),y=gl(i.names,z,c),L=y?y.length:0,d=P.rotation;if(h!=q){var m=w.globalAlpha;w.globalAlpha*=h}for(var A=0;L>A;A++){var l=y[A],f=yd(l),b=P[A];if(d){var F=b.x+b.width/2,x=b.y+b.height/2;w.save(),hi(w,F,x),Cm(w,d),hi(w,-F,-x)}U&&U._38o[Z].push(w.interactiveInfo={compInfos:[],matrix:d?new co(d,F,x).appendTranslate(-F,-x):new co});var e=So;So=Z,jl(w,f,gl(i.stretch,z,c),b.x,b.y,b.width,b.height,g._data,g.gv),So=e,w.interactiveInfo=q,d&&w.restore()}h!=q&&(w.globalAlpha=m)}}}}});var Xj=function(N,r){Vq(Xj,this,[N,r])};uj(Xj,fd,{_checkEmptyRect:!0,_40O:function(G,I){var B=this,o=B.s,A=G.rect;(G.borderColor=B.gv.getBorderColor(B._data))&&(G.borderType=o("border.type"),G.borderWidth=o("border.width"),G.borderPadding=o("border.padding"),I=E(I,G.borderPadding+G.borderWidth/2));var e=B._data.getScale(),R=E(1,E(D(e.x),D(e.y)));if(G.selectWidth=B.getSelectWidth()){var q=B.gv._zoom;G.selectType=o("select.type"),G._97o=B.getSelectColor(),G.selectPadding=o("select.padding"),I=E(I,(G.selectPadding+G.selectWidth/2/q)/R)}I>0&&(I*=R,A=Wr(A),Ti(A,I)),B._68o(A)},_39O:function(R,K){var m,j=this,H=K.rect;if(K.borderWidth>0&&(m=K.borderPadding,R.strokeStyle=K.borderColor,R.lineWidth=K.borderWidth,Ep(R,K.borderType,{x:H.x-m,y:H.y-m,width:H.width+2*m,height:H.height+2*m}),R.stroke()),K.selectWidth>0){var $=j.gv._zoom;if(m=K.selectPadding,R.strokeStyle=K._97o,R.lineWidth=K.selectWidth/$,K.rotation!=q){R.save(),R.translate(K.position.x,K.position.y),R.rotate(K.rotation);var O=j._data,c=O.getWidth(),k=O.getHeight(),v=K.scale,r=K.anchor;H={x:v.x*-c*r.x,y:v.y*-k*r.y,width:v.x*c,height:v.y*k}}Ep(R,K.selectType,{x:H.x-m,y:H.y-m,width:H.width+2*m,height:H.height+2*m}),K.rotation!=q&&R.restore(),R.stroke()}},dispose:function(){var u=this,T=u._htmlView;Xj.superClass.dispose.call(u),T&&(T.onHTMLRemoved&&T.onHTMLRemoved(),Qn(T))},_3O:function(){var I,t=this,S=t.s,x=t._data,Z=t.gv,o=Z.getShape(x),B=t.getBodyColor(),$=S("shape.border.color"),k=t._83o=o?{shape:o,_53o:t.getBodyColor("shape.background"),_27Q:yd(S("shape.repeat.image"),B),shapeGradientPack:S("shape.gradient.pack"),shapeBorderGradientPack:S("shape.border.gradient.pack"),_54o:S("shape.border.width"),_55o:$,shapeBorderRepeatImage:yd(S("shape.border.repeat.image"),$),_56o:S("shape.border.3d"),_57o:S("shape.border.3d.color"),_58o:S("shape.border.3d.accuracy"),shapeGradient:S("shape.gradient"),_59o:S("shape.gradient.color"),_60o:S("shape.border.pattern"),_61o:S("shape.border.cap"),_62o:S("shape.border.join"),shapeForeground:S("shape.foreground"),bodyColor:B,gray:S("2d.gray")}:{img:yd(Z.getImage(x),B),bodyColor:B,gray:S("2d.gray"),stretch:S("image.stretch")},v=k.img;v&&v.renderHTML?(t._htmlInfo&&t._htmlInfo.img!==v&&(t._htmlInfo=q),t._htmlInfo||(t._htmlInfo={img:v,cache:{}}),I=v.renderHTML(x,Z,t._htmlInfo.cache)):t._htmlInfo=q,t._htmlView&&t._htmlView!==I&&(t._htmlView.onHTMLRemoved&&t._htmlView.onHTMLRemoved(),Qn(t._htmlView.getView?t._htmlView.getView():t._htmlView)),(t._htmlView=I)&&Z.appendHTML(I)&&(I.onHTMLAddedSync&&I.onHTMLAddedSync(),I.onHTMLAdded&&Mi(I.onHTMLAdded)),k.rect=x.getRect(),k.position=x.p(),k.scale=x.getScale(),k.anchor=x.getAnchor(),k.rotation=x.getRotation(),o===jk&&(k._63o=S("shape.depth"));var u=0;if(o)u=ch(q,k._54o/2,k._62o),t.s("shape.dash")&&(u=E(u,(t.s("shape.dash.width")||k._54o)/2));else if(v&&v.boundExtend)if(u=gl(v.boundExtend,x,Z),v.boundExtendAbsolute){var p=x.getScale();u/=Z._zoom*E(1,E(D(p.x),D(p.y)))}else if(!gl(v.fitSize,x,Z)){var i=gl(v.width,x,Z),R=gl(v.height,x,Z);u*=E(x.getWidth()/i,x.getHeight()/R)}t._40O(k,u);var W=S("clip.percentage");if(W!=A&&(k.clipRect=jj(x.getAnchorRect(),S("clip.direction"),W)),o){var X=S("shape.fill.clip.percentage");X!=A&&(k.shapeClipRect=jj(x.getAnchorRect(),S("shape.fill.clip.direction"),X));var F=S("shape.foreground.clip.percentage");F!=A&&(k.shapeForegroundClipRect=jj(x.getAnchorRect(),S("shape.foreground.clip.direction"),F))}var h=S("clip.host");h&&x.getHost()&&(k.clipHost=!0)},getPosition:function(I,u,T,L){var p=oo(I,this._83o.rect,L);return p.x+=u,p.y+=T,p},_80o:function(I){var K=this,W=K.s,U=K.gv,l=K._data,e=K._83o,s=e.rect,X=e.position,G=e.rotation,S=e.anchor,u=e.scale,d=e.shape,p=e.clipHost,w=e.clipRect;if(!K._checkEmptyRect||s.width>0&&s.height>0){if(p){var b=l.getHost().getCorners();I.save(),I.beginPath(),b.forEach(function(H,c){c?I.lineTo(H.x,H.y):I.moveTo(H.x,H.y)}),I.clip()}var R=l.getSize();if(R.x=-R.width*S.x,R.y=-R.height*S.y,$b&&!In&&hi(I,R.width,R.height),I.save(),hi(I,X.x,X.y),Cm(I,G),pq(I,u.x,u.y),w&&(I.beginPath(),I.rect(w.x,w.y,w.width,w.height),I.clip()),U._drawForChecking&&e.img&&gl(e.img.pixelPerfect,l,U)===!1)Dh(I,R.x,R.y,R.width,R.height,"#888888");else if(K.freeDraw)K.freeDraw(I,R,e);else if(d){var T,L,F,$,P=e._60o,h=Jr(I,P),c=e._27Q,Z=e._54o,g=e.shapeGradientPack,a=e.gray,y=I.lineJoin,Y=I.lineCap,t=function(J){return a?M.toGrayColor(J):J};"roundRect"===d?T=W("shape.corner.radius"):"polygon"===d?(T=W("shape.polygon.side"),L=W("shape.corner.radius"),F=W("shape.regular")):"arc"===d&&(T=W("shape.arc.from"),L=W("shape.arc.to"),F=W("shape.arc.close"),$=W("shape.arc.oval")),I.lineJoin=e._62o,I.lineCap=e._61o;var x=t(e._53o);if(x||c||g){var D=e.shapeClipRect;D&&(I.save(),I.beginPath(),I.rect(D.x,D.y,D.width,D.height),I.clip()),Ep(I,d,R,T,L,F,$),g?mc(I,g,function(f){return Of(f,e.bodyColor)},!1,R):c?fk(I,c,t(e.bodyColor),null,l,U):mg(I,x,e.shapeGradient,t(e._59o),R),I.fill(),g&&I.restore(),D&&I.restore(),I!==h&&Ep(h,d,R,T,L,F,$)}else Ep(h,d,R,T,L,F,$);var E=e.shapeForeground;if(E){I.save();var z=e.shapeForegroundClipRect;z&&(I.beginPath(),I.rect(z.x,z.y,z.width,z.height),I.clip()),Ep(I,d,R,T,L,F,$),mg(I,E,W("shape.foreground.gradient"),t(W("shape.foreground.gradient.color")),R),I.fill(),I.restore()}if(Z>0){var Q=W("shape.border.width.absolute");Q&&(I.save(),I.setTransform(1,0,0,1,0,0)),I.lineWidth=Z;var k=t(e._55o),i=e.shapeBorderGradientPack;i?mc(I,i,t,!0,R):e.shapeBorderRepeatImage?_h(I,e.shapeBorderRepeatImage,k,null,l,U):I.strokeStyle=k,I.stroke(),i&&I.restore(),Q&&I.restore(),e._56o&&Gm(I,k,t(e._57o),Z,U._zoom,e._58o)}if(Ui(I,P),W("shape.dash")){var o=W("shape.dash.width")||Z;if(o>0){P=W("shape.dash.pattern");var h=Jr(I,P,K._2Q("shape.dash.offset"));h!==I&&Ep(h,d,R,T,L,F,$),K._1Q(I,"shape",o,P)}}Zk(I,x,e._63o,R),I.lineJoin=y,I.lineCap=Y}else{var n=K.interactiveInfo;n&&(I.interactiveInfo=n.bodyInfo={compInfos:[],matrix:new co(G,X.x,X.y,u.x,u.y)}),e.gray&&(I.compGray=!0);var A=e.img;A&&A.cacheRule!=q&&(A=Pg(I,A,e.stretch,R.width,R.height,l,U,e.bodyColor)),jl(I,A,e.stretch,R.x,R.y,R.width,R.height,l,U,e.bodyColor),I.compGray=!1,I.interactiveInfo=q}I.restore(),p&&I.restore()}K._39O(I,e)},_48O:function(){},_47O:function(){}});var _b=function(Y,U){Vq(_b,this,[Y,U])},pk=function(y,h,N,P){var G=Hh(y,h);return N=P?e(N,G):Oc(N,G),G?N/=G:N=0,{x:y.x+(h.x-y.x)*N,y:y.y+(h.y-y.y)*N}};uj(_b,fd,{_3O:function(){var V,L=this,u=L._data,K=L.gv,l=L.s,f=l(Oi),Q=u.isLooped(),Z=l("edge.width"),c=L.getBodyColor("edge.color"),n=l("edge.center"),y=l("edge.offset"),w=K.getBorderColor(u),e=w?l("border.width"):0,g=L.getSelectWidth(),v=u._40I,s=u._41I,X=L._78o=v&&s?{looped:Q,type:f,width:Z,center:n,color:c,repeatImage:yd(l("edge.repeat.image"),c),borderColor:w,borderWidth:e,_97o:g?L.getSelectColor():q,selectWidth:g,pattern:l("edge.pattern"),cap:l("edge.cap"),join:l("edge.join"),is3d:l("edge.3d"),_67o:l("edge.3d.color"),_66o:l("edge.3d.accuracy"),gray:l("2d.gray")}:q;if(X){var N=M.getEdgeType(f);if(N){var B=N(u,Rg(L,K,u,Q,f),K,L._19Q);B.points&&B.points.size()>1?(X.edgeTypeInfo=B,V=vn(X.edgeTypeInfo.points)):B[To]&&B.rect&&(X.edgeTypeInfo=B,V=B.rect)}else{var i=l("edge.source.anchor.x"),k=l("edge.source.anchor.y"),C=l("edge.target.anchor.x"),b=l("edge.target.anchor.y"),z=Ye(K,u,"source"),d=Ye(K,u,"target");if(f===kh){var j=X.points=l(Zf)||ni,W=j.size();X.segments=l("edge.segments");var F=i!==A||k!==A||dq(v),o=C!==A||b!==A||dq(s);if(!n)if(y)F||(z=pk(z,W?j.get(0):d,y,W)),o||(d=pk(d,W?j.get(W-1):z,y,W));else{var r;F||(r=fb(z,W?j.get(0):d,fm(K,v)),r&&(z={x:r[0],y:r[1]})),o||(r=fb(W?j.get(W-1):z,d,fm(K,s)),r&&(d={x:r[0],y:r[1]}))}V=sm(vn(X.points),vn(z,d))}else{var R=Rg(L,K,u,Q,f);if(L._19Q||(R=-R),Q)z=Wr(z),z.x=K.getNodeRect(v).x,X.radius=R,V={x:z.x-R,y:z.y-R,width:2*R,height:2*R};else{var U=Hh(z,d),m=Oc(y,U),x={x:m,y:R},I={x:U-m,y:R},H=Cl(d.y-z.y,d.x-z.x),p=X.mat=new rd(H);if(X.orienAngle=H,X.angle=d.x<z.x?H+Y:H,X.rect={x:x.x,y:x.y,width:I.x-x.x,height:0},X.origin=z,x=p.tf(x),x.x+=z.x,x.y+=z.y,I=p.tf(I),I.x+=z.x,I.y+=z.y,n){var $={x:U,y:0};$=p.tf($),$.x+=z.x,$.y+=z.y,V=vn([z,x,I,$]),X.c1=z,X.c2=$}else V=vn(x,I);z=x,d=I}}X.sourcePoint=z,X.targetPoint=d,u._lastSourcePoint=z,u._lastTargetPoint=d}var G=0;l("edge.dash")&&(G=l("edge.dash.width")||Z);var t="square"===X.cap?.71:.5;ch(V,E(G*t,Z*t+e+g),X.join),L._68o(V)}},getRotation:function(Y,C,Z){Y=Y||0;var b=this._78o;if(b){var V,J=b.angle,X=b.points,I=b.edgeTypeInfo;if(J!=q)return C?b.orienAngle+Y:J+Y;if(I&&I[To])return I.getRotation?I.getRotation(this,Y,C,Z):0;if(I&&I.points){var u=I.points;return V=u.size(),$e[Z]?V&&0===V%2?rm(u.get(V/2-1),u.get(V/2),C,Y):Y:Ii[Z]?rm(u.get(0),u.get(1),C,Y):rm(u.get(V-2),u.get(V-1),C,Y)}if(X)return V=X.size(),$e[Z]?V&&0===V%2?rm(X.get(V/2-1),X.get(V/2),C,Y):0===V?rm(b.sourcePoint,b.targetPoint,C,Y):Y:Ii[Z]?rm(b.sourcePoint,V?X.get(0):b.targetPoint,C,Y):rm(V?X.get(V-1):b.sourcePoint,b.targetPoint,C,Y)}return Y},getPosition:function(M,Y,d,Z,h){var g=this._78o;if(g){var b,E=g.type,V=g.points,m=g.edgeTypeInfo,p=g.sourcePoint,L=g.targetPoint;if(!E)return g.looped?{x:p.x-g.radius+Y,y:p.y+d}:(h&&p&&L&&(p.x>L.x||p.x===L.x&&p.y>L.y)&&(M=hk[M],d=-d),b=oo(M,g.rect,Z),b.x+=Y,b.y+=d,b=g.mat.tf(b),b.x+=g.origin.x,b.y+=g.origin.y,b);if(m&&m[To])return m.getPosition?m.getPosition(this,M,Y,d,Z,h):{x:(p.x+L.x)/2,y:(p.y+L.y)/2};if(V){var b,f=V.size();if($e[M]){if(f){var v=f%2;if(0===v)return Yj(V.get(f/2-1),V.get(f/2),M,Y,d,Z,h);b=V.get((f-v)/2)}else b={x:(p.x+L.x)/2,y:(p.y+L.y)/2};return b=oo(M,{x:b.x,y:b.y,width:0,height:0},Z),b.x+=Y,b.y+=d,b}return Ii[M]?Yj(p,f?V.get(0):L,M,Y,d,Z,h):Yj(f?V.get(f-1):p,L,M,Y,d,Z,h)}if(m){var W=m.points,f=W.size();if($e[M]){var v=f%2;return 0===v?Yj(W.get(f/2-1),W.get(f/2),M,Y,d,Z,h):(b=W.get((f-v)/2),b=oo(M,{x:b.x,y:b.y,width:0,height:0},Z),b.x+=Y,b.y+=d,b)}return Ii[M]?Yj(W.get(0),W.get(1),M,Y,d,Z,h):Yj(W.get(f-2),W.get(f-1),M,Y,d,Z,h)}}return Wb},_42:function(z){this._78o&&_b.superClass._42.call(this,z)},drawPath:function(i,B){i.beginPath();var d=B.type,p=B.points,j=B.segments,T=B.edgeTypeInfo;if(!d||p){var $=B.sourcePoint,R=$.x,_=$.y,N=B.targetPoint,t=N.x,z=N.y;if(d)if(j){var S=new lo({x:R,y:_});S.addAll(p),S.add({x:t,y:z}),Bg(i,S,j)}else i.moveTo(R,_),p.each(function(W){i.lineTo(W.x,W.y)}),i.lineTo(t,z);else B.looped?i.arc(R,_,B.radius,0,c,!0):B.center?(i.moveTo(B.c1.x,B.c1.y),i.lineTo(R,_),i.lineTo(t,z),i.lineTo(B.c2.x,B.c2.y)):(i.moveTo(R,_),i.lineTo(t,z))}else T&&(T.points?Bg(i,T.points,T.segments):T[To]&&T[To](i,T))},_80o:function(h){var T=this,Q=T.s,E=T._78o,j=E.width,K=E.selectWidth,R=E.borderWidth,B=E.repeatImage,L=h.lineJoin,w=h.lineCap,I=E.gray,H=E.pattern;h.lineJoin=E.join,h.lineCap=E.cap,T.drawPath(Jr(h,H),E);var u=Q("edge.width.absolute");u&&(h.save(),h.setTransform(1,0,0,1,0,0)),K&&(h.strokeStyle=E._97o,h.lineWidth=j+2*(R+K),h.stroke()),R&&(h.strokeStyle=I?M.toGrayColor(E.borderColor):E.borderColor,h.lineWidth=j+2*R,h.stroke());var f=I?M.toGrayColor(E.color):E.color;if(B?_h(h,B,f,null,T._data,T.gv):h.strokeStyle=f,h.lineWidth=j,h.stroke(),E.is3d){var y=I?M.toGrayColor(E._67o):E._67o;Gm(h,f,y,j,T.gv._zoom,E._66o)}if(Q("edge.dash")){H=Q("edge.dash.pattern");var d=Jr(h,H,T._2Q("edge.dash.offset"));d!==h&&T.drawPath(d,E),T._1Q(h,"edge",Q("edge.dash.width")||j,H)}u&&h.restore(),Ui(h,H),h.lineJoin=L,h.lineCap=w},_48O:function(){},_47O:function(){}});var Hg=function(q,o){Vq(Hg,this,[q,o])};uj(Hg,Xj,{_3O:function(){var h,m,Q=this,O=Q.s,L=Q._data,s=Q.gv;if(Q._88I=q,L.isExpanded()&&L.eachChild(function(P){if(uk(P)){var V=s.getBoundsForGroup(P);V&&(m||(m=[]),m.push(V),h=sm(h,V))}}),h){var r=s.getLabel(L),C=O("group.type"),U=O("group.border.width")||0,p=O("group.border.width.absolute"),k=U/2;p&&(U/=s._zoom),h=Pf(C,m,h),bq(h,L,"group.padding",1),Ti(h,U);var l=Q._88I={type:C,rect:h,_64o:h};if(!C&&r!=q){var c,b=Q.labelInfo={label:r,color:O("group.title.color"),font:O("group.title.font"),align:O("group.title.align")},z=Yq(b,r),J=z.width+U,i=z.height+U,j=O("group.title.align"),X=O("group.title.orientation");if(X===vg||X===rj?(h.height+=U,J>h.width&&(h.width=J)):(X===wk||X===Bj)&&(h.width+=U,J>h.height&&(h.height=J)),c=j===wk?h.x:j===Bj?h.x+h.width-J:h.x+h.width/2-J/2,X===rj)l.titleRect={x:h.x,y:h.y+h.height,width:h.width,height:i},l.rect={x:h.x,y:h.y,width:h.width,height:h.height+i},b.rect={x:c,y:h.y+h.height,width:J,height:i};else if(X===wk){var n=l.titleRect={x:h.x-i,y:h.y,width:i,height:h.height};l.rect={x:h.x-i,y:h.y,width:h.width+i,height:h.height},b.rect={x:n.x+i/2-h.height/2,y:n.y+h.height/2-i/2,width:h.height,height:i},b.rotation=-Math.PI/2}else if(X===Bj){var n=l.titleRect={x:h.x+h.width,y:h.y,width:i,height:h.height};l.rect={x:h.x,y:h.y,width:h.width+i,height:h.height},b.rect={x:n.x+i/2-h.height/2,y:n.y+h.height/2-i/2,width:h.height,height:i},b.rotation=Math.PI/2}else l.titleRect={x:h.x,y:h.y-i,width:h.width,height:i},l.rect={x:h.x,y:h.y-i,width:h.width,height:h.height+i},b.rect={x:c,y:h.y-i-k,width:J,height:i+U}}Q._40O(l,O("group.border.width")/2)}else Hg.superClass._3O.call(Q)},getPosition:function(Z,I,Y,x){var W=this._88I;if(W){var C=oo(Z,W.rect,x);return C.x+=I,C.y+=Y,C}return Hg.superClass.getPosition.apply(this,arguments)},_24O:function(t,E){var n=this._88I;(!n||n.type||"label2"===t)&&Hg.superClass._24O.call(this,t,E)},_80o:function(i){var n=this,P=n._88I;if(P){var l=n._data,w=n.s,K=n.gv,M=P.type,H=P.rect,g=P._64o,F=P.titleRect,z=n.getBodyColor(),e=yd(w("group.image"),z),p=w("group.image.stretch"),d=n.getBodyColor("group.background"),X=yd(w("group.repeat.image"),z),Q=w("group.gradient.pack"),J=w("group.gradient"),o=w("group.gradient.color"),f=w("group.border.width"),T=w("group.border.color"),G=w("group.border.pattern"),N=w("group.title.orientation"),C=w("group.depth"),x=w("group.border.radius"),c=w("group.border.join"),A=w("group.border.cap"),R=w("group.border.width.absolute");R&&(f/=K._zoom);var S=T,j=w("group.border.repeat.image");if(j&&(j=yd(j,T))&&(S=Qh(i,j,T,null,l,K)),M){var D=i.lineJoin,h=i.lineCap;if(i.lineJoin=c,i.lineCap=A,e){if(i.save(),Ep(i,M,H,x),i.clip(),jl(i,e,p,H.x,H.y,H.width,H.height,l,K,z),i.restore(),f>0){var I=Jr(i,G);Ep(I,M,H,x),i.lineWidth=f,i.strokeStyle=S,i.stroke(),Ui(i,G)}}else{var I=Jr(i,G);d||X||Q?(Ep(i,M,H,x),Q?mc(i,Q,function(P){return Of(P,z)},!1,H):X?fk(i,X,z,null,l,K):mg(i,d,J,o,H),i.fill(),Q&&i.restore(),i!==I&&Ep(I,M,H,x)):Ep(I,M,H,x),f>0&&(i.lineWidth=f,i.strokeStyle=S,i.stroke()),Ui(i,G),M===jk&&Zk(i,d,C,H)}i.lineJoin=D,i.lineCap=h}else{var y=w("group.title.background");if((!x||0>x)&&(x=0),e)jl(i,e,p,g.x,g.y,g.width,g.height,l,K,n.getBodyColor());else if(d||X)if(X?fk(i,X,z,null,l,K):mg(i,d,J,o,g),0===f)Ep(i,jk,g),i.fill(),Zk(i,d,C,g);else{switch(i.beginPath(),N){case rj:$r(i,g.x,g.y,g.width,g.height,x,x,0,0);break;case wk:$r(i,g.x,g.y,g.width,g.height,0,x,0,x);break;case Bj:$r(i,g.x,g.y,g.width,g.height,x,0,x,0);break;case vg:$r(i,g.x,g.y,g.width,g.height,0,0,x,x)}i.fill()}if(F&&y)if(0===f)Dh(i,F.x,F.y,F.width,F.height,y),Zk(i,y,C,F);else{switch(i.beginPath(),i.fillStyle=y,N){case rj:$r(i,F.x,F.y,F.width,F.height,0,0,x,x);break;case wk:$r(i,F.x,F.y,F.width,F.height,x,0,x,0);break;case Bj:$r(i,F.x,F.y,F.width,F.height,0,x,0,x);break;case vg:$r(i,F.x,F.y,F.width,F.height,x,x,0,0)}i.fill()}if(f>0){var I=Jr(i,G);if(Ep(I,"roundRect",H,x),i.save(),i.lineWidth=f,i.strokeStyle=S,i.lineJoin=c,i.lineCap=A,i.closePath(),i.stroke(),F&&w("group.splitLine")){var t=F.x,_=F.y,q=F.width,U=F.height;i.beginPath(),N===rj?(i.moveTo(t,_),i.lineTo(t+q,_)):N===wk?(i.moveTo(t+q,_),i.lineTo(t+q,_+U)):N===Bj?(i.moveTo(t,_),i.lineTo(t,_+U)):(i.moveTo(t,_+U),i.lineTo(t+q,_+U))}i.stroke(),i.restore(),Ui(I,G)}}n._39O(i,P)}else Hg.superClass._80o.call(n,i)}});var ge=function(n,P){Vq(ge,this,[n,P])};uj(ge,Xj,{_80o:function(L){this._39O(L,this._83o)}});var Wm=function(S,Q){Vq(Wm,this,[S,Q])};uj(Wm,Xj,{_3O:function(){var p=this,y=p._data,S=p.s,e=p.gv,C=y.getPoints(),r=e.getBorderColor(y),h=r?S("border.width"):0,L=p.getSelectWidth(),u=S("shape.border.width"),T=y.getRect(),G=y.getAnchorRect(),I=e.getBodyColor(y),g=S("shape.border.color"),M=p._99o=C.isEmpty()?q:{rect:T,rotation:y.getRotation(),fillRule:S("shape.fill.rule"),scale:y.getScale(),position:y.p(),points:C,segments:y.getSegments(),bodyColor:I,borderColor:r,borderWidth:h,_94o:S("shape.border.3d"),_95o:S("shape.border.3d.color"),_96o:S("shape.border.3d.accuracy"),_97o:L?p.getSelectColor():q,selectWidth:L,_53o:S("shape.background"),_27Q:yd(S("shape.repeat.image"),I),shapeGradientPack:S("shape.gradient.pack"),shapeBorderGradientPack:S("shape.border.gradient.pack"),_54o:u,_55o:g,shapeBorderRepeatImage:yd(S("shape.border.repeat.image"),g),shapeGradient:S("shape.gradient"),_59o:S("shape.gradient.color"),_60o:S("shape.border.pattern"),_61o:S("shape.border.cap"),_62o:S("shape.border.join"),shapeForeground:S("shape.foreground"),gray:S("2d.gray")};if(M){G.x+=M.position.x,G.y+=M.position.y,M.gradientRect=G;var o=y.getScale(),X=E(1,E(D(o.x),D(o.y)));S("shape.dash")&&S("shape.dash.width")>u&&(u=S("shape.dash.width"));var b,n=S("shape.border.width.absolute");b=n?(u+h+L)/p.gv._zoom/X:u*("square"===M._61o?.71:.5)+h+L/p.gv._zoom/X,b&&(b*=X,T=Wr(T),ch(T,b,M._62o)),p._68o(T);var Y=S("clip.percentage");Y!=A&&(M.clipRect=jj(y.getAnchorRect(),S("clip.direction"),Y));var f=S("shape.fill.clip.percentage");f!=A&&(M.shapeClipRect=jj(y.getAnchorRect(),S("shape.fill.clip.direction"),f));var _=S("shape.foreground.clip.percentage");_!=A&&(M.shapeForegroundClipRect=jj(y.getAnchorRect(),S("shape.foreground.clip.direction"),_))}},getPosition:function(m,L,o,r){var I=this._99o;if(I){var Y=oo(m,I.rect,r);return Y.x+=L,Y.y+=o,Y}return Wb},_42:function(M){this._99o&&Wm.superClass._42.call(this,M)},_80o:function(I){var X,c=this,B=c.s,N=c._99o,q=N.position,D=N.scale,d=N.rotation,C=N.borderWidth,U=c.gv._zoom,Q=N.selectWidth/U,J=N._27Q,Y=N.shapeGradientPack,i=N._54o,L=N.clipRect,P=N.shapeClipRect,j=N.points,m=N.segments,r=c._data.isClosePath(),R=N.fillRule,w=N.gray,b=function($){return w?M.toGrayColor($):$},f=b(N._53o),G=f||J||Y;I.save(),hi(I,q.x,q.y),Cm(I,d),pq(I,D.x,D.y),L&&(I.beginPath(),I.rect(L.x,L.y,L.width,L.height),I.clip()),G&&P&&(I.save(),I.beginPath(),I.rect(P.x,P.y,P.width,P.height),I.clip());var $=Wr(N.rect);x.Default.extractShapeTranslation?(j=Wr(j),j.forEach(function(b){b.x-=q.x,b.y-=q.y}),$.x-=q.x,$.y-=q.y):hi(I,-q.x,-q.y);var l=B("shape.border.width.absolute"),v=N._60o;l&&v&&(v=v.map(function(m){return m*U}));var e=Jr(I,v),O=I.lineJoin,z=I.lineCap;I.lineJoin=N._62o,I.lineCap=N._61o;var s=b(N.bodyColor);G?(Bg(I,j,m,r),Y?mc(I,Y,function(i){return Of(i,N.bodyColor)},!1,$):J?fk(I,J,s,null,c._data,c.gv):(X=s?s:f,mg(I,X,N.shapeGradient,b(N._59o),N.gradientRect)),I.fill(R),Y&&I.restore(),P&&(I.restore(),hi(I,-q.x,-q.y)),e!==I&&Bg(e,j,m,r)):Bg(e,j,m,r);var H=N.shapeForeground;if(H){I.save();var K=N.shapeForegroundClipRect;K&&(hi(I,q.x,q.y),I.beginPath(),I.rect(K.x,K.y,K.width,K.height),I.clip(),hi(I,-q.x,-q.y)),Bg(I,j,m,r),mg(I,H,B("shape.foreground.gradient"),b(B("shape.foreground.gradient.color")),N.gradientRect),I.fill(R),I.restore()}if(l&&(I.save(),I.setTransform(1,0,0,1,0,0)),Q&&(I.strokeStyle=N._97o,I.lineWidth=i+2*(C+Q),I.stroke()),C&&(I.strokeStyle=b(N.borderColor),I.lineWidth=i+2*C,I.stroke()),i){X=b(N._55o);var n=N.shapeBorderGradientPack;n?mc(I,n,b,!0,$):N.shapeBorderRepeatImage?_h(I,N.shapeBorderRepeatImage,X,null,c._data,c.gv):(!f&&s&&(X=s),I.strokeStyle=X),I.lineWidth=i,I.stroke(),n&&I.restore(),N._94o&&Gm(I,X,b(N._95o),i,U,N._96o)}if(Ui(I,v),B("shape.dash")){var p=B("shape.dash.width")||i;if(p>0){v=B("shape.dash.pattern"),l&&(v=v.map(function(E){return E*U}));var e=Jr(I,v,c._2Q("shape.dash.offset"));e!==I&&Bg(e,j,m,r),c._1Q(I,"shape",p,v)}}l&&I.restore(),I.lineJoin=O,I.lineCap=z,I.restore()},_48O:function(){},_47O:function(){}});var nn=function(_,A){Vq(nn,this,[_,A])};uj(nn,Wm,{getRotation:function(){var _=new sd,z=new sd,S=new co;return function(F,U,n){F=F||0;var X=this._data,j=X.getPoints(),I=j.size();if(I>1){var t,m,W=X.p(),D=X.getScale();if(S.identity().translate(-W.x,-W.y).scale(D.x,D.y).translate(W.x,W.y),$e[n]){var H=I%2,J=(I-H)/2;t=j.get(J-1),m=j.get(J)}else Ii[n]?(t=j.get(0),m=j.get(1)):(t=j.get(I-2),m=j.get(I-1));return S.apply(t,_),S.apply(m,z),rm(_,z,U,F)}return F}}(),getPosition:function(){var V=new sd,$=new sd,P=new sd;return function(v,u,y,D,o){var l=this._data,Z=l.getPoints(),I=Z.size();if(I>1){var A,E,X=l.getPointsMatrix2d();if($e[v]){var d=I%2,R=(I-d)/2;if(A=Z.get(R-1),E=Z.get(R),0!==d){var W=oo(v,Wb,D);return W.x+=u,W.y+=y,X.apply(A,V),X.apply(E,$),X.identity().rotate(P.copy($).sub(V).angle()).apply(W,V).add($)}}else Ii[v]?(A=Z.get(0),E=Z.get(1)):(A=Z.get(I-2),E=Z.get(I-1));return X.apply(A,V),X.apply(E,$),Yj(V,$,v,u,y,D,o)}return Wb}}()});var or=function(U,Y){Vq(or,this,[U,Y])};uj(or,Xj,{_3O:function(){var _=this;or.superClass._3O.call(_);var S=_.s,Y=_._83o;_._82o=Y.img||Y.shape?q:{background:_.getBodyColor("grid.background"),depth:S("grid.depth"),rect:Y.rect,_88o:S("grid.cell.depth"),cellBorderColor:S("grid.cell.border.color"),_89o:S("grid.row.count"),_90o:S("grid.column.count"),block:S("grid.block"),_91o:S("grid.block.color"),_92o:S("grid.block.padding"),_93o:S("grid.block.width")}},_80o:function(P){var B=this,w=B._82o;if(!w)return or.superClass._80o.call(B,P),void 0;var H,X,A=B._data,l=w.background,n=w.rect,m=w.block,R=w._91o,O=w._92o,c=w._93o,$=w._88o,i=w.cellBorderColor,s=w._89o,r=w._90o;if(l)if(Dh(P,n.x,n.y,n.width,n.height,l),Zk(P,l,w.depth,n),$)for(H=0;s>H;H++)for(X=0;r>X;X++)n=A.getCellRect(H,X),n&&Zk(P,l,$,n);else if(i){for(P.beginPath(),H=0;s>H;H++)for(X=0;r>X;X++)n=A.getCellRect(H,X),n&&P.rect(n.x,n.y,n.width,n.height);P.strokeStyle=i,P.lineWidth=1,P.stroke()}if("h"===m)for(H=0;s>H;H++)n=sm(A.getCellRect(H,0),A.getCellRect(H,r-1)),Ti(n,O),Co(P,R,n.x,n.y,n.width,n.height,c);else if("v"===m)for(X=0;r>X;X++)n=sm(A.getCellRect(0,X),A.getCellRect(s-1,X)),Ti(n,O),Co(P,R,n.x,n.y,n.width,n.height,c);B._39O(P,B._83o)}});var Vl=function(i,o){Vq(Vl,this,[i,o])},od=$?rs().getContext("2d"):q;uj(Vl,Xj,{_checkEmptyRect:!1,_81o:function(){var C=this._data,e=Vl.superClass._81o.call(this),U=C.s("text");if(U!=q){U+="";var s,K=C.s("text.font"),i=C.s("text.align"),B=C.s("text.vAlign"),p=C.s("text.wrap"),X=C.s("text.vertical"),u=C.s("text.vertical.gap"),k=C.s("text.letter.gap")||0,n=C.getWidth(),h=C.getHeight();if(null==u&&(u=1),X){var y;y=p?wj(U,h,K,k,X,u):[U];var x=(y.length-1)*k,W=0;od.textBaseline=vg,od.font=K,y.forEach(function(i){for(var e=i.length,O=0,n=(e-1)*u,q=0;e>q;q++){var D=od.measureText(i[q]);n+=D.fontBoundingBoxDescent||bi(K,i[q]).height,O=E(O,D.width)}x+=O,W=E(n,W)});var D=(y.length-1)*k;y.forEach(function(h){D+=h}),s={width:x,height:W}}else{var y=p?wj(U,n,K,k,X,u):U.split("\n"),Q=y.length;if(Q>1){var M=bi(K,U).height,x=0,W=M*Q+u*(Q-1);y.forEach(function(a){x=E(x,bi(K,a).width)}),s={width:x,height:W}}else s=bi(K,U),k&&(s.width+=(U.length-1)*k)}var A,Y,v=s.width,H=s.height,J=C.getAnchor();"left"===i?A=-n*J.x:"center"===i?A=-n*J.x+(n-v)/2:"right"===i&&(A=n*(1-J.x)-s.width),"top"===B?Y=-h*J.y:"middle"===B?Y=-h*J.y+(h-H)/2:"bottom"===B&&(Y=h*(1-J.y)-s.height);var z,c=C.getMatrix();if(z=vn([c.tf(A,Y),c.tf(A+v,Y),c.tf(A+v,Y+H),c.tf(A,Y+H)]),e=sm(e,z),e&&C.s("text.shadow")){var m=Wr(e);m.x+=C.s("text.shadow.offset.x"),m.y+=C.s("text.shadow.offset.y"),Ti(m,C.s("text.shadow.blur")),e=sm(e,m)}}return e}});var hr=Tq.Interactor=function(e){this.gv=this._graphView=e};cl("Interactor",u,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(W){this.gv.fi(W)},setCursor:function(W){lf||this.gv.setCursor(W)},startDragging:function(t){var g=this;g._lastClientPoint=Yi(t),g._lastLogicalPoint=g.gv.lp(t),Tl(g,t)},clearDragging:function(){var C=this;C._lastClientPoint=C._lastLogicalPoint=C._logicalPoint=q},autoScroll:function(q){return this.gv.autoScroll(q,this._lastClientPoint)}});var $f=q,eb=function($){$f.handleWindowTouchMove($)},Og=function(P){$f.handleWindowTouchEnd(P),F(W,Mg,eb),F(W,gh,Og),$f=q},be=function(Y){$f.handleWindowMouseMove(Y)},Bk=function(r){$f.handleWindowMouseUp(r),F(W,Mr,be),F(W,zp,Bk),$f=q},xp=function(r,i){if(r!==$f){var m=Wg(i);$f?m?$f.handleWindowTouchEnd(i):$f.handleWindowMouseUp(i):m?(X(W,Mg,eb),X(W,gh,Og)):(X(W,Mr,be),X(W,zp,Bk)),$f=r}},nb=function(x){var _=this;_.gv=x,_._is2d=x instanceof Tq.GraphView,_._eventListeners={},["mousedown","mousemove","mouseleave","touchstart","touchmove",Qj,"wheel"].forEach(function(C){_.addListener(C)}),_.initImageResource()};uj(nb,hr,{enableVR:function(U){var t=this;!!t._vrEnable!==U&&(t._vrEnable=U,U?t.gv.vr.mp(t.onVRControllerChange,t):t.gv.vr.ump(t.onVRControllerChange,t))},onVRControllerChange:function(w){var K=this,_=w.property,B=w.newValue,Y=B.id,G=K.gv.vr.getController(Y),P=G.getRay();if(P){P.controllerId=Y;var i=K.gv.vr.getRayEventType(P,_,B[td]);switch(i){case"down":K.handle_mousedown(P);break;case"up":$f&&Bk(P);break;case"move":K.handle_mousemove(P),$f&&K.handleWindowMouseMove(P)}}},setPreventEventDefault:function(V,T){var N=this,h=N._eventListeners[V];h?h._prevent=T:N._eventListeners[V]=h={_removal:A,_prevent:T}},removeListener:function(X){var B=this,g=B._eventListeners[X];g&&g._removal&&(g._removal(),g._removal=A)},addListener:function(T){var H=this,V=H._eventListeners[T];if(V||(H._eventListeners[T]=V={_removal:A,_prevent:!0}),!V||!V._removal){var s=function(X){V._prevent&&M.preventDefault(X),H.disabled||H.gv._48Q||("wheel"===T?Ab(H,X):H["handle_"+T](X))};X(H.gv.getView(),T,s),V._removal=function(){F(H.gv.getView(),T,s)}}},handleWindowTouchMove:function(M){this.handleWindowMouseMove(M)},handleWindowMouseMove:function(S){return!this.downInfo||Wg(S)&&1!==rn(S)?(this.isDragging&&(this.handleDownInfo("onEndDrag",S),this.isDragging=!1),void 0):(this.isDragging?this.handleDownInfo("onDrag",S):(this.handleDownInfo("onBeginDrag",S),this.isDragging=!0),void 0)},handleWindowTouchEnd:function(A){this.handleWindowMouseUp(A)},handleWindowMouseUp:function(U){if(this.isDragging&&(this.handleDownInfo("onEndDrag",U),this.isDragging=!1),this.downInfo){var v=this.handle("onUp",U);if(v&&v.data===this.downInfo.data){this.handleMissingUp(U);var Y=this,$=2===U.button?"onContextMenu":"onClick",j=v.data;if(j.s("disableDoubleClick")||!Y._dbclickTimer)return Y._dbclickTimer=Zl(function(){delete Y._dbclickTimer,Y.handleClick(U,$,v),this.downInfo=q},M.clickDelay),void 0;hh(Y._dbclickTimer),delete Y._dbclickTimer,$="onDoubleClick",Y.handleClick(U,$,v)}else this.handleDownInfo("onUp",U);this.downInfo=q,this.downComps=q}},handle_mouseleave:function(U){var n=this,J=n.gv;n._hoverTimer&&(hh(n._hoverTimer),delete n._hoverTimer);var V=n.currentInfo?n.currentInfo.data:q;if(V){V.s("onLeave")&&V.s("onLeave")(U,V,J),n.fire("data","onLeave",U,V);var b=n.currentInfo?n.currentInfo.hits:q;if(b)for(var R in b)n.handleLeave(U,R);n.currentInfo=q}},handle_mousewheel:function(V){V.scrollDelta=V.wheelDelta/40,this.handle("onScroll",V)},handle_DOMMouseScroll:function(A){A.scrollDelta=2===A.axis?-A.detail:0,this.handle("onScroll",A)},handle_touchstart:function(t){this.handle_mousedown(t)},handle_touchmove:function(S){this.handle("onMove",S)},handle_mousedown:function(X){this.isDragging&&(this.handleDownInfo("onEndDrag",X),this.isDragging=!1),this.downComps=[],this.downInfo=this.handle("onDown",X),this.downInfo&&xp(this,X)},handle_mousemove:function(C){var K=this,W=K.gv;if(K._hoverTimer&&(hh(K._hoverTimer),delete K._hoverTimer),!W._panning&&!W._moving){var a,b,j,N=K.handle("onMove",C),B=this.currentInfo?this.currentInfo.data:q,w=this.currentInfo?this.currentInfo.hits:q;if(N&&(b=N.data,j=N.hits,K._hoverTimer=Zl(function(){hh(K._hoverTimer),delete K._hoverTimer,K.handle("onHover",C,N)},W.getHoverDelay()||M.hoverDelay)),b!==B){if(B&&(B.s("onLeave")&&B.s("onLeave")(C,B,W),this.fire("data","onLeave",C,B)),b&&(b.s("onEnter")&&b.s("onEnter")(C,b,W),this.fire("data","onEnter",C,b)),w)for(a in w)this.handleLeave(C,a);if(j)for(a in j){var n=j[a],e=b._interactPrefix=n.prefix,s=e&&b.a(e+"onEnter")||n.target.onEnter;s&&s.call(n.target,C,b,W,n.point,n.width,n.height),this.fire(n.type,"onEnter",n.event,n.data,n.image,n.comp,n.point,n),b._interactPrefix=null}}else{if(w)for(a in w)j&&j[a]||this.handleLeave(C,a);if(j)for(a in j)if(!w||!w[a]){var n=j[a],e=b._interactPrefix=n.prefix,s=e&&b.a(e+"onEnter")||n.target.onEnter;s&&s.call(n.target,C,b,W,n.point,n.width,n.height),this.fire(n.type,"onEnter",n.event,n.data,n.image,n.comp,n.point,n),b._interactPrefix=null}}this.currentInfo=N}},handle:function(d,z,o){var F,j=this,E=j.gv;if(j._is2d){if(o=o||E.getDataInfoAt(z),!o||!E.isInteractive(o.data))return;if(F=o.ui.interactiveInfo){var J,q=o.data;if(q.s(d)&&q.s(d)(z,q,E),this.fire("data",d,z,q),"body"===o.part&&F.bodyInfo)J="body",o.hits=this.handleImage(J,E.getImage(q),d,z,q,o.point,F.bodyInfo);else if("icons"===o.part&&F._38o){var U=F._38o[o.name];U&&U[o.index]&&(J="icons|"+o.name+"|"+o.index,o.hits=this.handleImage(J,o.icon,d,z,q,o.point,U[o.index]))}}return o}var q,p;if(!o)if(z&&z instanceof x.Math.Ray&&E.isVREnabled()){var $=E.vr.intersectWorld(z);if(q=$.data,p=$.intersect,E.vr.renderRayDuringInteraction(z,q,p),!q)return;var O=E.getData3dUI(q);if(F=O.interactiveInfo,!F)return;o={data:q,part:p.part,ui:O}}else{if(o=this.getDataInfoAt(z),!o)return;o&&(o={data:o.data,part:o.part})}if(E.isInteractive(o.data)){if(!p){q=o.data;var O=E.getData3dUI(q);if(o.ui=O,F=O.interactiveInfo,!F)return o;if(p=E.intersectObject(z,q),!p)return o}q.s(d)&&q.s(d)(z,q,E),this.fire("data",d,z,q);var X,S=p.part;return"body"!==S&&(X=q.s(S+".image")||q.s("shape3d."+S+".image")),X||(X=q.s("all.image")||q.s("shape3d.image")),X?(F="object"==typeof X?F[X.uuid]:F[X],F&&F.bodyInfo?(o.part="body",o.interactiveInfo=F,o.point=this._convertUVToPoint(p.uv,F,q,S,X),o.image=X,o.hits=this.handleImage("body",X,d,z,q,o.point,F.bodyInfo),o):o):o
}},_handleLeaveOrMissing:function(_,L,j){var r="leave"===_?this.currentInfo:this.downInfo;if(r){var I=r.interactiveInfo||r.ui.interactiveInfo;if(I){var U,C,K=r.data;if(this._is2d){if(C=this.gv.lp(L),"body"===r.part&&I.bodyInfo)U="body","leave"===_?this.handleLeaveImage(j,U,this.gv.getImage(K),L,K,C,I.bodyInfo):this.handleMissingUpImage(U,this.gv.getImage(K),L,K,C,I.bodyInfo);else if("icons"===r.part&&I._38o){var Q=I._38o[r.name];Q&&Q[r.index]&&(U="icons|"+r.name+"|"+r.index,"leave"===_?this.handleLeaveImage(j,U,r.icon,L,K,C,Q[r.index]):this.handleMissingUpImage(U,r.icon,L,K,C,Q[r.index]))}}else{if(!I.bodyInfo)return;var a=this.gv.intersectObject(L,K);C=a&&a.uv?this._convertUVToPoint(a.uv,I,K,a.part,r.image):{x:1/0,y:1/0},"leave"===_?this.handleLeaveImage(j,"body",r.image,L,K,C,I.bodyInfo):this.handleMissingUpImage("body",r.image,L,K,C,I.bodyInfo)}}}},handleClick:function(f,Y,L){var V=this,a=this.downInfo;if(a&&L){var E,J=L.interactiveInfo||L.ui.interactiveInfo,i=L.data,q=this.gv;if(i.s(Y)&&i.s(Y)(f,i,q),V.fire("data",Y,f,i),J)if(this._is2d){if(a.part===L.part){var h=q.lp(f);"body"===L.part&&J.bodyInfo&&(E="body",this.handleClickImage(E,q.getImage(i),Y,f,i,h,J.bodyInfo,L))}}else{if(!J.bodyInfo)return;var w=q.intersectObject(f,i);if(!w)return;h=this._convertUVToPoint(w.uv,J,i,w.part,a.image),this.handleClickImage("body",a.image,Y,f,i,h,J.bodyInfo,L)}}},handleDownInfo:function(m,V){if(this.downInfo){var y=this.downInfo,U=this.gv,A=y.interactiveInfo||y.ui.interactiveInfo;if(A){var c,Y=y.data;if(Y.s(m)&&Y.s(m)(V,Y,U),this.fire("data",m,V,Y),this._is2d){var g=U.lp(V);if("body"===y.part&&A.bodyInfo)c="body",this.handleDownInfoImage(c,U.getImage(Y),m,V,Y,g,A.bodyInfo);else if("icons"===y.part&&A._38o){var D=A._38o[y.name];D&&D[y.index]&&(c="icons|"+y.name+"|"+y.index,this.handleDownInfoImage(c,y.icon,m,V,Y,g,D[y.index]))}}else{if(!A.bodyInfo)return;var X;if("onBeginDrag"===m?(X=U._raycaster.intersectObjectAndRecordTriangle(V,Y),X&&(A.beginDragIntersectInfo=X.triangleInfo)):X=U.intersectObject(V,Y),!X&&("onDrag"!==m&&"onEndDrag"!==m||!A.beginDragIntersectInfo||(X=U._raycaster.intersectLastTriangle(V,A.beginDragIntersectInfo)),!X))return;g=this._convertUVToPoint(X.uv,A,Y,X.part,y.image),this.handleDownInfoImage("body",y.image,m,V,Y,g,A.bodyInfo)}}}},fire:function(B,m,f,O,o,D,I,r){this.gv.fi({kind:m,type:B,event:f,data:O,image:o,comp:D,view:this.gv,point:I,width:r?r.width:A,height:r?r.height:A})},handleImage:function(k,g,Y,s,G,f,y){var D={};if(g&&(g=yd(g))){var L=this.gv,$=y.rect,O=this.convertPoint(f,y);O.inRect&&(g[Y]&&g[Y](s,G,L,O,$.width,$.height),this.fire("image",Y,s,G,g,A,O,$),D[k+"|image"]={target:g,type:"image",image:g,data:G,event:s,point:O,width:$.width,height:$.height});for(var H,Z=y.compInfos,p=g,X=Z.length-1;X>=0;X--){var M=Z[X],B=M.comp;if(O=this.convertPoint(f,M,p,B,L,G),O.inRect){$=M.rect;var V=G._interactPrefix=M.prefix,o=V&&G.a(V+Y)||B[Y];if(o&&(H=o.call(B,s,G,L,O,$.width,$.height)),this.fire("comp",Y,s,G,g,B,O,$),H!==!0&&(g=$.image)&&(g[Y]&&(H=g[Y](s,G,L,O,$.width,$.height)),this.fire("image",Y,s,G,g,A,O,$)),G._interactPrefix=null,D[k+"|"+X]={target:B,type:"comp",comp:B,image:g,data:G,event:s,point:O,width:$.width,height:$.height,prefix:V},this.downComps&&this.downComps.push(B),g&&(D[k+"|"+X+"|image"]={target:g,type:"image",image:g,data:G,event:s,point:O,width:$.width,height:$.height,prefix:V}),H===!0)break}}}return D},handleLeave:function(l,W){return this._handleLeaveOrMissing("leave",l,W)},handleMissingUp:function(P){return this._handleLeaveOrMissing("missing",P)},handleLeaveImage:function(z,I,d,W,T,K,y){if(d&&(d=yd(d))){var N=this.gv,p=y.rect,Z=this.convertPoint(K,y);z===I+"|image"&&(d.onLeave&&d.onLeave(W,T,N,Z,p.width,p.height),this.fire("image","onLeave",W,T,d,A,Z,p));for(var S,R=y.compInfos,h=d,f=R.length-1;f>=0;f--){var u=R[f],Y=u.comp;Z=this.convertPoint(K,u,h,Y,N,T),p=u.rect;var c=T._interactPrefix=u.prefix;if(z===I+"|"+f){var e=c&&T.a(c+"onLeave")||Y.onLeave;e&&(S=e.call(Y,W,T,N,Z,p.width,p.height)),this.fire("comp","onLeave",W,T,d,Y,Z,p)}if(S!==!0&&(d=p.image)&&z===I+"|"+f+"|image"&&(d.onLeave&&(S=d.onLeave(W,T,N,Z,p.width,p.height)),this.fire("image","onLeave",W,T,d,A,Z,p)),T._interactPrefix=null,S===!0)break}}},handleMissingUpImage:function(f,z,j,g,d,O){var U="onUp",o=this.downInfo.hits;if(o&&z&&(z=yd(z))){var s=this.gv,x=O.rect,M=this.convertPoint(d,O);!M.inRect&&o[f+"|image"]&&(z[U]&&z[U](j,g,s,M,x.width,x.height),this.fire("image",U,j,g,z,A,M,x));for(var l,D=O.compInfos,y=z,w=D.length-1;w>=0;w--){var X=D[w],c=X.comp;if(M=this.convertPoint(d,X,y,c,s,g),!M.inRect){x=X.rect;var t=g._interactPrefix=X.prefix;if(o[f+"|"+w]){var m=t&&g.a(t+U)||c[U];m&&(l=m.call(c,j,g,s,M,x.width,x.height)),this.fire("comp",U,j,g,z,c,M,x)}if(l!==!0&&(z=x.image)&&o[f+"|"+w+"|image"]&&(z[U]&&(l=z[U](j,g,s,M,x.width,x.height)),this.fire("image",U,j,g,z,A,M,x)),g._interactPrefix=null,l===!0)break}}}},handleDownInfoImage:function(k,n,x,P,q,Z,a){var j=this.downInfo.hits;if(j&&n&&(n=yd(n))){var Q=this.gv,s=a.rect,y=this.convertPoint(Z,a);j[k+"|image"]&&(n[x]&&n[x](P,q,Q,y,s.width,s.height),this.fire("image",x,P,q,n,A,y,s));for(var t,v=a.compInfos,D=n,G=v.length-1;G>=0;G--){var E=v[G],i=E.comp;y=this.convertPoint(Z,E,D,i,Q,q),s=E.rect;var r=q._interactPrefix=E.prefix,g=["onDrag","onEndDrag"].indexOf(x)>=0;if(!g&&j[k+"|"+G]||g&&this.downComps&&this.downComps.indexOf(i)>=0){var M=r&&q.a(r+x)||i[x];M&&(t=M.call(i,P,q,Q,y,s.width,s.height)),this.fire("comp",x,P,q,n,i,y,s)}if(t!==!0&&(n=s.image)&&j[k+"|"+G+"|image"]&&(n[x]&&(t=n[x](P,q,Q,y,s.width,s.height)),this.fire("image",x,P,q,n,A,y,s)),q._interactPrefix=null,t===!0)break}}},handleClickImage:function(n,Z,I,z,f,t,F,L){var p=this.downInfo.hits,P=L.hits;if(p&&Z&&(Z=yd(Z))){var r=this.gv,R=F.rect,X=this.convertPoint(t,F);p[n+"|image"]&&(Z[I]&&Z[I](z,f,r,X,R.width,R.height),this.fire("image",I,z,f,Z,A,X,R));for(var m,c=F.compInfos,h=Z,i=c.length-1;i>=0;i--){var v=c[i],Y=v.comp;X=this.convertPoint(t,v,h,Y,r,f),R=v.rect;var U=f._interactPrefix=v.prefix;if(p[n+"|"+i]&&P[n+"|"+i]){var y=U&&f.a(U+I)||Y[I];y&&(m=y.call(Y,z,f,r,X,R.width,R.height)),this.fire("comp",I,z,f,Z,Y,X,R)}if(m!==!0&&(Z=R.image)&&p[n+"|"+i+"|image"]&&(Z[I]&&(m=Z[I](z,f,r,X,R.width,R.height)),this.fire("image",I,z,f,Z,A,X,R)),f._interactPrefix=null,m===!0)break}}},initImageResource:function(){M.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},_convertUVToPoint:function(I,w,e,P,j){if(!I)return{x:1/0,y:1/0};var f=w.bodyInfo.rect;if(e&&j){var c,X;if("body"===P?(X=e.s("shape3d.uv.scale"),c=e.s("shape3d.uv.offset")):(X=e.s(P+".uv.scale")||e.s("all.uv.scale"),c=e.s(P+".uv.offset")||e.s("all.uv.offset")),X||c){j=M.getImage(j);var s=Mh.isPOT(j.width)&&Mh.isPOT(j.height),h=I.x*(X?X[0]:1)+(c?c[0]:0),d=I.y*(X?X[1]:1)+(c?c[1]:0);s&&(h=h%1+(h>0?0:1),d=d%1+(d>0?0:1)),I.set(h,d)}}var O=I.clone(),E=I.multiply({x:f.width,y:f.height});return E.local=O,E},convertPoint:function(r,i,Z,Q,c,W){var K=i.rect,x=i.matrix.applyInverse(r).sub(K),g=x.x>=0&&x.y>=0&&x.x<=K.width&&x.y<=K.height;if(!g)return x;if(Q&&gl(Q.pixelPerfect,W,c)){var K,Y=1;this._is2d?(Y=c.getZoom(),K=Fn(r.x,r.y,A,Y)):K=Fn(r.x,r.y);var k=!1,E=K.x,H=K.y,w=K.width,o=K.height,C=M.hitMaxArea,e=w*o*Y*Y;if(e>C){var T=Math.sqrt(C/e);Y*=T}w*=Y,o*=Y,2>w&&(w=2),2>o&&(o=2),E*=Y,H*=Y;var N=Pn(w,o),z=new co(0,-E,-H,Y,Y);z.append(i.matrix),c._drawForChecking=!0,Q.transform=z;var d=Z.fitSize;i.refRect&&i.refRect.fitSize?(Q.refRect=i.refRect,Z.fitSize=!0):Z.fitSize=!1;var t=Z.comps;Z.comps=[Q],xb(N,Z,0,0,w,o,W,self),Z.comps=t,Z.fitSize=d,delete Q.refRect,delete Q.unionRect,delete Q.transform,c._drawForChecking=!1;try{for(var L=0,X=N.getImageData(0,0,w,o).data;L<X.length;L+=4)if(0!==X[L+3]){k=!0;break}N.restore()}catch(b){Pr=q,k=!1}x.inRect=k}else x.inRect=!0;return x},getDataInfoAt:function(o,t){return Qs.prototype.getDataInfoAt.call(this,o,t)}});var Wf=Tq.DefaultInteractor=function(X){Vq(Wf,this,[X])};cl("DefaultInteractor",hr,{handle_mousedown:function(C){lr(C);var x=this,Z=x.gv,K=Z.getDataAt(C);if(Z.setFocus(C)&&!Z._editing&&!Z._scrolling){zr(C)?Z.handleDoubleClick(C,K):Z.handleClick(C,K);var s=$i(C);!Yo()&&!s&&K&&(Z.isMovable(K)||Z._39Q(K))||!Z.isPannable()||!$h(C)&&!s||qp(C)||(x._tx=Z.tx(),x._ty=Z.ty(),x.startDragging(C))}},handleWindowMouseUp:function(P){var H=this,t=H.gv;t._panning&&(delete t._panning,t.onPanEnded(),H.fi({kind:"endPan",event:P})),delete H._tx,delete H._ty,H.clearDragging()},handle_mousemove:function(L){var x=this,H=x.gv;x._hoverTimer&&(hh(x._hoverTimer),delete x._hoverTimer),x._hoverTimer=Zl(function(){x.fi({kind:"hover",event:L}),hh(x._hoverTimer),delete x._hoverTimer},H.getHoverDelay()||M.hoverDelay)},handle_mouseleave:function(){var i=this;i._hoverTimer&&(hh(i._hoverTimer),delete i._hoverTimer)},handleWindowMouseMove:function(H){var D=this,l=D.gv;D.fi({kind:l._panning?"betweenPan":"beginPan",event:H}),l._panning=1;var k=sl(l,H,D._lastClientPoint);l.setTranslate(D._tx+k.x,D._ty+k.y)},handle_mousewheel:function(j){this.gv.handleScroll(j,j.wheelDelta)},handle_DOMMouseScroll:function(V){2===V.axis&&this.gv.handleScroll(V,-V.detail)},handle_keydown:function(Y){this.gv.handleKeyDown(Y)}});var Ol=Tq.SelectInteractor=function(n){Vq(Ol,this,[n])};cl("SelectInteractor",hr,{_42:function(){var k=this,Q=k.gv,t=Q.getZoom(),L=k.mark,X=k.div;X||(X=k.div=Kn(),Bh(k.getView(),X));var e={};e.x=L.x*t+Q.tx(),e.y=L.y*t+Q.ty(),e.width=L.width*t,e.height=L.height*t,Xn(X,e),this.intersects()?(X.style.border="",X.style.background=Q.getRectSelectBackground()):(X.style.background="",X.style.border="1px solid "+Q.getRectSelectBorderColor())},handle_mousedown:function(U){var e=this,l=e.gv;if(e._57I=q,e.pendingClickThrough=q,!(l._editing||l._scrolling||Yo()||$i(U))){var a=l.getDataAt(U),m=l.sm();a?qp(U)?m.co(a)?m.rs(a):m.as(a):m.co(a)?a instanceof df&&a.isClickThroughEnabled()&&$h(U)&&(e.pendingClickThrough=Yi(U)):m.ss(a):qp(U)||!l.isPannable()?$h(U)&&(qp(U)||m.cs(),l.isRectSelectable()&&(e.startDragging(U),l._77O=1)):$h(U)&&(e._57I=Yi(U))}},handle_mouseup:function(U){var j=this,h=j.gv,l=j._57I;if(l&&(Hh(l,Yi(U))<=1&&h.sm().cs(),j._57I=q),j.pendingClickThrough){if(Hh(j.pendingClickThrough,Yi(U))<=1){var p=h.getDataAt(U);if(p instanceof df&&p.isClickThroughEnabled()){var g=h.getDataAt(U,function(S){var R=S.getParent()===p&&h.isSelectable(S,!0);return R});g&&(U.clickThrough=!0,h.sm().ss(g))}}j.pendingClickThrough=q}},handleWindowMouseUp:function(R){this.clear(R)},handleWindowMouseMove:function(p){var h=this,T=h.gv;h._logicalPoint=T.lp(p),h.mark?(h.fi({kind:"betweenRectSelect",event:p}),T.isPannable()&&h.autoScroll(p),h.redraw()):h.fi({kind:"beginRectSelect",event:p}),h.mark=vn(h._lastLogicalPoint,h._logicalPoint),h.redraw()},intersects:function(){var q=this,Q=q._lastLogicalPoint,X=q._logicalPoint;return Q.x>X.x||Q.y>X.y},clear:function(o){var s=this,Z=s.gv,x=s.mark;if(s._57I=q,s.pendingClickThrough=q,s._lastLogicalPoint){if(x){if(0!==x.width&&0!==x.height){var $=Z.getDatasInRect(x,s.intersects());if(!$.isEmpty()){var C=Z.sm(),b=C.toSelection(),G=ck(o),U=o.altKey;$.each(function(w){C.co(w)?(!G||G&&U)&&b.remove(w):(!U||G&&U)&&b.add(w)}),C.ss(b)}}Qn(s.div),delete s.div,delete s.mark,s.redraw(),s.fi({kind:"endRectSelect",event:o}),Z.onRectSelectEnded()}s.clearDragging(),delete Z._77O}},redraw:function(){var F=this;F._draw||(F._draw=1,Zl(function(){F.mark&&F._42(),delete F._draw},16))}});var Pj=Tq.MoveInteractor=function(v){Vq(Pj,this,[v])};cl("MoveInteractor",hr,{handle_mousedown:function(e){var E=this,t=E.gv;if($h(e)&&!t._editing&&!t._scrolling&&!Yo()){var $=t.getSelectedDataAt(e);!$||t._39Q($)&&!t.isMovable($)?t._focusData=q:(E._data=$,t.handleMouseDown&&t.handleMouseDown(e,$),E.startDragging(e),t.isMovable($)&&(t._moving=1))}},handleWindowMouseUp:function(Q){var F=this,D=F.gv;D.handleMouseUp&&D.handleMouseUp(Q,F._data),F.clear(Q)},handleWindowMouseMove:function(S){var J=this,Y=J._data,h=J.gv;if((!h._93O||!h._93O(S,Y))&&h._moving){J._logicalPoint||J.fi({kind:"prepareMove",event:S});var r=J._logicalPoint?"betweenMove":"beginMove",W={kind:r,event:S},n=J._logicalPoint=h.lp(S);"beginMove"!==r||J._alreadyBeginTransaction||(J._alreadyBeginTransaction=!0,h.getDataModel().beginTransaction());var j=J._calcShift(r,S),K=j.x,z=j.y,B=J.gv.getMoveMode(S,Y);B&&("x"===B?z=0:"y"===B?K=0:"xy"!==B&&(K=z=0)),h.moveSelection(K,z),J._lastLogicalPoint=n,J.autoScroll(S),J.fi(W)}},_calcShift:function(){var r=this,f=r._logicalPoint,h=r._lastLogicalPoint,N=f.x-h.x,$=f.y-h.y;return{x:N,y:$}},clear:function(M){var Z=this,d=Z.gv;Z._lastLogicalPoint&&(Z._lastLogicalPoint=Z._data=d._moving=q,Z._logicalPoint&&(Z.fi({kind:"endMove",event:M}),d.onMoveEnded()),Z.clearDragging()),Z._alreadyBeginTransaction&&(Z._alreadyBeginTransaction=!1,d.getDataModel().endTransaction())}});var Hq=Tq.TextEditInteractor=function(G){Vq(Hq,this,[G]),this.init()};cl("TextEditInteractor",hr,{setUp:function(){var t=this;Hq.superClass.setUp.call(t),t.gv.mp(t.handleGvPropertyChange,t)},teatDown:function(){var t=this;Hq.superClass.teatDown.call(t),t.gv.ump(t.handleGvPropertyChange,t)},handleGvPropertyChange:function(){this._editTarget&&this.endTextEdit()},init:function(){var D=this,l=this.input=$.createElement("input"),P=l.style;l.text="text",P.border="1px solid #d8d8d8",P.position="absolute",P.padding="2px 3px",P.outline="none",P.marginLeft="-90px",P.marginTop="-16px",P.backgroundColor="rgba(255,255,255, 1)",P.fontSize="14px",P.width="180px",P.height="32px",P.boxShadow="0 0 13px rgba(16,142,233, 0.5)",P.textAlign="center",P.boxSizing="border-box",X(l,"keyup",function(e){return yn(e)&&D.endTextEdit(),$q(e)?(D.endTextEdit(!0),void 0):void 0}),X(l,"focus",function(){l.select()});var W=this.textarea=$.createElement("textarea"),f=this.wrap=$.createElement("div");f.appendChild(W),P=W.style,P.margin=0,P.padding="4px",P.overflow="hidden",P.boxSizing="border-box",P.position="absolute",P.outline="none",P.backgroundColor="transparent",P.resize="none",P.textAlign="center",P.fontSize="14px",P.borderWidth=0,P.width="100%",P=f.style,P.boxSizing="border-box",P.margin=0,P.padding=0,P.position="absolute",P.boxShadow="0 0 13px rgba(16,142,233, 0.5)",P.border="1px solid #d8d8d8",P.backgroundColor="rgba(255,255,255, 1)",P.zIndex="10",X(W,"keydown",function(o){return(ck()||qp())&&yn(o)?(D.endTextEdit(),void 0):$q(o)?(D.endTextEdit(!0),void 0):(D._editTarget instanceof Tn||D.calculateTextareaHeight(String.fromCharCode(o.keyCode)),void 0)}),X(W,"focus",function(){W.select()});var t=function(C){C.stopPropagation()};X(l,"mousedown",t),X(l,"touchstart",t),X(W,"mousedown",t),X(W,"touchstart",t),X(W,"click",t),D.SIZING_STYLE=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],D.HIDDEN_TEXTAREA_STYLE="visibility:hidden; min-height:0 !important;max-height:none !important;height:0 !important;visibility:hidden !important;overflow:hidden !important;position:absolute !important;z-index:-1000 !important;top:0 !important;right:0 !important",D.handleWindowClick=function(N){var w=D._editingDOM;if(w){var g=w.getBoundingClientRect(),_=Yi(N);Do(g,_)||D.endTextEdit()}}},handle_mousedown:function(i){var q=this,N=q.gv;if(zr(i)&&!N._editing){var w=N.getDataAt(i);if(w){var g=N.getTextEditInfo(w);g&&(this._editInfo=g,this._editTarget=w,N._editing=!0,g.isMultiline?this.handleMultilineEdit():this.handleTextEdit())}}},handleMultilineEdit:function(){var K=this,M=K.gv,s=K._editTarget,w=K.getTargetValue(),c=K.textarea,S=K.wrap,y=this._editInfo;this.hiddenTextarea||this.createHiddenTextarea(),(null===w||w===A)&&(w=""),c.value=w,y.font&&(c.style.font=y.font),K._editingDOM=c,M.appendHTML(S),this.layoutHTML(S,s),s instanceof Tn?c.style.height="100%":(c.style.height="auto",this.calculateTextareaHeight()),Zl(function(){c.focus(),X(W,"mousedown",K.handleWindowClick),X(W,"touchstart",K.handleWindowClick)},10)},handleTextEdit:function(){var Z=this,O=Z.gv,L=Z._editTarget,H=Z.getTargetValue(),U=Z.input;(null===H||H===A)&&(H=""),U.value=H,Z._editingDOM=U,O.getView().appendChild(U),this.layoutHTML(U,L),Zl(function(){U.focus(),X(W,"mousedown",Z.handleWindowClick),X(W,"touchstart",Z.handleWindowClick)},10)},layoutHTML:function(T,k){var t=this.gv,l=t.getZoom();if(k instanceof Tn){var q=t.getDataUI(k),D=q._6I,j=k.getScale(),S=T.style;T.style.left=D.x*l+t.tx()+"px",T.style.top=D.y*l+t.ty()+"px",T.style.width=q._6I.width+"px",T.style.height=q._6I.height+"px",zc(S,"transform","scale("+l*j.x+","+l*j.y+")"),zc(S,"transformOrigin","0px 0px")}else if(k instanceof Ak){var D=k.getRect(),u=D.width*l;T.style.left=(D.x+D.width/2)*l+t.tx()+"px",T.style.top=(D.y+D.height/2)*l+t.ty()+"px",T.style.width=u+"px",T.style.marginLeft=-u/2+"px"}else if(k instanceof x.Edge){var q=t.getDataUI(k),D=q._6I;T.style.left=(D.x+D.width/2)*l+t.tx()+"px",T.style.top=(D.y+D.height/2)*l+t.ty()+"px"}},endTextEdit:function(k){var N=this,Y=N._editInfo.isMultiline?N.wrap:N.input,r=N._editInfo.isMultiline?N.textarea:N.input;k||N.setTargetValue(r.value),N.gv.getView().removeChild(Y),N.gv._editing=!1,delete N._editingDOM,delete N._editTarget,F(W,"mousedown",N.handleWindowClick),F(W,"touchstart",N.handleWindowClick)},setTargetValue:function(w){var J=this,f=J._editTarget,F=J._editInfo,v=F.accessType,z=F.name;if(z&&v||(v="p",z="name"),"p"===v){var j=x.Default.setter(z);f[j](w)}else"a"===v?f.a(z,w):f.s(z,w)},getTargetValue:function(){var D=this,O=D._editTarget,j=D._editInfo,A=j.accessType,X=j.name;if(X&&A||(A="p",X="name"),"p"===A){var k=x.Default.getter(X);return O[k]()}return"a"===A?O.a(X):O.s(X)},createHiddenTextarea:function(){this.hiddenTextarea=$.createElement("textarea"),this.hiddenTextarea.setAttribute("style","margin:0; padding:0; position:absolute; overflowY:scroll; resize:none; box-sizing:border-box;pointer-events: none;opacity:0;"),this.hiddenTextarea.setAttribute("rows","1"),this.gv.getView().appendChild(this.hiddenTextarea)},calculateHTMLStyle:function(j,_){if(_&&this.computedStyleCache)return this.computedStyleCache;var m=this,a=W.getComputedStyle(j),t=a.getPropertyValue("box-sizing")||a.getPropertyValue("-moz-box-sizing")||a.getPropertyValue("-webkit-box-sizing"),X=parseFloat(a.getPropertyValue("padding-bottom"))+parseFloat(a.getPropertyValue("padding-top")),L=parseFloat(a.getPropertyValue("border-bottom-width"))+parseFloat(a.getPropertyValue("border-top-width")),G=m.SIZING_STYLE.map(function(G){return G+":"+a.getPropertyValue(G)}).join(";"),r={sizingStyle:G,paddingSize:X,borderSize:L,boxSizing:t};return _&&(this.computedStyleCache=r),r},calculateTextareaHeight:function(V){V=V||"";var i=this,u=i.textarea,q=i.hiddenTextarea,N=i.wrap,n=32,C=i.calculateHTMLStyle(u,!1),e=C.paddingSize,r=C.borderSize,T=C.boxSizing,U=C.sizingStyle;q.setAttribute("style",U+";"+i.HIDDEN_TEXTAREA_STYLE),q.value=u.value+V;var L=q.scrollHeight;"border-box"===T?L+=r:"content-box"===T&&(L-=e),u.style.height=L+"px",N.style.height=Math.max(L,n)+"px",N.style.marginTop=L*-.5+"px"}});var ef=Tq.ScrollBarInteractor=function(f){Vq(ef,this,[f])};cl("ScrollBarInteractor",hr,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(c){var p=this.gv.getViewRect();return this._41o()&&(p.x+p.width-this.gv.lp(c).x)*this.gv.getZoom()<Ym},isH:function(r){var q=this.gv.getViewRect();return this._40o()&&(q.y+q.height-this.gv.lp(r).y)*this.gv.getZoom()<Ym},handle_mousemove:function(V){this.handle_touchmove(V)},handle_touchmove:function(k){if(!Yl&&$h(k)&&this.gv.isScrollBarVisible()){var b=this,t=b.isV(k),$=b.isH(k);(t||$)&&b.gv.showScrollBar(),b.gv._scrolling=t||$}},handleWindowMouseUp:function(j){this.handleWindowTouchEnd(j)},handleWindowTouchEnd:function(T){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=q,this.fi({kind:"endScroll",event:T})},handle_mousedown:function(c){this.handle_touchstart(c)},handle_touchstart:function(O){var d=this;if(d.gv.setFocus(O),lr(O),d.handle_touchmove(O),!(rn(O)>1)&&d.gv._scrolling&&d.gv.isScrollBarVisible()){d._cp=Yi(O),d._tx=d.gv.tx(),d._ty=d.gv.ty();var t=d.isV(O);d._state=t?"vScroll":"hScroll",Tl(d,O),d.fi({kind:"beginScroll",event:O})}},handleWindowMouseMove:function(N){this.handleWindowTouchMove(N)},handleWindowTouchMove:function(N){var r=Yi(N),M=this.gv.getViewRect(),e=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-r.y)*e.height/M.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-r.x)*e.width/M.width),this.fi({kind:"betweenScroll",event:N})}});var qm=Tq.TouchInteractor=function(c,M){M=M||{},M.selectable===A&&(M.selectable=!0),M.movable===A&&(M.movable=!0),M.pannable===A&&(M.pannable=!0),M.pinchable===A&&(M.pinchable=!0),M.editable===A&&(M.editable=!0),this.params=M,Vq(qm,this,[c])};cl("TouchInteractor",hr,{ms_edit:1,setUp:function(){var c=this;qm.superClass.setUp.call(c),lf&&c.params.editable&&c.gv.setEditInteractor(c)},tearDown:function(){var p=this;qm.superClass.tearDown.call(p),lf&&p.params.editable&&p.gv.setEditInteractor(q)},clear:function(I){var H=this,p=H.gv;p._moving&&(H.fi({kind:"endMove",event:I}),delete p._moving,p.onMoveEnded(),p.dm().endTransaction()),p._panning&&(H.fi({kind:"endPan",event:I}),delete p._panning,p.onPanEnded()),p._pinching&&(H.fi({kind:"endPinch",event:I}),delete p._pinching,p.onPinchEnded()),p._editing&&(H._46O(I),H._77I=H._node=H._edge=H._shape=H._rect=H._89I=H._index=p._editing=q),H.pendingClickThrough=H._moving=H._panning=H._pinching=H._editing=H._57I=H._data=H._beginHistory=q,H.clearDragging()},handle_touchstart:function(L){var y=this;if(!y.gv._editing){lr(L),y._57I=q,y.pendingClickThrough=q;var J=y.params,o=y.gv,m=o.sm(),C=o.getDataAt(L),p=rn(L);if(1===p){if(zr(L))return o.handleDoubleClick(L,C),void 0;o.handleClick(L,C),C&&(o.handleMouseDown&&o.handleMouseDown(L,C),y._data=C),J.selectable||(C=q),C&&(m.co(C)?C instanceof df&&C.isClickThroughEnabled()&&(y.pendingClickThrough=Yi(L)):m.ss(C),J.editable&&o.isEditable(C)&&y._79I(L,C,!0)?(y._editing=1,y.startDragging(L)):J.movable&&o.isMovable(C)&&(y._moving=1,y.startDragging(L))),C&&(o.isMovable(C)||o._39Q(C))||(y._57I=Yi(L),J.pannable&&o.isPannable()&&(y._panning=1,y.startDragging(L),y._translate={x:o.tx(),y:o.ty()}))}else if(J.pinchable&&2===p){if(!o.getEditInteractor()&&C){var V=yd(o.getImage(C));if(V&&gl(V.scrollable,C,this))return}y._pinching=1,y.startDragging(L);var d=o.getView(),i=o.getZoom(),M=d.getBoundingClientRect(),$=L.touches[0],X=L.touches[1],U={x:($.clientX+X.clientX)/2-M.left,y:($.clientY+X.clientY)/2-M.top};U.x-=o.tx(),U.y-=o.ty(),U.x/=i,U.y/=i,y._p=U,y._d=ce(L)}}},handle_touchend:function(s){var h=this,L=h.gv,i=h._57I,C=h._data;if(i&&(Hh(i,Yi(s))<=1&&!L.getDataAt(s)&&L.sm().cs(),h._57I=q),C&&L.handleMouseUp&&L.handleMouseUp(s,C),h.pendingClickThrough){if(Hh(h.pendingClickThrough,Yi(s))<=1){var C=L.getDataAt(s);if(C instanceof df&&C.isClickThroughEnabled()){var p=L.getDataAt(s,function(R){var p=R.getParent()===C&&L.isSelectable(R,!0);return p});p&&(s.clickThrough=!0,L.sm().ss(p))}}h.pendingClickThrough=q}},handleWindowTouchEnd:function(p){this.clear(p)},handleWindowTouchMove:function(X){var x=this,o=x.gv,P=rn(X);if(1===P){var O=Yi(X),G=sl(o,O,x._lastClientPoint),D=Hh({x:0,y:0},G);if(x._editing&&(x._beginHistory||(x._beginHistory=1,o.dm().beginTransaction()),o._editing=1,x._78I(X)),x._moving){if(!o._moving&&D<M.touchMoveThreshold)return;x._beginHistory||(x._beginHistory=1,o.dm().beginTransaction()),x.handleMove(X)}else if(x._panning){if(!o._panning&&D<M.touchMoveThreshold)return;o.setTranslate(x._translate.x+G.x,x._translate.y+G.y),x.fi({kind:o._panning?"betweenPan":"beginPan",event:X}),o._panning=1}}else if(2===P&&x._pinching){var H=ce(X);o.handlePinch(x._p,H,x._d),x._d=H,x.fi({kind:o._pinching?"betweenPinch":"beginPinch",event:X}),o._pinching=1}},handleMove:function(S){var F=this,$=F.gv,x=$.lp(S);$._93O&&$._93O(S,F._data)||($.moveSelection(x.x-F._lastLogicalPoint.x,x.y-F._lastLogicalPoint.y),F._lastLogicalPoint=x,F.autoScroll(S),F.fi({kind:$._moving?"betweenMove":"beginMove",event:S}),$._moving=1)}});var x=W.ht,hf=x.graph._editor={Math:x.Math,Guide:{}};hf.getStyle=function(x){var G,K=hf.StyleMap;return K&&(G=K[x],G!==A)?G:hf.DefaultStyleMap[x]},hf.setStyle=function(v,D){var J=hf.StyleMap;J||(J=hf.StyleMap={}),J[v]=D},hf.inEdit=function(v){return v._inXEdit===!0},hf.startEdit=function(d){d._inXEdit=!0,hf.Inject.doInject(d)},hf._46O=function(p){p._inXEdit=!1,hf.Inject.undoInject(p)},hf.toScreenPosition=function(k,a){var A=k.tx(),W=k.ty(),C=k._zoom;return new hf.Math.Vector2(a.x*C+A,a.y*C+W)},hf.checkHit=function(T,W,X){return T.distanceTo(W)<X?!0:!1},hf.toWorldPosition=function(C,N){var m=C.tx(),u=C.ty(),k=C._zoom;return{x:(N.x-m)/k,y:(N.y-u)/k}},hf.setAntialias=function(Q,V){for(var C,U=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],c=0,G=U.length;G>c&&(C=U[c],!(C in Q));c++);Q[C],Q[C]=V},hf.getTargetCornersOnScreen=function(C,$){if(!$)return null;var k,G=[];if(Ac($,C)){var y=fm(C,$);k=[{x:y.x,y:y.y},{x:y.x+y.width,y:y.y},{x:y.x+y.width,y:y.y+y.height},{x:y.x,y:y.y+y.height}]}else{if(!$.getCorners)return null;k=$.getCorners()}return k.forEach(function(h){var i=hf.toScreenPosition(C,h);G.push(i.x,i.y)}),G},hf.log=function(){};var ne;hf.updateTipInfo=function(o,I,e){if(e){var g=x.Default.getLogicalPoint(o,I._canvas);g.x+=hf.Icons.TipShiftX,g.y+=hf.Icons.TipShiftY,ne={helperPos:g,text:e,size:e.length}}else ne=q},hf.drawTip=function(C,_){ne&&hf.Icons.DrawIcon(_,C,hf.Icons.TipHelper,ne)};var dh=hf.Inject={_modules:[]};dh.registAsModule=function(I,N){var E={},d={};for(var X in I){var v=N.prototype[X];E[X]=v}I.getBackup=function(s){return E[s]},I.getBackups=function(){return E},d.doInject=function(){for(var t in I)"getBackup"!==t&&(N.prototype[t]=I[t])},d.undoInject=function(){for(var C in I)"getBackup"!==C&&(N.prototype[C]=E[C])},dh._modules.push(d)},dh.doInject=function(K){for(var j,M=dh._modules,U=0,Y=M.length;Y>U;U++)j=M[U],j.doInject(K)},dh.undoInject=function(s){for(var K,L=dh._modules,l=0,T=L.length;T>l;l++)K=L[l],K.undoInject(s)};var hr=x.graph.EditInteractor=function(d){var G=this,I=$.createElement("canvas");I.className="editCanvas",I.style.position="absolute",G._uuid=x.Math.generateUUID(),G._styleMap={},G._canvas=I,G._context=I.getContext("2d"),hr.superClass.constructor.call(G,d),this._editDetail=!1,hf.setAntialias(G._context,!1),G._subModules=G.initSubModule(),G._gridGuide=new hf.Guide.Grid(G),G._rectGuide=new hf.Guide.Rect(G),G._hoverGuide=new hf.Guide.Hover(G)},wo=hr;x.Default.def(hr,x.graph.Interactor,{ms_edit:1,ms_fire:1}),u.defineProperties(hr.prototype,{editDetail:{get:function(){var q=!!this._editDetail;return q},set:function(P){var G=this,n=G._editDetail;n!==P&&(G._editDetail=P,G.gv._editing=P,G.fp("editDetail",n,P),G.fp("pointsEditingMode",n,P),G.fi({kind:P?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(a){(!this._editDetail||a)&&(this.gv._editing=a,a||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(n){this._editing=n,this.gvEditing=n}},editingModule:{get:function(){return this._editMod}},pointsEditingMode:{get:function(){return this.editDetail},set:function(T){var v=this;v.editDetail!==T&&(T?v._tryEnterEditDetailMode():v._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var R=this._gridEnabled;if(!R)return!1;var s=this.gv;return s?!0:!0},set:function(S){S!==this._gridEnabled&&(this._gridEnabled=S,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(P){P!==this._agEnabled&&(this._agEnabled=P,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}},hoverGuide:{get:function(){return this._hoverGuide}}}),hr.prototype.initSubModule=function(){var X=this;return[new hf.Anchor(X),new hf.RotateX(X),new hf.MoveDummy(X),new hf.Rect(X),new hf.Curve(X),new hf.MoveHelper(X)]},hr.prototype.getSubModule=function(S){var v,o,$,Z=this._subModules;for(o=0,$=Z.length;$>o;o++)if(v=Z[o],v.catalog===S)return v},hr.prototype.invokeSubModule=function(N,J){for(var l,G,Q,s=this,S=s._subModules,O=Array.prototype.slice.call(arguments,2),R=0,b=S.length;b>R;R++)if(l=S[R],G=l[N],G&&(Q=G.apply(l,O),Q!=A&&J))return l},hr.prototype.invokeSubModuleInverse=function(I,Q){var K=this,j=K._subModules;if(j)for(var V,X,l,n=Array.prototype.slice.call(arguments,2),a=j.length-1;a>=0;a--)if(V=j[a],X=V[I],X&&(l=X.apply(V,n),l!=A&&Q))return V},hr.prototype.setUp=function(){hf.log("setUp");var i=this,_=i.gv,e=_.getView(),c=i._canvas;hr.superClass.setUp.call(i),_.setEditInteractor(i),_._79O?e.insertBefore(c,_._79O):e.appendChild(c),hf.startEdit(_),i.invokeSubModule("setUp"),_.dm().mm(i._onDataModelChanged,i),_.dm().md(i._onDataPropertyChanged,i)},hr.prototype.tearDown=function(){hf.log("tearDown");var X=this,s=X.gv,Q=s.getView();X._resetCustomCursorStyle(),hr.superClass.tearDown.call(X),s.dm().umm(X._onDataModelChanged,X),s.dm().umd(X._onDataPropertyChanged,X),s.setEditInteractor(null),Q.removeChild(X._canvas),X._drawTimer&&(hh(X._drawTimer),X._drawTimer=null),hf._46O(s),X.invokeSubModule("tearDown")},hr.prototype._onDataModelChanged=function(O){var c=this;("clear"===O.kind||"remove"===O.kind&&c.editDetail&&O.data===c.getSubModule("Curve").target)&&(c.editDetail=!1,c._42())},hr.prototype._onDataPropertyChanged=function(n){var O=this;if(O.editDetail){var Y=O.getSubModule("Curve"),G=n.data;G===Y.target&&(G._writing||Y._handleDataChanged(n))}},hr.prototype.clear=function(){hf.log("clear")},hr.prototype.redraw=function(){this._42()},hr.prototype._42=function(){var x=this;x._drawTimer||(x._drawTimer=Zl(function(){x._drawTimer=null,x.drawImpl()},0))},hr.prototype.drawImpl=function(){var e;for(e in{_42:!0})break;return function(){var u=this,Y=u._canvas,W=u.gv,A=W.getWidth(),S=W.getHeight(),h=u._context,J=x.Default.getInternal(),q=M.devicePixelRatio;(Y.width!==A||Y.height!==S)&&J.setCanvas(Y,A,S,q),h.clearRect(0,0,Y.width,Y.height);var y=u._getValidSelection();h.save(),h.scale(q,q),u._gridGuide._42(),u.invokeSubModuleInverse(e,!1,h,W,y),u._rectGuide._42(),u._hoverGuide._42(),h.restore()}}(),hr.prototype._getValidSelection=function(){var A=this,v=A.gv,J=v.sm().getSelection(),y=[];return J.each(function(z){v.isVisible(z)&&v.isEditable(z)&&y.push(z)}),y},hr.prototype.handle_touchmove=function(h){return this.handle_mousemove(h)},hr.prototype.handle_mousemove=function(o){if(!x.Default.isDragging()){var d=this;if((d.editDetail||!Yo()&&!$i(o))&&!d.gv._externalEditing){if(d.gvEditing=!1,d._checkEdit(o))d.gvEditing=!0;else{if(!d.getStyle("hoverGuideVisible"))return;d.hoverData=d.gv.getDataAt(o)}d._42()}}},hr.prototype.handle_touchstart=function(P){return this.handle_mousedown(P)},hr.prototype.handle_mousedown=function(k){lr(k);var l=this;if((l.editDetail||!Yo()&&!$i(k))&&!l.gv._externalEditing){if(zr(k)&&!k.clickThrough){if(l.editDetail){if(l._tryQuitEditDetailMode(k))return}else if(l._tryEnterEditDetailMode())return;l.gv.dm().beginTransaction();var s=l.invokeSubModule("handleDoubleClick",!0,k);if(l.gv.dm().endTransaction(),s)return}var r=l._checkEdit(k);r&&(l._downPosition=l._getLogicalPoint(k),l.gv.dm().beginTransaction(),r.startEdit(l,k),l.editing=!0)}},hr.prototype._checkEdit=function(Z){var x=this,e=x.gv,X=x._getLogicalPoint(Z),u=x.invokeSubModule("check",!0,e,Z,X)||null;return x._editMod=u,u},hr.prototype.handleWindowTouchMove=function(J){return this.handleWindowMouseMove(J)},hr.prototype.handleWindowMouseMove=function(S){var A=this,P=A._downPosition;if(P){var q=A._getLogicalPoint(S);if(q.distanceTo(P)<A.getStyle("moveSensitivity"))return;delete A._downPosition}var w=A._editMod;
w&&w.handleEdit(A.gv,S),A.redraw()},hr.prototype._getLogicalPoint=function(g){var j=this,s=x.Default.getLogicalPoint(g,j._canvas);return new hf.Math.Vector2(s)},hr.prototype.handleWindowTouchEnd=function(O){return this.handleWindowMouseUp(O)},hr.prototype.handleWindowMouseUp=function(){var w;for(w in{_46O:!0})break;return function(X){var W=this;W.editing=!1,W.setCursor("default"),W.invokeSubModule(w,!1,X),W._42(),W.gv.dm().endTransaction()}}(),hr.prototype.handle_mousewheel=function(G){var h=this;lr(G),h.invokeSubModule("preHandleScroll",!0)||h.gv.handleScroll(G,G.wheelDelta)},hr.prototype.handleDelete=function(){var k=this;if(!k.editDetail){k.gv.dm().beginTransaction();var v=k.invokeSubModule("handleNormalStateDelete",!0);return k.gv.dm().endTransaction(),v||k.gv.removeSelection(),void 0}k.gv.dm().beginTransaction(),k.invokeSubModule("handleDelete",!0),k.gv.dm().endTransaction(),k._42()},hr.prototype.handle_keydown=function(I){var Y=this;if((I.metaKey||I.ctrlKey)&&Y._42(),Yo(I)&&!Y.editing)return Y.gvEditing=!1,Y.setCursor("default"),Y._42(),void 0;var W=yn(I);return Y.editDetail?((W||$q(I))&&(Y.editDetail=!1,Y._42()),Y.gv.dm().beginTransaction(),Y.invokeSubModule("handle_keydown",!0,I),Y.gv.dm().endTransaction(),void 0):(Y.gv.dm().beginTransaction(),Y.invokeSubModule("handleNormalStateKeyDown",!0,I),Y.gv.dm().endTransaction(),W&&Y._tryEnterEditDetailMode(),void 0)},hr.prototype.handle_keyup=function(n){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,n),this.gv.dm().endTransaction()},hr.prototype._tryEnterEditDetailMode=function(){var w=this;return!w.editDetail&&w.invokeSubModule("canEnterEditDetailMode",!0)&&1===w._getValidSelection().length?(w.editDetail=!0,w._42(),!0):void 0},hr.prototype._tryQuitEditDetailMode=function(H){var k=this;return k.editDetail?!H||k.invokeSubModule("canQuitEditDetailMode",!0,H)?(k.editDetail=!1,k._42(),!0):!1:!1},hr.prototype.setStyle=function(z,Q,J){var U=this;J?hf.setStyle(z,Q):U._styleMap[z]=Q,"baseColor"===z&&(yr=Q),U.fp("styleChanged",null,{key:z,value:Q,base:J}),U._42()},hr.prototype.getStyle=function(s){var r=this,b=r._styleMap[s];return b!==A?b:hf.getStyle(s)},hr.prototype.setCursor=function(I){this._resetCustomCursorStyle(),x.graph.EditInteractor.superClass.setCursor.call(this,I)},hr.prototype._drawHostGuide=function(r){var P=this,C=P._context,K=P.gv;hf.Icons.DrawIcon(P,C,hf.Icons.NodeHoverGuide,r.corners);var J=r.host;if(J){var I=K.getAttachPoints(J);if(I&&I.length)for(var S=0,A=I.length;A>S;S++){var b=I[S],R=fp(K,J,0,b.offsetX||0,b.offsetY||0,b.x,b.y);R=hf.toScreenPosition(K,R),R.isAttach=r.attach===S,hf.Icons.DrawIcon(P,C,hf.Icons.AttachPoint,R)}}},hr.prototype._resetCustomCursorStyle=function(){var T=this;if(T._customStyle){var O=this.gv.getView();O.classList&&O.classList.remove&&O.classList.remove(T._customStyle),T._customStyle=null}},hr.prototype._setRotateCursor=function(X){var R=this,e=R._cursorFactory;e||(e=R._cursorFactory=new hf.CursorFactory(R));var u=e.getRotateCursor(X),J=R.gv.getView();R._resetCustomCursorStyle(),R._customStyle=u,J.classList&&J.classList.add&&J.classList.add(u)};var Dd=hf.Group=function(x){var G=this;G._entities=x,G._64O=0,G._position={x:0,y:0},G._scale={x:1,y:1},G._anchor={x:.5,y:.5},G._anchor2={x:.5,y:.5}};Dd.prototype={},Dd.prototype.constructor=Dd;var Xm=null,Qc=null;Dd.findOrCreateGroup=function(U,C){if(Qc===C&&Xm&&Xm.checkIsMe(U))return Xm;Qc=C;var N=new hf.Group(U);return N.getKeyOb()?(Xm=N,N):void 0},Dd.prototype.checkIsMe=function(B){var H=this._entities;if(H.length!==B.length)return!1;var q,n={},I=B.length;for(q=0;I>q;q++)n[B[q]._id]=!0;for(q=0;I>q;q++)if(!n[H[q]._id])return!1;return!0},Dd.prototype.getRotation=function(){return this._64O},Dd.prototype.getPosition=function(){return this._position},Dd.prototype.getAnchor=function(){return this._anchor},Dd.prototype.getWidth=function(){return this._width},Dd.prototype.getScale=function(){return this._scale},Dd.prototype.getSize=function(){return{width:this._width,height:this._height}},Dd.prototype.getHeight=function(){return this._height},Dd.prototype.getKeyOb=function(){for(var V=this._entities,Q=V.length-1;Q>=0;Q--){var T=V[Q];if(this.isNode(T))return T}},Dd.prototype.getAnchor2=function(){var z=this,w=z.rotateCenter;if(w)return w;var $=z.getKeyOb();if(!$)return z._anchor;var Y=z._anchor2,V=$.getMatrix();return V.tf({x:$.getWidth()*(Y.x-$.getAnchor().x),y:$.getHeight()*(Y.y-$.getAnchor().y)})},Dd.prototype.setAnchor2=function(J,h){var b=this,l=b.getKeyOb();if(l){var X,i=l.getMatrix();X="number"==typeof J?{x:J,y:h}:J;var v=i.tfi(X);b._anchor2={x:l.getAnchor().x+v.x/l.getWidth(),y:l.getAnchor().y+v.y/l.getHeight()}}},Dd.prototype.setRotation=function(){},Dd.prototype.beginRotate=function(h){this.rotateCenter=h.pos,this.rotateMode=h.groupRotateMode},Dd.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},Dd.prototype.addRotation=function(n,F,M){return"batch"===F?this._addRotationInBatchMode(n,M):"block"===F?this._addRotationInBlockMode(n,M):void 0},Dd.prototype._addRotationInBlockMode=function(b,P){var A=this,D=A.rotateCenter||A.getPosition();A._entities.forEach(function(k){if(A.isNode(k)&&(!P||P(k))){var C=k.getMatrix();C.translate(-D.x,-D.y),C.rotate(b),C.translate(D.x,D.y);var y=Math.sign(k.getScale().x);k.setRotation(Cl(C.b*y,C.a*y)),k.setPosition(C.tx,C.ty)}})},Dd.prototype._addRotationInBatchMode=function($,G){var N=this,D=N._anchor2;N._entities.forEach(function(p){if(N.isNode(p)&&(!G||G(p))){var A=p.getAnchor(),V=p.getMatrix(),K=V.tf({x:p.getWidth()*(D.x-A.x),y:p.getHeight()*(D.y-A.y)}),R=new hf.Math.Matrix2d;R.set(V.a,V.b,V.c,V.d,V.tx,V.ty),R.translate(-K.x,-K.y),R.rotate($),R.translate(K.x,K.y);var j=Math.sign(p.getScale().x);p.setRotation(Cl(R.b*j,R.a*j)),p.setPosition(R.tx,R.ty)}})},Dd.prototype.setPosition=function(P){var R,h,J,q,W=this,M=W._position,y=P.x-M.x,C=P.y-M.y,e=W._entities;for(h=0,J=e.length;J>h;h++)R=e[h],uk(R)&&(q=R.getPosition(),R.setPosition(q.x+y,q.y+C));W._position=P},Dd.prototype.setScale=function(c,B){var u=this,V=c/u._scale.x,Q=B/u._scale.y;u._adjustChildScaleOrSize(V,Q,"size"),u._scale={x:c,y:B}},Dd.prototype.getRect=function(){var j=this,V=j._position,D=j._width,W=j._height;return{x:V.x-D/2,y:V.y-W/2,width:D,height:W}},Dd.prototype.setSize=function(u,S){var p=this,u=Math.max(1,u),S=Math.max(1,S),T=u/p._width,d=S/p._height;p._adjustChildScaleOrSize(T,d,"size"),p._width=u,p._height=S},Dd.prototype._adjustChildScaleOrSize=function(F,n,Q){var W,c,S,R,m,M,g,u,N,B,b,A,T,$,x=this,h=x._position,O=x._entities,a=new hf.Math.Matrix2d;for(c=0,S=O.length;S>c;c++)if(W=O[c],x.isNode(W)){if(R=W.getPosition(),m=W.getRotation(),M=W.getWidth(),g=W.getHeight(),u=W.getScale(),b=u.x*M,A=u.y*g,a.identity().scale(b,A).rotate(m).translate(R.x,R.y).translate(-h.x,-h.y).rotate(-x._64O),m=Cl(a.b*Math.sign(b),a.a*Math.sign(b)),a.scale(F,n),N=Math.cos(m),B=Math.sin(m),Math.abs(N)<.001?(T=a.b/B,$=-a.c/B):(T=a.a/N,$=a.d/N),"scale"===Q)W.setScale(T/M,$/g);else if("size"===Q){var J=T/u.x,K=$/u.y;W.setScale(Vb(T)*Math.abs(u.x),Vb($)*Math.abs(u.y)),W.setSize(Math.max(.1,Math.abs(J)),Math.max(.1,Math.abs(K)))}a.rotate(x._64O).translate(h.x,h.y),W.setPosition(a.tx,a.ty)}},Dd.prototype.getMatrix=function(){var w=this,U=w._position,t=x.Default.getInternal(),y=w._scale;return new t.Mat(w._64O,U.x,U.y,y.x,y.y)},Dd.prototype.toGlobal=function(X){return this.getMatrix().tf(X)},Dd.prototype.getCorners=function(){var q=this,P=q._width,n=q._height,o=q._anchor,p=-P*o.x,K=-n*o.y,s=q.getMatrix();return[s.tf(p,K),s.tf(p,K+n),s.tf(p+P,K+n),s.tf(p+P,K)]},Dd.prototype.calcInfo=function(){var U,V,m,G,M,E,w=this,d=[],g=w._entities,W=w._64O;for(G=0,M=g.length;M>G;G++)E=g[G],w.isNode(E)&&E.getCorners&&d.push.apply(d,E.getCorners());if(d.length){var S=Math.cos(-W),c=Math.sin(-W),X=1/0,o=-1/0,Z=1/0,T=-1/0;for(G=0,M=d.length;M>G;G++)m=d[G],U=m.x,V=m.y,m.x=S*U-c*V,m.y=c*U+S*V,X=Math.min(X,m.x),o=Math.max(o,m.x),Z=Math.min(Z,m.y),T=Math.max(T,m.y);w._width=(o-X)/w._scale.x,w._height=(T-Z)/w._scale.y,S=Math.cos(W),c=Math.sin(W);var v=w._anchor;U=X+(o-X)*v.x,V=Z+(T-Z)*v.y,w._position={x:S*U-c*V,y:c*U+S*V}}},Dd.prototype.isNode=function(d){return uk(d)?Ac(d)?d.size()?!1:!0:!0:!1},Dd.prototype._42=function(Z,I,R){var x,E,l,d,L,V,G,A,v=this,N=v._entities,z=v.rotateMode;for("batch"===z&&(A=v.getKeyOb()),x=0,E=N.length;E>x;x++)l=N[x],v.isNode(l)&&(V=l.getRect(),d=hf.toScreenPosition(R,{x:V.x,y:V.y}),L=hf.toScreenPosition(R,{x:V.x+V.width,y:V.y+V.height}),G={min:d,max:L},l===A&&(G.isKeyOb=!0),hf.Icons.DrawIcon(Z,I,hf.Icons.GroupSubEntityRect,G))};var ue=hf.CurveActiving=function(i,v){this._curve=i,this._interactor=i._interactor,this.silent=!0;for(var u in v)this[u]=v[u];delete this.silent};ue.prototype={},ue.prototype.constructor=ue,u.defineProperties(ue.prototype,{point:{get:function(){return this._point},set:function($){var m=this;m._point=$,m.editingCtrl||m.silent||m._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(B){var g=this;g._pairs=B,g.editingCtrl&&!g.silent&&g._firePointChange()}}}),ue.prototype._firePointChange=function(){var s=this,y=s.getCurrentEditingPoint(),Y=s._interactor;if(!y)return Y.fi({kind:"selectPoint"}),void 0;var m=this._curve.target;if(m){var K=hf.getDataMatrix(m).invert(),h=y.e;y=K.apply(hf.toWorldPosition(Y.gv,y)),y.e=h;var G=s._lastFirePoint;G&&Math.abs(y.x-G.x)<1e-5&&Math.abs(y.y-G.y)<1e-5&&(y.e==A&&G.e==A||Math.abs(y.e-G.e)<1e-5)||(s._lastFirePoint=y,Y.fi({kind:"selectPoint",x:y.x,y:y.y,e:y.e}))}},ue.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},ue.prototype.getCurrentEditingPoint=function(){var r=this,X=r.editingCtrl;if(X){var E=r.pairs;if(E){var T=E[X.pairId];if(T){var W=T[X.type];if(W)return W}}}return r._point};var Ik=hf.CursorFactory=function(z){var b=this;b._interactor=z,b._rotateCursorStyles={}};Ik.prototype={},Ik.prototype.constructor=Ik,Ik.prototype.getRotateCursor=function(e){var C=this;0>e&&(e+=2*Math.PI);var V=C._interactor,Y=V.getStyle("rotateCursorSize"),m=V.getStyle("rotateCursorRound"),i=Math.round(180*(e/Math.PI)/m);i*m>=360&&(i=0);var I=C._rotateCursorStyles,N="htCustomRotateStyle_"+Y+"_"+m+"_"+i;return I[N]||(C._produceRotateCursor(N,Y,m,i),I[N]=!0),N},Ik.prototype._produceRotateCursor=function(V,B,o,l){var j=this;j._interactor;var y=j._canvas;y||(y=j._canvas=$.createElement("canvas"));var p=M.devicePixelRatio;y.width=y.height=B*p,y.style.width=y.style.height=B+" px";var S=y.getContext("2d");hf.setAntialias(S,!1),S.scale(p,p);var f,D,g,A,E,K=Math.round(B/2),I=""+K+" "+K+",auto !important;",t=4;f=Math.PI/180*l*o,S.clearRect(0,0,B,B),S.save(),S.scale(B/32,B/32),S.translate(16,15),S.rotate(f+Math.PI/2),S.beginPath(),S.moveTo(-8,0),S.lineTo(-8,t),S.lineTo(-8+t,t),S.moveTo(8,0),S.lineTo(8,t),S.lineTo(8-t,t),S.moveTo(-8,t),S.quadraticCurveTo(0,-6,8,t),S.restore(),S.lineCap="round",S.lineJoin="miter",S.strokeStyle="white",S.lineWidth=4,S.stroke(),S.strokeStyle="black",S.lineWidth=2,S.stroke(),D=JSON.stringify(y.toDataURL()),A="cursor:url("+D+")"+I,1!==p&&(g='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+B+'px" height="'+B+'px"><image xlink:href='+D+' width="'+B+'" height="'+B+'"/></svg>',A+="cursor:url(data:image/svg+xml;base64,"+btoa(g)+")"+I,A+="cursor:-webkit-image-set(url("+D+")"+p+"x,url("+D+")1x)"+I),E=$.createElement("style"),E.textContent="body."+V+" *, ."+V+"{"+A+"}",$.head.appendChild(E)};var zj=hf.Guide.Grid=function(Y){var L=this;L._interactor=Y,L._alignmentGuideId=0,L._xAlignmentGuide=[],L._yAlignmentGuide=[]};zj.prototype={},zj.prototype.constructor=zj,u.defineProperties(zj.prototype,{gridBlockSize:{get:function(){var k=this;return k._gridBlockSize||k._interactor.getStyle("gridBlockSize")},set:function(b){this._gridBlockSize=b,this._interactor._42()}},gridThickLinesEvery:{get:function(){var N=this;return N._gridThickLinesEvery||N._interactor.getStyle("gridThickLinesEvery")},set:function(n){this._gridThickLinesEvery=n,this._interactor._42()}},gridEnabled:{get:function(){var A=this,d=A._interactor;return d.gridEnabled&&A.isValidGrid()}}}),zj.prototype._42=function(){var D=this,F=D._interactor;D.gridEnabled&&D.drawGrid(),F.alignmentGuideEnabled&&D.drawAlignmentGuide()},zj.prototype.makeMatrix=function(){var q=this,o=q._interactor.getStyle("gridAngle"),d=q._interactor.getStyle("gridRotation"),O=new hf.Math.Matrix2d,M=Math.sin(o),v=Math.cos(o);return O.set(1,0,v,M,0,0),O.rotate(d),O},zj.prototype.isValidGrid=function(){var z=this,L=Math.PI,Y=z._interactor,E=Y.gv;if(E._zoom<Y.getStyle("gridZoomThreshold"))return!1;var m=Y.getStyle("gridAngle"),h=Math.abs(180*(m%L/L)),W=1-1e-8;return W>h||h>180-W?!1:!0},zj.prototype.drawAlignmentGuide=function(){var y=this,j=y._interactor,E=j.gv,k=j._canvas,b=j._context,J=k.width,i=k.height,N=E.tx(),s=E.ty(),K=E._zoom;b.beginPath(),b.strokeStyle=j.getStyle("gridAlignmentGuideColor"),b.lineWidth=1,y._xAlignmentGuide.forEach(function(F){var X=F.p*K+N;b.moveTo(X,0),b.lineTo(X,i)}),y._yAlignmentGuide.forEach(function(l){var h=l.p*K+s;b.moveTo(0,h),b.lineTo(J,h)}),b.stroke()},zj.prototype.drawGrid=function(){function U(y,u,$,J){var b=hf.toScreenPosition(a,o.apply({x:y,y:u})),i=hf.toScreenPosition(a,o.apply({x:$,y:J}));j.moveTo(b.x,b.y),j.lineTo(i.x,i.y)}var B=this,G=B._interactor,N=B.gridBlockSize,f=B.gridThickLinesEvery,P=G.getStyle("gridThickColor"),S=G.getStyle("gridLightColor"),a=G.gv,X=G._canvas,j=G._context,V=X.width,g=X.height,o=B.makeMatrix(),k=o.applyInverse(hf.toWorldPosition(a,{x:0,y:0})),v=o.applyInverse(hf.toWorldPosition(a,{x:V,y:0})),A=o.applyInverse(hf.toWorldPosition(a,{x:0,y:g})),E=o.applyInverse(hf.toWorldPosition(a,{x:V,y:g})),J=Math.min(k.x,v.x,A.x,E.x),W=Math.max(k.x,v.x,A.x,E.x),l=Math.min(k.y,v.y,A.y,E.y),p=Math.max(k.y,v.y,A.y,E.y);V=W-J,g=p-l;var z=Math.ceil(J/N),h=Math.floor(W/N),I=Math.ceil(l/N),D=Math.floor(p/N);a.tx(),a.ty(),a._zoom;var s,K,w;for(j.save(),j.lineWidth=1,j.beginPath(),j.strokeStyle=P,w=Math.ceil(z/f)*f;h>=w;w+=f)s=w*N,U(s,l,s,p);for(w=Math.ceil(I/f)*f;D>=w;w+=f)K=w*N,U(J,K,W,K);for(j.stroke(),j.beginPath(),j.strokeStyle=S,w=z;h>=w;w++)0!==w%f&&(s=w*N,U(s,l,s,p));for(w=I;D>=w;w++)0!==w%f&&(K=w*N,U(J,K,W,K));j.stroke(),j.restore()},zj.prototype.getAlignmentGuides=function(){var l=this;return{x:l._xAlignmentGuide,y:l._yAlignmentGuide}},zj.prototype.addAlignmentGuide=function(l,T,s){var Y=this,Q="x"===l?Y._xAlignmentGuide:Y._yAlignmentGuide,s=s?s:++Y._alignmentGuideId,E={p:T,id:s};if(Q.length){var U=Y._findClosestAlignmentGuide(E.p,Q);U.dis<0?Q.splice(U.index+1,0,E):Q.splice(U.index,0,E)}else Q.push(E);return Y._interactor._42(),s},zj.prototype.findClosest=function(q,t,_){var o=this,f=o._interactor,L=f.gv;_&&(q=hf.toWorldPosition(L,q));var Y,J,A,v=1/0,B=1/0,j=q.x,e=q.y;if(o.gridEnabled){var C=o.gridBlockSize,p=o.makeMatrix(),i=p.applyInverse(q);i=p.apply({x:Math.round(i.x/C)*C,y:Math.round(i.y/C)*C}),v=i.x-j,B=i.y-e,A=!0}if(f.alignmentGuideEnabled&&(Y=o._findClosestAlignmentGuide(j,o._xAlignmentGuide).dis,J=o._findClosestAlignmentGuide(e,o._yAlignmentGuide).dis,Math.abs(Y)<Math.abs(v)&&(v=Y,A=!0),Math.abs(J)<Math.abs(B)&&(B=J,A=!0)),A){A=!1;var y=L._zoom,s=f.getStyle("smartGuideThreshold")/y,a={};if(Math.abs(v)<s&&"y"!==t&&(a.x=_?v*y:v,A=!0),Math.abs(B)<s&&"x"!==t&&(a.y=_?B*y:B,A=!0),A)return a}},zj.prototype._findClosestAlignmentGuide=function(V,M){if(!M.length)return{dis:1/0};for(var E,H=0,h=M.length-1;h-H>1;)E=Math.floor((H+h)/2),M[E].p<V?H=E:h=E;var r=M[H].p-V,k=M[h].p-V;return Math.abs(r)<=Math.abs(k)?{line:M[H],dis:r,index:H}:{line:M[h],dis:k,index:h}},zj.prototype.removeAllAlignmentGuide=function(x){var k=this;"y"!==x&&(k._xAlignmentGuide=[]),"x"!==x&&(k._yAlignmentGuide=[]),k._interactor._42()},zj.prototype.removeAlignmentGuide=function(w){for(var M,e,G,D=this,o=D._xAlignmentGuide,T=0;2>T;T++)for(o=0===T?D._xAlignmentGuide:D._yAlignmentGuide,M=0,e=o.length;e>M;M++)if(G=o[M],G.id===w)return o.splice(M,1),D._interactor._42(),{axis:0===T?"x":"y",position:G.p};return!1},zj.prototype.adjustAlignmentGuide=function(A,u){var _=this,i=_.removeAlignmentGuide(A);return i?(_.addAlignmentGuide(i.axis,u,A),!0):!1};var Cd=hf.Guide.Rect=function(S){var e=this;e._interactor=S};Cd.prototype={},Cd.prototype.constructor=Cd,Cd.prototype.gatherRects=function(){var N,I,Q,F,j=this,r=j._interactor.gv,t=[],v=[],o={x:t,y:v},Y={},X=r.getDataModel(),G=X.a("width"),U=X.a("height");G&&U&&(N=0,I=0,Q=G,F=U,t.push({node:X,type:0,p:N},{node:X,type:1,p:N+Q/2},{node:X,type:2,p:N+Q}),v.push({node:X,type:0,p:I},{node:X,type:1,p:I+F/2},{node:X,type:2,p:I+F}),Y[X._id||0]={x:N,y:I,width:Q,height:F}),X.each(function(V){if(uk(V)&&!r.isSelected(V)&&r.isVisible(V)&&r.isValidGuideLineSource(V)){var B=!1;if(r.sm().getSelection().each(function(m){B||(V.isHostOn(m)?B=!0:V.isDescendantOf(m)&&(B=!0))}),!B){var p=V.getRect();N=p.x,I=p.y,Q=p.width,F=p.height,t.push({node:V,type:0,p:N},{node:V,type:1,p:N+Q/2},{node:V,type:2,p:N+Q}),v.push({node:V,type:0,p:I},{node:V,type:1,p:I+F/2},{node:V,type:2,p:I+F}),Y[V._id]=p}}}),t.sort(function(e,h){return e.p-h.p}),v.sort(function(O,e){return O.p-e.p}),j._grid=o,j._87I=Y},Cd.prototype.gatherLines=function(s,d,V){var W,J,X,A,Y,a,G,P,L,w,N,y,U=this,M=[U.findClosest({x:s.x,y:s.y},d),U.findClosest({x:s.x+s.w/2,y:s.y+s.h/2},d),U.findClosest({x:s.x+s.w,y:s.y+s.h},d)],l={},n=U._87I;V=V||255;var C,Q;for(U._guideLine=[],W=0;2>W;W++)for(l={},0===W?(A="y",P=s.x,L=P+s.w):(A="x",P=s.y,L=P+s.h),J=0;3>J;J++)Y=M[J],Y&&isFinite(Y[A])&&(C=1<<3*W+J,V&C&&(a=Y[A+"Line"],G=a.node,Q=G._id||0,l[Q]||(l[Q]=!0,y=n[Q],"y"===A?(w=y.x,N=y.x+y.width):(w=y.y,N=y.y+y.height),X=a.p,U._guideLine.push({type:A,a:P,b:L,c:w,d:N,p:X,center:1===a.type}))))},Cd.prototype._binarySearchClosest=function(G,i){if(!i.length)return{dis:1/0};for(var d,I=0,s=i.length-1;s-I>1;)d=Math.floor((I+s)/2),i[d].p<G?I=d:s=d;var b=i[I].p-G,W=i[s].p-G;return Math.abs(b)<=Math.abs(W)?{line:i[I],dis:b}:{line:i[s],dis:W}},Cd.prototype.findClosest=function(B,Y,A){var X=this,Z=X._interactor,t=Z.gv,h=X._grid;A&&(B=hf.toWorldPosition(t,B));var M,T=X._binarySearchClosest(B.x,h.x),z=X._binarySearchClosest(B.y,h.y),c=T.dis,v=z.dis,G=t._zoom,p=Z.getStyle("smartGuideThreshold")/G,O={};return Math.abs(c)<p&&"y"!==Y&&(O.x=A?c*G:c,O.xLine=T.line,M=!0),Math.abs(v)<p&&"x"!==Y&&(O.y=A?v*G:v,O.yLine=z.line,M=!0),M?O:void 0},Cd.prototype._42=function(){var r=this,k=r._guideLine;if(k&&!x.Default.isCtrlDown()){var I=r._interactor;if(I.getStyle("guideLineVisible")){var Y,Z,p,z,g,d,X,c,s,w,i,e,b,L,V,R,a,m=I.gv,v=I._context,C=m.tx(),A=m.ty(),$=m._zoom,P=I.getStyle("guideLineTextSpacing");for(Y=0,Z=k.length;Z>Y;Y++)p=k[Y],c=p.type,s=p.p,w=p.a,i=p.b,e=p.c,b=p.d,L=Math.min(w,e),V=Math.max(i,b),"x"===c?(z=s*$+C,g=L*$+A,d=z,X=V*$+A):(z=L*$+C,g=s*$+A,d=V*$+C,X=g),hf.Icons.DrawIcon(I,v,hf.Icons.MoveLineGuide,{rect:[z,g,d,X],center:p.center}),b>=w&&i>=e||(L=w>b?b:i,V=w>b?w:e,a=V-L,"x"===c?(p.center2center||(z-=P,d=z),g=L*$+A,X=V*$+A,R=hf.Icons.MoveLineGuideDistanceV):"y"===c&&(p.center2center||(g-=P,X=g),z=L*$+C,d=V*$+C,R=hf.Icons.MoveLineGuideDistanceH),hf.Icons.DrawIcon(I,v,R,{x0:z,y0:g,x1:d,y1:X,dis:a}))}}},Cd.prototype.clear=function(){this._guideLine=null};var vf=hf.Guide.Hover=function(q){var c=this;c._interactor=q};vf.prototype={},vf.prototype.constructor=vf,u.defineProperties(vf.prototype,{}),vf.prototype._42=function(){var v=this._interactor;if(v.getStyle("hoverGuideVisible")&&!v.gvEditing){var N=v.hoverData,X=v.gv;if(!uk(N)||X.isSelected(N))return v.hoverData=null,void 0;var I=fm(X,N),f=hf.toScreenPosition(X,{x:I.x,y:I.y}),c=hf.toScreenPosition(X,{x:I.x+I.width,y:I.y+I.height});hf.Icons.DrawIcon(v,v._context,hf.Icons.HoverDataRect,{min:f,max:c,color:v.getStyle("hoverGuideColor")||v.getStyle("baseColor"),borderWidth:v.getStyle("hoverGuideBorderWidth")||1,borderPattern:v.getStyle("hoverGuideBorderPattern")||[1,4]})}},hf.DefaultStyleMap={baseColor:"rgb(51,153,255)",pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,moveDummyThreshold:32,moveDummyPosition:[0,0,-16,-16],moveDummyLineExtraShift:[-32,0],moveDummySensitivity:16,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,rotateTipVisible:!0,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideThreshold:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,edgeHostEdgeMaxDistance:12,edgeHostEdgeHighlighColor:"#5d5d5d",edgeHostPointHighlighColor:"red",edgeHostHighlighPeriod:1500,edgeElevationEditable:!1,attachThreshold:25,guideLineVisible:!0,guideLineTextSpacing:0,hoverGuideVisible:!1,hoverGuideColor:null,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],curveTipVisible:!0,connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var qd=hf.Icons={},$l=1e4,zm=null,yr=hf.DefaultStyleMap.baseColor,Rj="rgb(183,232,135)",iq="rgb(255,204,153)",Pq=6;x.Default.setImage("Icons.RectPoint",{width:Pq,height:Pq,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return yr}},rect:[0,0,Pq,Pq]}]}),qd.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var k=qd.GroupSubEntityRect.data;if(!k)return[];var p=k.min,R=k.max;return[p.x,p.y,p.x,R.y,R.x,R.y,R.x,p.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return qd.GroupSubEntityRect.data.isKeyOb?yr:yr}}}]};var Zn=4;qd.HoverDataRect={comps:[{type:"shape",points:{func:function(){var J=qd.HoverDataRect.data;if(!J)return[];var y=J.min,T=J.max,F=Zn;return y.x-=F,y.y-=F,T.x+=F,T.y+=F,[y.x,y.y,y.x,T.y,T.x,T.y,T.x,y.y]}},segments:[1,2,2,2,5],background:null,borderWidth:{func:function(){return qd.HoverDataRect.data.borderWidth}},borderColor:{func:function(){return qd.HoverDataRect.data.color}},borderCap:"butt",borderPattern:{func:function(){return qd.HoverDataRect.data.borderPattern}}}]},qd.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[qd.Line.data.P1.x,qd.Line.data.P1.y],Pq,Pq]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[qd.Line.data.P2.x,qd.Line.data.P2.y],Pq,Pq]}}}]},qd.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return qd.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},qd.Rect={comps:[{type:"shape",points:{func:function(){var l=qd.Rect.data;if(!l)return[];var v=l.LT,M=l.LB,o=l.RB,I=l.RT;return[v.x,v.y,M.x,M.y,o.x,o.y,I.x,I.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return yr}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return qd.Rect.data.rotation}},rect:{func:function(){return[[qd.Rect.data.LT.x,qd.Rect.data.LT.y],Pq,Pq]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return qd.Rect.data.rotation}},rect:{func:function(){return[[qd.Rect.data.LB.x,qd.Rect.data.LB.y],Pq,Pq]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return qd.Rect.data.rotation}},rect:{func:function(){return[[qd.Rect.data.RB.x,qd.Rect.data.RB.y],Pq,Pq]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return qd.Rect.data.rotation}},rect:{func:function(){return[[qd.Rect.data.RT.x,qd.Rect.data.RT.y],Pq,Pq]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return qd.Rect.data.rotation}},visible:{func:function(){return qd.Rect.data.L?!0:!1}},rect:{func:function(){return[[qd.Rect.data.L.x,qd.Rect.data.L.y],Pq,Pq]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return qd.Rect.data.rotation}},visible:{func:function(){return qd.Rect.data.R?!0:!1}},rect:{func:function(){return[[qd.Rect.data.R.x,qd.Rect.data.R.y],Pq,Pq]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return qd.Rect.data.rotation}},visible:{func:function(){return qd.Rect.data.T?!0:!1}},rect:{func:function(){return[[qd.Rect.data.T.x,qd.Rect.data.T.y],Pq,Pq]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return qd.Rect.data.rotation}},visible:{func:function(){return qd.Rect.data.B?!0:!1}},rect:{func:function(){return[[qd.Rect.data.B.x,qd.Rect.data.B.y],Pq,Pq]}}}]};var Ei=16;x.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:{func:function(){return yr}},borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:{func:function(){return yr}},shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),qd.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[qd.Anchor.data.POS.x,qd.Anchor.data.POS.y],Ei,Ei]}}}]},qd.TipShiftX=12,qd.TipShiftY=12;var ln=[8,28];qd.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[qd.TipHelper.data.helperPos.x,qd.TipHelper.data.helperPos.y,ln[0]*qd.TipHelper.data.size,ln[1]]}},background:{func:function(){return zm.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return qd.TipHelper.data.text}},rect:{func:function(){return[qd.TipHelper.data.helperPos.x,qd.TipHelper.data.helperPos.y,ln[0]*qd.TipHelper.data.size,ln[1]]}},color:{func:function(){return zm.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var gc=7;qd.ShapePoint={comps:[{type:"circle",visible:{func:function(){return!!qd.ShapePoint.data.dynamicVisible}},rect:{func:function(){var K=qd.ShapePoint.data.point,R=qd.ShapePoint.data.size||gc;return[K,R+10,R+10]}},background:{func:function(){var S=Date.now(),y=qd.ShapePoint.data.dynamicPeriod||1500,f=Math.sin(S%y/y*Math.PI);return"rgba(27,124,22,"+.5*f+")"}},borderWidth:0},{type:"circle",rect:{func:function(){var r=qd.ShapePoint.data.point,Z=qd.ShapePoint.data.size||gc;return[r,Z,Z]}},background:{func:function(){var G=qd.ShapePoint.data.isEnd;return G?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:{func:function(){return qd.ShapePoint.data.color||yr}}},{type:"rect",visible:{func:function(){return!!qd.ShapePoint.data.dynamicVisible}},background:"red",borderWidth:0,rotation:Math.PI/4,borderColor:{func:function(){return yr}},rect:{func:function(){var G=5;return[qd.ShapePoint.data.point,G,G]}}}]},qd.ShapeBgCurve={comps:[{type:"shape",visible:{func:function(){return!!qd.ShapeBgCurve.data.dynamicVisible}},points:{func:function(){return qd.ShapeBgCurve.data.P}},segments:{func:function(){return qd.ShapeBgCurve.data.S}},background:null,borderWidth:6,borderColor:{func:function(){var f=Date.now(),E=qd.ShapeBgCurve.data.dynamicPeriod||1500,O=Math.sin(f%E/E*Math.PI);return"rgba(27,124,22,"+.3*O+")"}}},{type:"shape",points:{func:function(){return qd.ShapeBgCurve.data.P}},segments:{func:function(){return qd.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:{func:function(){return qd.ShapeBgCurve.data.color||yr}}}]};var rk=8;qd.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var B=qd.ShapeHighlighPoint.data;return[[B.x,B.y],rk,rk]}},background:{func:function(){return zm.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var Kf=10;qd.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var J=qd.ShapeHighlighRealPoint.data;return[[J.x,J.y],Kf,Kf]}},background:"#ffffff",borderWidth:2,borderColor:{func:function(){return yr}}}]};var ad=8;qd.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var R=qd.ShapeHighlighCtrlPoint.data,n=R.x,T=R.y,U=ad/2;return[n-U,T-U,n-U,T+U,n+U,T+U,n+U,T-U]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return zm.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return zm.getStyle("shapeCtrlPointBorderColor")||yr}}}]};var Oe=3;qd.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return qd.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:Oe,borderColor:{func:function(){return zm.getStyle("curveHighlightColor")}}}]},qd.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return qd.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},qd.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return qd.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return qd.MoveLineGuide.data.center?Rj:iq}}}]};var Bo=5;qd.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var t=qd.MoveLineGuideDistanceH.data,S=t.x0,Z=t.y0;return[S,Z-Bo,S,Z+Bo]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:iq},{type:"shape",points:{func:function(){var L=qd.MoveLineGuideDistanceH.data,Z=L.x1,O=L.y1;return[Z,O-Bo,Z,O+Bo]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:iq},{type:"text",text:{func:function(){return Math.round(qd.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var B=qd.MoveLineGuideDistanceH.data;return[[(B.x0+B.x1)/2,B.y0-10],20,20]}},color:iq,font:"12px Arial",align:"center"}]},qd.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var D=qd.MoveLineGuideDistanceV.data,a=D.x0,S=D.y0;return[a-Bo,S,a+Bo,S]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:iq},{type:"shape",points:{func:function(){var r=qd.MoveLineGuideDistanceV.data,d=r.x1,G=r.y1;return[d-Bo,G,d+Bo,G]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:iq},{type:"text",text:{func:function(){return Math.round(qd.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var w=qd.MoveLineGuideDistanceV.data;return[[w.x0-10,(w.y0+w.y1)/2],20,20]}},color:iq,font:"12px Arial",align:"center"}]},x.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),qd.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var f=qd.EdgeElevationGuide.data,q=f.x,K=f.y,_=zm.getStyle("curveElevationIntersectSize"),B=zm.getStyle("curveElevationGuideShift");return q+=B[0],K+=B[1],[q-_,K-_,2*_,2*_]}}}]},x.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),x.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),qd.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return qd.ConnectGuide.data.rotation}},rect:{func:function(){var q=qd.ConnectGuide.data.connect;q.x,q.y;var u=zm.getStyle("connectGuideIntersectSize");return[[q.x,q.y],2*u,2*u]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var M=qd.ConnectGuide.data.cursorPos||qd.ConnectGuide.data.connect,z=zm.getStyle("connectGuideIntersectSize");
return[[M.x,M.y],2*z-2,2*z-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var E=qd.ConnectGuide.data.connect,z=qd.ConnectGuide.data.cursorPos||E;return[E.x,E.y,E.x+.5*(z.x-E.x),E.y,z.x+.5*(E.x-z.x),z.y,z.x,z.y]}}}]},x.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),x.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),qd.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var K=qd.ConnectGuideGarbage.data.hover;return K?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var l=qd.ConnectGuideGarbage.data,Z=zm.getStyle("connectGuideGarbageIntersectsize");return l.hover&&(Z+=5),[[l.x,l.y],2*Z,2*Z]}}}]};var Cb=6;qd.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return qd.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var F=qd.ShapeActivingCtrl.data;return[F.point.x,F.point.y,F.c1.x,F.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return yr}}},{type:"shape",visible:{func:function(){return qd.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var f=qd.ShapeActivingCtrl.data;return[f.point.x,f.point.y,f.c2.x,f.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return yr}}},{type:"shape",visible:{func:function(){return qd.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var l=qd.ShapeActivingCtrl.data.c1,V=l.x,b=l.y,S=Cb/2;return"c1"===qd.ShapeActivingCtrl.data.hl&&(S+=.5),[V-S,b-S,V-S,b+S,V+S,b+S,V+S,b-S]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return zm.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===qd.ShapeActivingCtrl.data.hl?zm.getStyle("shapeCtrlPointHighlightBorder")||yr:zm.getStyle("shapeCtrlPointBorderColor")||yr}}},{type:"shape",visible:{func:function(){return qd.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var w=qd.ShapeActivingCtrl.data.c2,L=w.x,o=w.y,c=Cb/2;return"c2"===qd.ShapeActivingCtrl.data.hl&&(c+=.5),[L-c,o-c,L-c,o+c,L+c,o+c,L+c,o-c]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return zm.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===qd.ShapeActivingCtrl.data.hl?zm.getStyle("shapeCtrlPointHighlightBorder")||yr:zm.getStyle("shapeCtrlPointBorderColor")||yr}}}]},qd.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return yr}},rect:{func:function(){return[[qd.RoundPoint.data.x,qd.RoundPoint.data.y],Pq,Pq]}}}]},qd.AttachPoint={comps:[{type:"rect",background:{func:function(){return qd.AttachPoint.data.isAttach?"rgb(51,153,255)":"rgb(247,247,247)"}},borderWidth:1,rotation:Math.PI/4,borderColor:{func:function(){return yr}},rect:{func:function(){var X=qd.AttachPoint.data.isAttach?Pq+4:Pq;return[[qd.AttachPoint.data.x,qd.AttachPoint.data.y],X,X]}}}]},qd.SimpleRect={comps:[{type:"rect",background:null,borderWidth:{func:function(){return qd.SimpleRect.data.borderWidth||1}},borderColor:{func:function(){return qd.SimpleRect.data.color||yr}},rect:{func:function(){var f=qd.SimpleRect.data;return[f.x,f.y,f.width,f.height]}}}]},x.Default.setImage("Icons.MoveDummyImage",{width:32,height:32,boundExtend:12,attachStyle:"close",comps:[{type:"oval",background:"rgb(255,255,255)",borderColor:"#979797",shadow:!0,shadowColor:"rgba(0,0,0,0.25)",shadowOffsetX:0,rect:[0,0,32,32]},{type:"shape",background:"rgb(51,153,255)",pixelPerfect:!0,points:[8.65079,11.90713,9.05502,11.46921,9.70629,11.46921,10.11052,11.90713,10.51476,12.28891,10.51476,12.92895,10.11052,13.34441,8.49359,14.97258,12.2889,14.97258,12.85034,14.97258,13.29949,15.42172,13.29949,15.99439,13.29949,16.57828,12.85034,17.0162,12.2889,17.0162,8.49359,17.0162,10.11052,18.6556,10.51476,19.0486,10.51476,19.7111,10.11052,20.09288,9.70629,20.50834,9.05502,20.50834,8.65079,20.09288,5.32709,16.76917,5.28217,16.71303,4.87794,16.32002,4.87794,15.67998,5.28217,15.26452,8.65079,11.90713,8.65079,11.90713,8.65079,11.90713,13.3444,10.09931,13.3444,10.09931,12.94017,10.50354,12.2889,10.50354,11.88467,10.09931,11.48043,9.69507,11.48043,9.0438,11.88467,8.63957,15.27574,5.25973,15.66874,4.86672,16.32001,4.86672,16.73547,5.25973,16.76917,5.31586,20.10409,8.63957,20.50832,9.0438,20.50832,9.68385,20.10409,10.09931,19.69986,10.49231,19.07105,10.50354,18.64436,10.09931,17.02742,8.45991,17.02742,12.26646,17.02742,12.83912,16.55581,13.31072,15.99438,13.31072,15.43295,13.31072,14.98379,12.83912,14.98379,12.26646,14.96134,8.45991,13.3444,10.09931,13.3444,10.09931,13.3444,10.09931,21.90069,13.33318,21.90069,13.33318,21.49646,12.91771,21.49646,12.27768,21.90069,11.89591,22.31615,11.45798,22.94497,11.45798,23.36043,11.89591,26.72904,15.2533,27.12205,15.66876,27.12205,16.3088,26.72904,16.7018,26.6729,16.75794,23.36043,20.08165,22.94497,20.49711,22.31615,20.49711,21.90069,20.08165,21.49646,19.69987,21.49646,19.03737,21.90069,18.64437,23.51763,17.00498,19.72231,17.00498,19.14965,17.00498,18.71173,16.56705,18.71173,15.98316,18.71173,15.41049,19.14965,14.96135,19.72231,14.96135,23.51763,14.96135,21.90069,13.33318,21.90069,13.33318,21.90069,13.33318,11.88467,23.32675,11.88467,23.32675,11.48043,22.94498,11.48043,22.27125,11.88467,21.88948,12.2889,21.48523,12.94017,21.48523,13.3444,21.88948,14.96134,23.52887,14.98379,19.7111,14.98379,19.14966,15.43295,18.67805,15.99438,18.67805,16.55581,18.67805,17.02742,19.14966,17.02742,19.7111,17.02742,23.52887,18.64436,21.88948,19.07105,21.48523,19.69986,21.48523,20.10409,21.88948,20.50832,22.27125,20.50832,22.94498,20.10409,23.32675,16.76917,26.65045,16.73547,26.72905,16.32001,27.13329,15.66874,27.13329,15.27574,26.72905,11.88467,23.32675,11.88467,23.32675,11.88467,23.32675],segments:[1,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2]}]}),qd.MoveDummy={comps:[{type:"image",name:"Icons.MoveDummyImage",rect:{func:function(){var A=qd.MoveDummy.data;return[[A.pos.x,A.pos.y],2*A.size,2*A.size]}}}]},hf.Icons.DrawIcon=function(P,B,V,Z){V.width=V.height=$l,V.data=Z,zm=P,x.Default.drawImage(B,V,0,0,$l,$l),zm=A},hf.Icons.MapPoints=function(h,G){for(var D=0,r=h.length;r>D;D++)h[D]/=G},hf.roundTo=function(j,M,c){var J=Math.abs(j%M);return c>J||c>M-J?M*Math.round(j/M):j},hf.toFixed=function(Y){return Math.round(100*Y)/100},hf.getDataMatrix=function(l){if(l instanceof x.Shape){var g=new x.Math.Matrix2d,U=l.getPosition();return g.translate(-U.x,-U.y).scale(l.getScale().x,l.getScale().y).rotate(l.getRotation()).translate(U.x,U.y),g}return l.getMatrix?l.getMatrix():new x.Math.Matrix2d};var Tj=hf.Math.Curve=function(){this._curves=[]};Tj.prototype={},Tj.prototype.constructor=Tj,Tj.prototype.createFromHtShape=function(w,T,u){T instanceof x.List&&(T=T.toArray());var C,n,v,H,r,q,p,J=this,G=null,L=null,h=0,X=hf.Math.Vector2,R=hf.Math.CubicBezier,f=function(x){return new X(w[x],w[x+1],u?u[x/2]:A)};for(n=0,v=T.length;v>n;n++){switch(H=T[n],r=null,H){case 1:L=f(h),G=L,h+=2;break;case 2:C=f(h),h+=2,r=new R(L,L.clone(),C.clone(),C),L=C;break;case 3:q=f(h),C=f(h+2),h+=4,r=new R(L,q.clone().sub(L).multiplyScalar(2/3).add(L),q.clone().sub(C).multiplyScalar(2/3).add(C),C),L=C;break;case 4:q=f(h),p=f(h+2),C=f(h+4),h+=6,r=new R(L,q,p,C),L=C;break;case 5:if(!G)break;r=new R(L,L.clone(),G.clone(),G),L=null,G=null}r&&(r._index=J._curves.length,J._curves.push(r))}},Tj.prototype.checkPoint=function(v,P){var A,J,b,Q,t,V=this,p=V._curves;for(A=0,J=p.length;J>A;A++)if(Q=p[A],t=Q.intersectRect(v,P,P),t.length)return b=0,t.forEach(function(k){b+=k.t}),b/=t.length,v=Q.getPointAt(b),v.t=b,{bezier:Q,intersection:v}},Tj.prototype.insertKnot=function(g,G){var T=g.insertKnot(G),F=this,i=F._curves;i.splice(g._index,1,T[0],T[1])},Tj.prototype._isCloseEnough=function(D,n){return Math.abs(D.x-n.x)<1e-6&&Math.abs(D.y-n.y)<1e-6},Tj.prototype._isSamePoint=function(W,q){return W===q},Tj.prototype.moveRealPoint=function(U,N){var B=this,E=B._curves,n=N.clone().sub(U);E.forEach(function(J){var M=J._p1;J._p2,J._p3;var C=J._p4;B._isSamePoint(M,U)&&(J._p2.add(n),J._p1=N),B._isSamePoint(C,U)&&(J._p3.add(n),J._p4=N)})},Tj.prototype.moveCtrlDueToRealPointMovement=function(c,r){var M=this,P=M._curves,p=function(H){H.add(r),H.e&&r.e&&(H.e+=r.e)};P.forEach(function($){var y=$._p1;$._p2,$._p3;var u=$._p4;M._isSamePoint(y,c)&&p($._p2),M._isSamePoint(u,c)&&p($._p3)})},Tj.prototype.moveCtrlPoint=function(E,l,I){var M=E[I];if(M){M.e!==A&&(l.e=M.e);var w=this,F=w._curves;l.clone().sub(M),F.forEach(function(p){var A;"c2"===I?A="_p2":"c1"===I&&(A="_p3"),w._isSamePoint(p[A],M)&&(p[A]=l)}),E[I]=l}},Tj.prototype.deleteRealPoint=function(n,p){var g,l,U,L,y,r,T,P=this,N=P._curves,X={},M=[],f=hf.Math.CubicBezier;for(l=0,U=N.length;U>l;l++)g=N[l],L=g._p1,y=g._p2,r=g._p3,T=g._p4,(X[l]||!P._isSamePoint(L,n))&&(P._isSamePoint(T,n)?U>l+1&&P._isSamePoint(N[l+1]._p1,n)&&(p||M.push(new f(L,y,N[l+1]._p3,N[l+1]._p4))):M.push(g));P._curves=M},Tj.prototype.findPairs=function(_,K){var u,D,F,v,l,i,r,A,I=this,m=I._curves,c={},Q=[];for(D=0,F=m.length;F>D;D++)u=m[D],v=u._p1,l=u._p2,i=u._p3,r=u._p4,!c[D]&&I._isSamePoint(v,_)&&(K?Q.push({point:v,r2:r}):Q.push({point:v,c2:l})),I._isSamePoint(r,_)&&(A=K?{point:r,r1:v}:{point:r,c1:i},F>D+1&&I._isSamePoint(m[D+1]._p1,_)&&(K?A.r2=m[D+1]._p4:A.c2=m[D+1]._p2,c[D+1]=!0),Q.push(A));return Q},Tj.prototype.toHtShape=function(){var W=this,A=W._curves,N=[],m=[],S={x:1/0,y:1/0};return A.forEach(function(C){var b=C._p1,E=C._p2,d=C._p3,A=C._p4;return W._isCloseEnough(b,S)||(N.push(1),m.push(b.clone())),S=A,W._isCloseEnough(b,E)&&W._isCloseEnough(d,A)?(N.push(2),m.push(A.clone()),void 0):(N.push(4),m.push(E.clone(),d.clone(),A.clone()),void 0)}),{segments:N,points:m}};var rb=hf.Math.CubicBezier=function(k,c,N,Q){var F=this;F._id=hf.Math.CubicBezier._globalId++,F._p1=k,F._p2=c,F._p3=N,F._p4=Q};rb._globalId=1,rb.prototype={},rb.prototype.constructor=rb,rb.prototype.toString=function(){return this._id},rb.prototype.intersectRect=function(v,X,i){var a=X/2,f=i/2,Z=v.x,l=v.y,y=hf.Math.Vector2,s=new y(-a+Z,-f+l),G=new y(a+Z,f+l),x=new y(G.x,s.y),m=new y(s.x,G.y),M=this,k=M.intersectLine(s,x),p=M.intersectLine(x,G),K=M.intersectLine(G,m),$=M.intersectLine(m,s),j=k.concat(p).concat(K).concat($);return j},rb.prototype.intersectLine=function(i,T){var I,H,l,v,M,o,W,Y,P,D,J,U,g,k=this,F=i.clone().min(T),z=i.clone().max(T);v=k._p1,M=k._p2,o=k._p3,W=k._p4,I=v.clone().multiplyScalar(-1),H=M.clone().multiplyScalar(3),l=o.clone().multiplyScalar(-3),J=I.add(H).add(l).add(W),I=v.clone().multiplyScalar(3),H=M.clone().multiplyScalar(-6),l=o.clone().multiplyScalar(3),D=I.add(H).add(l),I=v.clone().multiplyScalar(-3),H=M.clone().multiplyScalar(3),P=I.add(H),Y=v.clone(),g=new hf.Math.Vector2(i.y-T.y,T.x-i.x),U=i.x*T.y-T.x*i.y;for(var u=k.getRoots(g.dot(J),g.dot(D),g.dot(P),g.dot(Y)+U),E=new Array,e=0,b=u.length;b>e;e++){var G=u[e];if(!(0>G||G>1)){var r=k.getPointAt(G);r.t=G,i.x==T.x?F.y<=r.y&&r.y<=z.y&&E.push(r):i.y==T.y?F.x<=r.x&&r.x<=z.x&&E.push(r):r.x>=F.x&&r.y>=F.y&&r.x<=z.x&&r.y<=z.y&&E.push(r)}}return E},rb.prototype.solveTForPoint=function(g){var B,U,E,_,Z=this;B=Z._p1.x-g.x,U=Z._p2.x-g.x,E=Z._p3.x-g.x,_=Z._p4.x-g.x;for(var S=Z.getRoots(_-3*E+3*U-B,3*E-6*U+3*B,3*U-3*B,B),w=A,l=1/0,r=0,x=S.length;x>r;r++){var Y=S[r];if(!(0>Y||Y>1)){var L=Z.getPointAt(Y);L.t=Y;var M=Math.abs(L.y-g.y);l>M&&(l=M,w=L)}}return w},rb.prototype.getPointAt=function(p){var J=this,H=J._p1,v=J._p2,S=J._p3,i=J._p4,O=H.clone().lerp(v,p),r=v.clone().lerp(S,p),b=S.clone().lerp(i,p),h=O.lerp(r,p),V=r.lerp(b,p);return h.lerp(V,p)},rb.prototype.getPointByPercentage=function(b){var H=this.length*b,m=this._cacheLength,j=m.length;if(0===H)return m[0].point;if(b>=1)return m[j-1].point;for(var q=0;j>q;q++){var V=m[q];if(!(V.len<H)){var k=m[q-1];return V.point.clone().sub(k.point).setLength(H-k.len).add(k.point)}}},rb.prototype.getTByPercentage=function($){var F=this.length*$,V=this._cacheLength,P=V.length;if(0===F||0>=$)return V[0].t;if($>=1)return V[P-1].t;for(var I=0;P>I;I++){var Y=V[I];if(!(Y.len<F)){var A=V[I-1];return(F-A.len)/(Y.len-A.len)*(Y.t-A.t)+A.t}}},rb.prototype.getRoots=function(I,m,a,k){var x,t,r,y,z,d=new Array;if(Math.abs(I)<1e-6){var x=m,t=a/x,r=k/x,y=t*t-4*r;if(y>0){var z=Math.sqrt(y);d.push(.5*(-t+z)),d.push(.5*(-t-z))}else 0==y&&d.push(.5*-t)}m/=I,a/=I,k/=I,x=(3*a-m*m)/3,t=(2*m*m*m-9*a*m+27*k)/27;var V=m/3,e=t*t/4+x*x*x/27,O=t/2;if(Math.abs(e)<=1e-6&&(e=0),e>0){var Q,D,z=Math.sqrt(e);Q=-O+z,D=Q>=0?Math.pow(Q,1/3):-Math.pow(-Q,1/3),Q=-O-z,Q>=0?D+=Math.pow(Q,1/3):D-=Math.pow(-Q,1/3),d.push(D-V)}else if(0>e){var Y=Math.sqrt(-x/3),L=Math.atan2(Math.sqrt(-e),-O)/3,l=Math.cos(L),U=Math.sin(L),h=Math.sqrt(3);d.push(2*Y*l-V),d.push(-Y*(l+h*U)-V),d.push(-Y*(l-h*U)-V)}else{var Q;Q=O>=0?-Math.pow(O,1/3):Math.pow(-O,1/3),d.push(2*Q-V),d.push(-Q-V)}return d},rb.prototype._70I=function(){var x=this;return x._p1.distanceToSquared(x._p2)<1e-10&&x._p3.distanceToSquared(x._p4)<1e-10},rb.prototype.insertKnot=function(p){var e=this,f=e._p1,j=e._p2,y=e._p3,A=e._p4,B=f.clone().lerp(j,p),g=j.clone().lerp(y,p),u=y.clone().lerp(A,p),x=B.clone().lerp(g,p),M=g.clone().lerp(u,p),n=x.clone().lerp(M,p);return e._70I()?(f.clone().lerp(A,p),[new hf.Math.CubicBezier(f,f.clone(),n.clone(),n),new hf.Math.CubicBezier(n,n.clone(),A.clone(),A)]):[new hf.Math.CubicBezier(f,B,x,n),new hf.Math.CubicBezier(n,M,u,A)]},u.defineProperties(rb.prototype,{length:{get:function(){var Z=this._cacheLength;if(!Z){Z=this._cacheLength=[];for(var z=this._p1,P=0,d=0;1>=P;){var u=this.getPointAt(P+=.001);d+=u.clone().sub(z).length(),z=u,Z.push({len:d,t:P,point:u.clone()})}}return Z[Z.length-1].len}},p1:{get:function(){return this._p1},set:function(J){this._p1=J,this._cacheLength=A}},p2:{get:function(){return this._p2},set:function(h){this._p2=h,this._cacheLength=A}},p3:{get:function(){return this._p3},set:function(g){this._p3=g,this._cacheLength=A}},p4:{get:function(){return this._p4},set:function(u){this._p4=u,this._cacheLength=A}}});var _b=x.Default.getInternal().ui().EdgeUI,Rk={_47O:function(p){var y=this,L=Rk.getBackups()._47O;hf.inEdit(y.gv)||L.call(y,p)}};hf.Inject.registAsModule(Rk,_b);var Xj=x.Default.getInternal().ui().NodeUI,Dq={_47O:function(z){var P=this,j=Dq.getBackups()._47O;hf.inEdit(P.gv)||j.call(P,z)},getSelectWidth:function(){var U=this,d=U.gv,g=U._data;if(d.isEditable(g)&&hf.inEdit(d))return 0;var i=Dq.getBackup("getSelectWidth");return i.call(U)}};hf.Inject.registAsModule(Dq,Xj);var Mf=x.graph.GraphView,gd={_editPointSize:function(){var M=x.Default.isTouchable,T=hf.getStyle("pointSize");return T[M?0:1]}(),isPointEditable:function(P){var V=this;if(hf.inEdit(V))return V._pointEditableFunc?V._pointEditableFunc(P):!0;var s=gd.getBackup("isPointEditable");s.call(V,P)},isEditable:function(R){var N,y=this,_=gd.getBackup("isEditable");if(N=R instanceof hf.Group?!0:_.call(y,R),!hf.inEdit(y))return N;if(!(R instanceof x.Edge))return N;if(!R.s("2d.editable"))return!1;var d=y.getEditableFunc();return d?d(R):!0},_42:function(k,v){var L=this,K=gd.getBackups()._42;if(K.call(L,k,v),hf.inEdit(L)){var u=L.getEditInteractor();u.drawImpl()}}};hf.Inject.registAsModule(gd,Mf);var Wm=x.Default.getInternal().ui().ShapeUI,rp={_47O:function(e){var E=this,z=rp.getBackups()._47O;hf.inEdit(E.gv)||z.call(E,e)}};hf.Inject.registAsModule(rp,Wm);var Wf=x.graph.DefaultInteractor,Kj={handle_mousewheel:function(a){var j=this,J=Kj.getBackup("handle_mousewheel");hf.inEdit(j.gv)||J.call(j,a)}};hf.Inject.registAsModule(Kj,Wf);var Pj=x.graph.MoveInteractor,_g={_calcShift:function(O,I){var W=this,v=_g.getBackup("_calcShift"),o=W.gv;if(!hf.inEdit(o))return v.call(W,O,I);var N=o.getEditInteractor(),w=N.getSubModule("Move").calcShift(O,I,W);return w||v.call(W,O,I)},clear:function(p){var H=this,i=_g.getBackup("clear");i.call(H,p);var z=H.gv;if(hf.inEdit(z)){var R=z.getEditInteractor();R.getSubModule("Move").clear(p)}}};hf.Inject.registAsModule(_g,Pj);var Cd=hf.Rect=function(G){this.catalog="Rect",this._interactor=G};Cd.prototype={},Cd.prototype.constructor=Cd,Cd.prototype.gatherInfo=function(q,B){var t=this;if(1===B.length){var H=B[0];return H instanceof x.Shape&&H._70I()?t.gatherLine(q,H):Ac(H,q)?!1:t.gatherSingleTarget(q,H)}return B.length>1?t.gatherMultiTargets(q,B):!1},Cd.prototype.gatherSingleTarget=function(P,v){if(v.getCorners){var r,c=this,Z=c.info;c.target=v,r=c.screenInfo={};var d=v.getCorners();Z.LT=new hf.Math.Vector2(d[0]),Z.LB=new hf.Math.Vector2(d[1]),Z.RB=new hf.Math.Vector2(d[2]),Z.RT=new hf.Math.Vector2(d[3]),Z.T=Z.LT.clone().add(Z.RT).divideScalar(2),Z.B=Z.LB.clone().add(Z.RB).divideScalar(2),Z.L=Z.LT.clone().add(Z.LB).divideScalar(2),Z.R=Z.RT.clone().add(Z.RB).divideScalar(2);for(var i in Z)r[i]=hf.toScreenPosition(P,Z[i]);var a=c._interactor,D=a.getStyle("checkSize"),J=function(q,g,y){var S=g.clone().sub(q).setLength(-D),b=y.clone().sub(q).setLength(-D),A=S.add(b).add(q);return A};return r.rotLT=J(r.LT,r.RT,r.LB),r.rotLB=J(r.LB,r.LT,r.RB),r.rotRB=J(r.RB,r.LB,r.RT),r.rotRT=J(r.RT,r.LT,r.RB),r.rotT=r.rotLT.clone().add(r.rotRT).divideScalar(2),r.rotB=r.rotLB.clone().add(r.rotRB).divideScalar(2),r.rotL=r.rotLT.clone().add(r.rotLB).divideScalar(2),r.rotR=r.rotRT.clone().add(r.rotRB).divideScalar(2),r.rotation=v.getRotation(),c.gatherConnectInfo(),!0}},Cd.prototype.gatherConnectInfo=function(){var J=this,d=J.target,w=J._interactor,I=J.screenInfo,W=w.gv;if(W.isConnectActionVisible(d)&&w.getStyle("connectGuideVisible")){var Z;d.s&&(Z=d.s("connectGuideShift")),Z||(Z=w.getStyle("connectGuideShift"));var A=d.getAnchor(),b=d.getSize(),P=d.toGlobal({x:b.width*(Z[0]-A.x),y:b.height*(Z[1]-A.y)});P=hf.toScreenPosition(W,P),I.P1?P.add(I.P2.clone().sub(I.P1).setLength(Z[2])):(P.add(I.RT.clone().sub(I.LT).setLength(Z[2])),P.add(I.LB.clone().sub(I.LT).setLength(Z[3]))),I.connect=P}},Cd.prototype.gatherMultiTargets=function(h,g){var b=hf.Group.findOrCreateGroup(g,this._interactor._uuid);if(!b)return!1;var p=this;return p.editing&&"rotate"!==p.editing.mode||b.calcInfo(),p.gatherSingleTarget(h,b)},Cd.prototype.gatherLine=function(z,e){this.target=e;var F=this.screenInfo={},N=e.getPoints(),$=hf.getDataMatrix(e);return F.P1=hf.toScreenPosition(z,$.apply(N.get(0))),F.P2=hf.toScreenPosition(z,$.apply(N.get(1))),this.gatherConnectInfo(),!0},Cd.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],Cd.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],Cd.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],Cd.prototype.check=function(S,H,Z){if(x.Default.isLeftButton(H)){var y=this;if(y.editing=null,y.tipInfo=null,y.screenInfo){var h=y.target,N=S.isEditable(h),B=y.screenInfo;if(N&&B.connect){var F=y._checkConnect(Z);if(F)return F}if(B.P1)return y._checkLine(Z);var W,e,n,u=null,m=y._interactor,p=m.getStyle("checkSize");if(N&&S.isRectEditable(h))for(e=0;e<hf.Rect.ResizeKeys.length;e++)if(n=hf.Rect.ResizeKeys[e],hf.checkHit(Z,B[n],p)){u=n,W="resize";break}if(!u&&N&&S.isRotationEditable(h)&&!m.getStyle("rotateAsClock")){var D=m.getStyle("rotateCheckSize");for(e=0;e<hf.Rect.RotateKeys.length;e++)if(n=hf.Rect.RotateKeys[e],hf.checkHit(Z,B[n],D)){u=n,W="rotate";break}}if(!u)return m.setCursor("default"),void 0;if("rotate"===W){var q,A=S.lp(H);if(h instanceof hf.Group){var t=m.getStyle("groupRotateModeKey");"string"==typeof t&&(t=[t]);for(var I=!1,P=0,Q=t.length;Q>P;P++)if(H[t[P]]){I=!0;break}var z=m.getStyle("groupRotateModeDefault");q=I?"batch"===z?"block":"batch":z}var i="batch"===q?h.getAnchor2():h.getPosition(),O=Math.atan2(A.y-i.y,A.x-i.x);m._setRotateCursor(O),y.editing={mode:W,key:u,pos:i,flipY:h.getScale().y<0,rotation:h.getRotation(),hitRot:O},q&&(y.editing.groupRotateMode=q)}else{var s=hf.Rect.ResizeKeys.indexOf(u),T=hf.Rect.ResizeDirection[s],$=Math.cos(h.getRotation()),v=Math.sin(h.getRotation()),L=T.x*Math.sign(h.getScale().x),f=T.y*Math.sign(h.getScale().y),c=Math.atan2(-v*L-$*f,$*L-v*f),b=(Math.round(c/(Math.PI/4))+8)%8,J=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][b];this._interactor.setCursor(J);var Y=h.getWidth(),a=h.getHeight(),X=h.getAnchor();y.editing={mode:W,key:u,rect:{x:-Y*X.x,y:-a*X.y,width:Y,height:a},anchor:X,matrix:h.getMatrix()}}return u}}},Cd.prototype._checkLine=function(A){var H=this;H.screenInfo;var a,e=H._interactor.getStyle("checkSize");if(hf.checkHit(A,H.screenInfo.P1,e))a="P1";else{if(!hf.checkHit(A,H.screenInfo.P2,e))return this._interactor.setCursor("default"),void 0;a="P2"}return H.editing={mode:"line",key:a},a},Cd.prototype._checkConnect=function(X){var z=this,q=z.screenInfo,v=z._interactor,P=v.getStyle("connectGuideIntersectSize"),E=q.connect,B=X.x,b=E.x;if(b>B&&P>b-B&&Math.abs(E.y-X.y)<P||B>=b&&hf.checkHit(X,E,P)){var y="connect",f=M.getConnectAction(v.gv);if(z.editing={mode:y},f&&f.delete)if(z.target instanceof hf.Group){var Q=!0;v.gv.sm().getSelection().each(function(H){f.delete.visible.call(null,v.gv,H)||(Q=!1)}),z.editing.hasDeleteAction=Q}else f.delete.visible.call(null,v.gv,z.target)&&(z.editing.hasDeleteAction=!0);return v.setCursor("default"),y}},Cd.prototype._fireEditEvent=function(o,q){var f=this._interactor,j=this.editing;if(j){var z=j.mode;z="rotate"===z?"Rotation":"connect"===z?"Connection":"resize"===z?"Rect":z[0].toUpperCase()+z.slice(1),f.fi({kind:o+"Edit"+z,event:q})}},Cd.prototype.startEdit=function(u,v){u.startDragging(v);var n=this;n._interactor.fi({kind:"prepareEdit",event:v});var r=n.editing,D=n.target;if(r){if(n._fireEditEvent("begin",v),r.started=!0,"rotate"===r.mode)return r.groupRotateMode&&D.beginRotate(r),u._42(),void 0;if("connect"!==r.mode)("line"===r.mode||D&&0===D.getRotation())&&(n._inSmartGuide=!0,n._interactor.rectGuide.gatherRects());else if(r.hasDeleteAction){var H=u.gv,q=n._interactor.getStyle("connectGuideGarbageShift");r.garbageInfo={x:H.getWidth()*q[0]+q[2],y:H.getHeight()*q[1]+q[3],size:n._interactor.getStyle("connectGuideGarbageIntersectsize")},u._42()}}},Cd.prototype._46O=function(L){var K,I,P=this,j=P.editing,F=P.target;if(j){if("connect"===j.mode&&!j.canceled&&!j.deleted)try{j.garbageInfo&&j.garbageInfo.hover?M.doDeleteConnectionAction(P._interactor.gv,F):M.doConnectAction(P._interactor.gv,F,j.target)}catch(Y){console.error(Y)}I=j.freezeFlag,K=P.editing.groupRotateMode,P._fireEditEvent("end",L),P.editing=null}P.tipInfo=null,P._inSmartGuide&&(P._interactor.rectGuide.clear(),P._inSmartGuide=!1),K&&F&&F.endRotate(),F instanceof x.Block&&(I===A?delete F._freezeSyncFromChildren:F._freezeSyncFromChildren=I,F.updateFromChildren())},Cd.prototype.handleNormalStateDelete=function(){var v=this,i=v.editing;if(i&&"connect"===i.mode&&!i.canceled&&!i.deleted){if(i.garbageInfo){try{M.doDeleteConnectionAction(v._interactor.gv,v.target)}catch(S){console.error(S)}i.garbageInfo=null}return i.cursorPos=null,i.targetCorners=null,i.deleted=!0,v._interactor._42(),!0}},Cd.prototype.handleNormalStateKeyDown=function(u){var F=this,Z=F.editing;return!Z||"connect"!==Z.mode||Z.canceled||Z.deleted?void 0:x.Default.isEsc(u)?(Z.cursorPos=null,Z.targetCorners=null,Z.canceled=!0,F._interactor._42(),!0):void 0},Cd.prototype.handleEdit=function(l,f){var p=this,Q=p.editing;if(Q){var y,E,K,t,N,G=p.target,B=Q.key,d=Q.mode,$=l.lp(f),b=p._interactor;if("connect"===d){if(Q.canceled)return;if(Q.deleted)return;Q.cursorPos=b._getLogicalPoint(f);var D=Q.garbageInfo;return D&&hf.checkHit(Q.cursorPos,D,D.size)?(D.hover=!0,Q.target=null,Q.targetCorners=null):(D&&(D.hover=!1),Q.target=l.getDataAt($,function(X){return l.isSelectable(X)?uk(X)?!0:!1:!1})||null,Q.targetCorners=hf.getTargetCornersOnScreen(l,Q.target)),b._42(),void 0}if("rotate"===d){var R,V,P=Q.pos,F=Math.atan2($.y-P.y,$.x-P.x);if(Q.groupRotateMode?V=F-Q.hitRot:(R=F-Q.hitRot,V=Q.rotation+R),V%=2*Math.PI,0>V&&(V+=2*Math.PI),!x.Default.isCtrlDown(f)){var n,C;ck(f)?(n=b.getStyle("shiftRotateRound"),C=n/2):(n=b.getStyle("rotateRound"),C=b.getStyle("rotateSensitivity")),V=hf.roundTo(V,n,C)}Q.groupRotateMode?(R=V-(Q.lastRotation||0),0!==R&&(G.addRotation(R,Q.groupRotateMode,function(y){return l.isRotationEditable(y)}),Q.lastRotation=V)):G.setRotation(V),b._setRotateCursor(F),V>Math.PI&&(V-=2*Math.PI);var w=180*(V/Math.PI);w=w.toFixed(2),y=""+w+"°"}else if("resize"===d){var T=Q.rect;K=T.x,t=T.y;var M,L=T.width,X=T.height,J=Q.anchor,S=Q.matrix,W=G.s&&G.s("keepAspectRatio")||b.getStyle("keepAspectRatio");ck(f)&&(W=!W);var z=p._unionPointMode1,A=p._unionPointMode2;if(p._inSmartGuide&&!x.Default.isCtrlDown(f)&&!W){var r;"L"===B||"R"===B?r="x":("T"===B||"B"===B)&&(r="y"),p._adsorbedToClosest($,r),N=!0}M=S.tfi($);var Y;"LT"===B?(T=z(M,{x:K+L,y:t+X},L,X,W),Y=9):"T"===B?(T=A({x:K,y:M.y},{x:K+L,y:t+X},L,X,W,"v"),Y=1):"RT"===B?(T=z(M,{x:K,y:t+X},L,X,W),Y=33):"L"===B?(T=A({x:M.x,y:t},{x:K+L,y:t+X},L,X,W,"h"),Y=8):"R"===B?(T=A({x:K,y:t},{x:M.x,y:t+X},L,X,W,"h"),Y=32):"LB"===B?(T=z(M,{x:K+L,y:t},L,X,W),Y=12):"B"===B?(T=A({x:K,y:t},{x:K+L,y:M.y},L,X,W,"v"),Y=4):"RB"===B&&(T=z(M,{x:K,y:t},L,X,W),Y=36);var u=S.tf(T.x+T.width*J.x,T.y+T.height*J.y);G instanceof x.Block&&(Q.hasOwnProperty("freezeFlag")||(Q.freezeFlag=G._freezeSyncFromChildren,G._freezeSyncFromChildren=!0)),G.setPosition(u),G.setSize(T.width,T.height),N&&(E=G.getRect(),b.rectGuide.gatherLines({node:G,x:E.x,y:E.y,w:E.width,h:E.height},r,Y)),y=""+Math.round(T.width)+" * "+Math.round(T.height)}else if("line"===d){if(ck(f)){var m=G.getPoints(),i="P1"===B?m.get(1):m.get(0),U={x:$.x-i.x,y:$.y-i.y},H=b.getStyle("shiftLineRotateRound"),v=p._shiftDirList;if(!v||p._shiftRotateRound!==H){p._shiftRotateRound=H,p._shiftDirList=v=[];for(var Z=0;Z<Math.PI;Z+=H)v.push({x:o(Z),y:O(Z)})}for(var s,e=0,j=0,I=v.length;I>j;j++){var q=v[j],g=q.x*U.x+q.y*U.y;Math.abs(g)>Math.abs(e)&&(e=g,s=q)}$={x:i.x+s.x*e,y:i.y+s.y*e},b.rectGuide.clear()}else p._inSmartGuide&&!x.Default.isCtrlDown(f)&&(p._adsorbedToClosest($),N=!0);var h=hf.getDataMatrix(G).applyInverse($);G.setPoint("P1"===B?0:1,h,!0);var c=G.getPoints(),_=c.get(0),k=c.get(1);K=_.x-k.x,t=_.y-k.y,y=" "+Math.round(Math.sqrt(K*K+t*t))+" ",N&&(E=G.getRect(),b.rectGuide.gatherLines({node:G,x:E.x,y:E.y,w:E.width,h:E.height}))}if(y){var a=x.Default.getLogicalPoint(f,b._canvas);a.x+=hf.Icons.TipShiftX,a.y+=hf.Icons.TipShiftY,p.tipInfo={helperPos:a,text:y,size:y.length}}p._fireEditEvent("between",f)}},Cd.prototype._unionPointMode1=function(G,d,W,q,f){if(f&&W&&q){var S=G.x-d.x,H=G.y-d.y;Math.abs(S*q)<Math.abs(H*W)?(H=Math.sign(H)*Math.abs(S*q/W),G.y=d.y+H):(S=Math.sign(S)*Math.abs(H*W/q),G.x=d.x+S)}return x.Default.unionPoint(G,d)},Cd.prototype._unionPointMode2=function(p,B,X,o,P,h){var H=x.Default.unionPoint(p,B);if(P&&X&&o){var C;"v"===h?(C=H.x+H.width/2,H.width=X*H.height/o,H.x=C-H.width/2):(C=H.y+H.height/2,H.height=o*H.width/X,H.y=C-H.height/2)}return H},Cd.prototype._adsorbedToClosest=function(I,T){var O=this,Q=O._interactor,C=Q.rectGuide.findClosest(I,T),c=Q.gridGuide.findClosest(I,T),b=1/0,L=1/0;C&&(isFinite(C.x)&&(b=C.x),isFinite(C.y)&&(L=C.y)),c&&(isFinite(c.x)&&Math.abs(c.x)<Math.abs(b)&&(b=c.x),isFinite(c.y)&&Math.abs(c.y)<Math.abs(L)&&(L=c.y)),isFinite(b)&&(I.x+=b),isFinite(L)&&(I.y+=L)},Cd.prototype._42=function(L,g,W){var q=this;q.info={},q.screenInfo=null;var K=q._interactor;if(!K.editDetail&&q.gatherInfo(g,W)){var u=q.editing,E=u?u.groupRotateMode:null,A=q.screenInfo;if("block"!==E||!u||!u.started){if(A.P1?hf.Icons.DrawIcon(K,L,hf.Icons.Line,A):hf.Icons.DrawIcon(K,L,hf.Icons.Rect,A),A.connect&&(hf.Icons.DrawIcon(K,L,hf.Icons.ConnectGuide,{rotation:A.rotation,connect:A.connect,cursorPos:u?u.cursorPos:null}),u)){if(u.targetCorners){for(var w={x:1/0,y:1/0},p={x:-1/0,y:-1/0},l=0,Y=u.targetCorners.length;Y>l;l+=2)w.x=Math.min(w.x,u.targetCorners[l]),p.x=Math.max(p.x,u.targetCorners[l]),w.y=Math.min(w.y,u.targetCorners[l+1]),p.y=Math.max(p.y,u.targetCorners[l+1]);hf.Icons.DrawIcon(K,L,hf.Icons.HoverDataRect,{min:w,max:p,color:K.getStyle("hoverGuideColor")||K.getStyle("baseColor")})}u.garbageInfo&&hf.Icons.DrawIcon(K,L,hf.Icons.ConnectGuideGarbage,u.garbageInfo)}K.getStyle("rotateTipVisible")&&q.tipInfo&&hf.Icons.DrawIcon(K,L,hf.Icons.TipHelper,q.tipInfo)}q.target instanceof hf.Group&&q.target._42(K,L,g)}};var Wc=hf.Anchor=function(D){this.catalog="Anchor",this._interactor=D};Wc.prototype={},Wc.prototype.constructor=Wc,Wc.prototype.gatherInfo=function(_,J){var s=this;if(1===J.length){var A=J[0];if(!A.getAnchor)return;if(A instanceof x.Shape&&A._70I())return;if(Ac(A,_))return;return s.gatherSingleTarget(_,J[0])}return J.length>1?s.gatherMultiTargets(_,J):!1},Wc.prototype.gatherSingleTarget=function(Q,I){var Z=this;return Z.info.POS=I.getPosition(),Z.screenInfo.POS=hf.toScreenPosition(Q,Z.info.POS),Z.target=I,!0},Wc.prototype.gatherMultiTargets=function(Y,D){var e=this,O=hf.Group.findOrCreateGroup(D,this._interactor._uuid);return O?(e.screenInfo.POS=hf.toScreenPosition(Y,O.getAnchor2()),e.target=O,!0):!1},Wc.prototype.isVisible=function(){var h=this,Q=h._interactor;if(Q.getStyle("anchorVisible")===!1)return!1;var n=h.target;if(n){if(this.editing)return!0;var l=n.getAnchor(),T=Q.getStyle("anchorOutsideVisibleThreshold");if(l.x<-T||l.x>1+T||l.y<-T||l.y>1+T)return!0;var F=n.getSize(),g=n.getScale(),i=Math.min(Math.abs(F.width*g.x),Math.abs(F.height*g.y));if(i*Q.gv._zoom<Q.getStyle("anchorHideThreshold"))return!1}return!0},Wc.prototype.check=function(C,F,A){if(x.Default.isLeftButton(F)){var l=this,e=l._interactor;if(l.isVisible()&&e.getStyle("anchorMovable")!==!1){l.editing=null,l.tipInfo=null;var z=l.target;if(z&&C.isAnchorEditable(z)&&C.isEditable(z)){var s;if(l.screenInfo&&(s=l.screenInfo.POS)&&hf.checkHit(A,new hf.Math.Vector2(s),e.getStyle("checkSize"))){if(z instanceof hf.Group)return l.editing={},!0;var E=z.getWidth(),V=z.getHeight(),t=z.getAnchor();return l.editing={rect:{x:-E*t.x,y:-V*t.y,width:E,height:V},anchor:t,matrix:z.getMatrix()},!0}}}}},Wc.prototype.startEdit=function(o,D){o.startDragging(D),o.fi({kind:"beginEditAnchor",event:D})},Wc.prototype._46O=function(Q){var k=this;k.editing&&(k.editing=null,k._interactor.fi({kind:"endEditAnchor",event:Q})),k.tipInfo=null},Wc.prototype.handleEdit=function(Q,b){var m=this,E=m.target;if(E){var h=m.editing;if(h){var C=Q.lp(b),g=m._interactor;if(E instanceof hf.Group)return E.setAnchor2(C),g._42(),void 0;
var N=h.matrix,j=N.tfi(C),z=h.rect,Y=(j.x-z.x)/z.width,n=(j.y-z.y)/z.height;if(!x.Default.isCtrlDown(b)){var a=g.getStyle("anchorRound"),X=g.getStyle("anchorSensitivity");Y=hf.roundTo(Y,a,X),n=hf.roundTo(n,a,X)}E.setAnchor(Y,n,!0);var G=x.Default.getLogicalPoint(b,g._canvas);G.x+=hf.Icons.TipShiftX,G.y+=hf.Icons.TipShiftY;var l=""+Y.toFixed(2)+", "+n.toFixed(2);m.tipInfo={helperPos:G,text:l,size:l.length},g.fi({kind:"betweenEditAnchor",event:b})}}},Wc.prototype._42=function(A,v,M){var z=this;z.info={},z.screenInfo={};var H=z._interactor;H.editDetail||z.gatherInfo(v,M)&&z.isVisible()&&(hf.Icons.DrawIcon(H,A,hf.Icons.Anchor,z.screenInfo),z.tipInfo&&hf.Icons.DrawIcon(H,A,hf.Icons.TipHelper,z.tipInfo))};var wd=hf.MoveDummy=function(i){this.catalog="MoveDummy",this._interactor=i};wd.prototype={},wd.prototype.constructor=wd,wd.prototype.gatherInfo=function(){var l=this,u=this._interactor.getSubModule("Rect");if(u){var O=u.screenInfo;if(O){var V=l._interactor,h=l.getMovableTarget(u.target);if(h){var n=V.getStyle("moveDummyThreshold");if(n!==!1){var T=O.LT||O.P1,J=O.RT||O.P2,C=O.LB||T;if(T){var K=O.P1,F=Math.min(T.distanceTo(C),T.distanceTo(J));if(!(n!==!0&&F>n)){var U=V.getStyle("moveDummyPosition"),L=J.clone().sub(T),o=C.clone().sub(T),g=U[2],p=U[3];if(K){var s=V.getStyle("moveDummyLineExtraShift");s&&(g+=s[0],p+=s[1])}var b=T.clone().add(L.clone().multiplyScalar(U[0])).add(L.setLength(g)).add(o.clone().multiplyScalar(U[1])).add(o.setLength(p));return l.screenInfo.pos=b,l.screenInfo.size=V.getStyle("moveDummySensitivity"),!0}}}}}}},wd.prototype.getMovableTarget=function(c){var C=this._interactor.gv;if(uk(c)){if(C.isMovable(c))return c}else if(c instanceof hf.Group)for(var W=c._entities,Z=W.length-1;Z>=0;Z--){var l=W[Z];if(uk(l)&&C.isMovable(l))return l}return null},wd.prototype.getMoveInteractor=function(){for(var j,U,O,L=this._interactor.gv,s=L.getInteractors(),j=0,U=s.length;U>j;j++)if(O=s.get(j),O instanceof Pj)return O},wd.prototype.startEdit=function(O,E){O.startDragging(E);var l=this.getMoveInteractor();if(l){var X=this.selectedTarget,w=O.gv;w._moving=1,l._data=X,w.handleMouseDown&&w.handleMouseDown(E,X)}},wd.prototype._46O=function(X){var b=this,V=b.getMoveInteractor();V&&(V.handleWindowMouseUp(X),b.selectedTarget=null)},wd.prototype.handleEdit=function(d,z){var v=this.getMoveInteractor();v&&v.handleWindowMouseMove(z)},wd.prototype.check=function(J,n,r){if(this.selectedTarget=null,x.Default.isLeftButton(n)&&!J._scrolling&&!Yo()){var s=this;if(s.screenInfo){var w=s.screenInfo.pos;if(w&&!(r.distanceTo(w)>s.screenInfo.size)){var q=s._interactor;return s.selectedTarget=s.getMovableTarget(q.getSubModule("Rect").target),q.setCursor("default"),!0}}}},wd.prototype._42=function(q,P,H){var K=this;K.screenInfo={};var C=K._interactor;C.editDetail||K.gatherInfo(P,H)&&(!C.editing||K.selectedTarget)&&hf.Icons.DrawIcon(C,q,hf.Icons.MoveDummy,K.screenInfo)};var vo=hf.RotateX=function(b){this.catalog="RotateX",this._interactor=b};vo.prototype={},vo.prototype.constructor=vo,vo.prototype.gatherInfo=function(g,H){var v=this;if(1===H.length){var L=H[0];return L instanceof x.Shape&&L._70I()||Ac(L,g)?!1:v.gatherSingleTarget(g,L)}return H.length>1?v.gatherMultiTargets(g,H):!1},vo.prototype.gatherSingleTarget=function(){var p=new x.Math.Vector2,m=new x.Math.Vector2,X=new x.Math.Vector2,I=new x.Math.Vector2,k=function(L,m){var P=L.x-m.x,F=L.y-m.y;return P*P+F*F};return function(o,N){if(N.getCorners){var S=this,v=N.getCorners(),z=15,q=N.getPosition();p.copy(v[0]),X.copy(v[1]),I.copy(v[3]),m.copy(p).add(I).divideScalar(2).add(p.sub(X).setLength(z/o.getZoom()));var J=Math.max(k(q,v[0]),k(q,v[1]),k(q,v[2]),k(q,v[3]));return S.info.POS=m.clone(),S.screenInfo.POS=hf.toScreenPosition(o,S.info.POS),S.screenInfo.LEN=Math.sqrt(J)*o.getZoom()+z,S.screenInfo.CENTER=hf.toScreenPosition(o,q),S.target=N,!0}}}(),vo.prototype.gatherMultiTargets=function(K,T){var J=this,P=hf.Group.findOrCreateGroup(T,this._interactor._uuid);if(!P)return!1;var J=this;return J.gatherSingleTarget(K,P)},vo.prototype.isVisible=function(){var e=this._interactor;if(!e.getStyle("rotateAsClock"))return!1;var B=this.target;if(!B)return!0;var d=e.gv;return d.isEditable(B)&&d.isRotationEditable(B)?!0:!1},vo.prototype.check=function(M,E,d){var U=this,n=U._checkImpl(M,E,d);return(n||U._clockPainted)&&U._interactor._42(),n},vo.prototype._checkImpl=function(R,p,w){if(x.Default.isLeftButton(p)){var h=this;h.editing=null,h.tipInfo=null;var A;if(h.screenInfo&&(A=h.screenInfo.POS)&&h.isVisible()){var I=h._interactor;if(hf.checkHit(w,A,I.getStyle("checkSize"))){var r=h.target,j=R.lp(p),z=r.getPosition(),P=Math.atan2(j.y-z.y,j.x-z.x);return I._setRotateCursor(P),h.editing={pos:z,rotation:r.getRotation(),hitRot:P,groupRotateMode:"block",screenInfo:{CENTER:h.screenInfo.CENTER,LEN:h.screenInfo.LEN}},!0}}}},vo.prototype.startEdit=function(z,q){z.startDragging(q),z.fi({kind:"beginEditRotation",event:q}),this.target instanceof hf.Group&&this.target.beginRotate(this.editing)},vo.prototype._46O=function(g){var D=this;D.editing&&(D.editing=null,D._interactor.fi({kind:"endEditRotation",event:g})),D.target instanceof hf.Group&&D.target.endRotate(),D.tipInfo=null},vo.prototype.handleEdit=function(q,W){var u=this,K=u.editing;if(K){var A,n,Z=u.target,I=q.lp(W),U=u._interactor,g=K.pos,S=Math.atan2(I.y-g.y,I.x-g.x),t=Z instanceof hf.Group;if(t?n=S-K.hitRot:(A=S-K.hitRot,n=K.rotation+A),n%=2*Math.PI,0>n&&(n+=2*Math.PI),!x.Default.isCtrlDown(W)){var Y,Q;ck(W)?(Y=U.getStyle("shiftRotateRound"),Q=Y/2):(Y=U.getStyle("rotateRound"),Q=U.getStyle("rotateSensitivity")),n=hf.roundTo(n,Y,Q)}t?(A=n-(K.lastRotation||0),0!==A&&(Z.addRotation(A,K.groupRotateMode,function(c){return q.isRotationEditable(c)}),K.lastRotation=n)):Z.setRotation(n),U._setRotateCursor(S),n>Math.PI&&(n-=2*Math.PI);var L=180*(n/Math.PI),M=""+L.toFixed(2)+"°",R=x.Default.getLogicalPoint(W,U._canvas);R.x+=hf.Icons.TipShiftX,R.y+=hf.Icons.TipShiftY,u.tipInfo={helperPos:R,text:M,size:M.length},U.fi({kind:"betweenEditRotation",event:W})}},vo.prototype._42=function(s,c,r){var z=this;z._clockPainted=!1,z.info={},z.screenInfo={};var Z=z._interactor;Z.editDetail||z.gatherInfo(c,r)&&z.isVisible()&&(hf.Icons.DrawIcon(Z,s,hf.Icons.RoundPoint,z.screenInfo.POS),Z.getStyle("rotateTipVisible")&&z.tipInfo&&hf.Icons.DrawIcon(Z,s,hf.Icons.TipHelper,z.tipInfo),z.editing&&z.drawClock(s))},vo.prototype.drawClock=function(V){V.save();var E=this;E._clockPainted=!0;var i=E.editing||{},U=i.screenInfo||E.screenInfo,e=U.LEN,y=e+8,t=e+18;V.save(),V.translate(U.CENTER.x,U.CENTER.y),V.beginPath(),V.strokeStyle="rgb(150, 150, 150)";for(var A,H,m,N,W,a=0;360>a;a++)A=a*Math.PI/180,0===a%5&&(H=O(A)*e,m=o(A)*e,N=O(A)*y,W=o(A)*y,V.moveTo(H,m),V.lineTo(N,W)),0===a%45&&(H=O(A)*e,m=o(A)*e,N=O(A)*t,W=o(A)*t,V.moveTo(H,m),V.lineTo(N,W));V.stroke(),V.rotate(-Ek);var v=i.lastRotation||E.target.getRotation();V.beginPath(),V.fillStyle="rgba(255, 0, 0, 0.1)",V.strokeStyle="rgb(157, 157, 157)",V.moveTo(0,0),V.arc(0,0,t,0,v,!1),V.fill(),V.beginPath(),V.moveTo(0+t,0),V.arc(0,0,t,0,v,!1),V.stroke(),V.restore()};var Tj=hf.Curve=function(k){this.catalog="Curve",this._interactor=k};Tj.prototype={},Tj.prototype.constructor=Tj,u.defineProperties(Tj.prototype,{activing:{get:function(){return this._activing},set:function($){var l=this;if($)l._activing=new hf.CurveActiving(this,$),l.gatherSingleTarget(l._interactor.gv,l.target);else{var g=l._activing;g&&g.dispose(),l._activing=null}}}}),Tj.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},Tj.prototype.setUp=function(){var x=this,g=x._interactor;g&&g.gv.mp(x._onGraphviewPropertyChanged,x)},Tj.prototype._onGraphviewPropertyChanged=function(e){("zoom"===e.property||"translateX"===e.property||"translateY"===e.property)&&this._handleDataChanged()},Tj.prototype.tearDown=function(){var R=this,k=R._interactor;k&&k.gv.ump(R._onGraphviewPropertyChanged,R)},Tj.prototype.canEnterEditDetailMode=function(){var Y=mn(this._interactor);return Y?this.target=Y:void 0},Tj.prototype.canQuitEditDetailMode=function(J){var Y=this,I=Y._interactor._getLogicalPoint(J);return Y._checkEditRealPoint(I)?void 0:Y._interactor.gv.getDataAt(J)!==Y.target?!0:void 0},Tj.prototype.preHandleScroll=function(){var c=this.editing;return c&&c.inEdit?!0:void 0},Tj.prototype.getCurrentSelectintStatus=function(){var O=this;if(O.activing&&!O.activing.selections){if(O.activing.status!=A)return O.activing.status;var v=function(R){var w=O.activing.status;O.activing.status=R,O._interactor.fp("shapePointStatus",w,R)},C=hf.Curve.PointType,S=O.activing.point,E=O.activing.pairs;if(!E||1!==E.length)return v(C.Mirrored);var B=E[0],b=B.c1&&B.c1.isNearEnough(S),y=B.c2&&B.c2.isNearEnough(S);if(!B.c1||!B.c2)return b||y?v(C.Straight):v(C.Disconnected);if(b&&y)return v(C.Straight);if(b||y)return v(C.Asymmetric);var m=B.c1.clone().sub(S),T=B.c2.clone().sub(S);return Math.abs(m.x*T.y-m.y*T.x)>1e-5||m.x*T.x>0?v(C.Disconnected):Math.abs(m.length()-T.length())>1e-5?v(C.Asymmetric):v(C.Mirrored)}},Tj.prototype.handle_keydown=function(S){var $=this;if($._interactor.editDetail){var h=hf.Curve.PointType;"1"===S.key?$._setCurrentSelectionStatus(h.Straight):"2"===S.key?$._setCurrentSelectionStatus(h.Mirrored):"3"===S.key?$._setCurrentSelectionStatus(h.Disconnected):"4"===S.key&&$._setCurrentSelectionStatus(h.Asymmetric)}},Tj.prototype.setCurrentSelectionStatus=function(b){var F=this,W=F._interactor;if(W){var m=W.gv;m.dm().beginTransaction(),this._setCurrentSelectionStatus(b),m.dm().endTransaction()}},Tj.prototype._setCurrentSelectionStatus=function(y){var f=this,V=f.activing;if(V){var o=f.getCurrentSelectintStatus();if(null!==o&&o!==y){V.status=y;var e=f.activing.point,U=f.activing.pairs;if(U&&1===U.length){var F=U[0],d=f.screenInfo.curve,I=hf.Curve.PointType,E=f._interactor,W=function(){f._writeToHt(),E.fp("shapePointStatus",o,y),f.check(E.gv,null,new hf.Math.Vector2(E._lastLogicalPoint))};if(y===I.Straight)return d.moveCtrlPoint(F,e,"c1"),d.moveCtrlPoint(F,e,"c2"),W(),void 0;if(o===I.Straight){var R=d.findPairs(e,!0),T=R[0],c=T.r1||e,l=T.r2||e,g=l.clone().sub(c).multiplyScalar(.25);return d.moveCtrlPoint(F,e.clone().sub(g),"c1"),d.moveCtrlPoint(F,e.clone().add(g),"c2"),W(),void 0}var B=F.c1,Y=F.c2;if(B&&Y){if(y===I.Mirrored)return d.moveCtrlPoint(F,e.clone().multiplyScalar(2).sub(Y),"c1"),W(),void 0;if(y===I.Asymmetric&&o===I.Disconnected){var P=B.clone().sub(e).length(),g=e.clone().sub(Y).setLength(P).add(e);return d.moveCtrlPoint(F,g,"c1"),W(),void 0}}V._firePointChange(),E.fp("shapePointStatus",o,y),f.check(E.gv,null,new hf.Math.Vector2(E._lastLogicalPoint))}}}},Tj.prototype._handleDataChanged=function(){var Y="s:edge.points,s:edge.segments,points,segments,shape,position,rotation,scale".split(",");return function(X){var M=this;if(M.screenInfo&&M.target){if(X&&Y.indexOf(X.property)<0)return;var H=M._interactor;M.gatherSingleTarget(H.gv,M.target,!0),M.check(H.gv,null,new hf.Math.Vector2(H._lastLogicalPoint)),H._42()}}}(),Tj.prototype.gatherSingleTarget=function(q,n,R){var E,Z,d=this;d.screenInfo&&d.screenInfo.curve&&(Z=d.screenInfo.curve._curves);var W=d.editing;E=W?d.screenInfo:d.screenInfo={};var I,s,H=n instanceof x.Edge;H?(I=n.s("edge.segments"),s=n.s("edge.points")||new x.List):(I=n._58O,s=n._59O),E.S=I;var y,f=E.P=[],K=hf.getDataMatrix(n);if(n instanceof x.Polyline||n instanceof x.Edge&&d._interactor.getStyle("edgeElevationEditable"))y=n.getElevation&&n.getElevation()||0,E.E=[];else{var L=!1;s.each(function(U){U.e!==A&&(L=!0)}),L&&(E.E=[])}if(s.each(function(u){E.E&&E.E.push(u.e!=A?u.e:y),u=K.apply(u);var G=hf.toScreenPosition(q,u);f.push(G.x,G.y)}),H){var v=f.length,X=hf.toScreenPosition(q,n._lastSourcePoint||(v?{x:f[0],y:f[1]}:{x:0,y:0})),N=hf.toScreenPosition(q,n._lastTargetPoint||(v?{x:f[v-2],y:f[v-1]}:{x:0,y:0}));if(f.splice(0,0,X.x,X.y),f.push(N.x,N.y),E.E){var p=n.getSourceAgent();p instanceof x.Edge?E.E.splice(0,0,n.s("edge.source.offset.elevation")):E.E.splice(0,0,((n.s("edge.source.anchor.elevation")||.5)-.5)*p.getTall()*p.getScaleTall()+p.getElevation()+n.s("edge.source.offset.elevation"));var C=n.getTargetAgent();C instanceof x.Edge?E.E.push(n.s("edge.target.offset.elevation")):E.E.push(((n.s("edge.target.anchor.elevation")||.5)-.5)*C.getTall()*C.getScaleTall()+C.getElevation()+n.s("edge.target.offset.elevation"))}}if(!E.S||!E.S.size()){E.S=new x.List,E.S.add(1);for(var D=0;D<f.length/2-1;D++)E.S.add(2)}if((!W||R)&&d.convertToCubicBezier(Z),d.activing&&(R||!d.editing||"realPoint"===d.editing.type)){var M=E.curve.findPairs(d.activing.point);d.activing.pairs=M}},Tj.prototype._convertToNewPoint=function(b,B,X,y){var g,W,K;for(g=0,W=B.length;W>g;g++){if(K=B[g],K._p1.isNearEnough(b)&&(!y||y.indexOf(K._p1)<0))return K._p1;if(K._p4.isNearEnough(b)&&(!y||y.indexOf(K._p4)<0))return K._p4}if(X)for(g=0,W=Math.min(X.length,W);W>g;g++){if(K=X[g],K._p1===b&&(!y||y.indexOf(B[g]._p1)<0))return B[g]._p1;if(K._p4===b&&(!y||y.indexOf(B[g]._p4)<0))return B[g]._p4}},Tj.prototype.convertToCubicBezier=function(t){var l,p,O=this,R=new hf.Math.Curve,Z=O.screenInfo;if(R.createFromHtShape(Z.P,Z.S,Z.E),Z.curve=R,O.activing){var H=R._curves;l=O.activing.point,p=O._convertToNewPoint(l,H,t);var K=[];if(p&&(O.activing.point=p,K.push(p)),O.activing.selections){var L=-1,o=O.activing.selections;o.forEach(function(w){L++,p=O._convertToNewPoint(w,H,t,K),p&&(o[L]=p,K.push(p))})}}},Tj.prototype.check=function(f,J,Z){if(!J||$h(J)||$i(J)){var X=this;if(X._interactor.setCursor("default"),X.editing=null,X.highlight=null,X.tipInfo=null,X.edgeEditResult=null,X.screenInfo){if(Yo()||J&&$i(J))return X._interactor._42(),!0;if(X._checkEditCtrlPoint(Z))return X._interactor._42(),!0;if(X._checkEditRealPoint(Z))return X._interactor._42(),!0;if(X._checkEditElevation(Z))return X._interactor._42(),!0;var D=X.screenInfo.curve,n=D.checkPoint(Z,X._interactor.getStyle("curveIntersectSize"));if(n){var s=X.highlight={};s.type="insertKnot",s.bezier=n.bezier,s.point=n.intersection}return X._interactor._42(),!0}}},Tj.prototype.getAdjacentBeziers=function(S){var M=this.screenInfo;if(M){var X,L,C,I=M.curve._curves,r=[],R=A;for(X=0,L=I.length;L>X;X++)if(C=I[X],R===A){if(C._p4.isNearEnough(S)){r.push(C),R=X;continue}}else{if(C._p1.isNearEnough(S))return r.push(C),r;if(C._p4.isNearEnough(S)){r[0]=C,R=X;continue}}}},Tj.prototype.roundCorner=function(M){if(this.activing&&this.screenInfo){var t=this.screenInfo.curve,X=t._curves,k=this.getAdjacentBeziers(this.activing.point),r=k[1],F=r._index;r=r.insertKnot(r.getTByPercentage(M/r.length))[1],X[F]=r;var y=r.p1,W=k[0],$=W._index;W=W.insertKnot(W.getTByPercentage(1-M/W.length))[0],X[$]=W;var A=W.p4,C=this.activing.point,Q=new hf.Math.CubicBezier(A,C.clone().sub(A).multiplyScalar(2/3).add(A),C.clone().sub(y).multiplyScalar(2/3).add(y),y);X.splice(F,0,Q),this._writeToHt(),this.activing=null,this._interactor._42()}},Tj.prototype._checkEditRealPoint=function(j){var K,a,T,k,o,h,M=this,Q=M.screenInfo.curve._curves,S=M._interactor.getStyle("curvePointIntersectSize"),G=1/0;for(S*=S,T=0,k=Q.length;k>T;T++)K=Q[T],o=K._p1,h=j.distanceToSquared(o),G>h&&(G=h,a=o),o=K._p4,h=j.distanceToSquared(o),G>h&&(G=h,a=o);if(G>S)return!1;var p=M.highlight={};return p.type="changeRealPoint",p.point=a,M.editing={type:"realPoint",point:a,shiftGuide:{point:a.clone(),dir:"x",limit:0}},M._interactor.setCursor("crosshair"),!0},Tj.prototype._checkEditElevation=function(K){var Z=this;if(!Z._interactor.getStyle("curveElevationVisible"))return!1;var e=Z.target;if(e instanceof x.Edge&&!Z._interactor.getStyle("edgeElevationEditable"))return!1;var S=Z.activing;if(!S)return!1;var k=S.getCurrentEditingPoint();if(!k)return!1;var I=Z._interactor,c=I.getStyle("curveElevationGuideShift"),W=I.getStyle("curveElevationIntersectSize"),X=K.distanceToSquared({x:k.x+c[0],y:k.y+c[1]});if(!(X>W*W)){var M=Z.highlight={};M.type="elevation";var j=new hf.Math.Vector2(K.x,K.y,k.e);return Z.editing={type:"elevation",startPoint:j},Z._interactor.setCursor("crosshair"),!0}},Tj.prototype._checkEditCtrlPoint=function(T){var I=this;if(I.activing&&!I.activing.selections){var Z=I.getCurrentSelectintStatus();if(Z!==hf.Curve.PointType.Straight){var d=I.activing.pairs;if(d){var J=I._interactor.getStyle("curvePointIntersectSize");J*=J;var F,x,g,E,m,V,z,u,C,r=1/0;for(z=0,C=d.length;C>z;z++)for(E=d[z],u=0;2>u;u++)m=0===u?"c1":"c2",E[m]&&(V=T.distanceToSquared(E[m]),r>V&&(r=V,F=E,x=z,g=m));if(r>J)return!1;I.activing.hlpair=F,I.activing.hltype=g;var e=I.highlight={};return e.type="changeCtrlPoint",e.point=F[g],I.editing={type:"ctrlPoint",pair:F,pairId:x,ctrlType:g,direction:F[g].clone().sub(I.activing.point).normalize()},I._interactor.setCursor("crosshair"),!0}}}},Tj.prototype.startEdit=function(g,Z){g.startDragging(Z);var l=this;l.highlight&&"insertKnot"===l.highlight.type&&(l.insertKnot(),l.gatherSingleTarget(l._interactor.gv,l.target),l.activing=null,l._checkEditRealPoint(l._interactor._getLogicalPoint(Z)));var M=l._activing;if(M){var U=l.editing?l.editing.type:null;"ctrlPoint"===U?M.editingCtrl={pairId:l.editing.pairId,type:M.hltype}:"realPoint"===U&&(M.editingCtrl=!1)}var p=l.highlight,h=x.Default.isCtrlDown(Z);if(!p||Yo()||$i(Z)){var E=l._interactor.gv;if(!E.setFocus(Z)||E._scrolling)return;return h?l._multiSelect={startPoint:E.lp(Z)}:E.isPannable()&&($h(Z)||$i(Z))&&(l._pan={tx:E.tx(),ty:E.ty()},g.fi({kind:"beginPan",event:Z})),void 0}if("changeRealPoint"===p.type){var y,i=l.activing?l.activing.point:null,f=l.activing?l.activing.selections:null;if(h&&l.activing)i===p.point?(f?(l.activing={point:f[0]},f.length>1&&(f.splice(0,1),l.activing.selections=f)):l.activing=null,l.editing=null):f&&(y=f.indexOf(p.point))>=0?(f.length>1?f.splice(y,1):delete l.activing.selections,l.editing=null):f?(f.push(i),l.activing={point:p.point,selections:f}):l.activing={point:p.point,selections:[i]};else if(f)i===p.point||((y=f.indexOf(p.point))>=0?(f.splice(y,1,i),l.activing={point:p.point,selections:f}):l.activing={point:p.point});else{var O;i===p.point&&(O=l.activing.status),l.activing={point:p.point},O&&(l.activing.status=O)}g.fi({kind:"beginEditPoint",event:Z})}},Tj.prototype.insertKnot=function(){var l=this,h=l.highlight,T=l.screenInfo.curve;T.insertKnot(h.bezier,h.point.t),l._writeToHt()},Tj.prototype._writeToHt=function(){var E,U,n=this,P=n.screenInfo.curve,e=P.toHtShape(),d=e.points,c=[],W=e.segments,R=n._interactor.gv;R.dm().beginTransaction();var C,G,F=n.target,z=F instanceof x.Edge,b=hf.getDataMatrix(F).invert();G=F instanceof x.Polyline||z&&n._interactor.getStyle("edgeElevationEditable"),G&&(C=F.getElevation&&F.getElevation()||0);for(var J=0,Z=d.length;Z>J;J++)E=d[J],U=hf.toWorldPosition(R,E),U=b.apply(U),isFinite(E.e)&&E.e!==C&&(U.e=E.e),c.push(U);if(F._writing=!0,z){F.s("edge.type","points"),F.setStyle("edge.segments",W),F.setStyle("edge.points",c.slice(1,c.length-1)),F.setStyle("edge.source.offset.x",0),F.setStyle("edge.source.offset.y",0),F.setStyle("edge.target.offset.x",0),F.setStyle("edge.target.offset.y",0);var T=n._nextChangeEdgeHost;delete n._nextChangeEdgeHost,T&&("source"===T.type?F.setSource(T.host):F.setTarget(T.host)),n._writeEdgeHostAnchor("source",c[0]),n._writeEdgeHostAnchor("target",c[c.length-1])}else c.length?(F.setSegments(W),F.setPoints(c,!0)):F.removeFromDataModel();R.dm().endTransaction(),delete F._writing},Tj.prototype._writeEdgeHostAnchor=function(h,k){var E=this,n=E.target,H=E._calcHostAnchor(n,h,k);H.index!==A?(n.setStyle("edge."+h+".index",H.index),n.setStyle("edge."+h+".percent",A),n.setStyle("edge."+h+".anchor.x",A),n.setStyle("edge."+h+".anchor.y",A),n.setStyle("edge."+h+".anchor.elevation",A),n.setStyle("edge."+h+".offset.elevation",k.e)):H.percent!==A?(n.setStyle("edge."+h+".percent",H.percent),n.setStyle("edge."+h+".index",A),n.setStyle("edge."+h+".anchor.x",A),n.setStyle("edge."+h+".anchor.y",A),n.setStyle("edge."+h+".anchor.elevation",A),n.setStyle("edge."+h+".offset.elevation",k.e)):(n.s("edge."+h+".anchor.x",H.x),n.s("edge."+h+".anchor.y",H.y),n.s("edge."+h+".anchor.elevation",H.e),H.offsetX||H.offsetY||H.offsetElevation?(n.s("edge."+h+".offset.x",H.offsetX),n.s("edge."+h+".offset.y",H.offsetY),n.s("edge."+h+".offset.elevation",H.offsetElevation)):(n.s("edge."+h+".offset.x",0),n.s("edge."+h+".offset.y",0),n.s("edge."+h+".offset.elevation",0)))},Tj.prototype._calcHostAnchor=function(G,Q,$,p){p||(p="source"===Q?G.getSource():G.getTarget());var k=this._interactor.gv,J=k.calculateAttachPoint(p,$);if(J)return J.info;if(dq(p)){var M=k.calculateEdgePosition(p,$);return M}var D=p.getRotation(),X=p.getAnchor();Ac(p,k)&&(D=0);var c=p.getElevation(),v=p.getTall()*p.getScaleTall();c=(($.e||0)-G.s("edge."+Q+".offset.elevation")-c)/v+.5;var u=p.getScale();if(D||u.x<0||u.y<0){var r=p.getMatrix(),d=r.tfi($),q=p.getSize();return{x:d.x/q.width+X.x,y:d.y/q.height+X.y,e:c}}var y=fm(k,p),Y={x:($.x-y.x)/y.width,y:($.y-y.y)/y.height,e:c};return Y},Tj.prototype._handlePanning=function(b){var F=this,s=F._pan;if(s){s.started=!0;var J=F._interactor,Y=J.gv,r=J._lastClientPoint,H=Yi(b),j=sl(Y,H,r);Y.setTranslate(s.tx+j.x,s.ty+j.y),F.gatherSingleTarget(J.gv,F.target),J._42(),J.fi({kind:"betweenPan",event:b})}},Tj.prototype.handleEdit=function(V,y){var P=this,S=P.editing;if(P._pan)return P._handlePanning(y),void 0;if(P._multiSelect)return P._multiSelect.endPoint=V.lp(y),P._interactor.redraw(),void 0;if(S){S.inEdit=!0;var I,W,k,q=P._interactor._getLogicalPoint(y),b=x.Default.isCtrlDown(y),X=x.Default.isShiftDown(y),$=S.type,G=P.activing;if(P._guideInfo=null,"ctrlPoint"===$&&X){var J=P.editing.direction.clone();I=G.point;var H=J.dot(q.clone().sub(I));q=J.setLength(H).add(I)}else if("ctrlPoint"===$||"realPoint"===$){var J;if("realPoint"===$&&X){var v=P.editing.shiftGuide;W=v.point;var d=Math.abs(q.x-W.x),K=Math.abs(q.y-W.y);d>K&&d>v.limit&&"y"===v.dir&&(v.dir="x"),K>d&&K>v.limit&&"x"===v.dir&&(v.dir="y"),J=v.dir,"x"===J?(q.y=W.y,v.limit=Math.max(v.limit,d)):"y"===J&&(q.x=W.x,v.limit=Math.max(v.limit,K))}if(!b){var a,u=P._isEditEdgeSourceTarget();u&&(a=q.clone());var p=P._guidingToEdit(q,J),s="realPoint"===$?P._interactor.gridGuide.findClosest(q,J,!0):null,e=1/0,h=1/0;s&&(s.x&&(e=s.x),s.y&&(h=s.y));var r=!1;if(p&&(p.xList&&(Math.abs(p.x)<=Math.abs(e)?(r=!0,e=p.x):delete p.xList),p.yList&&(Math.abs(p.y)<=Math.abs(h)?(r=!0,h=p.y):delete p.yList),r&&(P._guideInfo=p)),isFinite(e)&&(q.x+=e),isFinite(h)&&(q.y+=h),r&&(p.v=q),u){var F=r?q.clone():null;q.copy(a);var f=P._editEdgeSourceTarget(u,q,b,F);f&&(P.edgeEditResult=f,k=f.tipText,f.isFixed&&(P._guideInfo=null))}}}var M=P.screenInfo.curve;if("realPoint"===S.type){I=S.point,I.e!==A&&(q.e=I.e),M.moveRealPoint(I,q),S.point=q,P.highlight.point=q;var Z=G.status,t=G.selections;if(P.activing={point:q,status:Z},t){var Y=q.clone().sub(I),L=0;t.forEach(function(l){var x=l.clone().add(Y);M.moveRealPoint(l,x),t[L++]=x}),P.activing.selections=t}}else if("ctrlPoint"===S.type){var o=G.pairs,n=o[S.pairId];M.moveCtrlPoint(n,q,S.ctrlType);var j=G.status,E=hf.Curve.PointType;if((j===E.Mirrored||j===E.Asymmetric)&&n.c1&&n.c2){var I=new hf.Math.Vector2(G.point),i="c1"===S.ctrlType?"c2":"c1";if(j===hf.Curve.PointType.Mirrored)M.moveCtrlPoint(n,I.clone().multiplyScalar(2).sub(q),i);else if(j===E.Asymmetric){var H=n[i].clone().sub(I).length(),U=I.clone().sub(n[S.ctrlType]).setLength(H).add(I);isNaN(U.x)||M.moveCtrlPoint(n,U,i)}}G._firePointChange()}else if("elevation"===S.type){W=S.startPoint;var C=W.e+(W.y-q.y)/V._zoom;P._setCurrentPointImpl("e",C),G._firePointChange(),k="E: "+hf.toFixed(C)}var D=x.Default.getLogicalPoint(y,P._interactor._canvas);if(D.x+=hf.Icons.TipShiftX,D.y+=hf.Icons.TipShiftY,!k){var R=hf.toWorldPosition(V,q);k=""+hf.toFixed(R.x)+", "+hf.toFixed(R.y)}P.tipInfo={helperPos:D,text:k,size:k.length},P._writeToHt(),P._interactor.fi({kind:"betweenEditPoint",event:y})}},Tj.prototype._setCurrentPointImpl=function(n,U){var H=this,s=H._activing;if(!s)return!1;var _=H.target;if(!_)return!1;var N=s.getCurrentEditingPoint();if(!N)return!1;var G=s.editingCtrl;if(!G)var j=N.clone();if("e"===n)N.e=U;else{var Z;if("x"===n||"y"===n){var Y=s._lastFirePoint;Z="x"===n?{x:U,y:Y?Y.y:0}:{x:Y?Y.x:0,y:U}}else"object"==typeof n?(Z=n,n.e!==A&&(N.e=n.e)):(Z={x:arguments[0],y:arguments[1]},arguments[2]!==A&&(N.e=arguments[2]));var r=hf.getDataMatrix(_);Z=hf.toScreenPosition(H._interactor.gv,r.apply(Z)),N.x=Z.x,N.y=Z.y}if(!G){var w=j.multiplyScalar(-1).add(N);xe(N.e)&&xe(j.e)&&(w.e=N.e-j.e);var f=H.screenInfo.curve;f.moveCtrlDueToRealPointMovement(N,w);var $=s.selections;if($){var z=0;$.forEach(function(I){var D=I.clone().add(w);isFinite(w.e)&&(D.e=(isFinite(I.e)?I.e:_.getElevation()||0)+w.e),f.moveRealPoint(I,D),$[z++]=D}),s.selections=$}}return!0},Tj.prototype.setCurrentPoint=function(J,x){return this._setCurrentPointImpl(J,x)?(this._writeToHt(),!0):!1},Tj.prototype._isEditEdgeSourceTarget=function(){var v=this,y=v.target;if(!(y instanceof x.Edge))return!1;var O=v.editing.point,e=v.screenInfo.curve._curves;return O===e[0]._p1?"source":O===e[e.length-1]._p4?"target":!1},Tj.prototype._editEdgeSourceTarget=function(H,m,l,k){var D,M=this,R=M.target;if(D="source"===H?R.getSource():R.getTarget()){var O,Y=M._interactor.gv,Z=hf.toWorldPosition(Y,m),o=M._calcHostAnchor(R,H,Z,D);if(O=o.index!==A||o.percent!==A?o.distance*Y.getZoom()>M._interactor.getStyle("edgeHostEdgeMaxDistance"):M._interactor.getStyle("edgeHostDetectPerFrame")?!0:o.x<0||o.x>1||o.y<0||o.y>1?!0:!1){var p=Y.getDataAt(Z,function(T){return Y.isSelectable(T)?Y.isSourceTargetEditable(R,T,H)?R.canSetSourceTarget(T,H)?!0:!1:!1:!1});if(p){var c=M._calcHostAnchor(R,H,Z,p);D=p,M._nextChangeEdgeHost={type:H,host:p},o=c}}var X,j,C,r=!1;if(l||o.x===A)(o.percent!==A||o.index!==A)&&(r=!0,j=o.point);else{var T=M._interactor.getStyle("anchorRound"),J=M._interactor.getStyle("anchorSensitivity");X=Y.calculateAttachPoint(D,Z),X?(o=X.info,r=!0):(k&&(o=M._calcHostAnchor(R,H,hf.toWorldPosition(Y,k),D)),o.x=hf.roundTo(o.x,T,J),o.y=hf.roundTo(o.y,T,J)),j=fp(Y,D,0,o.offsetX||0,o.offsetY||0,o.x,o.y)}j&&(C=hf.toScreenPosition(Y,j),m.x=C.x,m.y=C.y),M._edgeHostGuideInfo={corners:hf.getTargetCornersOnScreen(Y,D),attach:X?X.index:-1,host:D};var b;return o.percent!==A?b="percent: "+o.percent.toFixed(2):o.index!==A?b="index: "+o.index:(b=""+o.x.toFixed(2)+", "+o.y.toFixed(2),(o.offsetX||o.offsetY)&&(b+=" offset: "+o.offsetX.toFixed(2)+", "+o.offsetY.toFixed(2))),{host:D,anchor:o,tipText:b,isFixed:r}}},Tj.prototype._guidingToEdit=function(G,K){var T,q,e=this;if(T=e.screenInfo.curve){q=T._curves;var v,D,w,P,S,b,k,h,H=1/0,C=1/0,I=[];for(e.editing&&"realPoint"===e.editing.type&&(h=e.editing.point),S=0,b=2*q.length;b>S;S++)k=q[Math.floor(S/2)][S%2?"_p4":"_p1"],I.indexOf(k)>=0||(I.push(k),h&&h===k||(w=k.x-G.x,P=k.y-G.y,Math.abs(w)<Math.abs(H)?(H=w,v=[k]):w===H&&v.push(k),Math.abs(P)<Math.abs(C)?(C=P,D=[k]):P===C&&D.push(k)));var M=e._interactor.getStyle("smartGuideThreshold");if((Math.abs(H)>M||"y"===K)&&(v=null),(Math.abs(C)>M||"x"===K)&&(D=null),v||D){var p=!1,r={};if(v&&(p=!0,r.xList=v,r.x=H),D&&(p=!0,r.yList=D,r.y=C),p)return r}}},Tj.prototype._46O=function(R){var D=this;D.editing&&(D.editing=null,D._interactor.fi({kind:"endEditPoint",event:R})),D._guideInfo=null,D._edgeHostGuideInfo=null,D._pan&&(D._pan=null,D._interactor.fi({kind:"endPan",event:R})),D._multiSelect&&(D._handleMultiSelect(D._multiSelect,R),D._multiSelect=null),D.tipInfo=null,D.edgeEditResult=null},Tj.prototype._handleMultiSelect=function(n,W){if(n.startPoint&&n.endPoint){var $,Y,G,N,w,j,t=this,q=t._interactor,a=q.gv,e=hf.toScreenPosition(a,n.startPoint),O=hf.toScreenPosition(a,n.endPoint),i=x.Default.unionPoint(e,O),E=t.screenInfo.curve._curves,y=[],L=function(F){F.x>=i.x&&F.y>=i.y&&F.x<=i.x+i.width&&F.y<=i.y+i.height&&y.indexOf(F)<0&&y.push(F)};for($=0,Y=E.length;Y>$;$++)w=E[$],L(w._p1),L(w._p4);if(y.length){var u=t.activing||{},S=u.selections||[];u.point&&S.push(u.point);var T=x.Default.isShiftDown(W),J=W.altKey;if(J&&!T)for(j=y,y=[],$=0,Y=j.length;Y>$;$++)G=j[$],N=S.indexOf(G),N>=0&&y.push(G);for($=0,Y=S.length;Y>$;$++)G=S[$],N=y.indexOf(G),N>=0?(!T||T&&J)&&(y[N]=A):y.push(G);for(j=y,y=[],$=0,Y=j.length;Y>$;$++)j[$]&&y.push(j[$]);Y=y.length,0===Y?t.activing=null:1===Y?t.activing={point:y[0]}:(G=y[Y-1],t.activing={point:G,selections:y.splice(0,Y-1)}),q.redraw()}}},Tj.prototype._canDeletePoint=function(J,$){var Q=this.target;if(!(Q instanceof x.Edge))return!0;var B=J._curves[0],y=J._curves[J._curves.length-1];return B._p1===$||y._p4===$?!1:!0},Tj.prototype.handleDelete=function(){var P=this;if(P.activing&&P.screenInfo){var $=x.Default.isShiftDown(),J=P.screenInfo.curve;P._canDeletePoint(J,P.activing.point)&&J.deleteRealPoint(P.activing.point,$),P.activing.selections&&P.activing.selections.forEach(function(c){P._canDeletePoint(J,c)&&J.deleteRealPoint(c,$)}),P.activing=null,delete P.editing,delete P.tipInfo,delete P.edgeEditResult,delete P._pan,delete P._multiSelect,P._writeToHt(),P._interactor.fp("deleteShapePoint",!1,!0)}},Tj.prototype.handleDoubleClick=function(n){var I=this,F=I._interactor._getLogicalPoint(n);if(I.screenInfo&&I._checkEditRealPoint(F)){var A=I.getCurrentSelectintStatus(),t=hf.Curve.PointType;return A=A===t.Mirrored?t.Straight:t.Mirrored,I._setCurrentSelectionStatus(A),I._interactor._42(),!0}},Tj.prototype._drawHighlight=function(e){var Q=this,H=Q.highlight;if(H){var T=H.bezier,F=Q._interactor;T&&hf.Icons.DrawIcon(F,e,hf.Icons.ShapeHighlightCurve,[T._p1.x,T._p1.y,T._p2.x,T._p2.y,T._p3.x,T._p3.y,T._p4.x,T._p4.y]);var $=H.point;$&&"insertKnot"===H.type&&hf.Icons.DrawIcon(F,e,hf.Icons.ShapeHighlighPoint,$)}},Tj.prototype._drawGuide=function(R){var a=this,p=a._guideInfo;if(p){var G,T,h,Q,J=p.v;for(G=0;2>G;G++)if(Q=0===G?p.xList:p.yList)for(T=0,h=Q.length;h>T;T++)hf.Icons.DrawIcon(a._interactor,R,hf.Icons.ShapeGuideLine,[J.x,J.y,Q[T].x,Q[T].y])}},Tj.prototype._drawCurrentPoint=function(W){var h=this;if(h.activing){var O=h.activing,M=h.getCurrentSelectintStatus(),y=h._interactor;if(M!==hf.Curve.PointType.Straight){var U=O.pairs;O.hlpair,O.hltype;var N=O.selections,K=O.editingCtrl;if(U&&!N){var L,Q,C;for(Q=0,C=U.length;C>Q;Q++)L=U[Q],K&&Q===K.pairId&&L[K.type]?hf.Icons.DrawIcon(y,W,hf.Icons.ShapeActivingCtrl,{point:L.point,c1:L.c1,c2:L.c2,hl:K.type}):hf.Icons.DrawIcon(y,W,hf.Icons.ShapeActivingCtrl,L)}}hf.Icons.DrawIcon(y,W,hf.Icons.ShapeHighlighRealPoint,h.activing.point),N&&N.forEach(function(j){hf.Icons.DrawIcon(y,W,hf.Icons.ShapeHighlighRealPoint,j)})}},Tj.prototype.clear=function(){var Y=this;Y.editing=null,Y._guideInfo=null,Y.activing=null,Y.highlight=null},Tj.prototype._42=function(t){var A=this;A.info={},A.editing||(A.screenInfo=null);var F=A._interactor;if(!F.editDetail)return A.clear(),void 0;var N=F.gv;if(!A.target||!N.isSelected(A.target)||!N.isVisible(A.target))return F.editDetail=!1,A.clear(),void 0;if(A.gatherSingleTarget(N,A.target),hf.Icons.DrawIcon(F,t,hf.Icons.ShapeBgCurve,A.screenInfo),A._interactor.getStyle("curveElevationVisible")&&(A.target instanceof x.Polyline||A.target instanceof x.Edge&&A._interactor.getStyle("edgeElevationEditable"))&&A.activing){var p=A.activing.getCurrentEditingPoint();p&&"string"!=typeof p.e&&hf.Icons.DrawIcon(F,t,hf.Icons.EdgeElevationGuide,p)}if(A._drawHighlight(t),A._drawCurrentPoint(t),A._getRealPoint().forEach(function(P){hf.Icons.DrawIcon(F,t,hf.Icons.ShapePoint,P)}),A._drawGuide(t),A.tipInfo&&A._interactor.getStyle("curveTipVisible")&&hf.Icons.DrawIcon(F,t,hf.Icons.TipHelper,A.tipInfo),A._edgeHostGuideInfo&&F._drawHostGuide(A._edgeHostGuideInfo),A.edgeEditResult&&A._drawEdgeHostHighlight(t,A.edgeEditResult.host,A.edgeEditResult.anchor),A._multiSelect&&A._multiSelect.endPoint){var g=x.Default.unionPoint(hf.toScreenPosition(N,A._multiSelect.startPoint),hf.toScreenPosition(N,A._multiSelect.endPoint));g.color=N.getRectSelectBorderColor(),t.save(),t.setTransform(1,0,0,1,0,0);var V=M.devicePixelRatio,e=g.borderWidth=Math.round(V);e/=2,g.x=Math.round(g.x*V)+e,g.y=Math.round(g.y*V)+e,g.width=Math.round(g.width*V),g.height=Math.round(g.height*V),hf.Icons.DrawIcon(F,t,hf.Icons.SimpleRect,g),t.restore()}},Tj.prototype._drawEdgeHostHighlight=function(D,K,V){this.drawEdgeHostHighlight(D,K,V),this._interactor.redraw()
},Tj.prototype.drawEdgeHostHighlight=function(w,t,J){if(dq(t)){var s,j,m,y,K=this,d=K._interactor,Z=d.gv,q=Z.getDataUI(t),f=Lf(q),U=[];for(m=0,y=f.points.length;y>m;m++)j=hf.toScreenPosition(Z,f.points.get(m)),U.push(j.x,j.y);f.segments&&(s=f.segments.toArray());var V=d.getStyle("edgeHostHighlighPeriod"),G=d.getStyle("edgeHostEdgeHighlighColor");hf.Icons.DrawIcon(d,w,hf.Icons.ShapeBgCurve,{P:U,S:s,color:G,dynamicVisible:J.index===A,dynamicPeriod:V}),G=d.getStyle("edgeHostPointHighlighColor");var u=Hm(q);for(m=0,y=u.length;y>m;m++){var L=u[m],n=hf.toScreenPosition(Z,L);hf.Icons.DrawIcon(d,w,hf.Icons.ShapePoint,{point:{x:n.x,y:n.y},color:G,size:12,dynamicVisible:m===J.index,dynamicPeriod:V})}}},Tj.prototype._getRealPoint=function(){var Z,R=this.screenInfo,d=R.P,v=R.S,y=-1,c=[],D=-1,G=v.length;return v.each(function(x){D++;var t=1;if(3===x)t=2;else if(4===x)t=3;else if(5===x)return;y+=t,Z=D+1>=G?!0:1===v.get(D+1)?!0:!1,c.push({point:{x:d[2*y],y:d[2*y+1]},segmentIndex:D,pointIndex:y,isEnd:Z})}),c},Tj.prototype.getEditingPointsInfo=function(H){var I=this,Z=I.activing;if(!Z)return!1;var s=Z.point;if(!s)return!1;var Y=this._getRealPoint(),e=[{screen:s}];Z.selections&&Z.selections.forEach(function(H){e.push({screen:H})});var $,j,X=Y.length;return e.forEach(function(E){for($=0;X>$;$++)if(j=Y[$],E.screen.isNearEnough(j.point)){E.segmentIndex=j.segmentIndex,E.pointIndex=j.pointIndex,E.point=I.target.getPoints().get(j.pointIndex);break}}),H&&e.sort(function(L,g){return L.segmentIndex-g.segmentIndex}),e};var vs=hf.MoveHelper=function(b){var o=this;o.catalog="Move",o._interactor=b};vs.prototype={},vs.prototype.constructor=vs,vs.prototype.calcShift=function($,I,J){var L,_,z=this,d=z._interactor.gv,F=d.lp(I);if("beginMove"===$&&z._gatherGridInfo(J._lastLogicalPoint||F),L=z._target){var B=L.downPosition;if(B){var D=z._interactor.getStyle("moveSensitivity")/d._zoom;if(B.distanceTo(F)<D)return{x:0,y:0};delete L.downPosition}var M;_=x.Default.isShiftDown(I),_&&(F=z._dealShiftDown(F),M=L.shiftGuide.dir);var Q,E=L.rawPos={x:L.pos.x+F.x-L.lp.x,y:L.pos.y+F.y-L.lp.y};if(x.Default.isCtrlDown(I)){if(Q=z._calcShiftByAddon(),z._target.node instanceof hf.Group){var X=z._target.node;X._position.x+=Q.x,X._position.y+=Q.y}return Q}var C=z._interactor.rectGuide;if(L.node instanceof x.Data&&L.node.s("2d.attachable")){var r=z._calcAttachNodeShift(L.node,E);if(C.clear(),r)return r}for(var P,n=L.x+E.x,u=L.y+E.y,y={x:n,y:u},V={x:n+L.w/2,y:u+L.h/2},A={x:n+L.w,y:u+L.h},f=z._interactor.gridGuide,Y=[C.findClosest(y,M),C.findClosest(V,M),C.findClosest(A,M),f.findClosest(y,M),f.findClosest(V,M),f.findClosest(A,M)],R=1/0,j=1/0,t=0,s=Y.length;s>t;t++)P=Y[t],P&&(n=P.x,u=P.y,isFinite(n)&&Math.abs(n)<Math.abs(R)&&(R=n),isFinite(u)&&Math.abs(u)<Math.abs(j)&&(j=u));if(isFinite(R)||(R=0),isFinite(j)||(j=0),Q=z._calcShiftByAddon(R,j),z._target.node instanceof hf.Group){var X=z._target.node;X._position.x+=Q.x,X._position.y+=Q.y}var p=L.node;if(!Ac(p,d)){var N=E.x+R,S=E.y+j;z._interactor.rectGuide.gatherLines({node:p,x:L.x+N,y:L.y+S,w:L.w,h:L.h},M)}return Q}},vs.prototype._calcShiftByAddon=function(t,Y){var l=this._target,A=l.rawPos,R=l.node.getPosition();return t=t||0,Y=Y||0,{x:A.x-R.x+t,y:A.y-R.y+Y}},vs.prototype._dealShiftDown=function(R){var e=this,h=e._target.shiftGuide,v=e._target.lp,o=Math.abs(R.x-v.x),m=Math.abs(R.y-v.y);o>m&&o>h.limit&&"y"===h.dir&&(h.dir="x"),m>o&&m>h.limit&&"x"===h.dir&&(h.dir="y");var V=h.dir;return"x"===V?(R.y=v.y,h.limit=Math.max(h.limit,o)):"y"===V&&(R.x=v.x,h.limit=Math.max(h.limit,m)),R},vs.prototype._isAttachableLineShape=function(F){if(!F.getSegments)return!1;var H=F.getSegments();if(!H)return!0;H instanceof x.List&&(H=H.getArray());for(var M=1,l=H.length;l>M;M++)if(2!==H[M])return!1;return!0},vs.prototype._calcAttachNodeShift=function(){var w=new sd,D=new sd,n=new sd,l=new sd;return function(q,L){var y=this._interactor.gv,h=q.getHost(),T=y.getDataAt(L,function(L){return L.s("2d.hostable")?!0:!1});if(T&&h!==T&&q.setHost(T),!T)return this._edgeHostGuideInfo=null,q.setHost(null);var G=this._edgeHostGuideInfo={corners:hf.getTargetCornersOnScreen(y,T),host:T,attach:-1};if(this._isAttachableLineShape(T)){for(var u,i,X,o,f,S,z=T.getPoints(),Q=z.size(),K=T.getPointsMatrix2d(),V=1/0,x=0;Q>x&&(x!==Q-1||T.isClosePath());x++)0!==x?D.copy(n):K.apply(z.get(x),D),K.apply(x===Q-1?z.get(0):z.get(x+1),n),w.copy(L).sub(D),l.copy(n).sub(D),u=l.length(),l.divideScalar(u),i=w.dot(l),0>i?i=0:i>u&&(i=u),l.multiplyScalar(i).add(D),X=w.copy(L).sub(l).lengthSq(),V>X&&(V=X,S=x,o=i,f=u);return Math.sqrt(V)*y.getZoom()>this._interactor.getStyle("attachThreshold")?(q.s({"attach.index":-1}),q.setHost(null),void 0):(q.s("attach.offset.opposite")&&(o=f-o),q.s({"attach.index":S,"attach.offset":q.s("attach.offset.relative")?o/f:o}),{x:0,y:0})}var c=y.calculateAttachPoint(T,L);if(c){var a=c.point;return G.attach=c.index,this._calcShiftByAddon(a.x-L.x,a.y-L.y)}}}(),vs.prototype._gatherGridInfo=function(X){var p,z=this,v=z._interactor,b=v._getValidSelection();if(b.length){if(1===b.length){if(p=b[0],!p.getRect)return z._target=null,void 0}else if(p=hf.Group.findOrCreateGroup(b,v._uuid),!p)return z._target=null,void 0}else{var b=v.gv.sm().getSelection();if(b.length&&(p=b.get(0),!p.getRect))return z._target=null,void 0}if(p){var P=p.getPosition(),l=p.getRect();z._target={node:p,x:l.x-P.x,y:l.y-P.y,w:l.width,h:l.height,lp:{x:X.x,y:X.y},pos:{x:P.x,y:P.y},shiftGuide:{dir:"x",limit:0},downPosition:new hf.Math.Vector2(X)},v.rectGuide.gatherRects()}},vs.prototype.clear=function(){var l=this;l._edgeHostGuideInfo=null,l._interactor.rectGuide.clear(),l._interactor._42()},vs.prototype._42=function(){var z=this._edgeHostGuideInfo;z&&this._interactor._drawHostGuide(z)};var Xh=u.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047}),pc=function(){function g(N,O){var x=A;return function(){return x||(x=N.getExtension(O)),x}}function z(P,I){I==A&&(I={}),I.version=K&&(P instanceof WebGL2RenderingContext||u.prototype.toString.call(P)===t)?2:1,I.extensions=function(){for(var E={},v=P.getSupportedExtensions(),M=v.length;M--;)E[v[M]]=g(P,v[M]);return E}();for(var N=u.keys(Q),S=0,s=N.length;s>S;++S){var i=N[S];I[i]=P.getParameter(Q[i])}if(I.version>1){N=u.keys(T);for(var S=0,s=N.length;s>S;++S){var i=N[S];I[i]=P.getParameter(T[i])}}return I}var K="undefined"!=typeof WebGL2RenderingContext,t="[object WebGL2RenderingContext]",Q={aliasedLineWidthRange:Xh.ALIASED_LINE_WIDTH_RANGE,aliasedPointSizeRange:Xh.ALIASED_POINT_SIZE_RANGE,maxCombinedTextureImageUnits:Xh.MAX_COMBINED_TEXTURE_IMAGE_UNITS,maxCubeMapTextureSize:Xh.MAX_CUBE_MAP_TEXTURE_SIZE,maxFragmentUniformVectors:Xh.MAX_FRAGMENT_UNIFORM_VECTORS,maxRenderBufferSize:Xh.MAX_RENDERBUFFER_SIZE,maxTextureImageUnits:Xh.MAX_TEXTURE_IMAGE_UNITS,maxTextureSize:Xh.MAX_TEXTURE_SIZE,maxVaryingVectors:Xh.MAX_VARYING_VECTORS,maxVertexAttribs:Xh.MAX_VERTEX_ATTRIBS,maxVertexTextureImageUnits:Xh.MAX_VERTEX_TEXTURE_IMAGE_UNITS,maxVertexUniformVectors:Xh.MAX_VERTEX_UNIFORM_VECTORS,maxViewportDIMs:Xh.MAX_VIEWPORT_DIMS},T={max3DTextureSize:Xh.MAX_3D_TEXTURE_SIZE,maxArrayTextureLayers:Xh.MAX_ARRAY_TEXTURE_LAYERS,maxColorAttachments:Xh.MAX_COLOR_ATTACHMENTS,maxCombinedFragmentUniformComponents:Xh.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS,maxCombinedUniformBlocks:Xh.MAX_COMBINED_UNIFORM_BLOCKS,maxCombinedVertexUniformComponents:Xh.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS,maxDrawBuffers:Xh.MAX_DRAW_BUFFERS,maxElementIndex:Xh.MAX_ELEMENT_INDEX,maxElementsIndices:Xh.MAX_ELEMENTS_INDICES,maxElementsVertices:Xh.MAX_ELEMENTS_VERTICES,maxFragmentInpuComponents:Xh.MAX_FRAGMENT_INPUT_COMPONENTS,maxFragmentUniformBlocks:Xh.MAX_FRAGMENT_UNIFORM_BLOCKS,maxFragmentUniformComponents:Xh.MAX_FRAGMENT_UNIFORM_COMPONENTS,maxProgramTexelOffset:Xh.MAX_PROGRAM_TEXEL_OFFSET,maxSamples:Xh.MAX_SAMPLES,maxTextureLODBias:Xh.MAX_TEXTURE_LOD_BIAS,maxTransformFeedbackInterleavedComponents:Xh.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS,maxTransformFeedbackSeparateAttribs:Xh.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS,maxTransformFeedbackSeparateComponents:Xh.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS,maxUniformBlockSize:Xh.MAX_UNIFORM_BLOCK_SIZE,maxUniformBufferBindings:Xh.MAX_UNIFORM_BUFFER_BINDINGS,maxVaryingComponents:Xh.MAX_VARYING_COMPONENTS,maxVertexOutputComponents:Xh.MAX_VERTEX_OUTPUT_COMPONENTS,maxVertexUniformBlocks:Xh.MAX_VERTEX_UNIFORM_BLOCKS,maxVertexUniformComponents:Xh.MAX_VERTEX_UNIFORM_COMPONENTS,minProgramTexelOffset:Xh.MIN_PROGRAM_TEXEL_OFFSET};return{"for":function(n){var B=n._info;return B||(n._info=B=z(n,B)),B}}}(),Po=function(){function I(W,P,k){return{def:W,getter:k?function(q){var j=pc.for(q);return j.version>1?q.getParameter(P):W}:function(y){return y.getParameter(P)},setter:k?function(T,N){var s=pc.for(T);s.version>1&&T.pixelStorei(P,N)}:function(a,Y){a.pixelStorei(P,Y)}}}function n(t){return"string"==typeof t?qn(t):t.r!==A?(z[0]=t.r,z[1]=t.g,z[2]=t.b,z[3]=t.a,z):t.red!==A?(z[0]=t.red,z[1]=t.green,z[2]=t.blue,z[3]=t.alpha,z):t}function O(z){return S(z)?Array.prototype.slice.call(z,0):z}function L(G,l,i){this.gl=l,this._record=i||{},this._branches={},this._leafSync={},this._struct=G;for(var e=G.children,g=e.length;g--;){var t=e[g],C=t.name;t.isLeaf?(this._leafSync[C]=!1,this._record[C]=O(t.desc.def)):this._record[C]={}}}function e(k){function D(Y,d){L.call(this,k,Y,d);for(var h=B.length;h--;){var c=B[h];this._branches[c._name]=new c._type(Y,this._record[c._name])}}function y(F,W){function g(q,O){for(var f=J,g=!1;f--;)q[f]!==O[f]&&(q[f]=O[f],g=!0);return g}var y=F.name,X=S(F.desc.def),J=X&&F.desc.def.length;if(F.isLeaf){var N=F.desc.setter,I=F.desc.parse;u.defineProperty(W,y,{configurable:!1,enumerable:!0,get:function(){return this._record[y]},set:X?function(T){I&&(T=I(T)),(g(this._record[y],T)||!this._leafSync[y])&&(N(this.gl,this._record[y]),this._leafSync[y]=!0)}:function(R){this._record[y]===R&&this._leafSync[y]||(N(this.gl,R),this._record[y]=R,this._leafSync[y]=!0)}})}else B.push({_name:y,_type:e(F)}),u.defineProperty(W,y,{configurable:!1,enumerable:!0,get:function(){return this._branches[y]},set:function(T){this._branches[y].apply(T)}})}var B=[];return J(D,L),k.forEach(y,D.prototype),D}var z="undefined"!=typeof Float32Array&&new Float32Array(4),g={viewport:{def:[0,0,0/0,0/0],getter:function(w){return w.getParameter(w.VIEWPORT)},setter:function(h,q){var M=q[2]!==q[2]?h.drawingBufferWidth-q[0]:q[2],O=q[3]!==q[3]?h.drawingBufferHeight-q[1]:q[3];h.viewport(q[0],q[1],M,O)}},dither:{def:!1,getter:function(O){return O.isEnabled(O.DITHER)},setter:function(K,C){C?K.enable(K.DITHER):K.disable(K.DITHER)}},rasterizerDiscard:{def:!1,getter:function(l){var U=pc.for(l);return U.version>1&&l.isEnabled(l.RASTERIZER_DISCARD)},setter:function(S,Q){var M=pc.for(S);1!==M.version&&(Q?S.enable(S.RASTERIZER_DISCARD):S.disable(S.RASTERIZER_DISCARD))}},lineWidth:{def:1,getter:function(X){return X.lineWidth?X.getParameter(X.LINE_WIDTH):1},setter:function(x,W){x.lineWidth&&x.lineWidth(W)}},color:{clear:{def:[0,0,0,0],getter:function(r){return r.getParameter(r.COLOR_CLEAR_VALUE)},setter:function(f,p){f.clearColor(p[0],p[1],p[2],p[3])},parse:n},mask:{def:[!0,!0,!0,!0],getter:function(v){return v.getParameter(v.COLOR_WRITEMASK)},setter:function(d,$){d.colorMask($[0],$[1],$[2],$[3])}}},blend:{enabled:{def:!1,getter:function(W){return W.isEnabled(W.BLEND)},setter:function(s,$){$?s.enable(s.BLEND):s.disable(s.BLEND)}},color:{def:[0,0,0,0],getter:function(e){return e.getParameter(e.BLEND_COLOR)},setter:function($,S){$.blendColor(S[0],S[1],S[2],S[3])},parse:n},equation:{def:[Xh.FUNC_ADD,Xh.FUNC_ADD],getter:function(H){return[H.getParameter(H.BLEND_EQUATION_RGB),H.getParameter(H.BLEND_EQUATION_ALPHA)]},setter:function(S,F){S.blendEquationSeparate(F[0],F[1])},parse:function(p){var W=p.length;return W>1?p:1===W?(z[1]=z[0]=p[0],z):(z[1]=z[0]=p,z)}},func:{def:[Xh.ONE,Xh.ZERO,Xh.ONE,Xh.ZERO],getter:function(V){return[V.getParameter(V.BLEND_SRC_RGB),V.getParameter(V.BLEND_DST_RGB),V.getParameter(V.BLEND_SRC_ALPHA),V.getParameter(V.BLEND_DST_ALPHA)]},setter:function(p,f){p.blendFuncSeparate(f[0],f[1],f[2],f[3])},parse:function(W){var c=W.length;return c>3?W:(z[2]=z[0]=W[0],z[3]=z[1]=W[1],z)}}},cullFace:{enabled:{def:!1,getter:function(k){return k.isEnabled(k.CULL_FACE)},setter:function(d,F){F?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE)}},mode:{def:Xh.BACK,getter:function(y){return y.getParameter(y.CULL_FACE_MODE)},setter:function(l,w){l.cullFace(w)}},frontFace:{def:Xh.CCW,getter:function(j){return j.getParameter(j.FRONT_FACE)},setter:function(z,g){z.frontFace(g)}}},scissor:{enabled:{def:!1,getter:function(o){return o.isEnabled(o.SCISSOR_TEST)},setter:function(U,w){w?U.enable(U.SCISSOR_TEST):U.disable(U.SCISSOR_TEST)}},box:{def:[0,0,0/0,0/0],getter:function(N){return N.getParameter(N.SCISSOR_BOX)},setter:function(X,z){var y=z[2]!==z[2]?X.drawingBufferWidth-z[0]:z[2],u=z[3]!==z[3]?X.drawingBufferHeight-z[1]:z[3];X.scissor(z[0],z[1],y,u)}}},depth:{enabled:{def:!1,getter:function(y){return y.isEnabled(y.DEPTH_TEST)},setter:function(G,B){B?G.enable(G.DEPTH_TEST):G.disable(G.DEPTH_TEST)}},clear:{def:1,getter:function(G){return G.getParameter(G.DEPTH_CLEAR_VALUE)},setter:function(m,J){m.clearDepth(J)}},mask:{def:!0,getter:function(v){return v.getParameter(v.DEPTH_WRITEMASK)},setter:function(j,q){j.depthMask(q)}},range:{def:[-1,1],getter:function(D){return D.getParameter(D.DEPTH_RANGE)},setter:function(g,Y){g.depthRange(Y[0],Y[1])}},func:{def:Xh.LESS,getter:function(u){return u.getParameter(u.DEPTH_FUNC)},setter:function(s,Y){s.depthFunc(Y)}}},stencil:{enabled:{def:!1,getter:function(v){return v.isEnabled(v.STENCIL_TEST)},setter:function(K,W){W?K.enable(K.STENCIL_TEST):K.disable(K.STENCIL_TEST)}},clear:{def:0,getter:function(l){return l.getParameter(l.STENCIL_CLEAR_VALUE)},setter:function(p,Y){p.clearStencil(Y)}},frontMask:{def:255,getter:function(t){return t.getParameter(t.STENCIL_WRITEMASK)},setter:function(x,r){x.stencilMaskSeparate(x.FRONT,r)}},frontOp:{def:[Xh.KEEP,Xh.KEEP,Xh.KEEP],getter:function(H){return[H.getParameter(H.STENCIL_FAIL),H.getParameter(H.STENCIL_PASS_DEPTH_FAIL),H.getParameter(H.STENCIL_PASS_DEPTH_PASS)]},setter:function(S,x){S.stencilOpSeparate(S.FRONT,x[0],x[1],x[2])}},frontFunc:{def:[Xh.ALWAYS,0,255],getter:function(s){return[s.getParameter(s.STENCIL_FUNC),s.getParameter(s.STENCIL_REF),s.getParameter(s.STENCIL_VALUE_MASK)]},setter:function(D,o){D.stencilFuncSeparate(D.FRONT,o[0],o[1],o[2])}},backMask:{def:255,getter:function(u){return u.getParameter(u.STENCIL_BACK_WRITEMASK)},setter:function(Y,j){Y.stencilMaskSeparate(Y.BACK,j)}},backOp:{def:[Xh.KEEP,Xh.KEEP,Xh.KEEP],getter:function(L){return[L.getParameter(L.STENCIL_BACK_FAIL),L.getParameter(L.STENCIL_BACK_PASS_DEPTH_FAIL),L.getParameter(L.STENCIL_BACK_PASS_DEPTH_PASS)]},setter:function(A,C){A.stencilOpSeparate(A.BACK,C[0],C[1],C[2])}},backFunc:{def:[Xh.ALWAYS,0,255],getter:function(g){return[g.getParameter(g.STENCIL_BACK_FUNC),g.getParameter(g.STENCIL_BACK_REF),g.getParameter(g.STENCIL_BACK_VALUE_MASK)]},setter:function(R,a){R.stencilFuncSeparate(R.BACK,a[0],a[1],a[2])}}},hint:{generateMipmap:{def:Xh.DONT_CARE,getter:function(G){return G.getParameter(G.GENERATE_MIPMAP_HINT)},setter:function(y,V){y.hint(y.GENERATE_MIPMAP_HINT,V)}},fragmentShaderDerivative:{def:Xh.DONT_CARE,getter:function(d){var E=pc.for(d);return 1!==E.version||E.extensions.OES_standard_derivatives?d.getParameter(Xh.FRAGMENT_SHADER_DERIVATIVE_HINT):Xh.DONT_CARE},setter:function(j,v){var Z=pc.for(j);return Z.version>1||Z.extensions.OES_standard_derivatives?(j.hint(Xh.FRAGMENT_SHADER_DERIVATIVE_HINT,v),void 0):void 0}}},pixelStore:{packAlignment:I(4,Xh.PACK_ALIGNMENT,!1),unpackAlignment:I(4,Xh.UNPACK_ALIGNMENT,!1),unpackFlipY:I(!1,Xh.UNPACK_FLIP_Y_WEBGL,!1),unpackPremultiplyAlpha:I(!1,Xh.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),unpackColorspaceConversion:I(Xh.BROWSER_DEFAULT_WEBGL,Xh.UNPACK_COLORSPACE_CONVERSION_WEBGL,!1),packRowLength:I(0,Xh.PACK_ROW_LENGTH,!0),packSkipPixels:I(0,Xh.PACK_SKIP_PIXELS,!0),packSkipRows:I(0,Xh.PACK_SKIP_ROWS,!0),unpackRowLength:I(0,Xh.UNPACK_ROW_LENGTH,!0),unpackImageHeight:I(0,Xh.UNPACK_IMAGE_HEIGHT,!0),unpackSkipPixels:I(0,Xh.UNPACK_SKIP_PIXELS,!0),unpackSkipRows:I(0,Xh.UNPACK_SKIP_ROWS,!0),unpackSkipImages:I(0,Xh.UNPACK_SKIP_IMAGES,!0)},polygonOffset:{enabled:{def:!1,getter:function(X){return X.isEnabled(X.POLYGON_OFFSET_FILL)},setter:function(h,V){V?h.enable(h.POLYGON_OFFSET_FILL):h.disable(h.POLYGON_OFFSET_FILL)}},value:{def:[0,0],getter:function(n){return[n.getParameter(n.POLYGON_OFFSET_FACTOR),n.getParameter(n.POLYGON_OFFSET_UNITS)]},setter:function(E,S){E.polygonOffset(S[0],S[1])}}},sampleCoverage:{enabled:{def:!1,getter:function(q){return q.isEnabled(q.SAMPLE_COVERAGE)},setter:function(z,g){g?z.enable(z.SAMPLE_COVERAGE):z.disable(z.SAMPLE_COVERAGE)}},alpha:{def:!1,getter:function(Q){return Q.isEnabled(Q.SAMPLE_ALPHA_TO_COVERAGE)},setter:function(U,D){D?U.enable(U.SAMPLE_ALPHA_TO_COVERAGE):U.disable(U.SAMPLE_ALPHA_TO_COVERAGE)}},value:{def:[1,!1],getter:function(L){return[L.getParameter(L.SAMPLE_COVERAGE_VALUE),L.getParameter(L.SAMPLE_COVERAGE_INVERT)]},setter:function(L,K){L.sampleCoverage(K[0],K[1])}}}},o=He.create(g,function(j){return"def"in j});L.prototype.reset=function(){for(var T=this._struct.children,G=T.length;G--;){var x=T[G],w=x.name;x.isLeaf?this[w]=x.desc.def:this._branches[w].reset()}},L.prototype.save=function(r){r==A&&(r={});for(var K=this._struct.children,q=K.length;q--;){var M=K[q],G=M.name;if(M.isLeaf)r[G]=O(this._record[G]);else{var m=r[G];m==A&&(r[G]=m={}),this._branches[G].save(m)}}return r},L.prototype.sync=function(r,F){for(var Y=this._struct.children,n=Y.length;n--;){var X=Y[n],K=X.name;X.isLeaf?(F||!this._leafSync[K])&&(r?(this._record[K]=X.desc.getter(this.gl),this._leafSync[K]=!0):(X.desc.setter(this.gl,this._record[K]),this._leafSync[K]=!0)):this._branches[K].sync(r,F)}},L.prototype.syncLoss=function(){for(var e=this._struct.children,i=e.length;i--;){var q=e[i];q.isLeaf?this._leafSync[q.name]=!1:this._branches[q.name].syncLoss()}},L.prototype.apply=function(y){for(var D=this._struct.children,Q=D.length;Q--;){var x=D[Q],f=x.name;f in y&&(x.isLeaf?this[f]=y[f]:this._branches[f].apply(y[f]))}},L.prototype.append=function(e){var o=this._struct.childMap;for(var s in e){var G=o[s];G&&(G.isLeaf?this[s]=e[s]:this._branches[s].append(e[s]))}};var B=e(o);return function(H){var W=H._state;return W||(H._state=W=new B(H)),W}}(),Jb=function(){function k(T,Y,U,N){if(T){var S=T.length;if(S!=A)for(var s=0;N>s;++s)Y[U+s]=T[s];else T.toArray&&T.toArray(Y,U)}else for(var s=0;N>s;++s)Y[U+s]=0}function c(x,G,c){var Z=x[0];if(0>=Z||Z>0)return x;var q=G*c,K=j[q];if(K==A&&(j[q]=K=new Float32Array(q)),0!==G){k(Z,K,0,c);for(var U=1,p=0;U!==G;++U)p+=c,k(x[U],K,p,c)}return K}function W(G,q){G.uniform1f(this.addr,q)}function U(S,Q){S.uniform1fv(this.addr,Q)
}function P(R,V){if(V.x!=A)R.uniform2f(this.addr,V.x,V.y);else{var x=j[2];x.set(V,0),R.uniform2fv(this.addr,x)}}function _(P,b){P.uniform2fv(this.addr,c(b,this.size,2))}function w(m,J){if(J.x!=A)m.uniform3f(this.addr,J.x,J.y,J.z);else if(J.r!=A)m.uniform3f(this.addr,J.r,J.g,J.b);else if(J.red!=A)m.uniform3f(this.addr,J.red,J.green,J.blue);else{var l=j[3];l.set(J,0),m.uniform3fv(this.addr,l)}}function G(m,O){m.uniform3fv(this.addr,c(O,this.size,3))}function D(G,L){if("string"==typeof L&&(L=qn(L)),L.x!=A)G.uniform4f(this.addr,L.x,L.y,L.z,L.w);else if(L.r!=A)G.uniform4f(this.addr,L.r,L.g,L.b,L.a);else if(L.red!=A)G.uniform4f(this.addr,L.red,L.green,L.blue,L.alpha);else{var w=j[4];w.set(L,0),G.uniform4fv(this.addr,w)}}function Z(g,Y){g.uniform4fv(this.addr,c(Y,this.size,4))}function X(z,N){z.uniform1i(this.addr,N)}function M(b,i){b.uniform1iv(this.addr,i)}function x($,F){$.uniform2iv(this.addr,F)}function f(m,K){m.uniform3iv(this.addr,K)}function g(B,T){B.uniform4iv(this.addr,T)}function I($,R){$.uniform1i(this.addr,C[R?1:0])}function r(y,A){var T=j[4];T.set(A,0),y.uniformMatrix2fv(this.addr,!1,T)}function L(z,l){z.uniformMatrix2fv(this.addr,!1,c(l,this.size,4))}function F(I,y){var G=j[9];G.set(y,0),I.uniformMatrix3fv(this.addr,!1,G)}function t(E,R){E.uniformMatrix3fv(this.addr,!1,c(R,this.size,9))}function s(I,Y){var P=j[16];P.set(Y,0),I.uniformMatrix4fv(this.addr,!1,P)}function V(p,f){p.uniformMatrix4fv(this.addr,!1,c(f,this.size,16))}function Q(o,Q){o.uniform1i(this.addr,this.slots[0]),o.activeTexture(o.TEXTURE0+this.slots[0]),o.bindTexture(o.TEXTURE_2D,Q||o._emptyTexture)}function q(S,q){S.uniform1iv(this.addr,this.slots);for(var J=this.slots.length;J--;)S.activeTexture(S.TEXTURE0+this.slots[J]),S.bindTexture(S.TEXTURE_2D,q[J]||S._emptyTexture)}function T(G,w){G.uniform1i(this.addr,this.slots[0]),G.activeTexture(G.TEXTURE0+this.slots[0]),G.bindTexture(G.TEXTURE_CUBE_MAP,w||G._emptyCubeTexture)}function K(k,S){k.uniform1iv(this.addr,this.slots);for(var n=this.slots.length;n--;)k.activeTexture(k.TEXTURE0+this.slots[n]),k.bindTexture(k.TEXTURE_CUBE_MAP,S[n]||k._emptyCubeTexture)}function o(B,g,l){y[B]=[g,l]}function p(o,f,c){switch(o.type){case 35678:case 35680:if("uSampler"===c)return[0];if("uBlendSampler"===c)return[1];for(var d=o.size,l=new Int32Array(d),I=0;d>I;++I)l[I]=f.usedTextureSlot++;return l}return A}function m(j,Q,K,s,B){this.name=j,this.addr=Q,this.size=s?K.size:0,this.activeInfo=K,this.setter=y[K.type][s?1:0],this.slots=p(K,B,j),jd(this)}function $(r,q,o,D){var w=r.name,J=w.length;for(n.lastIndex=0;;){var K=n.exec(w),u=n.lastIndex,y=K[1],Z="]"===K[2],U=K[3];if(Z&&(y=0|y),U===A||"["===U&&u+2===J){o[y]=new m(y,q,r,U!==A,D);break}var v=o[y];v==A&&(o[y]=v={}),o=v}}function B(A,j,a){this.gl=j,this._program=a,this._leaves={},this._branches={},this._struct=A}function O(o){function y(k,x){B.call(this,o,k,x);for(var f=P.length;f--;){var Z=P[f];this._branches[Z._name]=new Z._type(k,x)}this.uuid=Mh.generateUUID()}function Q(E,h){var f=E.name;if(E.isLeaf){var e=l("d.setter(this.gl, v);",["v"],["d"],[E.desc]);u.defineProperty(h,f,{configurable:!1,enumerable:!0,get:function(){return e},set:e})}else P.push({_name:f,_type:O(E)}),u.defineProperty(h,f,{configurable:!1,enumerable:!0,get:function(){return this._branches[f]},set:function(d){this._branches[f].apply(d)}})}var P=[];return J(y,B),o.forEach(Q,y.prototype),y}function N(L,k){for(var P=L.getProgramParameter(k,L.ACTIVE_UNIFORMS),C={},B={usedTextureSlot:2};P--;){var K=L.getActiveUniform(k,P),f=K.name,v=L.getUniformLocation(k,f);$(K,v,C,B)}var M=He.create(C,function(G){return"addr"in G}),V=O(M);return u.defineProperty(V.prototype,"textureCount",{configurable:!1,enumerable:!1,writable:!1,value:B.usedTextureSlot}),new V(L,k)}var j=[];if("function"==typeof Float32Array)for(var d=1;17>d;++d)j[d]=new Float32Array(d);var C=[0,1],y=[];o(Xh.FLOAT,W,U),o(Xh.FLOAT_VEC2,P,_),o(Xh.FLOAT_VEC3,w,G),o(Xh.FLOAT_VEC4,D,Z),o(Xh.INT,X,M),o(Xh.INT_VEC2,x,x),o(Xh.INT_VEC3,f,f),o(Xh.INT_VEC4,g,g),o(Xh.BOOL,I,M),o(Xh.BOOL_VEC2,x,x),o(Xh.BOOL_VEC3,f,f),o(Xh.BOOL_VEC4,g,g),o(Xh.FLOAT_MAT2,r,L),o(Xh.FLOAT_MAT3,F,t),o(Xh.FLOAT_MAT4,s,V),o(Xh.SAMPLER_2D,Q,q),o(Xh.SAMPLER_CUBE,T,K);var n=/([\w\d_]+)(\])?(\[|\.)?/g;return B.prototype.apply=function(m){for(var n=this._struct.children,s=n.length;s--;){var v=n[s],U=v.name;U in m&&(v.isLeaf?this[U]=m[U]:this._branches[U].apply(m[U]))}},B.prototype.append=function(u){var N=this._struct.childMap;for(var K in u){var i=N[K];i&&(i.isLeaf?this[K]=u[K]:this._branches[K].append(u[K]))}},function(d,H){var i=H._uniforms;return i||(H._uniforms=i=N(d,H)),i}}(),tq=function(){function H(d,Y,h){Y.vertexAttrib1f(d.addr,h)}function y(P,e,K){if(K.x!=A)e.vertexAttrib2f(P.addr,K.x,K.y);else{var w=W[2];w.set(K,0),e.vertexAttrib2fv(P.addr,w)}}function t(g,y,M){if(M.x!=A)y.vertexAttrib3f(g.addr,M.x,M.y,M.z);else if(M.r!=A)y.vertexAttrib3f(g.addr,M.r,M.g,M.b);else if(M.red!=A)y.vertexAttrib3f(g.addr,M.red,M.green,M.blue);else{var r=W[3];r.set(M,0),y.vertexAttrib3fv(g.addr,r)}}function j(o,a,k){if("string"==typeof k&&(k=qn(k)),k.x!=A)a.vertexAttrib4f(o.addr,k.x,k.y,k.z,k.w);else if(k.r!=A)a.vertexAttrib4f(o.addr,k.r,k.g,k.b,k.a);else if(k.red!=A)a.vertexAttrib4f(o.addr,k.red,k.green,k.blue,k.alpha);else{var O=W[4];O.set(k,0),a.vertexAttrib4fv(o.addr,O)}}function K(K,c,s){s=s.el||s;for(var R=0,X=0;2>R;++R)c.vertexAttrib2f(K.addr,s[X++],s[X++])}function D(h,e,u){u=u.el||u;for(var p=0,A=0;3>p;++p)e.vertexAttrib3f(h.addr,u[A++],u[A++],u[A++])}function B(r,C,z){z=z.el||z;for(var P=0,J=0;4>P;++P)C.vertexAttrib4f(r.addr,z[J++],z[J++],z[J++],z[J++])}function F(L,x,l,k){for(var i,X=l?1:0,A=x.addr,Y=L._divisorState,W=0;k>W;W++)i=Y[A+W]||0,i!==X&&(Y[A+W]=X,L.vertexAttribDivisor(A+W,X))}function r(K,P,J,z,m,f,h){P.bindBuffer(P.ARRAY_BUFFER,J);var U=K.addr;P.enableVertexAttribArray(U),F(P,K,J.instanced,1),P.vertexAttribPointer(U,1,z||P.FLOAT,!!m,f||0,h||0),P.bindBuffer(P.ARRAY_BUFFER,null)}function d(b,d,J,g,A,q,l){d.bindBuffer(d.ARRAY_BUFFER,J);var Y=b.addr;d.enableVertexAttribArray(Y),F(d,b,J.instanced,1),d.vertexAttribPointer(Y,2,g||d.FLOAT,!!A,q||0,l||0),d.bindBuffer(d.ARRAY_BUFFER,null)}function Y(u,q,a,$,g,x,s){q.bindBuffer(q.ARRAY_BUFFER,a);var A=u.addr;q.enableVertexAttribArray(A),F(q,u,a.instanced,1),q.vertexAttribPointer(A,3,$||q.FLOAT,!!g,x||0,s||0),q.bindBuffer(q.ARRAY_BUFFER,null)}function L($,W,w,R,d,I,q){W.bindBuffer(W.ARRAY_BUFFER,w);var n=$.addr;W.enableVertexAttribArray(n),F(W,$,w.instanced,1),W.vertexAttribPointer(n,4,R||W.FLOAT,!!d,I||0,q||0),W.bindBuffer(W.ARRAY_BUFFER,null)}function g(P,Y,e,_,h,O,D){var O=O||16,D=D||0,v=P.addr;Y.bindBuffer(Y.ARRAY_BUFFER,e),Y.enableVertexAttribArray(v),Y.vertexAttribPointer(v,2,_||Y.FLOAT,!!h,O,D),Y.enableVertexAttribArray(v+1),Y.vertexAttribPointer(v+1,2,_||Y.FLOAT,!!h,O,D+8),F(Y,P,e.instanced,2),Y.bindBuffer(Y.ARRAY_BUFFER,null)}function M(H,k,X,E,U,g,v){var g=g||36,v=v||0,A=H.addr;k.bindBuffer(k.ARRAY_BUFFER,X);for(var j=0;3>j;j++)k.enableVertexAttribArray(A+j),k.vertexAttribPointer(A+j,3,E||k.FLOAT,!!U,g,v+12*j);F(k,H,X.instanced,3),k.bindBuffer(k.ARRAY_BUFFER,null)}function R(x,Z,L,G,E,M,d){var M=M||64,d=d||0,I=x.addr;Z.bindBuffer(Z.ARRAY_BUFFER,L);for(var j=0;4>j;j++)Z.enableVertexAttribArray(I+j),Z.vertexAttribPointer(I+j,4,G||Z.FLOAT,!!E,M,d+16*j);F(Z,x,L.instanced,4),Z.bindBuffer(Z.ARRAY_BUFFER,null)}function b(N,z,C,L){q[N]=function(g,u,m,Y,T,x){this.addr==A||this.addr<0||(u==A||u===!1?L(g,this.addr):uo(u)===E?C(this,g,u,m,Y,T,x):(L(g,this.addr),z(this,g,u)))}}function Z(X,Y){X.disableVertexAttribArray(Y)}function Q(V,M){V.disableVertexAttribArray(M),V.disableVertexAttribArray(M+1)}function p(i,R){i.disableVertexAttribArray(R),i.disableVertexAttribArray(R+1),i.disableVertexAttribArray(R+2)}function s(f,Q){f.disableVertexAttribArray(Q),f.disableVertexAttribArray(Q+1),f.disableVertexAttribArray(Q+2),f.disableVertexAttribArray(Q+3)}function o(J,L,i){this.name=J,this.addr=L,this.activeInfo=i,this.setter=q[i.type],jd(this)}function c(U,o,l){this.gl=o,this.program=l,this._branches={},this._struct=U}function e(C){function G(B,M){c.call(this,C,B,M);for(var u=t.length;u--;){var V=t[u];this._branches[V._name]=new V._type(B,M)}}function r(E,j){var c=E.name;if(E.isLeaf){var G=l("d.setter(this.gl, v);",["v"],["d"],[E.desc]);u.defineProperty(j,c,{configurable:!1,enumerable:!0,get:function(){return G},set:G})}else t.push({_name:c,_type:e(E)}),u.defineProperty(j,c,{configurable:!1,enumerable:!0,get:function(){return this._branches[c]},set:function(O){this._branches[c].apply(O)}})}var t=[];return J(G,c),C.forEach(r,G.prototype),G}function T(f,R){for(var z=f.getProgramParameter(R,f.ACTIVE_ATTRIBUTES),H={};z--;){var K=f.getActiveAttrib(R,z),O=K.name,T=f.getAttribLocation(R,O);H[O]=new o(O,T,K)}var g=He.create(H,function(L){return"addr"in L}),N=e(g);return new N(f,R)}for(var W=[],X=1;17>X;++X)W[X]=new yk(X);var q=[],E="undefined"!=typeof WebGLBuffer&&WebGLBuffer.prototype;return b(Xh.FLOAT,H,r,Z),b(Xh.FLOAT_VEC2,y,d,Z),b(Xh.FLOAT_VEC3,t,Y,Z),b(Xh.FLOAT_VEC4,j,L,Z),b(Xh.FLOAT_MAT2,K,g,Q),b(Xh.FLOAT_MAT3,D,M,p),b(Xh.FLOAT_MAT4,B,R,s),c.prototype.disable=function(){for(var h=this._struct.children,V=h.length;V--;){var d=h[V],Y=d.name;d.isLeaf?this[Y]=A:this._branches[Y].disable()}},c.prototype.apply=function(F){for(var Z=this._struct.children,$=Z.length;$--;){var w=Z[$],N=w.name;N in F&&(w.isLeaf?this[N]=F[N]:this._branches[N].apply(F[N]))}},c.prototype.append=function(p){var t=this._struct.childMap;for(var c in p){var k=t[c];k&&(k.isLeaf?this[c]=p[c]:this._branches[c].append(p[c]))}},function(e,s){var r=s._attribs;return r||(s._attribs=r=T(e,s)),r}}(),Jq=function(n){var W=this;u.defineProperties(this,{gl:{configurable:!1,enumerable:!1,value:n,writable:!1},glState:{configurable:!1,enumerable:!1,value:Po(n),writable:!1}}),W._currProgram=A,W._currUniforms=A,W._currAttribs=A,W._sync=!0};u.defineProperties(Jq.prototype,{program:{configurable:!1,enumerable:!1,get:function(){return this._currProgram},set:function(J){var X=this;X._sync&&J===X._currProgram||(X.gl.useProgram(J),X._currProgram=J,X._currUniforms=Jb(X.gl,J),X._currAttribs=tq(X.gl,J),X._sync=!0)}},uniforms:{configurable:!1,enumerable:!1,get:function(){var g=this;return g._currProgram&&!g._sync&&(g.gl.useProgram(g._currProgram),g._sync=!0),g._currUniforms},set:function(x){var O=this;O._currUniforms&&(O._currProgram&&!O._sync&&(O.gl.useProgram(O._currProgram),this._sync=!0),O._currUniforms.apply(x))}},attribs:{configurable:!1,enumerable:!1,get:function(){var X=this;return X._currProgram&&!X._sync&&(X.gl.useProgram(X._currProgram),X._sync=!0),X._currAttribs},set:function(H){var i=this;i._currUniforms&&(i._currProgram&&!i._sync&&(i.gl.useProgram(i._currProgram),this._sync=!0),i._currAttribs.apply(H))}}}),Jq.prototype.useProgram=function(m){var q=this;q._sync&&m===q._currProgram||(q.gl.useProgram(m),q._currProgram=m,q._currUniforms=Jb(q.gl,m),q._currAttribs=tq(q.gl,m),q._sync=!0)},Jq.prototype.directState=function(){return this.glState},Jq.prototype.directUniforms=function(){return this._currUniforms},Jq.prototype.directAttribs=function(){return this._currAttribs},Jq.prototype.syncLoss=function(){this._sync=!1,this.glState.syncLoss()},Jq.for=function(b){var S=b._renderState;return S||(b._renderState=S=new Jq(b)),S};var hg="directional",fe="point",Nc="spot",pp="light.color",Xe=4294967295,dn=0,Xk={},Nm=[],pd=0,dl=function(q,i){ro(i)&&dk.test(i)?no(q,i):fg(i)&&i.modelType?Yd(q,i):i===A?delete rf[q]:rf[q]=i},gk=function(K){return K},Pd=function(F){F=M.convertShape3dModelName(F);var u;if(fg(F)){if(F.modelType){if(F.uuid){if(u=rf[F.uuid])return u}else F.uuid=x.Math.generateUUID();return u===A&&(Rl&&Rl[F.uuid]||Yd(F.uuid,F)),A}return F}return u=rf[F],F&&u===A&&dk.test(F)&&(Rl&&Rl[F]||no(F,F)),u},Tf=function(u,m){u.frameStack?u.frameStack.push(m):u.frameStack=[m],u.bindFramebuffer(u.FRAMEBUFFER,m)},jr=function(M){var t=M.frameStack;if(t){if(t.pop(),t.length)return M.bindFramebuffer(M.FRAMEBUFFER,t[t.length-1]),void 0;M.frameStack=null}M.bindFramebuffer(M.FRAMEBUFFER,null)};zb(M,{graph3dViewAttributes:q,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:Y/60,graph3dViewSortable:!1,graph3dViewBlockSelectable:!0,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:Aq,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewRotateMaxPhi:Y,graph3dViewRotateMinPhi:0,graph3dViewShadowDisabled:!0,graph3dViewShadowQuality:"high",graph3dViewShadowIntensity:.3,graph3dViewShadowBias:-.005,graph3dViewShadowRadius:.1,graph3dViewShadowType:"hard",graph3dViewShadowDegreeX:30,graph3dViewShadowDegreeZ:-10,graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewSyncEyeWithOrthoWidth:!1,graph3dViewFovy:Y/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewDataNumWarningLine:1e4,graph3dViewHeadlightDirection:"camera",graph3dViewHeadlightRange:0,graph3dViewHeadlightGroup:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewHeadlightAmbientIntensity:.7,graph3dViewFogDisabled:!0,graph3dViewFogMode:"linear",graph3dViewFogDensity:5e-4,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewPickerResolution:.5,graph3dViewDashDisabled:!0,graph3dViewUvClipEnabled:!1,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,graph3dViewBatchInstancedDisabled:!0,graph3dViewFlowBlendMode:"addRGB",graph3dViewEnvmapType:"legacy",graph3dMaxVectorCacheTime:50,graph3dEnvmapCapabilityRequire:8,setShape3dModel:dl,getShape3dModel:Pd,convertShape3dModelName:gk,getShape3dModelMap:function(){return rf},getCachedShape3dModelMap:function(){return em},createMatrix:function(S,w){bj(S)||(S=[S]);for(var K=S.length-1;K>=0;K--){var i=S[K];w=vl(i.mat,i.s3,i.r3,i.rotationMode,i.t3,w)}return w},transformVec:function(X,x){return Vk(X,x)},glBindFrame:Tf,glUnbindFrame:jr,createBoxModel:function(){return{vs:qf,ns:er,uv:Ql,is:he}},createRoundRectModel:function(b,y){return Mn.roundRect(b,y)},createStarModel:function(j,H){return Mn.star(j,H)},createRectModel:function(l,k){return Mn.rect(l,k)},createTriangleModel:function(c,R){return Mn.triangle(c,R)},createRightTriangleModel:function(s,J){return Mn.rightTriangle(s,J)},createParallelogramModel:function(e,p){return Mn.parallelogram(e,p)},createTrapezoidModel:function(O,D){return Mn.trapezoid(O,D)},createSmoothSphereModel:function(D,r,y,Y,o,P,W){return bs(new lk(D,r,y,Y,o,P,W))},createSphereModel:function(h,v,q,n,Z,N,K){return h?Sc(h,v,q,n,Z,N,K):M.createSmoothSphereModel()},createSmoothConeModel:function(k,w,H,B,i){return Fr(k,w,H,B,i)},createConeModel:function(V,U,S,t,u,x,b,I){return V?$c(V,U,S,t,u,x,b,I):Fr(x)},createSmoothCylinderModel:function(e,N,q,V,l,L,W,r){return bs(new Kd(e,N,q,V,l,L,W,r))},createCylinderModel:function($,v,y,e,K,j,_,w){return $?Jj($,v,y,e,K,j,_,w):ui(j,_)},createSmoothTorusModel:function(a,Q,l,X,f,T){return bs(new db(a,Q,l,X,f,T))},createTorusModel:function(F,G,i,O,l,r,g,n){return F?je(F,G,i,O,l,r,g,n):Bn(r,g)},createExtrusionModel:function(x,G,c,k,p,X,j,C){return uh(x,G,c,k,p,X,j,C)},createSmoothRingModel:function(X,G,y,Y,s,o){for(var k=[],W=0;W<X.length-1;W+=2)k.push({x:X[W],y:X[W+1]});for(X=gi(k,G,y)[0],k=[],W=0;W<X.length;W++){var I=X[W];k.push(new Ko(I.x,0,I.y))}return bs(new bf(k,o,Y,s))},createTextGeometry:function(H,w){var x=bs(new sb(H,w));if(w.cube)for(var h=kb(x),L=h.min,d=h.max,k=L.x,f=L.y,z=L.z,S=d.x-k||1,e=d.y-f||1,u=d.z-z||1,g=["vs","top_vs","bottom_vs"],C=0,K=g.length;K>C;C++){var M=x[g[C]];if(M)for(var c=0,$=M.length;$>c;c+=3)M[c]=(M[c]-k)/S-.5,M[c+1]=(M[c+1]-f)/e-.5,M[c+2]=(M[c+2]-z)/u-.5}return x},loadFontFace:function(R,E){M.xhrLoad(R,function(K){if(!K)return E();var y;try{y=JSON.parse(K)}catch(v){y=JSON.parse(K.substring(65,K.length-2))}tj.loadFace(y),E&&E(y.familyName.toLowerCase())},E?null:{sync:!0})},getShaderErrorLog:function(){return Nm.join("\n")},createRingModel:function(y,i,G,k,W,m,Z,_,b,Q){for(var C=[],d=0;d<y.length-1;d+=2)C.push({x:y[d],y:y[d+1]});m=m||M.shapeSide,Z=Z||0,_=_||m;var w,L,P,e,H,h,X,R,c,p,d,A,u,j,g,v,x,J,Y=[],N=[],s=b?[]:q,U=b?[]:q,B=Q?[]:q,E=Q?[]:q,t=k?[]:q,S=k?[]:q,l=W?[]:q,T=W?[]:q,y=gi(C,i,G),n=oi(y),f=0,I=2*Math.PI/m;return y.forEach(function($){if(P=$.length,P>1){if(e=$[0],k)for(h=e.x,R=e.y,d=Z;_>d;d++)A=d+1,u=d*I,j=A*I,g=O(u),v=o(u),x=O(j),J=o(j),t.push(g*h,R,-v*h,x*h,R,-J*h,0,R,0),S.push(.5-.5*g,.5-.5*v,.5-.5*x,.5-.5*J,.5,.5);for(p=0;P>p;p++){for(H=$[p],h=e.x,X=H.x,R=e.y,c=H.y,w=f/n,f+=Hh(e,H),L=f/n,d=Z;_>d;d++)A=d+1,u=d*I,j=A*I,g=O(u),v=o(u),x=O(j),J=o(j),Y.push(g*X,c,-v*X,x*X,c,-J*X,g*h,R,-v*h,x*X,c,-J*X,x*h,R,-J*h,g*h,R,-v*h),N.push(d/m,L,A/m,L,d/m,w,A/m,L,A/m,w,d/m,w),b&&d===Z&&(s.push(0,R,0,0,c,0,g*X,c,-v*X,g*X,c,-v*X,g*h,R,-v*h,0,R,0),U.push(0,.5-R,0,.5-c,2*X,.5-c,2*X,.5-c,2*h,.5-R,0,.5-R)),Q&&A===_&&(B.push(0,R,0,x*X,c,-J*X,0,c,0,x*X,c,-J*X,0,R,0,x*h,R,-J*h),E.push(1,.5-R,1-2*X,.5-c,1,.5-c,1-2*X,.5-c,1,.5-R,1-2*h,.5-R));e=H}if(W)for(h=e.x,R=e.y,d=Z;_>d;d++)A=d+1,u=d*I,j=A*I,g=O(u),v=o(u),x=O(j),J=o(j),l.push(x*h,R,-J*h,g*h,R,-v*h,0,R,0),T.push(.5-.5*x,.5+.5*J,.5-.5*g,.5+.5*v,.5,.5)}}),{vs:Y,uv:N,bottom_vs:l,bottom_uv:T,top_vs:t,top_uv:S,from_vs:s,from_uv:U,to_vs:B,to_uv:E}}},!0),zb(T,{"3d.move.mode":A,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"3d.clip.direction":null,"3d.clip.percentage":1,"3d.reflectable":!0,"shape.border.gradient.color":A,"edge.gradient.color":A,"edge.source.t3":A,"edge.target.t3":A,"light.type":fe,"light.group":0,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":Y/4,"light.range":0,"light.exponent":1,"light.intensity":1,"light.mask":Xe,"headlight.ambientIntensity":A,"wf.visible":!1,"wf.width":1,"wf.fog":!0,"wf.color":Bc,"wf.short":!1,"wf.mat":A,"wf.boundingBox":!1,"wf.geometry":!1,"wf.loadQuadWireframe":!1,"wf.combineTriangle":!0,batch:A,"transparent.mask":!1,brightness:A,"select.brightness":.7,"repeat.uv.length":A,"shadow.cast":!0,"shadow.receive":!0,"3d.clipbox":A,"3d.clipbox.mask":Xe,"3d.clipbox.group":0,"3d.clipbox.shape":"cube","effect.flow":!1,"effect.flow.gradient":"spread.horizontal","effect.flow.uvshape":"rect","effect.flow.size":512,"effect.flow.group":0,"effect.flow.intensity":1,"effect.flow.blend":A,"effect.flow.mask":Xe,bloom:!1,envmap:0,"envmap.probe":0,roughness:0,renderTextureSamples:4,alphaTest:.4,autorotate:!1,fixSizeOnScreen:!1,"texture.cache":!1,"hide.overlapping.group":A,"vector.dynamic":!1,"vector.dynamic.maxsize":2048,"texture.scale":1,"geometry.cache":!1,"highlight.mode":!1,"highlight.type":"hard","highlight.visible":!0,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","highlight.glow":.8,"highlight.strength":2,"color.empty":[0,0,0,0],"label.face":Ao,"label.t3":A,"label.r3":A,"label.texture.scale":2,"label.rotationMode":ks,"label.light":!1,"label.blend":A,"label.reverse.flip":!1,"label.reverse.color":cm,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":Ao,"label2.t3":A,"label2.r3":A,"label2.texture.scale":2,"label2.rotationMode":ks,"label2.light":!1,"label2.blend":A,"label2.reverse.flip":!1,"label2.reverse.color":cm,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":Ao,"note.t3":A,"note.r3":A,"note.texture.scale":2,"note.rotationMode":ks,"note.light":!1,"note.blend":A,"note.reverse.flip":!1,"note.reverse.color":cm,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":Ao,"note2.t3":A,"note2.r3":A,"note2.texture.scale":2,"note2.rotationMode":ks,"note2.light":!1,"note2.blend":A,"note2.reverse.flip":!1,"note2.reverse.color":cm,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,"part.boundingBox":!1,shape3d:A,"shape3d.color":pb,"shape3d.top.color":A,"shape3d.bottom.color":A,"shape3d.from.color":A,"shape3d.to.color":A,"shape3d.image":A,"shape3d.image.projection":A,"shape3d.top.image":A,"shape3d.bottom.image":A,"shape3d.from.image":A,"shape3d.to.image":A,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":A,"shape3d.side.to":A,"shape3d.smooth":A,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":A,"shape3d.opacity":A,"shape3d.reverse.flip":!1,"shape3d.reverse.color":cm,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":A,"shape3d.uv.scale":A,"shape3d.uv.rotation":A,"shape3d.uv.anchor":A,"shape3d.uv.union":A,"shape3d.top.uv.offset":A,"shape3d.top.uv.scale":A,"shape3d.top.uv.rotation":A,"shape3d.top.uv.anchor":A,"shape3d.bottom.uv.offset":A,"shape3d.bottom.uv.scale":A,"shape3d.bottom.uv.rotation":A,"shape3d.bottom.uv.anchor":A,"shape3d.from.uv.offset":A,"shape3d.from.uv.scale":A,"shape3d.from.uv.rotation":A,"shape3d.from.uv.anchor":A,"shape3d.to.uv.offset":A,"shape3d.to.uv.scale":A,"shape3d.to.uv.rotation":A,"shape3d.to.uv.anchor":A,"shape3d.top.cap":A,"shape3d.bottom.cap":A,"shape3d.start.angle":0,"shape3d.sweep.angle":c,"shape3d.point.epsilon":1e-6,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.reflector":!1,"shape3d.reflector.color":"rgb(128,128,128)","shape3d.reflector.blur":0,"shape3d.reflector.blur.iterations":1,"shape3d.reflector.background":null,"shape3d.reflector.clip":.003,"shape3d.reflector.shadow":"scene","camera.type":"perspective","camera.aspect":1,"camera.fovy":A,"camera.ortho.width":A,"camera.near":A,"camera.far":A,"camera.background":0,"camera.renderSky":!0,"camera.renderAxis":!1,"camera.renderGrid":!1,"camera.renderEdit":!1,"camera.onlySky":!1,"texture.mipmap.max":A,"texture.filter":A,"texture.filter.min":A,"texture.filter.mag":A,"texture.wrap":A,"points.image":"rect","points.color":"white","points.transparent":!1,"points.size":20,"points.opacity":1,"points.uv.scale":[1,1],"points.uv.offset":[0,0],"points.discard.selectable":!1,"all.light":!0,"all.visible":!0,"all.color":pb,"all.image":A,"all.blend":A,"all.opacity":A,"all.reverse.flip":!1,"all.reverse.color":cm,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":A,"all.uv.offset":A,"all.uv.scale":A,"all.uv.rotation":A,"all.uv.anchor":A,"all.uv.union":A,"all.discard.selectable":!0,mat:A,"left.mat":A,"right.mat":A,"top.mat":A,"bottom.mat":A,"front.mat":A,"back.mat":A,"edge.source.anchor.elevation":A,"edge.target.anchor.elevation":A,"edge.source.offset.elevation":0,"edge.target.offset.elevation":0},!0);var Jm,Ml=!1,Tk=[0,0,0,0],Qp=function(m){return m instanceof Es},Ve=function(G){return[G.x,G.e||0,G.y]},qk=function(w,B,t){for(var B=qn(B||0),L=B[0],u=B[1],K=B[2];t--;)w.push(L,u,K)},Ae=function(l,e,H){for(var e=qn(e||0),p=e[0],z=e[1],m=e[2],d=e[3];H--;)l.push(p,z,m,d)},Hc=function(K,j,J){if(j)for(var g,T,d,f=j[0],k=j[1],M=j[2],Q=j[4],t=j[5],s=j[6],u=j[8],l=j[9],a=j[10],G=j[12],V=j[13],I=j[14],p=J.length,R=0,R=0;p>R;R+=3)g=J[R],T=J[R+1],d=J[R+2],K.push(f*g+Q*T+u*d+G,k*g+t*T+l*d+V,M*g+s*T+a*d+I);else Te(K,J);return K},Pe=function(d,h,o){var H=h.s("light.intensity"),k=qn(h.s(pp)),r=k[0],B=k[1],e=k[2];1!==H&&(r*=H,B*=H,e*=H);var f=h.s("light.disabled");d.push(r,B,e,f?1:0),o.c.push(r,B,e),o.g.push(f?-1:h.s("light.group")),o.e.push(f?1:0)},ti=function(p,b){var d,T=Jq.for(b),V=T.directUniforms(),E=p._lastLightUploadInfo={c:[],g:[],e:[]},X=p._headlightDirection;X&&3===X.length?d=X:"shadow"===X&&(d=p.shadowMap.getDirection()),d=d?ah.normalizeArray(p._transformDirectionToViewSpace(null,d)):[0,0,0],V.uHeadlightDirection=d,V.uHeadlightRange=p._headlightRange;var y=V.uHeadlightAmbientIntensity=p._headlightAmbientIntensity,W=p._headlightIntensity,A=qn(p._headlightColor);1!==W&&(A=[A[0]*W,A[1]*W,A[2]*W]);var R;V.uHeadlightColor=[A[0],A[1],A[2],(R=p._headlightDisabled)?1:0],E.c.push(A[0],A[1],A[2]),E.g.push(R?-1:p._headlightGroup),E.e.push(R?1:0);var U=p._59O,z=p._spots,L=p._dirs;if(U.length){var i=[],Q=[],Z=[];U.forEach(function(x){Pe(i,x,E),Te(Q,p._transformPointToViewSpace(x.p3())),Z.push(x.s("light.range"))}),V.uPointColor=i,V.uPointRange=Z,V.uPointPosition=Q}if(z.length){var k=[],g=[],H=[],x=[],P=[],q=[];z.forEach(function(D){Pe(k,D,E),Te(g,p._transformPointToViewSpace(D.p3())),Te(P,p._transformDirectionToViewSpace(D.p3(),D.s("light.center"))),H.push(D.s("light.range")),x.push(O(D.s("light.angle")/2)),q.push(D.s("light.exponent"))}),V.uSpotColor=k,V.uSpotRange=H,V.uSpotAngle=x,V.uSpotExponent=q,V.uSpotPosition=g,V.uSpotDirection=P}if(L.length){var J=[],$=[];L.forEach(function(U){Pe(J,U,E),Te($,p._transformDirectionToViewSpace(U.p3()))}),V.uDirColor=J,V.uDirDirection=$}p._lastLightMask=Xe,p._lastHeadlightAmbientIntensity=y},Oh=function(S,B,W,y){if(y===A&&(y=S._headlightAmbientIntensity),y!==S._lastHeadlightAmbientIntensity&&(B.uHeadlightAmbientIntensity=S._lastHeadlightAmbientIntensity=y),W!==S._lastLightMask){S._lastLightMask=W;var q=S._lastLightUploadInfo;if(q){var T,k,n,f=q.g,E=q.e,D=f.length,r=new Array(D),v=!1;for(k=0;D>k;k++)T=f[k],n=0>T||T>=32?1:W&1<<T?0:1,r[k]=n,n!==E[k]&&(v=!0);if(v){q.e=E=r;var U=q.c;B.uHeadlightColor=[U[0],U[1],U[2],E[0]];var j,g=S._59O,F=S._spots,z=S._dirs,p=3,Q=1;if(D=g.length){for(k=0,j=[];D>k;k++)j.push(U[p++],U[p++],U[p++],E[Q++]);B.uPointColor=j}if(D=F.length){for(k=0,j=[];D>k;k++)j.push(U[p++],U[p++],U[p++],E[Q++]);B.uSpotColor=j}if(D=z.length){for(k=0,j=[];D>k;k++)j.push(U[p++],U[p++],U[p++],E[Q++]);B.uDirColor=j}}}}},Di=function(Z,b){return Math.max(Z.getRotateMinPhi()+Qd,Math.min(Z.getRotateMaxPhi()-Qd,b))},sc=function(){return.05+ol()/2},Dr=function(g,p,z,U){var E,l=g.getEye();return g.isOrtho()?(E=Dk(g.getCenter(),l),E[0]+=U[0],E[1]+=U[1],E[2]+=U[2]):E=l,Hi(p,z,U,E)},Hi=function(j,R,C,J){var O=Tp(j,R),I=Dk(J,C,!0),Q=Tp(I,R);if(D(Q)<Qd)return q;var w=(O-Tp(C,R))/Q;return[C[0]+I[0]*w,C[1]+I[1]*w,C[2]+I[2]*w]},Vf=function(E,l){return{x:2*E.x-l.x,y:2*E.y-l.y}},wr=function(u,Z,s,N){var Y,B;if(!u)return Y=Cl(Z.y-s.y,s.x-Z.x),{x:Z.x+N*o(Y),y:Z.y+N*O(Y)};if(!s)return Y=Cl(u.y-Z.y,Z.x-u.x),{x:Z.x+N*o(Y),y:Z.y+N*O(Y)};var C=Dk([u.x,u.y,0],[Z.x,Z.y,0],!0),n=Dk([s.x,s.y,0],[Z.x,Z.y,0],!0),l=-(C[0]+n[0])/2,K=-(C[1]+n[1])/2,b=h(l*l+K*K);if(Qd>b)return Y=Cl(u.y-Z.y,Z.x-u.x),{x:Z.x+N*o(Y),y:Z.y+N*O(Y)};var f=u.x-Z.x,x=u.y-Z.y,z=s.x-Z.x,J=s.y-Z.y,F=h(f*f+x*x),e=h(z*z+J*J);Y=V(Tp(C,n))/2,B=C[1]*n[0]-C[0]*n[1]>0?-1:1,l/=b,K/=b;var G=N/o(Y),m=E(F,e)/O(Y);b=Math.min(G,m);var S={x:Z.x+B*b*l,y:Z.y+B*b*K};return s.b&&G>e/O(Y)&&(S.adjust=!0),S},Ic=function(T){var s=T[1],E=T[2],g=T[3],S=T[6],f=T[7],U=T[11];T[1]=T[4],T[2]=T[8],T[3]=T[12],T[4]=s,T[6]=T[9],T[7]=T[13],T[8]=E,T[9]=S,T[11]=T[14],T[12]=g,T[13]=f,T[14]=U},Lm=function(j){var K=j[0],S=j[1],z=j[2],B=j[3],h=j[4],P=j[5],w=j[6],g=j[7],i=j[8],b=j[9],e=j[10],F=j[11],Y=j[12],k=j[13],p=j[14],l=j[15],o=K*P-S*h,m=K*w-z*h,d=K*g-B*h,G=S*w-z*P,A=S*g-B*P,n=z*g-B*w,N=i*k-b*Y,x=i*p-e*Y,E=i*l-F*Y,M=b*p-e*k,R=b*l-F*k,U=e*l-F*p,Z=o*U-m*R+d*M+G*E-A*x+n*N;return Z?(Z=1/Z,j[0]=(P*U-w*R+g*M)*Z,j[1]=(z*R-S*U-B*M)*Z,j[2]=(k*n-p*A+l*G)*Z,j[3]=(e*A-b*n-F*G)*Z,j[4]=(w*E-h*U-g*x)*Z,j[5]=(K*U-z*E+B*x)*Z,j[6]=(p*d-Y*n-l*m)*Z,j[7]=(i*n-e*d+F*m)*Z,j[8]=(h*R-P*E+g*N)*Z,j[9]=(S*E-K*R-B*N)*Z,j[10]=(Y*A-k*d+l*o)*Z,j[11]=(b*d-i*A-F*o)*Z,j[12]=(P*x-h*M-w*N)*Z,j[13]=(K*M-S*x+z*N)*Z,j[14]=(k*m-Y*G-p*o)*Z,j[15]=(i*G-b*m+e*o)*Z,void 0):q},Um=function(E,j){if(j){var l=j[0],m=j[1],w=j[2];E[12]=E[0]*l+E[4]*m+E[8]*w+E[12],E[13]=E[1]*l+E[5]*m+E[9]*w+E[13],E[14]=E[2]*l+E[6]*m+E[10]*w+E[14],E[15]=E[3]*l+E[7]*m+E[11]*w+E[15]}},xh=function(u,z){if(z){var b=z[0],a=z[1],e=z[2];u[0]=u[0]*b,u[1]=u[1]*b,u[2]=u[2]*b,u[3]=u[3]*b,u[4]=u[4]*a,u[5]=u[5]*a,u[6]=u[6]*a,u[7]=u[7]*a,u[8]=u[8]*e,u[9]=u[9]*e,u[10]=u[10]*e,u[11]=u[11]*e}},ds=function(A,p,k){var R=p[0],U=p[1],V=p[2],N=p[3],w=p[4],g=p[5],o=p[6],c=p[7],e=p[8],d=p[9],$=p[10],i=p[11],E=p[12],G=p[13],u=p[14],s=p[15],B=k[0],y=k[1],T=k[2],D=k[3];return A[0]=B*R+y*w+T*e+D*E,A[1]=B*U+y*g+T*d+D*G,A[2]=B*V+y*o+T*$+D*u,A[3]=B*N+y*c+T*i+D*s,B=k[4],y=k[5],T=k[6],D=k[7],A[4]=B*R+y*w+T*e+D*E,A[5]=B*U+y*g+T*d+D*G,A[6]=B*V+y*o+T*$+D*u,A[7]=B*N+y*c+T*i+D*s,B=k[8],y=k[9],T=k[10],D=k[11],A[8]=B*R+y*w+T*e+D*E,A[9]=B*U+y*g+T*d+D*G,A[10]=B*V+y*o+T*$+D*u,A[11]=B*N+y*c+T*i+D*s,B=k[12],y=k[13],T=k[14],D=k[15],A[12]=B*R+y*w+T*e+D*E,A[13]=B*U+y*g+T*d+D*G,A[14]=B*V+y*o+T*$+D*u,A[15]=B*N+y*c+T*i+D*s,A},ur=function(V,C,S,O){var w,W,z,c,Y,t,p,M,Z,e,N=C[0],Q=C[1],I=C[2],E=O[0],k=O[1],K=O[2],r=S[0],P=S[1],f=S[2];return D(N-r)<Qd&&D(Q-P)<Qd&&D(I-f)<Qd?Nl(V):(p=N-r,M=Q-P,Z=I-f,e=1/h(p*p+M*M+Z*Z),p*=e,M*=e,Z*=e,w=k*Z-K*M,W=K*p-E*Z,z=E*M-k*p,e=h(w*w+W*W+z*z),e?(e=1/e,w*=e,W*=e,z*=e):(w=0,W=0,z=0),c=M*z-Z*W,Y=Z*w-p*z,t=p*W-M*w,e=h(c*c+Y*Y+t*t),e?(e=1/e,c*=e,Y*=e,t*=e):(c=0,Y=0,t=0),V[0]=w,V[1]=c,V[2]=p,V[3]=0,V[4]=W,V[5]=Y,V[6]=M,V[7]=0,V[8]=z,V[9]=t,V[10]=Z,V[11]=0,V[12]=-(w*N+W*Q+z*I),V[13]=-(c*N+Y*Q+t*I),V[14]=-(p*N+M*Q+Z*I),V[15]=1,V)},wl=function(W,F,m,L,q){var x=1/al(F/2),s=1/(L-q);return W[0]=x/m,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=x,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=(q+L)*s,W[11]=-1,W[12]=0,W[13]=0,W[14]=2*q*L*s,W[15]=0,W},bk=function(n,F,p,W,m,w,b){var _=1/(F-p),$=1/(W-m),Q=1/(w-b);return n[0]=-2*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*$,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*Q,n[11]=0,n[12]=(F+p)*_,n[13]=(m+W)*$,n[14]=(b+w)*Q,n[15]=1,n},ph=function(k,c){var t=c[0],Z=c[1],A=c[2],h=c[3],o=t*t+Z*Z+A*A+h*h,T=o?1/o:0;return k[0]=-t*T,k[1]=-Z*T,k[2]=-A*T,k[3]=h*T,k},mo=function(n,o){var d=o[0]+o[5]+o[10],Z=0;return d>0?(Z=2*Math.sqrt(d+1),n[3]=.25*Z,n[0]=(o[6]-o[9])/Z,n[1]=(o[8]-o[2])/Z,n[2]=(o[1]-o[4])/Z):o[0]>o[5]&o[0]>o[10]?(Z=2*Math.sqrt(1+o[0]-o[5]-o[10]),n[3]=(o[6]-o[9])/Z,n[0]=.25*Z,n[1]=(o[1]+o[4])/Z,n[2]=(o[8]+o[2])/Z):o[5]>o[10]?(Z=2*Math.sqrt(1+o[5]-o[0]-o[10]),n[3]=(o[8]-o[2])/Z,n[0]=(o[1]+o[4])/Z,n[1]=.25*Z,n[2]=(o[6]+o[9])/Z):(Z=2*Math.sqrt(1+o[10]-o[0]-o[5]),n[3]=(o[1]-o[4])/Z,n[0]=(o[8]+o[2])/Z,n[1]=(o[6]+o[9])/Z,n[2]=.25*Z),n},vh=function(l,r,v){var U=r[0],q=r[1],y=r[2],P=r[3],O=U+U,m=q+q,N=y+y,L=U*O,D=U*m,d=U*N,J=q*m,h=q*N,x=y*N,E=P*O,$=P*m,Q=P*N;return l[0]=1-(J+x),l[1]=D+Q,l[2]=d-$,l[3]=0,l[4]=D-Q,l[5]=1-(L+x),l[6]=h+E,l[7]=0,l[8]=d+$,l[9]=h-E,l[10]=1-(L+J),l[11]=0,l[12]=v[0],l[13]=v[1],l[14]=v[2],l[15]=1,l},Wn=function(s,l){if(s.isVREnabled()){var I=s.vr.getViewMatrix(l);if(I)return I}return s._camera?s._camera.getViewMatrix(l):ur(l?l:Sj(),s._eye,s._center,s._up)},Vc=function(N,l){if(N.isVREnabled()){var U=N.vr.getProjectMatrix();if(U)return U}if(N._camera)return N._camera.getProjectMatrix();if(!l&&N._computedProjectMatrix)return li(N._computedProjectMatrix);var h=N.getAspect(),R=N._near,L=N._far,Z=Sj();if(N._ortho){var Q=N._orthoWidth/2,x=Q/h;bk(Z,-Q,Q,-x,x,R,L)}else wl(Z,N._fovy,h,R,L);return Z},am=function(U,z){if(!U)return q;var x=0,N=1,n=2,$=[],m=0,O=U.length,c=O/3;if(z){for(;O>m;m++)$[m]=0;for(m=0;m<z.length;m+=3){var X=[],A=[],t=[];X[x]=U[3*z[m+1]+x]-U[3*z[m]+x],X[N]=U[3*z[m+1]+N]-U[3*z[m]+N],X[n]=U[3*z[m+1]+n]-U[3*z[m]+n],A[x]=U[3*z[m+2]+x]-U[3*z[m+1]+x],A[N]=U[3*z[m+2]+N]-U[3*z[m+1]+N],A[n]=U[3*z[m+2]+n]-U[3*z[m+1]+n],t[x]=X[N]*A[n]-X[n]*A[N],t[N]=X[n]*A[x]-X[x]*A[n],t[n]=X[x]*A[N]-X[N]*A[x];for(var Y=0;3>Y;Y++)$[3*z[m+Y]+x]+=t[x],$[3*z[m+Y]+N]+=t[N],$[3*z[m+Y]+n]+=t[n]}}else for(m=0;c>m;m+=3){var X=[],A=[],t=[];X[x]=U[3*(m+1)+x]-U[3*m+x],X[N]=U[3*(m+1)+N]-U[3*m+N],X[n]=U[3*(m+1)+n]-U[3*m+n],A[x]=U[3*(m+2)+x]-U[3*(m+1)+x],A[N]=U[3*(m+2)+N]-U[3*(m+1)+N],A[n]=U[3*(m+2)+n]-U[3*(m+1)+n],t[x]=X[N]*A[n]-X[n]*A[N],t[N]=X[n]*A[x]-X[x]*A[n],t[n]=X[x]*A[N]-X[N]*A[x];for(var Y=0;3>Y;Y++)$[3*(m+Y)+x]=t[x],$[3*(m+Y)+N]=t[N],$[3*(m+Y)+n]=t[n]}for(m=0;O>m;m+=3){var J=[];J[x]=$[m+x],J[N]=$[m+N],J[n]=$[m+n];var g=h(J[x]*J[x]+J[N]*J[N]+J[n]*J[n]);
0===g&&(g=Qd),J[x]=J[x]/g,J[N]=J[N]/g,J[n]=J[n]/g,$[m+x]=J[x],$[m+N]=J[N],$[m+n]=J[n]}return new yk($)},$k=function(L,t,h,N){if(h||(h=L.createTexture()),t){var r=L.TEXTURE_2D,z=L.REPEAT,C=L.CLAMP_TO_EDGE,F=L.TEXTURE_MIN_FILTER;N=N||yq;var S=N.minFilter||N.filter||L.LINEAR,w=N.magFilter||N.filter||L.LINEAR;L.activeTexture(L.TEXTURE0),kf(L,h),L.pixelStorei(L.UNPACK_FLIP_Y_WEBGL,!1),L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),L.texImage2D(r,0,L.RGBA,L.RGBA,L.UNSIGNED_BYTE,t),wf(L,L.TEXTURE_MAG_FILTER,w);var D=t.naturalWidth||t.width,B=t.naturalHeight||t.height;Mh.isPOT(D)&&Mh.isPOT(B)&&!N.clampToEdge&&!t.clampToEdge?(wf(L,L.TEXTURE_WRAP_S,z),wf(L,L.TEXTURE_WRAP_T,z),wf(L,F,S===L.NEAREST?L.NEAREST_MIPMAP_NEAREST:L.LINEAR_MIPMAP_LINEAR),N.mipmapMaxLevel!==A&&wf(L,L.TEXTURE_MAX_LEVEL,N.mipmapMaxLevel),L.generateMipmap(r)):(wf(L,L.TEXTURE_WRAP_S,C),wf(L,L.TEXTURE_WRAP_T,C),wf(L,F,S)),kf(L,q)}return h},ig=function(Z,$,I){var D=new Uint8Array(I||4);return $=$||Z.createTexture(),Z.activeTexture(Z.TEXTURE0),kf(Z,$),wf(Z,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,1,1,0,Z.RGBA,Z.UNSIGNED_BYTE,D),$},Bm=function(B,P,m){var a=new Uint8Array(m||4);return P=P||B.createTexture(),B.activeTexture(B.TEXTURE0),B.bindTexture(B.TEXTURE_CUBE_MAP,P),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAG_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,a),B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,a),B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,a),B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,a),B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,a),B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,a),P},sh=function($){$._26I&&$._prg&&($._26I.deleteProgram($._prg),$._prg=q)},Mo=function(){function g(I){if(I.match(x))return hd(I);var D=h[I];if(D)return D;var q=new RegExp("#define\\s+"+I+"\\s+(\\d+)"),v=H.match(q);return h[I]=v?hd(v[1]):0}function d(o){h={},H=o;var T=o.replace(W,X).replace(z,n);return H=null,h=null,T}function X(L,o,I){I=g(I);for(var G="",J=0;I>J;J++)G+=o+J+";";return G}function n(K,s,m,e){for(var c="",M=g(s);M<g(m);M++)c+=e.replace(/\[\s*i\s*\]/g,"["+M+"]").replace(/\[\s*I\s*\]/g,M);return c}var h,H,W=/(uniform\s+sampler2D\s+\w+)\[([\S\d]+)\];/g,z=/#UNROLL_LOOP_START\s+for\s*\(\s*int\s+i\s*=\s*([\S\d]+)\s*;\s*i\s*<\s*([\S\d]+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#UNROLL_LOOP_END/g,x=/^\d+$/;return function(h){return d(h)}}(),sf=function(H,M,U,t){var P=H.createShader(U);return H.shaderSource(P,Mo(t)),H.compileShader(P),H.attachShader(M,P),P},Ib=function(x){return x.createBuffer()},kf=function(O,y){O.bindTexture(O.TEXTURE_2D,y||O._emptyTexture)},wf=function(g,h,Q){g.texParameteri(g.TEXTURE_2D,h,Q)},Db=function(M,y){var B=Jq.for(M).directState();B.polygonOffset.enabled=!0,B.polygonOffset.value=y},mq=function(S){var m=Jq.for(S).directState();m.polygonOffset.enabled=!1},Zc=function(h,D){if(D){var I=Jq.for(h).directState();I.color.clear=qn(D)}},Gg=function(N,X,B){if(B!==X._lastClipboxEnabled){var r=N._boxClipperGroups,W=N._boxClipperShape,o=r?r.length:0,P=new Array(o);if(B)for(var Q=0;o>Q;Q++)P[Q]=B&1<<r[Q]?W[Q]:0;X._lastClipboxEnabled=B,X.uClipperShape=P}},fj=Gg,Ad=function(J){var E=Jq.for(J),d=E.directUniforms(),Z=E.directAttribs();d.uFix=!0,Z.aNormal=!1},pl=function(p){var P=Jq.for(p),e=P.directUniforms();e.uFix=!1},ng=function(Q,u,e,X,g,Z,w,h){var R=Jq.for(Q),x=R.directState(),v=R.directUniforms();Q._picking||(e?(v.uBlend=!0,v.uBlendColor=e):v.uBlend=!1,v.uLight=v.uFog=X==q?!0:X,xe(g)&&1!==g&&(v.uPartOpacity=g),v.uReverseFlip=Z==q?!1:Z,v.uFixPickReverseColor=w||cm),x.cullFace.enabled=h?!0:!1},Wi=function(I){if(!I._picking){var R=Jq.for(I),c=R.directUniforms();c.uPartOpacity=1}},Dj=function(){var M=new x.Math.Matrix2d,o=[1,0,0,0,1,0,0,0,0];return function(s,K,c,S,E,h,j,G,J,p,a){var P=Jq.for(s),b=P.directUniforms(),y=P.directAttribs();return c?(b.uTexture=!0,b.uDiscardSelectable=_k(S)?S:!0,y.aUv=Id(s,E,h,q,2),a?(b.uBlendTexture=!0,b.uBlendSampler=a):(b.uBlendTexture=!1,b.uBlendSampler=s._emptyBlendTexture),b.uSampler=c,b.uUvMatrix=j||G||J||p?ps(J,j,G,p,M).toArray9():o,void 0):(b.uSampler=s._emptyTexture,b.uBlendSampler=s._emptyBlendTexture,void 0)}}(),gg=function(Y,B,j){var r=Jq.for(Y),V=r.directUniforms(),t=r.directAttribs();Y.activeTexture(Y.TEXTURE0),kf(Y,q),Y.activeTexture(Y.TEXTURE1),kf(Y,q),j&&(t.aUv=!1,V.uTexture=!1,V.uSampler=Y._emptyTexture,V.uBlendTexture=!1,V.uBlendSampler=Y._emptyBlendTexture)},Iq=function(l,K,I,k,g,v){var a=Jq.for(l),N=a.directUniforms(),h=a.directAttribs();!I||mp||Sr||l.lineWidth(I),k&&!l._picking&&(N.uFixPickReverseColor=k),g&&(h.aPosition=Id(l,g,v,q))},nf=function(e,X,c,U,G){Jm&&(U=e[Jm]),G?e.drawArraysInstanced(U==q?e.TRIANGLES:U,X,c,G):e.drawArrays(U==q?e.TRIANGLES:U,X,c);var I=e._renderInfo;I&&(I.calls++,G&&(c*=G),I.vertices+=c,(U==q||U===e.TRIANGLES)&&(I.faces+=c/3),U===e.LINES&&(I.lines+=c/2),U===e.POINTS&&(I.points+=c))},ei=function(I,z,f,T,l,k){Jm&&(T=I[Jm]),k?I.drawElementsInstanced(T==q?I.TRIANGLES:T,f,l==q?I.UNSIGNED_SHORT:l,z==q?0:2*z,k):I.drawElements(T==q?I.TRIANGLES:T,f,l==q?I.UNSIGNED_SHORT:l,z==q?0:2*z);var i=I._renderInfo;i&&(i.calls++,k&&(f*=k),i.vertices+=f,(T==q||T===I.TRIANGLES)&&(i.faces+=f/3),T===I.LINES&&(i.lines+=f/2),T===I.POINTS&&(i.points+=f))},lm=function(r,i,k){var C=r.ARRAY_BUFFER;return r.bindBuffer(C,i),k&&r.bufferData(C,k,r.STATIC_DRAW),i},Bp=function(u,X,v,J,p){var X=Id(u,X,v,J,p);return X.instanced=!0,X},Id=function($,e,l,a,Z){return l?Jn($,$.ARRAY_BUFFER,e,l):lm($,e,l,a,Z)},ql=function(t,i,H){var T=t.ELEMENT_ARRAY_BUFFER;t.bindBuffer(T,i),H&&t.bufferData(T,H,t.STATIC_DRAW)},ho=function(J,q,k){Jn(J,J.ELEMENT_ARRAY_BUFFER,q,k)},Jn=function(s,V,S,w){var B=w._bufId;B||(B=w._bufId=x.Math.generateIncreasingID());var S,A=s._bufPool;return(S=A[B])&&S._buf?s.bindBuffer(V,S._buf):(S=A[B]={_buf:Ib(s)},s.bindBuffer(V,S._buf),s.bufferData(V,w,s.STATIC_DRAW)),S._fid=s._renderInfo.frame,S._buf},Op=function(n,z){z!=q&&z>=0&&n.enableVertexAttribArray(z)},cj=function(g,T){T!=q&&T>=0&&g.disableVertexAttribArray(T)},Kh=function(Q,L){var W=Q.getGL(),F=Jq.for(W),v=F.directUniforms();Q._7O=Q._8O.pop(),L&&(v.uMVMatrix=Q._7O,Q._6O=L,v.uNMatrix=L)},jn=function(m,M){return M||(M=Sj()),Vm(M,m),Lm(M),Ic(M),M},Gq=function($,v){var n=$.getGL(),V=$._7O,E=Jq.for(n),y=E.directUniforms();v?($._8O.push(li(V)),y.uMMatrix=v,ds(V,V,v),$._7O=V):y.uMMatrix=Gl,y.uMVMatrix=V,y.uNMatrix=jn(V,$._6O)},Al={body:0,label:1,label2:2,note:3,note2:4,symbol:5},On=10,Wk=function(E,b,r,y,W,f){var N;if(r){var d=y._pickId;d||(d=y._pickId=b._pickIdUsed,b._pickIdUsed+=On);var T,m=Al[W];if(null!=m)T=d+m;else{var Q=y._pickExtraPartMap;Q||(Q=y._pickExtraPartMap={}),(T=Q[W])||(T=Q[W]=b._pickIdUsed++)}b[T]||(b[T]={data:y.data,part:W}),N=Ws(T)}else N=Tk;if(!f){var c=Jq.for(E),D=c.directUniforms();D.uFixPickReverseColor=N}return N},Aj=Wk,as=function(G,o,B){"target"!==B&&(B="source");var H="target"===B?o.getTargetAgent():o.getSourceAgent(),i="edge."+B+".";if(uk(H)){var N=o.s(i+"anchor.x"),E=o.s(i+"anchor.elevation"),U=o.s(i+"anchor.y"),v=bg(H,G.getMat(H)),c=H.getAnchor3d(),K=Vk([(N===A?.5:N)-c.x,(E===A?.5:E)-c.y,(U===A?.5:U)-c.z],v);return K[1]+=o.s(i+"offset.elevation"),K}var T=o.s(i+"index"),X=G.getData3dUI(H);if(!X.info||!X.info.list)return!1;if(T>=0){var x,n,Q,g,b,w=X.info._lastPointsSegments,f=w.points,V=w.segments,D=-1,h=-1;for(Q=0,g=V?V.length:f.length;g>Q;Q++){if(n=V?V.get(Q):1,3===n)b=2;else if(4===n)b=3;else{if(5===n)continue;b=1}if(D+=b,h++,h===T){x=f.get(D);break}}return x||(x=f.get(f.length-1)),[x.x,(x.e||0)+o.s(i+"offset.elevation"),x.y]}var J=o.s(i+"percent")||.5;if(J=Math.max(0,Math.min(J,1)),!X||!X.getCache)return!1;var O=X.getCache(),g=O[O.length-1].length,w=G.getLineOffset(H,J*g),K=w.point;return[K.x,K.y+o.s(i+"offset.elevation"),K.z]},ep=function(){var E={center:function(x,o,I,l,A){var m=-o[1]/2,f={x:-o[0]/2,y:m,width:o[0],height:o[1]},W=oo(x,f,I);return[W.x+l,-W.y-A,M.getPosition3dGap()]},front:function(g,v,N,Q,C){var f=-v[1]/2,s={x:-v[0]/2,y:f,width:v[0],height:v[1]},j=oo(g,s,N);return[j.x+Q,-j.y-C,v[2]/2+M.getPosition3dGap()]},back:function(_,s,h,o,R){var N=-s[0]/2,G=-s[1]/2,q={x:N,y:G,width:s[0],height:s[1]},U=oo(_,q,h);return[-U.x-o,-U.y-R,-s[2]/2-M.getPosition3dGap()]},left:function(o,A,c,F,s){var j=-A[1]/2,k={x:-A[2]/2,y:j,width:A[2],height:A[1]},h=oo(o,k,c);return[-A[0]/2-M.getPosition3dGap(),-h.y-s,h.x+F]},right:function(p,R,Y,T,O){var e=-R[2]/2,x=-R[1]/2,n={x:e,y:x,width:R[2],height:R[1]},k=oo(p,n,Y);return[R[0]/2+M.getPosition3dGap(),-k.y-O,-k.x-T]},top:function(C,K,S,O,U){var L={x:-K[0]/2,y:-K[2]/2,width:K[0],height:K[2]},a=oo(C,L,S);return[a.x+O,K[1]/2+M.getPosition3dGap(),a.y+U]},bottom:function(W,w,a,U,z){var e=-w[2]/2,T={x:-w[0]/2,y:e,width:w[0],height:w[2]},K=oo(W,T,a);return[K.x+U,-w[1]/2-M.getPosition3dGap(),-K.y-z]}};return function(T,g,j,N,A,c){return E[N](T,g,j,A||0,c||0)}}(),zf=function(J,t,q,B,V,P,c,x,E,Q){if(V&&(t[0]+=V[0],t[1]+=V[1],t[2]+=V[2]),Um(J,q),x){var o=Sj();if(Ah(o,E,Q),Vk(t,o),Um(J,t),J.auto=x,J.pos=Vk([0,0,0],J),P){var y=J.mat2=Sj();Ah(y,P,c)}}else Ah(J,E,Q),Um(J,t),B===wk?ai(J,-Ek):B===Bj?ai(J,Ek):B===vg?Xc(J,-Ek):B===rj?Xc(J,Ek):B===ki&&ai(J,Y),Ah(J,P,c);return J},Eo=function(T,e){var S=e.auto,V=e.mat2,a=T.gv;if(S){var M,w=Sj(),I=[0,0,0,0];M="string"==typeof S?[S.indexOf("x")<0?a._eye[0]:a._center[0],S.indexOf("y")<0?a._eye[1]:a._center[1],S.indexOf("z")<0?a._eye[2]:a._center[2]]:a._eye,mo(I,ur(Sj(),M,a._center,a._up)),vh(w,ph(I,I),e.pos),V&&ds(w,w,V),Gq(a,w)}else Gq(a,e)},bd=function(C,Z,H,r,G){var U=C.s,M=C.gv,w=M.getGL(),E=M._prg,o=M._buffer,A=M._1O,Y=Jq.for(w),X=Y.directAttribs();$k(w,Pr,A),Eo(C,H),ng(w,E,U(Z+".blend"),U(Z+".light"),U(Z+".opacity"),U(Z+".reverse.flip"),U(Z+".reverse.color"),U(Z+".reverse.cull")),Dj(w,E,A,G,o.uv,oq),X.aPosition=Id(w,o.vs,r,q),X.aNormal=Id(w,o.ns,Zp,q),ho(w,o.is,vd),ei(w,0,vd.length),gg(w,E,A),Wi(w,E),Kh(M)},tn=function(D,j,I){var U=D.gv,y=D.data,O=D[j]={blend:U.getBodyColor(y)||U.getFaceBlend(y,j),light:U.getFaceLight(y,j),color:U.getFaceColor(y,j),opacity:U.getFaceOpacity(y,j),transparent:U.getFaceTransparent(y,j),reverseFlip:U.getFaceReverseFlip(y,j),reverseColor:U.getFaceReverseColor(y,j),reverseCull:U.getFaceReverseCull(y,j),texture:U.getFaceImage(y,j),blendTexture:U.getFaceBlendImage(y,j),discardSelectable:U.getFaceDiscardSelectable(y,j)};if("csg"!==j){O.uv=U.getFaceUv(y,j)||I&&I[j+"Uv"],O.uvScale=U.getFaceUvScale(y,j)||I&&I[j+"UvScale"],O.uvOffset=U.getFaceUvOffset(y,j)||I&&I[j+"UvOffset"],O.uvRotation=U.getFaceUvRotation(y,j)||I&&I[j+"uvRotation"],O.uvAnchor=U.getFaceUvAnchor(y,j)||I&&I[j+"uvAnchor"];var V=U.getFaceMat(y,j);if(V){var w=bg(y,V);y.appendAnchorMatrix3d(w),O.mat=w}}return O},If=function(B,C,H,D,K){var n=B[D];if(n){if(!K(n.transparent))return;var Q=B.data,z=B.gv,j=z._buffer,x=z.getTexture(n.texture,Q,D),Y=z.getTexture(n.blendTexture,Q),a=Jq.for(C),t=a.directUniforms(),I=a.directAttribs();Dj(C,H,x,n.discardSelectable,j.uv,n.tuv,n.uvOffset,n.uvScale,n.uvRotation,n.uvAnchor,Y),ng(C,H,n.blend,n.light,n.opacity,n.reverseFlip,n.reverseColor,n.reverseCull),n.cs&&!z._batchColorDisabled?(t.uBatchColor=!0,I.aBatchColor=Id(C,j.batchColor,n.cs,H.aBatchColor,4)):t.uDiffuse=n.color||T["color.empty"],I.aPosition=Id(C,j.vs,n.vs,q),I.aNormal=Id(C,j.ns,n.ns,q),nf(C,0,n.vs.length/3),n.cs&&!z._batchColorDisabled&&(t.uBatchColor=!1,cj(C,H.aBatchColor)),Wi(C,H),gg(C,H,x)}},of=function(D,B,K){bj(D)?D.forEach(function(S){of(S,B,K)}):ro(D)?of(Hf(B,D),B,K):fg(D)?D.shape3d?of(D.shape3d,B,K):K.push(D):K.push(D)},qi=function(){for(var c=50,a=arguments.length,r=[],M=0;a>M;M++)r[M]=arguments[M];Nm[pd]="Time : "+(new Date).toLocaleString()+", Info :"+r.join(", "),pd=(pd+1)%c,console.error("Failed to create shader.")},ps=function(){var H=new Mh.Matrix2d;return function(c,y,l,O,X){return X||(X=H),X.identity(),O&&X.translate(-O[0],-O[1]),l&&X.scale(l[0],l[1]),c&&X.rotate(c),O&&X.translate(O[0],O[1]),y&&X.translate(y[0],y[1]),X}}(),Tc=function(r,e,j,R,Y,M){var f,E,G,i,O,g,l,L,V,U,I,A=[R-e,Y-j],X=r?r.length:0;for(G=0;X>G;G++){for(i=2,f=r[G],O=f[0],g=f[1];i+1<f.length;){if(l=f[i],L=f[i+1],E=Tg(e,j,R,Y,O,g,l,L,!0)){V=[l-O,L-g],U=Hh(V),V[0]/=U,V[1]/=U,U=Tp(A,V),U=U>0?M:-M,I=[V[0]*U,V[1]*U];break}O=l,g=L,i+=2}if(I)break}if(I)for(R=e+I[0],Y=j+I[1],G=0;X>G;G++)for(i=2,f=r[G],O=f[0],g=f[1];i+1<f.length;){if(l=f[i],L=f[i+1],E=Tg(e,j,R,Y,O,g,l,L,!0))return[0,0];O=l,g=L,i+=2}return I?I:[R-e,Y-j]},kg=function(U){return"nearest"===U?Xh.NEAREST:"linear"===U?Xh.LINEAR:U},Kr=x.graph3d={WebGLConstants:Xh},Xr=function(E,U,V){uj(H+".graph3d."+E,U,V)},fq="!~!<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!~!<6/1!,!*{/mbdpMwVxpmg!,!z/mbdpMwVxpmg!-y/mbdpMwVxpmg)3dfw!>!^j]wVxpmg!<{zy/*enspgtobsu!+!yjsubNNv!+!^j]yjsubNxpmg)!>!mbdpMwVxpmg!|!*,,j!<UDFKCP`XPMG`YBN!=!j!<1!>!j!uoj)!spg!<mbdpMwVxpmg!4dfw!1!?!UDFKCP`XPMG`YBN!gj$!gjeof$!<enspgtobsu!+!yjsubNNv!+!yjsubNxpebit!>!esppDxpebit!QBNXPEBIT`FTV!gfegj$!gjeof$!~!<fdobutjEfojMb!>!fdobutjEfojMw!|!*itbEv)!gj!ITBE!gfegj$!gjeof$!~!<ttfouihjsCidubCb!>!ttfouihjsCidubCw!|!*ttfouihjsCidubCv)!gj!TTFOUIHJSCIDUBC!gfegj$!gjeof$!~!<eofmCidubCb!>!eofmCidubCw!|!*eofmCidubCv)!gj!EOFMCIDUBC!gfegj$!gjeof$!~!<spmpDidubCb!>!spmpDidubCw!|!*spmpDidubCv)!gj!SPMPDIDUBC!gfegj$!gjeof$!~!<**1/2!-wVb)4dfw!+!yjsubNwVv)3dfw!>!wVw!|!*fsvuyfUv)!gj!ftmf$!<*y/wVb!-**1/2!-wVb)4dfw!+!yjsubNwVv)3dfw)4dfw!>!wVw!QJMD`WV!gfegj$!<*enspgtobsu)4dfw!>!opjujtpQw!gjeof$!~!1!>>!SFQQJMD`YPC`YBN!gj$!<*enspgtobsu!+!yjsubNNv)4dfw!>!emspXw!<*yfusfw)4dfw!>!yfusfWw!gjeof$!<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw!ftmf$!<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw!ftmf!~!<**1/2!-mbnspOw!+!n)5dfw!+!yjsubNOv)4dfw!>!mbnspOw!<**^3]n!-^3]n)upe!-*^2]n!-^2]n)upe!-*^1]n!-^1]n)upe)4dfw!0!mbnspOb!>!mbnspOw!<*!efdobutoJyjsubNb!)4ubn!>!n!4ubn!|!*fdobutoJftVv)!gj!FDOBUTOJIDUBC!gfegj$!gjeof$!|!*ldjQva)!gj!1!>>!SFQQJMD`YPC`YBN!gj$!<enspgtobsu!+!yjsubNWNv!>!yfusfw!5dfw!gjeof$!~!<enspgtobsu!+!efdobutoJyjsubNb!>!enspgtobsu!|!*fdobutoJftVv)!gj!FDOBUTOJIDUBC!gfegj$!<*1/2!-opjujtpQb)5dfw!>!enspgtobsu!5dfw!|!*ejpw)ojbn!ejpw!gjeof$!<^UDFKCP`XPMG`YBN]wVxpmg!3dfw!hojzsbw!<^UDFKCP`XPMG`YBN]yjsubNxpmg!5ubn!nspgjov!1!?!UDFKCP`XPMG`YBN!gj$!gjeof$!<esppDxpebit!5dfw!hojzsbw!<yjsubNxpebit!5ubn!nspgjov!QBNXPEBIT`FTV!gfegj$!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw!<fdobutjEfojMb!ubpmg!fuvcjsuub!<itbEv!mppc!nspgjov!ITBE!gfegj$!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov!<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov!<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov!<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov!<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!gjeof$!<eofmCidubCw!4dfw!hojzsbw!<eofmCidubCb!4dfw!fuvcjsuub!<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw!<ttfouihjsCidubCb!ubpmg!fuvcjsuub!<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!gjeof$!<spmpDidubCw!5dfw!hojzsbw!<spmpDidubCb!5dfw!fuvcjsuub!<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<opjujtpQw!4dfw!hojzsbw!<emspXw!4dfw!hojzsbw!<yfusfWw!4dfw!hojzsbw!<mbnspOw!4dfw!hojzsbw!<yjGv!mppc!nspgjov!<ldjQv!mppc!nspgjov!<yjsubNxfjWv!5ubn!nspgjov!<yjsubNOv!5ubn!nspgjov!<yjsubNQv!5ubn!nspgjov!<yjsubNNv!5ubn!nspgjov!<yjsubNWNv!5ubn!nspgjov!<opjujtpQb!4dfw!fuvcjsuub!gjeof$!~!<*{zy/**1/1!-sje)5dfw!+!yjsubn))f{jmbnspo!osvufs!|!*yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsu!4dfw!<efdobutoJyjsubNb!5ubn!fuvcjsuub!<fdobutoJftVv!mppc!nspgjov!FDOBUTOJIDUBC!gfegj$!<mbnspOb!4dfw!fuvcjsuub!gjeof$!<wVw!3dfw!hojzsbw!ftmf$!<wVw!4dfw!hojzsbw!QJMD`WV!gfegj$!<wVb!3dfw!fuvcjsuub!<yjsubNwVv!4ubn!nspgjov!<fsvuyfUeofmCv!mppc!nspgjov!<fsvuyfUv!mppc!nspgjov!YJGFSQ$!^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",ic="!~!~!<eJ!>!spmpDhbsG`mh!~!<spmpDsfmqnbTwv!>+!eJ!<*zy/wVw!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw!|!*fsvuyfUeofmCv)!gj!gjeof$!~!<ttfouihjsCidubCw!>+!chs/eJ!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~!<ttfouihjsCv!>+!chs/eJ!|*1/2!>a!ttfouihjsCv)gj!gjeof$!~!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ!gjeof$!<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg!ftmf$!<*iuqfe!+!iuqfe!+!zujtofEhpGv!+!zujtofEhpGv!.)qyf!.!1/2!>!spudbGhpg!ubpmg!3QYF`HPG!gfegj$!<{/yfusfWw.!>!iuqfe!ubpmg!|!*hpGv)!gj!HPG!gfegj$!~!~!<zujdbqPusbQv!>+!b/eJ!|*1/2!>a!zujdbqPusbQv)gj!~!gjeof$!~!<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ!gjeof$!<*spmpDwof)sbfojMpUmfyfUqbNwof!>!spmpDwof!<**{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv)fcvDfsvuyfu!>!spmpDwof!5dfw!ftmf$!<**ttfoihvps!-*{z/dfWudfmgfs!-y/dfWudfmgfs.)4dfw!-qbNwoFv)WVfcvDfsvuyfu)CHStpUsbfojM!>!spmpDwof!5dfw!WV`FCVD`FQZU`QBNWOF!gfegj$!gjeof$!<*mbnspOemspx!-yfusfWpUbsfnbd)udfmgfs!>!dfWudfmgfs!4dfw!ftmf$!<***mbnspOemspx!-yfusfWpUbsfnbd)udfmgfs!-ubvRqbnwoFv)spudfWfubups)f{jmbnspo!>!dfWudfmgfs!4dfw!FUBUPS`QBNWOF!gfegj$!<*yjsubNxfjWv!-O)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw!<*opjujtpQbsfnbDv!.!emspXw)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw!|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!gjeof$!~!~!~!~!<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ!<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt!|*^j]fmhoBupqTv!?!udfggFupqt)gj!<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg!<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw!|*1/1!?!fhobSm)!gj!~!<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm!|*1/1!?!^j]fhobSupqTv)!gj!<1/2!>!fhobSm!ubpmg!<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw!|*1/1!>>!x/^j]spmpDupqTv)gj!|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!gjeof$!~!~!~!<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ!|*1/1!?!fhobSm)!gj!~!<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm!|*1/1!?!^j]fhobSuojpQv)!gj!<1/2!>!fhobSm!ubpmg!<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw!|*1/1!>>!x/^j]spmpDuojpQv)gj!|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!gjeof$!~!~!<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ!|*1/1!>>!x/^j]spmpDsjEv)gj!|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~!<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ!gjeof$!~!<fvmbWxpebit!+!zujtofuoJxpebit!.!1/2!>+!nsfUusfcnbm!~!<osvufs!<esbdtje!|!*1/1!>>!fvmbWxpebit!%%!mmvDxpebit)!gj!<*esppDxpebit!-tvjebSxpebit!-tbjCxpebit!-f{jTxpebit!-qbNxpebit)xpebiTufh!.!1/2!>!fvmbWxpebit!ubpmg!|!*fwjfdfSxpebit)!gj!QBNXPEBIT`FTV!gfegj$!~!<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!>+!nsfUusfcnbm!|*1/1!?!fhobSuihjmebfIv)gj!<*1/1!-zujtofuoJuofjcnBuihjmebfIv!,!*zujtofuoJuofjcnBuihjmebfIv!.!1/2)!+!nsfUusfcnbm)ybn!>!nsfUusfcnbm!<*opjudfsjEuihjmebfIv.!-O)upe!>!nsfUusfcnbm!ftmf!<*M.!-O)upe!>!nsfUusfcnbm!*1/1!>>!{/opjudfsjEuihjmebfIv!%%!1/1!>>!z/opjudfsjEuihjmebfIv!%%!1/1!>>!y/opjudfsjEuihjmebfIv)!gj!<nsfUusfcnbm!ubpmg!|*1/1!>>!x/spmpDuihjmebfIv)gj!gjeof$!EOF`QPPM`MMPSOV$!~!gjeof$!<chs/mfyfUxpmg!>,!chs/eJ!ftmf$!<bchs/mfyfUxpmg!>,!bchs/eJ!*!BCHS`EEB`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<bchs/mfyfUxpmg!>!bchs/eJ!*!BCHS`FEJSSFWP`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<b/mfyfUxpmg!>!b/eJ!*!B`FEJSSFWP`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<chs/mfyfUxpmg!>!chs/eJ!*!CHS`FEJSSFWP`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<bchs/mfyfUxpmg!>+!bchs/eJ!*!BCHS`ZMQJUMVN`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<chs/mfyfUxpmg!>+!chs/eJ!*!CHS`ZMQJUMVN`FEPN`EOFMC`XPMG!)efojgfe!gj$!****1/1)3dfw!-^j]wVxpmg)obiUsfubfsh)mmb!%%!***1/2)3dfw!-^j]wVxpmg)obiUttfm)mmb!%%!^j]efmcboFxpmg)!gj!<*^j]wVxpmg!-^J]fsvuyfUxpmg)E3fsvuyfu!>!mfyfUxpmg!|!*,,j!<UDFKCP`XPMG`YBN!=!j!<1>j!uoj)!spg!USBUT`QPPM`MMPSOV$!<mfyfUxpmg!5dfw!1!?!UDFKCP`XPMG`YBN!gj$!|!*uihjMv)!gj!~!gjeof$!~!<spmpDeofmCv!>+!eJ!|*eofmCv)gj!ftmf$!~!<spmpDeofmCv!>+!eJ!|*eofmCv)gj!ftmf!~!<eofmCidubCw!>+!chs/eJ!|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~!~!<esbdtje!|*1/1!>>!x/eJ)gj!gjeof$!<ftvggjEv!>!eJ!ftmf$!~!<ftvggjEv!>!eJ!|ftmf~!<spmpDidubCw!>!eJ!|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|!ftmf!~!<spmpDwv!>!eJ!|*fsvuyfUv)gj!|!ftmf!~!<spmpDftsfwfSldjQyjGv!>!eJ!|*qjmGftsfwfSva!%%!ldbCtj)gj!~!<fvsu!>!ldbCtj!<O.!>!O!|*1/1!=!*O!-F)upe)gj!<ftmbg!>!ldbCtj!mppc!<F.!>!M!4dfw!gjeof$!<*yfusfWw.)f{jmbnspo!>!F!4dfw!ftmf$!<*2!-1!-1)4dfw!>!F!4dfw!DJIQBSHPIUSP!gfegj$!<*mbnspOw)f{jmbnspo!>!O!4dfw!|!ftmf!~!gjeof$!~!~!<ftvggjEv!>!eJ!|ftmf!~!<esbdtje!|*1/1!>>!x/ftvggjEv)gj!|!*fdobutjEitbEv!?!*fdobutjEqbHitbEv!-fdobutjEfojMw)epn!%%!itbEv)!gj!ITBE!gfegj$!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~!<spmpDftsfwfSldjQyjGv!>!eJ!|!ftmf!~!<spmpDidubCw!>!eJ!|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|!*yjGv)!gj!<eJ!5dfw!|!ftmf!~!~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!|!ftmf!~!<spmpDidubCw!>!spmpDhbsG`mh!|!*spmpDidubCv)!gj!SPMPDIDUBC!gfegj$!|!*ldjQv)!gj!~!<osvufs!<*1/2!-1/1!-1/1!-1/1)5dfw!>!spmpDhbsG`mh!|!*uvpldbmc)!gj!gjeof$!~!~!<osvufs!<esbdtje!|!**6/1!=!*mbdpMw)iuhofm)!>a!^j]sfooJqjmDsfqqjmDv!%%!3!>>!^j]fqbiTsfqqjmDv!}}!***ojNqjmd!-mbdpMw)obiUsfubfsh)mmb!%%!**ybNqjmd!-mbdpMw)obiUttfm)mmb)!>a!^j]sfooJqjmDsfqqjmDv!%%!2!>>!^j]fqbiTsfqqjmDv)!gj!<**1/2!-emspXw)5dfw!+!^j]yjsubNsfqqjmDv)4dfw!>!mbdpMw!|!*,,j!<SFQQJMD`YPC`YBN!=!j!<1!>!j!uoj)!spg!<mbdpMw!4dfw!1!?!SFQQJMD`YPC`YBN!gj$!~!gjeof$!~!<esbdtje!|!**sje!-*uofdsfQqjmDv)4dfw)upe!?!*opjujtpQw!-sje)upe)!gj!ftmf$!~!<esbdtje!|!**sje!-*uofdsfQqjmDv)4dfw)upe!?!*opjujtpQqjmd!-sje)upe)!gj!~!<*1/1!-1/1!-{/wVw)4dfw!>!opjujtpQqjmd!<1/2.!>!y/sje!|!*:!=!opjudfsjEqjmDv)!gj!ftmf!~!<*1/1!-1/1!-{/wVw)4dfw!>!opjujtpQqjmd!<1/2!>!y/sje!|!*9!=!opjudfsjEqjmDv)!gj!ftmf!QJMD`WV!gfegj$!~!<1/2.!>!{/sje!|!*8!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2!>!{/sje!|!*7!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2.!>!z/sje!|!*6!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2!>!z/sje!|!*5!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2.!>!y/sje!|!*4!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2!>!y/sje!|!*3!=!opjudfsjEqjmDv)!gj!gjeof$!<opjujtpQw!>!opjujtpQqjmd!4dfw!QJMD`WV!gfegj$!<*1/1!-1/1!-1/1)4dfw!>!sje!4dfw!|!*1!?!opjudfsjEqjmDv)!gj!~!~!~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!|!ftmf!~!~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!|!*uofsbqtobsUv)!gj!gjeof$!<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv!ftmf$!<*zy/wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv!QJMD`WV!gfegj$!|!**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)!gj!<spmpDwv!5dfw!|!*ejpw)ojbn!ejpw!<uvpldbmc!mppc!nspgjov!gjeof$!<^UDFKCP`XPMG`YBN]wVxpmg!3dfw!hojzsbw!<^UDFKCP`XPMG`YBN]efmcboFxpmg!mppc!nspgjov!<^UDFKCP`XPMG`YBN]fsvuyfUxpmg!E3sfmqnbt!nspgjov!1!?!UDFKCP`XPMG`YBN!gj$!gjeof$!gjeof$!~!~!<*1/2!-*Gqjn!-2spmpd!-1spmpd)yjn)5dfw!osvufs!<*1/2!,!uoJqjn!-sjEfmqnbt!-qbNwof)WVfcvDsbfojmjc!>!2spmpd!4dfw!|!ftmf!~!<*1/2!-1spmpd)5dfw!osvufs!|!*1/1!>>!Gqjn)!gj!<*uoJqjn!-sjEfmqnbt!-qbNwof)WVfcvDsbfojmjc!>!1spmpd!4dfw!<*qjn)sppmg!>!uoJqjn!ubpmg!<*qjn)udbsg!>!Gqjn!ubpmg!<*mfwfMqjNybn`WVfcvd!-1n!-*ttfoihvps)qjNpUttfoihvps)qnbmd!>!qjn!ubpmg!|!*ttfoihvps!ubpmg!-sjEfmqnbt!4dfw!-qbNwof!E3sfmqnbt)WVfcvDfsvuyfu!5dfw!~!<qjn!osvufs!~!<*ttfoihvps!+!72/2)3hpm!+!1/3!.!>!qjn!|!ftmf!~!<6n!,!*7s!.!6s)!0!*6n!.!7n)!+!*ttfoihvps!.!6s)!>!qjn!|!*7s!>?!ttfoihvps)!gj!ftmf!~!<5n!,!*6s!.!5s)!0!*5n!.!6n)!+!*ttfoihvps!.!5s)!>!qjn!|!*6s!>?!ttfoihvps)!gj!ftmf!~!<2n!,!*5s!.!2s)!0!*2n!.!5n)!+!*ttfoihvps!.!2s)!>!qjn!|!*5s!>?!ttfoihvps)!gj!ftmf!~!<1n!,!*2s!.!1s)!0!*1n!.!2n)!+!*ttfoihvps!.!1s)!>!qjn!|!*2s!>?!ttfoihvps)!gj!<1/1!>!qjn!ubpmg!|!*ttfoihvps!ubpmg)qjNpUttfoihvps!ubpmg!1/5!7n!fojgfe$!9411/1!7w!fojgfe$!23/1!7s!fojgfe$!1/4!6n!fojgfe$!721/1!6w!fojgfe$!614/1!6s!fojgfe$!1/3!5n!fojgfe$!751/1!5w!fojgfe$!5/1!5s!fojgfe$!1/2!.!2n!fojgfe$!783/1!2w!fojgfe$!9/1!2s!fojgfe$!1/3!.!1n!fojgfe$!:44/1!1w!fojgfe$!1/2!1s!fojgfe$!~!<*z/g!-nc!-nu)yjn!osvufs!<*y/g!-sc!-mc)yjn!>!nc!4dfw!<*y/g!-su!-mu)yjn!>!nu!4dfw!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!mc!4dfw!<f{jTmfyfu!>.!y/wv!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!sc!4dfw!<f{jTmfyfu!>,!z/wv!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!su!4dfw!<f{jTmfyfu!>,!y/wv!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!mu!4dfw!<f{jTmfyfu!>+!wv!<*f{jTfdbg!+!1/3!.!f{jTfmjUybn`WVfcvd!-1/1)ybn!+!1/4!>,!y/wv!<f{jTfmjUojn`WVfcvd!+!1/3!+!uoJsfumjg!>,!z/wv!~!<f{jTfmjUybn`WVfcvd!+!1/3!>,!z/wv!|!*mfwfMqjNybn`WVfcvd!=!uoJqjn)!gj!<f{jTfdbg!+!fdbg!>,!y/wv!~!<1/4!>.!fdbg!<f{jTfdbg!>,!z/wv!|!*1/3!?!fdbg)!gj!<g!.!6/1!>,!wv!<*wv)udbsg!>!g!3dfw!<*1/2!.!f{jTfdbg)!+!*fdbg!-opjudfsje)WVufh!>!wv!3dfw!<*f{jTfmjUybn`WVfcvd!+!1/4)!0!1/2!>!f{jTmfyfu!ubpmg!<*uoJqjn)3qyf!>!f{jTfdbg!ubpmg!<*mfwfMqjNojn`WVfcvd!-uoJqjn)ybn!>!uoJqjn!<*1/1!-uoJqjn!.!mfwfMqjNojn`WVfcvd)ybn!>!uoJsfumjg!ubpmg!<*opjudfsje)fdbGufh!>!fdbg!ubpmg!|!*uoJqjn!ubpmg!-opjudfsje!4dfw!-qbNwof!E3sfmqnbt)WVfcvDsbfojmjc!4dfw!~!<*1/2!,!wv)!+!6/1!osvufs!~!<*{/opjudfsje)tcb!0!*z/opjudfsje!-y/opjudfsje)3dfw!>!wv!|!ftmf!~!<*z/opjudfsje)tcb!0!*{/opjudfsje!-y/opjudfsje!.)3dfw!>!wv!|!*1/5!>>!fdbg)!gj!ftmf!~!<*y/opjudfsje)tcb!0!*z/opjudfsje!-{/opjudfsje!.)3dfw!>!wv!|!*1/4!>>!fdbg)!gj!ftmf!~!<*{/opjudfsje)tcb!0!*z/opjudfsje!-y/opjudfsje!.)3dfw!>!wv!|!*1/3!>>!fdbg)!gj!ftmf!~!<*z/opjudfsje)tcb!0!*{/opjudfsje!.!-y/opjudfsje!.)3dfw!>!wv!|!*1/2!>>!fdbg)!gj!ftmf!~!<*y/opjudfsje)tcb!0!*z/opjudfsje!-{/opjudfsje)3dfw!>!wv!|!*1/1!>>!fdbg)!gj!<wv!3dfw!|!*fdbg!ubpmg!-opjudfsje!4dfw)WVufh!3dfw!~!<fdbg!osvufs!~!<1/5!;!1/2!@!1/1!?!z/opjudfsje!>!fdbg!ftmf!<1/6!;!1/3!@!1/1!?!{/opjudfsje!>!fdbg!*z/opjudfsjEtcb!?!{/opjudfsjEtcb)!gj!|!ftmf!~!<1/5!;!1/2!@!1/1!?!z/opjudfsje!>!fdbg!ftmf!<1/4!;!1/1!@!1/1!?!y/opjudfsje!>!fdbg!*z/opjudfsjEtcb!?!y/opjudfsjEtcb)!gj!|!*{/opjudfsjEtcb!?!y/opjudfsjEtcb)!gj!<1/2!.!>!fdbg!ubpmg!<*opjudfsje)tcb!>!opjudfsjEtcb!4dfw!|!*opjudfsje!4dfw)fdbGufh!ubpmg!1/72!f{jTfmjUojn`WVfcvd!fojgfe$!1/763!f{jTfmjUybn`WVfcvd!fojgfe$!1/5!mfwfMqjNojn`WVfcvd!fojgfe$!1/9!mfwfMqjNybn`WVfcvd!fojgfe$!WV`FCVD`FQZU`QBNWOF!gfegj$!~!<*{zy/*yjsubn!+!*1/1!-sje)5dfw))f{jmbnspo!osvufs!|!*yjsubn!5ubn!oj!-sje!4dfw!oj)opjudfsjEnspgtobsUftsfwoj!4dfw!gjeof$!~!<*x/fvmbw!-**SPUDBG`BNNBH)4dfw!-{zy/fvmbw)xpq)5dfw!osvufs!|!*fvmbw!5dfw)sbfojMpUmfyfUqbNwof!5dfw!ftmf$!~<*!b/fvmbw!-*!*!*!*!9142411/1!)4dfw!-chs/fvmbw!)mbvrFobiUttfm!)4dfw!-3:/32!+!chs/fvmbw!-*!661/1!)4dfw!.!661/2!+!*!*!77725/1!)4dfw!-chs/fvmbw!)xpq!)yjn!)5dfw!osvufs!|!*!fvmbw!5dfw!oj!)CHStpUsbfojM!5dfw!~!<*b/fvmbw!-****65151/1)4dfw!-chs/fvmbw)mbvrFobiUttfm)4dfw!-9194::4881/1!+!chs/fvmbw!-**5/3)4dfw!-*5218342361/1)4dfw!,!79:387985:/1!+!chs/fvmbw)xpq)yjn)5dfw!osvufs!|!*fvmbw!5dfw)sbfojMpUmfyfUqbNwof!5dfw!WV`FCVD`FQZU`QBNWOF!gfegj$!gjeof$!~!<{zy/*!*x/ubvr!-{/ubvr.!-z/ubvr.!-y/ubvr.)5dfw!-wr!)ubvRumvn!osvufs!<*!*1/1!-dfw)5dfw!-ubvr!)ubvRumvn!>!wr!5dfw!|!*!dfw!4dfw!-ubvr!5dfw!)spudfWfubups!4dfw!~!<*!{/3r!+!{/2r!.!z/3r!+!z/2r!.!y/3r!+!y/2r!.!x/3r!+!x/2r!-z/3r!+!y/2r!.!y/3r!+!z/2r!,!x/3r!+!{/2r!,!{/3r!+!x/2r!-y/3r!+!{/2r!.!{/3r!+!y/2r!,!x/3r!+!z/2r!,!z/3r!+!x/2r!-{/3r!+!z/2r!.!z/3r!+!{/2r!,!x/3r!+!y/2r!,!y/3r!+!x/2r)5dfw!osvufs!|!*3r!5dfw!-2r!5dfw)ubvRumvn!5dfw!<ubvRqbnwoFv!5dfw!nspgjov!FUBUPS`QBNWOF!gfegj$!<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!QBNWOF`FTV!gfegj$!gjeof$!~!gjeof$!<*qe!-*z/f{jTmfyfu!-E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!osvufs!ftmf$!<*1/:!0!1/2)!+!*!*qe!-*z/f{jTmfyfu!-yyz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-yyy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zyz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zyy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-yzz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-yzy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zzz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zzy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!)!osvufs!<z/f{jTmfyfu!+!tvjebSxpebit!+!*2!-2!.)3dfw!>!uftggp!3dfw!*UGPT`GDQ`FQZU`QBNXPEBIT)efojgfe!}}!*GDQ`FQZU`QBNXPEBIT)efojgfe!gj$!<*opjujtpQpUuihjm)f{jmbnspo!>!E4ec!4dfw!<tbjCxpebit!>,!qe!<*sbfObsfnbDxpebit!.!sbGbsfnbDxpebit)!0!*sbfObsfnbDxpebit!.!*opjujtpQpUuihjm)iuhofm)!>!qe!ubpmg!<{zy/esppDxpebit!>!opjujtpQpUuihjm!4dfw!<**1/3!-1/5)3dfw!+!f{jTqbNxpebit)!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!|!*sbGbsfnbDxpebit!ubpmg!-sbfObsfnbDxpebit!ubpmg!-esppDxpebit!5dfw!-tvjebSxpebit!ubpmg!-tbjCxpebit!ubpmg!-f{jTqbNxpebit!3dfw!-qbNxpebit!E3sfmqnbt)xpebiTuojpQufh!ubpmg!~!<*68/1!-684/1)3dfw!,!sbobmq!+!*63/1!-632/1)3dfw!osvufs!~!<1/3!.!Zohjt!+!{/w!>!z/sbobmq!<1/3!,!Zohjt!+!1/3!,!y/w!>!y/sbobmq!<*z/w)ohjt!>!Zohjt!ubpmg!|!*foPutpnmb!>?!z/Wtcb)!gj!ftmf!~!<Yohjt!+!1/3!,!Yohjt!+!{/w!>!y/sbobmq!<*y/w)ohjt!>!Yohjt!ubpmg!|!*foPutpnmb!>?!y/Wtcb)!gj!ftmf!~!<y/w!.!1/5!>!y/sbobmq!*1/1!?!{/w)!gj!|!*foPutpnmb!>?!{/Wtcb)!gj!<mfyfUButpnmb!.!1/2!>!foPutpnmb!ubpmg!<Zf{jTmfyfu!+!6/2!>!mfyfUButpnmb!ubpmg!<zy/w!>!sbobmq!3dfw!<*Zf{jTmfyfu!+!1/3!.!1/2)!+!fcvDpUfmbdt!>+!w!<fcvDpUfmbdt!>+!Wtcb!<**{/Wtcb!-z/Wtcb)ybn!-y/Wtcb)ybn!0!1/2!>!fcvDpUfmbdt!ubpmg!<*w)tcb!>!Wtcb!4dfw!|!*Zf{jTmfyfu!ubpmg!-w!4dfw)WVpUfcvd!3dfw!~!<xpebit!osvufs!~!gjeof$!<*{/esppDxpebit!-zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!>!xpebit!ftmf$!<*1/:!0!1/2)!+!*!*{/esppDxpebit!-*2ze!-2ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1/1)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-2ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-1ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-2ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1/1)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!)!>!xpebit!<tvjebSxpebit!+!z/f{jTmfyfu!,!>!2ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!,!>!2ye!ubpmg!<tvjebSxpebit!+!z/f{jTmfyfu!.!>!1ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!.!>!1ye!ubpmg!<f{jTqbNxpebit!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!*UGPT`GDQ`FQZU`QBNXPEBIT)efojgfe!gjmf$!<*1/:!0!1/2)!+!*!*{/esppDxpebit!-*2ze!-2ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1/1)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-2ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-1ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-2ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1/1)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!)!>!xpebit!<tvjebSxpebit!+!z/f{jTmfyfu!,!>!2ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!,!>!2ye!ubpmg!<tvjebSxpebit!+!z/f{jTmfyfu!.!>!1ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!.!>!1ye!ubpmg!<f{jTqbNxpebit!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!*GDQ`FQZU`QBNXPEBIT)efojgfe!gj$!|!*utfUnvutvsg)!gj!<*dfWutfUnvutvsg)mmb!>!utfUnvutvsg!mppc!<*1/2!>=!{/esppDxpebit!-nvutvsGoj)3dfwc!>!dfWutfUnvutvsg!3dfwc!<*dfWnvutvsGoj)mmb!>!nvutvsGoj!mppc!<*1/2!>=!z/esppDxpebit!-1/1!>?!z/esppDxpebit!-1/2!>=!y/esppDxpebit!-1/1!>?!y/esppDxpebit)!5dfwc!>!dfWnvutvsGoj!5dfwc!<*::::::/1!-{/esppDxpebit)ojn!>!{/esppDxpebit!<tbjCxpebit!>,!{/esppDxpebit!<x/esppDxpebit!>0!{zy/esppDxpebit!<1/2!>!xpebit!ubpmg!|!*esppDxpebit!5dfw!-tvjebSxpebit!ubpmg!-tbjCxpebit!ubpmg!-f{jTqbNxpebit!3dfw!-qbNxpebit!E3sfmqnbt)xpebiTufh!ubpmg!~!<d!osvufs!<*y/g!-c!-b)yjn!>!d!ubpmg!<*z/g!-us!-cs)yjn!>!c!ubpmg!<*z/g!-um!-cm)yjn!>!b!ubpmg!<*6/1!,!f{jt!+!wv)udbsg!>!g!3dfw!<*fsbqnpd!-zz/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!us!ubpmg!<*fsbqnpd!-yz/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!cs!ubpmg!<*fsbqnpd!-zy/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!um!ubpmg!<*fsbqnpd!-yy/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!cm!ubpmg!<f{jt!0!*6/1!,!f{jt!+!wv)sppmg!>!WVejpsuofd!3dfw!<f{jt!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!<*1/2!-1/1)3dfw!>!uftggp!3dfw!utopd!|!*fsbqnpd!ubpmg!-wv!3dfw!-f{jt!3dfw!-tiuqfe!E3sfmqnbt)qsfMxpebiTE3fsvuyfu!ubpmg!~!<***wv!-tiuqfe)E3fsvuyfu)iuqfEpUBCHSldbqov!-fsbqnpd)qfut!osvufs!|!*fsbqnpd!ubpmg!-wv!3dfw!-tiuqfe!E3sfmqnbt)fsbqnpDE3fsvuyfu!ubpmg!~!<*tspudbGldbqoV!-w)upe!osvufs!|!*w!5dfw!oj!utopd)iuqfEpUBCHSldbqov!ubpmg!<*/2!-tspudbGldbQ)5dfw!0!fmbdtoxpEldbqoV!>!tspudbGldbqoV!5dfw!utopd!<*/763!-/763!+!/763!-/763!+!/763!+!/763)4dfw!>!tspudbGldbQ!4dfw!utopd!</763!0!/663!>!fmbdtoxpEldbqoV!ubpmg!utopd!</663!0!/763!>!fmbdtqVldbQ!ubpmg!utopd!<esppDxpebit!5dfw!hojzsbw!<fwjfdfSxpebit!mppc!nspgjov!<tvjebSxpebit!ubpmg!nspgjov!<tbjCxpebit!ubpmg!nspgjov!<zujtofuoJxpebit!ubpmg!nspgjov!<f{jTxpebit!3dfw!nspgjov!<qbNxpebit!E3sfmqnbt!nspgjov!<mmvDxpebit!mppc!nspgjov!QBNXPEBIT`FTV!gfegj$!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw!<fdobutjEqbHitbEv!ubpmg!nspgjov!<fdobutjEitbEv!ubpmg!nspgjov!<itbEv!mppc!nspgjov!ITBE!gfegj$!gjeof$!gjeof$!<sbGhpGv!ubpmg!nspgjov!<sbfOhpGv!ubpmg!nspgjov!ftmf$!<zujtofEhpGv!ubpmg!nspgjov!3QYF`HPG!gfegj$!<hpGv!mppc!nspgjov!<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!gjeof$!<*6/1!-6/1!-6/1)4dfw!>!ybNqjmd!4dfw!utopd!<*6/1.!-6/1.!-6/1.)4dfw!>!ojNqjmd!4dfw!utopd!<^SFQQJMD`YPC`YBN]yjsubNsfqqjmDv!5ubn!nspgjov!<^SFQQJMD`YPC`YBN]sfooJqjmDsfqqjmDv!mppc!nspgjov!<^SFQQJMD`YPC`YBN]fqbiTsfqqjmDv!uoj!nspgjov!1!?!SFQQJMD`YPC`YBN!gj$!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov!<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov!<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov!<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov!<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov!<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov!<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov!<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov!<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!gjeof$!<eofmCidubCw!4dfw!hojzsbw!<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw!<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!gjeof$!<spmpDidubCw!5dfw!hojzsbw!<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<opjudfsjEuihjmebfIv!4dfw!nspgjov!<spmpDuihjmebfIv!5dfw!nspgjov!<zujtofuoJuofjcnBuihjmebfIv!ubpmg!nspgjov!<fhobSuihjmebfIv!ubpmg!nspgjov!<emspXw!4dfw!hojzsbw!<opjujtpQbsfnbDv!4dfw!nspgjov!<yjsubNxfjWv!5ubn!nspgjov!gjeof$!gjeof$!<qbNwoFv!fcvDsfmqnbt!nspgjov!ftmf$!<ttfoihvps!ubpmg!nspgjov!<qbNwoFv!E3sfmqnbt!nspgjov!WV`FCVD`FQZU`QBNWOF!gfegj$!<zujwjudfmgfSv!ubpmg!nspgjov!<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<opjujtpQw!4dfw!hojzsbw!<yfusfWw!4dfw!hojzsbw!<mbnspOw!4dfw!hojzsbw!<ftvggjEv!5dfw!nspgjov!<zujdbqPusbQv!ubpmg!nspgjov!<ttfouihjsCv!ubpmg!nspgjov!<uihjMv!mppc!nspgjov!<spmpDeofmCv!5dfw!nspgjov!<eofmCv!mppc!nspgjov!<uofdsfQqjmDv!ubpmg!nspgjov!<opjudfsjEqjmDv!uoj!nspgjov!<sfmqnbTeofmCv!E3sfmqnbt!nspgjov!<sfmqnbTv!E3sfmqnbt!nspgjov!gjeof$!<wVw!3dfw!hojzsbw!ftmf$!<wVw!4dfw!hojzsbw!QJMD`WV!gfegj$!<fsvuyfUeofmCv!mppc!nspgjov!<fsvuyfUv!mppc!nspgjov!<uofsbqtobsUv!mppc!nspgjov!<utfUbiqmBv!ubpmg!nspgjov!<spmpDftsfwfSldjQyjGv!5dfw!nspgjov!<qjmGftsfwfSv!mppc!nspgjov!<ldjQv!mppc!nspgjov!<yjGv!mppc!nspgjov!<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ$!gjeof$!gjeof$!<ubpmg!qnvjefn!opjtjdfsq!ftmf$!<ubpmg!qihji!opjtjdfsq!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!TF`MH!gfegj$!";
zb(M,{setBatchInfo:function(B,a){Im[B]=a},getBatchInfo:function(z){return Im[z]},getBatchInfoMap:function(){return Im},setBatchInfoMap:function(E){Im=E}},!0);var Kc=[1,1,1],Sb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$j=[1,0,0,0,0,1,0,1,1,1,1,0],wg=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],xq=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],Ug=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],dj=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],Td=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],Be=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],Wd=function(U,y){var k=U._40Q;k.each(function(S){S.ivBatch(y)})},lj=function(z,N,A){var P=A._id,Q=N[P];if(Q){var g=Q.batch,w=z[g],L=w.ds,V=Q.index;if(w.invalidate=!0,delete N[P],L.splice(V,1),ob(L))return delete z[g],void 0;for(var I=V,Z=Q.begin,q=Q.size;V<L.length;V++)Q=N[L[V]._id],Q.index--,Q.begin-=q;if(w.ms&&w.ms.length)return w.ms.splice(16*I,16),w.ics&&w.ics.splice(4*I,4),w.ps&&w.ps.splice(4*I,4),void 0;var l=3*Z,n=3*q,h=4*Z,v=4*q,F=w.vs,$=w.ps,B=w.uv,c=w.cs,W=w.bs,E=w.rs,y=w.ns,o=w.ls;F.splice(l,n),$.splice(h,v),B&&B.splice(2*Z,2*q),c&&c.splice(h,v),W&&W.splice(l,n),E&&E.splice(Z,q),y&&y.splice(l,n),o&&o.splice(Z,q)}},Tr=function(k,V,D,W,n){if(!W)return q;var X=V[W];if(!X){var E=n.getBatchInfo(W)||yq,J=E.image?[]:q;X=V[W]={vs:[],ns:[],uv:J,cs:J?q:E.color?q:[],bs:E.blend?[]:q,ps:[],rs:E.brightness?[]:q,ds:[],ms:E.instanced?[]:q,ics:J?q:E.color||!E.instanced?q:[]}}return X.invalidate=!0,k[D._id]={index:X.ds.length,begin:X.vs.length/3,batch:W},X.ds.push(D),X},Dg=function(v,o){return o!=q&&1!==o?[v[0]*o,v[1]*o,v[2]*o,v[3]]:v},Ph=function(X){var E=X.shapeModel;E||(E=Hf(X)),E&&(E._ctlineModel=[],E._lineModel=A)},Fg=function(){var b;return function(M,S){var $,X=M.data,T=X.s("wf.combineTriangle");if(!S&&(X instanceof x.Node&&!(X instanceof x.Shape)?(b||(b={vs:qf,is:he,uv:Ql}),S=b):S=[M.left,M.front,M.right,M.back,M.top,M.bottom],!S))return A;if(T){var Z=X.s("wf.normEpsilon");isNaN(Z)&&(Z=2),T=0|Math.min(3,Math.max(1,isNaN(T)?1:T)),$=Dm[T-1](S,M,180/(Math.PI*Z))}else $=Fo(S,M);return $}}(),Np=function(){return function(P,o,S){var W=P.getData3dUI(o),f=W.shapeModel;if(f||(f=Hf(W)),f||!W.shapeName){var k,b;if(S.geometry){if(W.wfGeometry?(b=W.wfMatrix,k=W.wfGeometry,W.wfGeometry=A):k=Fg(W,f),!k||0===k.length)return}else if(k=S.short?xf:pj,o.s("wf.boundingBox")){var K=W.getBoundingBox(!0);if(K){var C=(new We).scale(K.max.clone().sub(K.min)).setPosition(K.max.clone().add(K.min).divideScalar(2)).toArray();k=Hc([],C,k)}}var D,l,L,g=P.getBrightness(o),Q=o.s("bloom"),c=o.s("3d.reflectable"),r=qn(S.color||"white"),y=r[3]<1,p=Math.ceil(S.width)||1,u=o.s("3d.clipbox")?dn:o.s("3d.clipbox.mask"),t=o.s("wf.fog"),X=o.getRenderLayer(),_=P._40Q.get(X),G=_.wireframeIndexMap,V=_.wireframeModelMap,E=o.s("batch"),H=o.s("3d.clip.direction");if(H){if(l=o.s("3d.clip.percentage"),0===l)return;D="_"+o._id,L=W._formatClipUniforms(H,l,o)}else D=E?(y?"T":"O")+E:(y?"T":"O")+(Q?"_1":"_0")+(c?"1_":"0_")+u+"_"+p+(t?"1_":"0_");var m=V[D];m||(m=V[D]={vs:[],cs:[],ps:[],ds:[],T:y,B:Q,clipboxMask:u,reflectable:!!c,W:p,batch:E,fog:t}),m.invalidate=!0;var U=m.vs,q=m.cs,i=m.ds,O=G[o._id]={index:i.length,begin:U.length/3,batch:D};i.push(o);var I,F=b||W.mat;S.geometry&&o instanceof x.Shape&&(M.extractShapeTranslation||M.extractPolylineTranslation||M.extractVerticesTranslation)&&(I=W._vsTranslation)&&F&&(F=(new Mh.Matrix4).fromArray(F).multiply(I).toArray()),o instanceof x.Edge||!(!F||!S.geometry&&o instanceof x.Shape)||(F=bg(o,S.mat),o.appendAnchorMatrix3d(F)),L?(m.mat=li(F),m.clipDirection=L[0],m.clipPercent=L[1],Hc(U,null,k)):Hc(U,F,k);var T=O.size=U.length/3-O.begin;Ae(q,Dg(r,g),T)}}}(),Pc=function(c,r,j,T,o,H,D,h,n){var f=c.getBrightness(r);f==q&&(f=1);var y=Dg(qn(T),f),R=y[3]<1;H=Math.ceil(H)||1;var a=r.s("3d.clipbox")?dn:r.s("3d.clipbox.mask"),O=(R?"T":"O")+H+"_"+a;if(D){var b=D[0],M=(D[1]||b)+b;O+="-"+b+"-"+M,n&&(O+="-"+Ck(n)+"-"+f,n=Dg(qn(n),f))}var $=r.getRenderLayer(),N=c._40Q.get($),m=N.polylineIndexMap,E=N.polylineModelMap,p=E[O];p||(p=E[O]={vs:[],cs:[],ps:[],ds:[],ls:D?[]:q,T:R,clipboxMask:a,W:H},D&&(p.D=b,p.G=M,p.A=n)),p.invalidate=!0;var L,B=p.vs,s=p.cs,Q=p.ds,U=p.ls,k=m[r._id]={index:Q.length,begin:B.length/3,batch:O};Q.push(r);var W;!(W=c.getData3dUI(r).mat)&&r instanceof x.Polyline&&(W=bg(r),r.appendAnchorMatrix3d(W)),Hc(B,W,j);var G,Z=k.size=B.length/3-k.begin,e=j.length,_=0,u=[];if(D||o)for(L=0;e>L;L+=6)G=Hh([j[L],j[L+1],j[L+2]],[j[L+3],j[L+4],j[L+5]]),u.push(G),_+=G;if(_&&o){var C,d=Dg(qn(o),f),K=[d[0]-y[0],d[1]-y[1],d[2]-y[2],d[3]-y[3]],V=0;for(L=0;e>L;L+=6)C=V/_,Ae(s,[y[0]+K[0]*C,y[1]+K[1]*C,y[2]+K[2]*C,y[3]+K[3]*C],1),V+=u[L/6],C=V/_,Ae(s,[y[0]+K[0]*C,y[1]+K[1]*C,y[2]+K[2]*C,y[3]+K[3]*C],1)}else Ae(s,y,Z);if(D)for(V=h||0,L=0;e>L;L+=6)U.push(V),V+=u[L/6],U.push(V)},Nq=function(L,V,n){if(V){var l=n[V.batch],R=l.ps,r=l.ms&&l.ms.length,t=r?4*V.index:4*V.begin,S=r?1:V.size;if(R[t]!==L[0]||R[t+1]!==L[1]||R[t+2]!==L[2]||R[t+3]!==L[3]){for(var Z=0;S>Z;Z++)R[t++]=L[0],R[t++]=L[1],R[t++]=L[2],R[t++]=L[3];R._invalidateThisFrame=!0}}},pf=function(){var V=new x.Math.Vector3,N=new x.Math.Vector3;return function(_,X){var Q=X+["32"],C=_[X],t=_[Q];if(C){if((M.extractBatchTranslation||M.extractVerticesTranslation)&&"vs"===X){N.set(0,0,0);for(var f=C.length,Z=0;f>Z;Z+=3)N.add(V.fromArray(C,Z));N.divideScalar(f/3);for(var O=N.x,k=N.y,e=N.z,F=new Array(f),Z=0;f>Z;Z+=3)F[Z]=C[Z]-O,F[Z+1]=C[Z+1]-k,F[Z+2]=C[Z+2]-e;C=F,_.translate=[O,k,e]}t&&t.length===C.length?(t.set(C),t._bufId=null):_[Q]=new yk(C)}else delete _[Q]}}(),hn=function(h,N,d,J,H,c,U,m){var $=N instanceof x.Shape,I=c[0],v=c.length;if(v>1){I=li(I);for(var j=1;v>j;j++)ds(I,I,c[j])}if($){var s=N.p3();Um(I,s)}Te(U.ms,I);var S;if(U.ics&&(S=N.s("shape3d.color"))&&Ae(U.ics,S,1),!U.vs.length){var E=li(Sb);$&&Um(E,qj(s)),$n(h,N,d,J,H,[E],U,m)}},$n=function(n,j,i,P,x,T,C,G){if(bj(i))i.forEach(function(f){$n(n,j,f,P,x,T,C,G)});else if(ro(i))$n(n,j,Hf(P,i),P,x,T,C,G);else if(fg(i)){var d,L=gl(i.mat,j,n),v=gl(i.s3,j,n),D=gl(i.t3,j,n),B=gl(i.r3,j,n);if((v||B||D||L)&&(d=vl(L,v,B,gl(i.rotationMode,j,n),D),T.push(d)),i.shape3d)$n(n,j,i.shape3d,P,x,T,C,i);else{var k=P.s;G=G||yq;var X=T[0],r=T.length,J=k("shape3d.color",i.color,G.color);if(x||(x=k("shape3d.blend",i.blend,G.blend)),r>1){X=li(X);for(var Q=1;r>Q;Q++)ds(X,X,T[Q])}var V=X?jn(X):q;i.vs&&k(Zr,i.visible,G.visible)&&ie(X,C,i.vs,i.uv,i.is,i.ns,V,x,J),i.top_vs&&k(Cf,i.topVisible,G.topVisible)&&ie(X,C,i.top_vs,i.top_uv,i.top_is,i.top_ns,V,x,k("shape3d.top.color",i.topColor,G.topColor)||J),i.bottom_vs&&k(ao,i.bottomVisible,G.bottomVisible)&&ie(X,C,i.bottom_vs,i.bottom_uv,i.bottom_is,i.bottom_ns,V,x,k("shape3d.bottom.color",i.bottomColor,G.bottomColor)||J),i.from_vs&&k(xk,i.fromVisible,G.fromVisible)&&ie(X,C,i.from_vs,i.from_uv,i.from_is,i.from_ns,V,x,k("shape3d.from.color",i.fromColor,G.fromColor)||J),i.to_vs&&k(yc,i.toVisible,G.toVisible)&&ie(X,C,i.to_vs,i.to_uv,i.to_is,i.to_ns,V,x,k("shape3d.to.color",i.toColor,G.toColor)||J)}d&&T.pop()}},ie=function(j,m,k,p,X,h,l,q,F){var M,T=m.cs,H=m.uv,S=m.bs,g=m.ns,t=m.vs;if(h&&0!==h.length||(h=am(k,X)),X){M=X.length;for(var n=0;M>n;n++){var J=X[n],W=3*J;Hc(t,j,[k[W],k[W+1],k[W+2]]),Hc(g,l,[h[W],h[W+1],h[W+2]]),H&&Te(H,[p[2*J],p[2*J+1]])}}else M=k.length/3,Hc(t,j,k),Hc(g,l,h),H&&Te(H,p);T&&Ae(T,F,M),S&&(q?qk(S,q,M):Te(S,Kc,M))},gr=function(K,F,A){var R=K.data.p3();if(F=li(F),Um(F,R),Te(A.ms,F),!A.vs.length){var I=li(Sb);Um(I,qj(R)),Gn(K,I,A)}},Gn=function(N,l,A){os(N,wk,l,A),os(N,Bj,l,A),os(N,Ao,l,A),os(N,ki,l,A),os(N,vg,l,A),os(N,rj,l,A),os(N,"csg",l,A)},Kq=function(F,O,x,u,Y,p){Te(x.ms,Y);var D;x.ics&&(D=O.s("all.color"))&&Ae(x.ics,D,1),x.vs.length||xn(F,O,x,u,li(Sb),p)},xn=function(Z,j,e,R,Q,$){Mc(Z,j,e,R,Q,$,wk,wg),Mc(Z,j,e,R,Q,$,Bj,xq),Mc(Z,j,e,R,Q,$,vg,Ug),Mc(Z,j,e,R,Q,$,rj,dj),Mc(Z,j,e,R,Q,$,Ao,Td),Mc(Z,j,e,R,Q,$,ki,Be)},Ag=function(x,o,f,Z,I){Z?I.instanced?x.gv.batchInstancedModel(x.data,Z,x,x.getBodyColor(),[o],f):$n(x.gv,x.data,Z,x,x.getBodyColor(),[o],f):I.instanced?x.gv.batchInstancedShapeFace(x,o,f):Gn(x,o,f)},os=function(t,E,i,s){var n=t[E];if(n){var O=n.tuv;if(O){var N=n.uvScale,r=n.uvOffset,a=n.uvRotation,m=n.uvAnchor;if(N||r||a){var M,S,L,F=ps(a,r,N,m),G=F.a,X=F.b,Y=F.c,V=F.d,$=F.tx,l=F.ty,j=O.length;for(L=0;j>L;L+=2)M=O[L],S=O[L+1],O[L]=G*M+Y*S+$,O[L+1]=X*M+V*S+l}}ie(i,s,n.vs,O,q,q,i?jn(i):q,n.blend,n.color)}},Mc=function(k,o,Z,p,b,M,T,G){var V,K=Z.cs,c=Z.uv,m=Z.bs,H=Z.vs,U=Z.ns,B=am(G);if(k.getFaceVisible(o,T)){var w=k.getFaceMat(o,T);if(w&&(b=bg(o,w),M=jn(b)),Hc(H,b,G),Hc(U,M,B),K&&Ae(K,k.getFaceColor(o,T),6),c){var q=k.getFaceUv(o,T)||p[T+"Uv"],i=k.getFaceUvScale(o,T)||p[T+"UvScale"],x=k.getFaceUvOffset(o,T)||p[T+"UvOffset"],E=k.getFaceUvRotation(o,T)||p[T+"UvRotation"],h=k.getFaceUvAnchor(o,T)||p[T+"UvAnchor"];q=q?[q[6],q[7],q[0],q[1],q[2],q[3],q[2],q[3],q[4],q[5],q[6],q[7]]:$j;var R=q[0],N=q[1],X=q[2],J=q[3],j=q[4],O=q[5],l=q[6],Q=q[7],S=q[8],Y=q[9],I=q[10],t=q[11];if(i||x||E||h){var L=ps(E,x,i,h),y=L.a,W=L.b,d=L.c,A=L.d,z=L.tx,C=L.ty;R=y*R+d*N+z,N=W*R+A*N+C,X=y*X+d*J+z,J=W*X+A*J+C,j=y*j+d*O+z,O=W*j+A*O+C,l=y*l+d*Q+z,Q=W*l+A*Q+C,S=y*S+d*Y+z,Y=W*S+A*Y+C,I=y*I+d*t+z,t=W*I+A*t+C}c.push(R,N,X,J,j,O,l,Q,S,Y,I,t)}m&&(V=k.getBodyColor(o)||k.getFaceBlend(o,T),V?qk(m,V,6):Te(m,Kc,6))}},kp=function(_,z,l,o){var l=_._picking?_.pickColorMap:null,P=_.getGL(),d=_._prg,Q=_._buffer;if(!Er(z)){Gq(_,Sb),Ad(P);var R,F,Y,H;for(var v in z){var n,b,C,N,e=z[v];if(e.batch){var k=_.getBatchInfo(e.batch)||yq;n=k.wfBloom===A?k.bloom:k.wfBloom,b=k.wfReflectable===A?k.reflectable:k.wfReflectable,C=k.wfClipboxMask===A?k.clipboxMask:k.wfClipboxMask,N=k.width}else n=e.B,b=e.reflectable,C=e.clipboxMask,N=e.W;if(!(o&&!e.T||!o&&e.T||_.isReflecting(P)&&b===!1)){e.invalidate?(e.invalidate=!1,pf(e,"vs"),pf(e,"cs"),pf(e,"ls"),pf(e,"ps")):l&&e.ps&&e.ps._invalidateThisFrame&&(e.ps._invalidateThisFrame=!1,pf(e,"ps")),R=e.translate,F=e.clipDirection,R||F?(Y=F?li(e.mat):[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],R&&Um(Y,R),H=li(_._6O),Gq(_,Y)):Y=null;var M=e.vs32,s=l?e.ps32:e.cs32;Iq(P,d,N,q,Q.vs,M);var G=Jq.for(P),a=G.directUniforms(),r=G.directAttribs(),D=e.D,W=!_._dashDisabled&&D;a.uAlphaTest=T.alphaTest,P._blooming&&!n&&(a.blackout=!0),F&&(a.uClipPercent=e.clipPercent,a.uClipDirection=F),fj(_,a,C===A?Xe:C),W&&(a.uDash=!0,a.uDashDistance=D,a.uDashGapDistance=e.G,a.uDiffuse=e.A||T["color.empty"],r.aLineDistance=Id(P,Q.lineDistance,e.ls32,q,1));var O=!_._batchColorDisabled;O&&s.length?(a.uBatchColor=!0,r.aBatchColor=Id(P,Q.batchColor,s,q,4)):(a.uBatchColor=!1,r.aBatchColor=!1);var u=e.fog!==!1;u||(a.uFog=!1),Dj(P),nf(P,0,M.length/3,P.LINES),gg(P),u||(a.uFog=!0),O&&(a.uBatchColor=!1,r.aBatchColor=!1),W&&(a.uDash=!1,r.aLineDistance=!1),P._blooming&&!n&&(a.blackout=!1),Y&&(F&&(a.uClipDirection=0),Kh(_,H),a.uMMatrix=Gl)}}pl(P),Kh(_)}},kk=function(E){E.invalidate=!1,pf(E,"vs"),pf(E,"ns"),pf(E,"cs"),pf(E,"rs"),pf(E,"ps"),pf(E,"bs"),pf(E,"uv"),pf(E,"ms"),pf(E,"ics")},yh=function(p,C,E,I,x){var k,N,J,V,B,w,Q,t,F,R,D,S,m,E=p._picking?p.pickColorMap:null,v=p.getGL(),$=p._prg,l=Jq.for(v),i=l.directUniforms(),G=l.directAttribs(),K=p._buffer;if(!Er(C)){var g,Y,M=p._flowObjects.length?p.flowMap:null,U=p.drawFilter;Gq(p,Sb);for(N in C)if(J=p.getBatchInfo(N)||yq,J.visible!==!1&&!(I&&!J.transparent||!I&&J.transparent||p.isReflecting(v)&&J.reflectable===!1)){var o=J.renderLayerMask;if(o==q&&(o=Kg),x==q&&(x=Kg),Cn(x,o)&&(V=C[N],E||!J.transparentMask)){if(U){if(J.highlight!==!0)continue;if(g=V.ds){Y=!1;for(var X=0,e=g.length;e>X;X++)if(!U(g[X])){Y=!0;break}if(!Y)continue}}var n=I&&J.autoSort===!0&&(p._33Q||V.invalidate);V.invalidate?kk(V):E&&V.ps&&V.ps._invalidateThisFrame&&(V.ps._invalidateThisFrame=!1,pf(V,"ps"));var L=V.ms32,H=L&&L.length;if(w=V.vs32,Q=E?V.ps32:H?V.ics32:V.cs32,R=V.uv32,t=V.bs32,F=V.rs32,S=w.length/3,n){var c=mk(w,p.getEye(),p);c?(V.is=c.is,V.elementTypeUint=c.useUint32):(V.is=null,V.elementTypeUint=null)}if(S){m=V.translate,m&&Gq(p,[1,0,0,0,0,1,0,0,0,0,1,0,m[0],m[1],m[2],1]),B=J.light,D=p.getTexture(J.image),ng(v,$,q,J.light,J.opacity,J.reverseFlip,J.reverseColor,J.reverseCull),k=J.polygonOffset,k&&Db(v,k),Q?p._batchColorDisabled?(i.uBatchColor=!1,G.aBatchColor=!1):(i.uBatchColor=!0,G.aBatchColor=H?Bp(v,K.instancedBatchColor,Q,q,4):Id(v,K.batchColor,Q,q,4)):(i.uBatchColor=!1,i.uDiffuse=J.color||T["color.empty"]);var O=J.alphaTest;i.uAlphaTest=O===A?T.alphaTest:O,i.shadowReceive=!E&&J.shadowReceive!==!1,fj(p,i,J.clipboxMask===A?Xe:J.clipboxMask),Oh(p,i,J.lightMask===A?Xe:J.lightMask,J.headlightAmbientIntensity),M&&M.resetFlowUniform(J.effectFlowMask===A?Xe:J.effectFlowMask,i),v._blooming&&!J.bloom&&(i.blackout=!0),J.envmap!==A?(i.uUseEnvMap=!0,i.uReflectivity=J.envmap,i.roughness=J.roughness||0,p._setEnvmapByProbeId(i,J.envmapProbe||0)):(i.uUseEnvMap=!1,i.uReflectivity=0);var r=t&&!p._batchBlendDisabled;r&&(i.uBatchBlend=!0,G.aBatchBlend=Id(v,K.batchBlend,t,q));var h=F&&!p._batchBrightnessDisabled;h&&(i.uBatchBrightness=!0,G.aBatchBrightness=Id(v,K.batchBrightness,F,q,1)),R?Dj(v,$,D,J.discardSelectable,K.uv,R,J.uvOffset,J.uvScale,J.uvRotation,J.uvAnchor):Dj(v),G.aPosition=Id(v,K.vs,w,q),G.aNormal=Id(v,K.ns,V.ns32,q),H&&(i.uUseInstance=!0,G.aMatrixInstanced=Bp(v,K.ms,L,q)),V.is?(ql(v,K.is,V.is),ei(v,0,S,null,V.elementTypeUint?v.UNSIGNED_INT:null,null,H?V.ms32.length/16:0)):nf(v,0,S,null,H?V.ms32.length/16:0),R?gg(v,$,D):gg(v),Q&&!p._batchColorDisabled&&(i.uBatchColor=!1,G.aBatchColor=!1),r&&(i.uBatchBlend=!1,G.aBatchBlend=!1),h&&(i.uBatchBrightness=!1,G.aBatchBrightness=!1),v._blooming&&!J.bloom&&(i.blackout=!1),H&&(i.uUseInstance=!1,G.aMatrixInstanced=A),k&&mq(v),Wi(v,$),m&&(Kh(p),i.uMMatrix=Gl)}}}Kh(p)}},mk=function(X,S,h){var r=X.length/3,A=r>65535,K=h._glCapabilities.elementTypeUint&&A;if(!K&&A)return null;for(var B=new Array(r),R=r/3,y=new Array(R),q=0;R>q;q++)y[q]=q;y.sort(function(p,w){var Q=9*p,H=[(X[Q]+X[Q+3]+2*X[Q+6])/4,(X[Q+1]+X[Q+4]+2*X[Q+7])/4,(X[Q+2]+X[Q+5]+2*X[Q+8])/4];Q=9*w;var B=[(X[Q]+X[Q+3]+2*X[Q+6])/4,(X[Q+1]+X[Q+4]+2*X[Q+7])/4,(X[Q+2]+X[Q+5]+2*X[Q+8])/4],q=Hh(S,H)-Hh(S,B);return q>0?-1:0>q?1:0});for(var q=0;R>q;q++){var C=3*q,D=3*y[q];B[C]=D,B[C+1]=D+1,B[C+2]=D+2}return{useUint32:K,is:K?new Uint32Array(B):new gb(B)}},wm={obj:function(h,O){var t={mat:h.mat,s3:h.s3,r3:h.r3,rotationMode:h.rotationMode,t3:h.t3,cube:h.cube==q?!0:h.cube,center:h.center==q?!0:h.center,ignoreMtls:h.ignoreMtls,ignoreTransparent:h.ignoreTransparent,ignoreColor:h.ignoreColor,ignoreImage:h.ignoreImage,ignoreNormal:h.ignoreNormal,prefix:h.prefix,flipY:h.flipY,flipFace:h.flipFace,reverseFlipMtls:h.reverseFlipMtls,finishFunc:function(n,f){if(n){var f=[];for(var i in n){var M=n[i];f.rawS3=M.rawS3,M.center&&(f.center=M.center),f.push(M),h.eachModel&&h.eachModel(i,M)}f.json=h,O(f)}else O()}};M.loadObj(h.obj,h.mtl,t)},bin:function(D,l){var O={finishFunc:function(_){_?l(_):l()}};M.loadBin(D.url,O)}};M.getModelTypeHandlers=function(){return wm},M.setModelTypeHandler=function(O,N){wm[O]=N},M.getModelTypeHandler=function(m){return wm[m]},M.handleModelLoaded=function(){},M.handleUnfoundModel=function(){};var Rl=q,Jd=q,gm=function(l){Rl&&!l._loadingModelView_&&(Jd||(Jd={}),Jd[l._loadingModelView_=Fq()]=l)},no=function(z,a){Rl||(Rl={});var j=Rl[z];if(j){if(j.url===a)return;j.request.onload=pr,j.request.onerror=pr}if(a.indexOf(".bin")===a.length-4)return Yd(z,{modelType:"bin",url:a},a);if(a=M.beforeLoadURL(a),a.data){var N=M.parse(a.data);Yd(z,N,a)}else{var D=new Gd;Rl[z]={request:D,url:a},D.onload=function(){if(200===this.status||0===this.status){delete Rl[z];var U=M.parse(D.getResponseText());Yd(z,U,a)}else lc(z,M.handleUnfoundModel(z,a)||q)},D.onerror=function(){lc(z,M.handleUnfoundModel(z,a)||q)};var k={};k.url=encodeURI(a),k.sync=!1,D.send(k)}},Yd=function(I,c,w){var p=c.modelType;if(!p)return lc(I,c),M.handleModelLoaded(I,c),void 0;var X=M.getModelTypeHandler(p);if(X){if(Rl||(Rl={}),Rl[I])return;Rl[I]=!0;var A=function(E){E?(lc(I,E),M.handleModelLoaded(I,E)):lc(I,M.handleUnfoundModel(I,w,c)||q)};X(c,A)}else lc(I,M.handleUnfoundModel(I,w,c)||q)},lc=function(t,b){if(delete Rl[t],ro(b)&&dk.test(b))return no(t,b),void 0;if(rf[t]=b,Er(Rl)&&(Rl=q,Jd)){for(var y in Jd){var Y=Jd[y];Y.invalidateAll&&Y.invalidateAll(A,"modelLoaded",t),Y.redraw&&Y.redraw(),Y.iv(),delete Y._loadingModelView_}Jd=q}if(b&&Jd)for(var y in Jd){var Y=Jd[y];Y.invalidateAll&&Y.invalidateAll(A,"modelLoading",t),Y.redraw&&Y.redraw(),Y.iv()}},oq=new yk([0,0,0,1,1,1,1,0]),Zp=new yk([0,0,1,0,0,1,0,0,1,0,0,1]),vd=new gb([0,1,2,2,3,0]),qf=new yk([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),he=new gb([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Ql=new yk([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),er=am(qf,he),sr=(new yk([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new gb([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[wk,Ao,Bj,ki,vg,rj]),pj=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],xf=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],Sc=function(s,S,R,D,M,I,L){I=I||16,s=s||16,S=S||0,R=R||s;var r,k,T,l,j,q,W,b,a,P=.5,w=[],v=[],F=c/s,B=Y/I;for(r=0;I>r;r++)for(q=r+1,l=r*B,a=q*B,k=S;R>k;k++)W=k+1,T=k*F,b=W*F,w.push(P*o(l)*O(T),P*O(l),-P*o(l)*o(T),P*o(a)*O(b),P*O(a),-P*o(a)*o(b),P*o(l)*O(b),P*O(l),-P*o(l)*o(b),P*o(l)*O(T),P*O(l),-P*o(l)*o(T),P*o(a)*O(T),P*O(a),-P*o(a)*o(T),P*o(a)*O(b),P*O(a),-P*o(a)*o(b)),v.push(k/s,r/I,W/s,q/I,W/s,r/I,k/s,r/I,k/s,q/I,W/s,q/I);if(L){var n=[];for(r=0,j=w.length;j>r;r+=3)n.push(2*w[r],2*w[r+1],2*w[r+2])}if(D){var K=[],A=[];for(T=S*F,r=0;I>r;r++)q=r+1,l=r*B,a=q*B,K.push(0,0,0,P*o(a)*O(T),P*O(a),-P*o(a)*o(T),P*o(l)*O(T),P*O(l),-P*o(l)*o(T)),A.push(0,.5,S/s,q/I,S/s,r/I)}if(M){var d=[],i=[];for(T=R*F,r=0;I>r;r++)q=r+1,l=r*B,a=q*B,d.push(0,0,0,P*o(l)*O(T),P*O(l),-P*o(l)*o(T),P*o(a)*O(T),P*O(a),-P*o(a)*o(T)),i.push(1,.5,R/s,r/I,R/s,q/I)}var Z={vs:w,uv:v,from_vs:K,from_uv:A,to_vs:d,to_uv:i};return L&&(Z.ns=n),Z},Bn=function(g,z,D){g=g||.17,z=z||12,D=D||18,0>g?g=0:g>.25&&(g=.25);var T,R,E,f,V,K,t,r=.5,u=[],B=[],j=[],L=c/D,M=c/z,l=r-g;for(R=0;z>=R;R++)for(f=-Y+R*M,K=O(f),V=o(f),T=0;D>=T;T++)E=T*L,t=l+g*K,u.push(O(E)*t,V*g,-o(E)*t),B.push(T/D,1-R/z);for(R=0;z>R;R++){var S=R*(D+1),W=(R+1)*(D+1);for(T=0;D>T;T++)j.push(S+T,W+T+1,W+T,S+T,S+T+1,W+T+1)}return{vs:u,uv:B,is:j}},je=function(_,i,q,P,N,a,Z,y){Z=Z||12,_=_||18,i=i||0,q=q||_,a=a||.17,0>a?a=0:a>.25&&(a=.25);var k,T,f,L,d,U,V,t,X,R,l=.5,x=[],w=[],j=c/_,Q=c/Z,h=l-a,e=y?[]:A;for(f=0;Z>f;f++)for(L=f+1,V=-Y+f*Q,t=-Y+L*Q,k=i;q>k;k++)T=k+1,d=k*j,U=T*j,X=h+a*O(V),R=h+a*O(t),x.push(O(d)*X,o(V)*a,-o(d)*X,O(U)*X,o(V)*a,-o(U)*X,O(U)*R,o(t)*a,-o(U)*R,O(d)*X,o(V)*a,-o(d)*X,O(U)*R,o(t)*a,-o(U)*R,O(d)*R,o(t)*a,-o(d)*R),w.push(k/_,1-f/Z,T/_,1-f/Z,T/_,1-L/Z,k/_,1-f/Z,T/_,1-L/Z,k/_,1-L/Z),y&&e.push(O(d)*O(V),o(V),-o(d)*O(V),O(U)*O(V),o(V),-o(U)*O(V),O(U)*O(t),o(t),-o(U)*O(t),O(d)*O(V),o(V),-o(d)*O(V),O(U)*O(t),o(t),-o(U)*O(t),O(d)*O(t),o(t),-o(d)*O(t));if(P){var r=[],K=[];for(f=0;Z>f;f++)L=f+1,V=-Y+f*Q,t=-Y+L*Q,d=i*j,X=h+a*O(V),R=h+a*O(t),r.push(O(d)*X,o(V)*a,-o(d)*X,O(d)*R,o(t)*a,-o(d)*R,O(d)*h,0,-o(d)*h),K.push(.5+.5*O(V),.5-.5*o(V),.5+.5*O(t),.5-.5*o(t),.5,.5)}if(N){var G=[],D=[];for(f=0;Z>f;f++)L=f+1,V=-Y+f*Q,t=-Y+L*Q,d=q*j,X=h+a*O(V),R=h+a*O(t),G.push(O(d)*X,o(V)*a,-o(d)*X,O(d)*h,0,-o(d)*h,O(d)*R,o(t)*a,-o(d)*R),D.push(.5-.5*O(V),.5-.5*o(V),.5,.5,.5-.5*O(t),.5-.5*o(t))}var S={vs:x,uv:w,from_vs:r,from_uv:K,to_vs:G,to_uv:D};return y&&(S.ns=e),S},ui=function(g,l){for(var $,C,d,a,A,x=.5,w=16,G=[],z=[],T=[],_=[],D=c/w,B=0;w>=B;B++)$=B*D,C=O($),a=C*x,d=o($),A=d*x,G.push(a,-x,A,a,x,A),T.push(C,0,d,C,0,d),z.push(1-B/w,1,1-B/w,0);for(B=0;w>B;B++)_.push(2*B,2*B+1,2*B+3,2*B,2*B+3,2*B+2);if(l){var u=[],Z=[],f=[];for(u.push(0,-x,0),Z.push(.5,.5),B=0;w>=B;B++)$=B*D,C=O($),d=o($),u.push(C*x,-x,-d*x),Z.push(.5+.5*C,.5+.5*d);for(B=0;w>B;B++)f.push(0,B+2,B+1)}if(g){var h=[],L=[],Y=[];for(h.push(0,x,0),L.push(.5,.5),B=0;w>=B;B++)$=B*D,C=O($),d=o($),h.push(C*x,x,-d*x),L.push(.5+.5*C,.5-.5*d);for(B=0;w>B;B++)Y.push(0,B+1,B+2)}return{vs:G,uv:z,is:_,ns:T,bottom_vs:u,bottom_uv:Z,bottom_is:f,top_vs:h,top_uv:L,top_is:Y}},Jj=function(M,p,z,V,S,n,y,T){M=M||12,p=p||0,z=z||M;for(var Z,j,J,U,r,H,h,$,g,W=.5,K=[],w=[],e=c/M,E=p;z>E;E++)Z=E+1,j=E*e,J=Z*e,U=O(j)*W,r=o(j)*W,H=O(J)*W,h=o(J)*W,K.push(U,-W,-r,H,-W,-h,U,W,-r,H,-W,-h,H,W,-h,U,W,-r),w.push(E/M,1,Z/M,1,E/M,0,Z/M,1,Z/M,0,E/M,0);if(T){var q=[];for(E=0,g=K.length;g>E;E+=3)q.push(2*K[E],0,2*K[E+2])}if(y){var d=[],P=[];for(E=p;z>E;E++)j=e*E,J=e*(E+1),U=O(j),r=o(j),H=O(J),h=o(J),d.push(U*W,-W,-r*W,0,-W,0,H*W,-W,-h*W),P.push(.5+.5*U,.5+.5*r,.5,.5,.5+.5*H,.5+.5*h)}if(n){var a=[],i=[];for(E=p;z>E;E++)j=e*E,J=e*(E+1),U=O(j),r=o(j),H=O(J),h=o(J),a.push(U*W,W,-r*W,H*W,W,-h*W,0,W,0),i.push(.5+.5*U,.5-.5*r,.5+.5*H,.5-.5*h,.5,.5)}if(V){var L=[],C=[];j=e*p,U=O(j)*W,r=o(j)*W,$=p/M,L.push(0,W,0,0,-W,0,U,-W,-r,U,-W,-r,U,W,-r,0,W,0),C.push(0,0,0,1,$,1,$,1,$,0,0,0)}if(S){var f=[],D=[];j=e*z,U=O(j)*W,r=o(j)*W,$=z/M,f.push(0,-W,0,0,W,0,U,W,-r,U,W,-r,U,-W,-r,0,-W,0),D.push(1,1,1,0,$,0,$,0,$,1,1,1)}var v={vs:K,uv:w,bottom_vs:d,bottom_uv:P,top_vs:a,top_uv:i,from_vs:L,from_uv:C,to_vs:f,to_uv:D};return T&&(v.ns=q),v},Fr=function(S,z,x,H,b){z=z||18,x=x||0,H=H==q?c:H,b=b==q?.5:b;for(var F,X,m,r,J,t,y=[0,.5,.75,.875,.9375],n=[],R=[],U=[],Q=H/z,_=0;_<y.length;_++){var Z=0===_%2?0:.5;for(F=0;z>=F;F++)X=(F+Z)*Q+x,m=1-y[_],n.push(O(X)*b*m,-b+2*y[_]*b,-o(X)*b*m),R.push((F+Z)/z,m)}for(_=0;_<y.length-1;_++){var V=_*(z+1),i=(_+1)*(z+1);for(F=0;z>F;F++)U.push(V+F,i+F+1,i+F,V+F,V+F+1,i+F+1)}for(t=n.length/3-(z+1),F=0;z>F;F++)n.push(0,b,0),R.push((F+.5)/z,0);for(F=0;z>F;F++)U.push(t+F,t+F+1,t+(z+1)+F);if(S){var Y=[],k=[],f=[];for(Y.push(0,-b,0),k.push(.5,.5),F=0;z>=F;F++)X=F*Q+x,r=O(X),J=o(X),Y.push(r*b,-b,-J*b),k.push(.5+.5*r,.5+.5*J);for(F=0;z>F;F++)f.push(0,F+2,F+1)}return{vs:n,uv:R,is:U,bottom_vs:Y,bottom_uv:k,bottom_is:f}},$c=function(B,l,S,v,w,V,e,G){B=B||16,l=l||0,S=S||B,e=e||1;var H,z,N,Q,E,q,f,I=.5,Y=[],D=[],p=c/B,n=l,u=1/e,z=new ah,N=new ah,t=new ah,T=new ah,K=new ah,d=new ah,j=new ah;for(G&&(H=[],E=new ah,q=new ah,f=new ah);S>n;n++){var M=n+1,_=p*n,x=p*M;for(z.set(O(_)*I,-I,-o(_)*I),N.set(O(x)*I,-I,-o(x)*I),t.set(0,I,0),G&&(E.set(O(_),.5,-o(_)).normalize(),q.set(O(x),.5,-o(x)).normalize(),f.copy(E).add(q).normalize()),T.lerpVectors(t,z,u),K.lerpVectors(t,N,u),Y.push(T.x,T.y,T.z,K.x,K.y,K.z,t.x,t.y,t.z),D.push(n/B,u,M/B,u,(n+M)/2/B,0),G&&H.push(E.x,E.y,E.z,q.x,q.y,q.z,f.x,f.y,f.z),Q=1;e>Q;Q++)T.lerpVectors(t,z,u*(Q+1)),K.lerpVectors(t,N,u*(Q+1)),d.lerpVectors(t,z,u*Q),j.lerpVectors(t,N,u*Q),Y.push(T.x,T.y,T.z,K.x,K.y,K.z,d.x,d.y,d.z,d.x,d.y,d.z,K.x,K.y,K.z,j.x,j.y,j.z),D.push(n/B,u*(Q+1),M/B,u*(Q+1),n/B,u*Q,n/B,u*Q,M/B,u*(Q+1),M/B,u*Q),G&&H.push(E.x,E.y,E.z,q.x,q.y,q.z,E.x,E.y,E.z,E.x,E.y,E.z,q.x,q.y,q.z,q.x,q.y,q.z)}if(V){var r=[],F=[];for(n=l;S>n;n++){_=p*n,x=p*(n+1);var A=O(_),i=o(_),g=O(x),C=o(x);r.push(A*I,-I,-i*I,0,-I,0,g*I,-I,-C*I),F.push(.5+.5*A,.5+.5*i,.5,.5,.5+.5*g,.5+.5*C)}}if(v){var b=[],L=[];_=p*l,b.push(0,I,0,0,-I,0,O(_)*I,-I,-o(_)*I),L.push(0,0,0,1,l/B,1)}if(w){var m=[],Z=[];_=p*S,m.push(0,-I,0,0,I,0,O(_)*I,-I,-o(_)*I),Z.push(1,1,1,0,S/B,1)}var y={vs:Y,uv:D,bottom_vs:r,bottom_uv:F,from_vs:b,from_uv:L,to_vs:m,to_uv:Z};return G&&(y.ns=H),y},uh=function(N,a,i,w,Y,$,g,q){for(var G=[],X=0;X<N.length-1;X+=2)G.push({x:N[X],y:N[X+1]});return Dn(G,a,i,w,Y,$,g,q,!1)},Mn={roundRect:function(l,C){return uh([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],l,C,3)},star:function(H,J){return uh([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],H,J)},rect:function(Z,o){return uh([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],Z,o)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(B,Q){return uh([0,-.5,.5,.5,-.5,.5],[1,2,2,5],B,Q)},rightTriangle:function(T,P){return uh([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],T,P)},parallelogram:function(U,K){return uh([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],U,K)},trapezoid:function(y,U){return uh([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],y,U)}},Eq={sphere:1,cylinder:1,cone:1,torus:1},ug={torus:1,sphere:1,cone:1},Fl=zb(Wr(Mn),{cylinder:1}),Zd=zb(Wr(Mn),{cylinder:1,cone:1}),Zo=function(T,o,B){var f,u=gl(T.anchor3d,B,o),$=gl(T.mat,B,o),s=gl(T.s3,B,o),w=gl(T.t3,B,o),r=gl(T.r3,B,o),b=s||r||w||$;if(u||b){f=li(o._6O);var C=b?vl($,s,r,gl(T.rotationMode,B,o),w):Sj();u&&Um(C,[.5-u[0],.5-u[1],.5-u[2]]),Gq(o,C)}return f},Hp=function($,S,Y,n,w,F,b){if(bj(Y))Y.forEach(function(m){Hp($,S,m,n,w,F,b)});else if(ro(Y))Hp($,S,Hf(n,Y),n,w,F,b);else if(fg(Y))if(Y.shape3d){var g=Zo(Y,$,S);Hp($,S,Y.shape3d,n,w,F,Y),g&&Kh($,g)}else ze($,S,Y,n.s,w,F,b)},ze=function(P,V,N,x,p,y,g){if(g=g||yq,!y||y(x("shape3d.transparent",N.transparent,g.transparent))){var $=Zo(N,P,V);if(Mk(N)){var o=P.getData3dUI(V);o.dispatchBoundingBoxChanged()}var C=P._26I,f=P._prg,F=P._buffer,A=x("shape3d.color",N.color,g.color);p||(p=x("shape3d.blend",N.blend,g.blend));var G,D=N.opacity==q?g.opacity:N.opacity,E=x("shape3d.opacity");G=E!=q&&D!=q?D*E:D!=q?D:E,ng(C,f,p,x("shape3d.light",N.light,g.light),G,x("shape3d.reverse.flip",N.reverseFlip,g.reverseFlip),x("shape3d.reverse.color",N.reverseColor,g.reverseColor),x("shape3d.reverse.cull",N.reverseCull,g.reverseCull));var z=x("polygonOffset",N.polygonOffset,g.polygonOffset);N.vs&&x(Zr,N.visible,g.visible)&&Ip(C,f,F,A,P.getTexture(x("shape3d.image",N.image,g.image),V),x("shape3d.discard.selectable",N.discardSelectable,g.discardSelectable),N.vs,N.uv,N.ns,N.is,x("shape3d.uv.offset",N.uvOffset,g.uvOffset),x("shape3d.uv.scale",N.uvScale,g.uvScale),x("shape3d.uv.rotation",N.uvRotation,g.uvRotation),x("shape3d.uv.anchor",N.uvAnchor,g.uvAnchor),z),N.top_vs&&x(Cf,N.topVisible,g.topVisible)&&Ip(C,f,F,x("shape3d.top.color",N.topColor,g.topColor)||A,P.getTexture(x("shape3d.top.image",N.topImage,g.topImage),V,"top"),x("shape3d.top.discard.selectable",N.topDiscardSelectable,g.topDiscardSelectable),N.top_vs,N.top_uv,N.top_ns,N.top_is,x("shape3d.top.uv.offset",N.topUvOffset,g.topUvOffset),x("shape3d.top.uv.scale",N.topUvScale,g.topUvScale),x("shape3d.top.uv.rotation",N.topUvRotation,g.topUvRotation),x("shape3d.top.uv.anchor",N.topUvAnchor,g.topUvAnchor),z),N.bottom_vs&&x(ao,N.bottomVisible,g.bottomVisible)&&Ip(C,f,F,x("shape3d.bottom.color",N.bottomColor,g.bottomColor)||A,P.getTexture(x("shape3d.bottom.image",N.bottomImage,g.bottomImage),V,"bottom"),x("shape3d.bottom.discard.selectable",N.bottomDiscardSelectable,g.bottomDiscardSelectable),N.bottom_vs,N.bottom_uv,N.bottom_ns,N.bottom_is,x("shape3d.bottom.uv.offset",N.bottomUvOffset,g.bottomUvOffset),x("shape3d.bottom.uv.scale",N.bottomUvScale,g.bottomUvScale),x("shape3d.bottom.uv.rotation",N.bottomUvRotation,g.bottomUvRotation),x("shape3d.bottom.uv.anchor",N.bottomUvAnchor,g.bottomUvAnchor),z),N.from_vs&&x(xk,N.fromVisible,g.fromVisible)&&Ip(C,f,F,x("shape3d.from.color",N.fromColor,g.fromColor)||A,P.getTexture(x("shape3d.from.image",N.fromImage,g.fromImage),V,"from"),x("shape3d.from.discard.selectable",N.fromDiscardSelectable,g.fromDiscardSelectable),N.from_vs,N.from_uv,N.from_ns,N.from_is,x("shape3d.from.uv.offset",N.fromUvOffset,g.fromUvOffset),x("shape3d.from.uv.scale",N.fromUvScale,g.fromUvScale),x("shape3d.from.uv.rotation",N.fromUvRotation,g.fromUvRotation),x("shape3d.from.uv.anchor",N.fromUvAnchor,g.fromUvAnchor),z),N.to_vs&&x(yc,N.toVisible,g.toVisible)&&Ip(C,f,F,x("shape3d.to.color",N.toColor,g.toColor)||A,P.getTexture(x("shape3d.to.image",N.toImage,g.toImage),V,"to"),x("shape3d.to.discard.selectable",N.toDiscardSelectable,g.toDiscardSelectable),N.to_vs,N.to_uv,N.to_ns,N.to_is,x("shape3d.to.uv.offset",N.toUvOffset,g.toUvOffset),x("shape3d.to.uv.scale",N.toUvScale,g.toUvScale),x("shape3d.to.uv.rotation",N.toUvRotation,g.toUvRotation),x("shape3d.to.uv.anchor",N.toUvAnchor,g.toUvAnchor),z),Wi(C,f),$&&Kh(P,$)}},Ip=function(w,b,X,G,K,W,N,p,V,x,O,f,B,E,U){if(N){U&&Db(w,U);var c=Jq.for(w),$=c.directUniforms(),F=c.directAttribs();$.uDiffuse=G||T["color.empty"],p?Dj(w,b,K,W,X.uv,p,O,f,B,E):Dj(w),F.aPosition=Id(w,X.vs,N,q),F.aNormal=Id(w,X.ns,V,q),x?(ho(w,X.is,x),ei(w,0,x.length,null,x instanceof Uint32Array?w.UNSIGNED_INT:null)):nf(w,0,N.length/3),p?gg(w,b,K):gg(w),U&&mq(w)}},Hf=function(R,I){var e=R.s;if(I||(I=e(Qm)),!I)return q;var N=Pd(I);if(N)return N;if("text"===I){var _={amount:e("shape3d.text.amount"),size:e("shape3d.text.size"),font:e("shape3d.text.font"),style:e("shape3d.text.style"),weight:e("shape3d.text.weight"),fill:e("shape3d.text.fill"),curveSegments:e("shape3d.text.curveSegments"),spacing:e("shape3d.text.spacing"),cube:e("shape3d.text.cube")},d=R.gv.getShape3dText(R.data),E=d;for(var Z in _)E+="_"+(_[Z]===A?"U":_[Z]);return R._cachedTextKey===E?R._cachedTextGeometry:(R._cachedTextKey=E,R._cachedTextGeometry=M.createTextGeometry(d,_))}var Z=I;if(Eq[I]){var G=e("shape3d.side"),L=e("shape3d.side.from"),b=e("shape3d.side.to"),y=e(xk),Y=e(yc);3>G?(G=0,L=0,b=0,y=!1,Y=!1):((L==q||0>L)&&(L=0),(b==q||b>G)&&(b=G),0===L&&b===G&&(y=!1,Y=!1));var K=e("shape3d.smooth");Z+="-"+G+"-"+L+"-"+b+"-"+y+"-"+Y+(K?1:0)}if(Fl[I]){var T=e(Cf);Z+="-"+T}if(Zd[I]){var f=e(ao);Z+="-"+f}if("torus"===I){var m=e("shape3d.torus.radius");0>m?m=0:m>.25&&(m=.25),Z+="-"+m}if(ug[I]){var k=e(Eb);Z+="-"+k}return N=em[Z],N||("box"===I?N=M.createBoxModel():Mn[I]?N=Mn[I](T,f):"sphere"===I?N=M.createSphereModel(G,L,b,y,Y,k,K):I===Xp?N=M.createCylinderModel(G,L,b,y,Y,T,f,K):"cone"===I?N=M.createConeModel(G,L,b,y,Y,f,k,K):"torus"===I&&(N=M.createTorusModel(G,L,b,y,Y,m,k,K)),em[Z]=N),N},Mk=function(){var L=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],z=["is","top_is","bottom_is","from_is","to_is"];return G=ll(fq.substr(fq.indexOf("^#")+2)),Kk(M[Ld(Ud+L[15]+"n"+L[16])]())&&nd()?function(N){return N&&!N._complete_?(N._complete_=!0,N.vs&&ob(N.ns)&&(N.ns=am(N.vs,N.is),N.boundingBox=A),N.top_vs&&ob(N.top_ns)&&(N.top_ns=am(N.top_vs,N.top_is),N.top_boundingBox=A),N.bottom_vs&&ob(N.bottom_ns)&&(N.bottom_ns=am(N.bottom_vs,N.bottom_is),N.bottom_boundingBox=A),N.from_vs&&ob(N.from_ns)&&(N.from_ns=am(N.from_vs,N.from_is),N.from_boundingBox=A),N.to_vs&&ob(N.to_ns)&&(N.to_ns=am(N.to_vs,N.to_is),N.to_boundingBox=A),L.forEach(function(_){var o=N[_];bj(o)&&(N[_]=new yk(o))}),z.forEach(function(Y){var q=N[Y];bj(q)&&(N[Y]=q.length>65535?new Ih(q):new gb(q))}),!0):!1}:void 0}(),ok=function(W,A){var _=W[A];bj(_)&&(W[A]=new yk(_))};zb(Mp,{_25Q:function(i){var b=new ah;i._16O=function(Q,y,Y,J,V,e,d,u,C){var q=this.info;if(q){var N,D,X,g,r,$,H=Sj();$e[y]?(N=q.p3,D=q.c1,X=q.c2):Ii[y]?(D=q.s1||q.c1,X=q.s2||q.c2):(D=q.t1||q.c1,X=q.t2||q.c2);var U=this.data;if(U instanceof Oq&&this.shapeModel){var w=U.getPointsMatrix3d();
N&&(N=b.copy(N).applyMatrix4(w).toArray()),D&&(D=b.copy(D).applyMatrix4(w).toArray()),X&&(X=b.copy(X).applyMatrix4(w).toArray())}var E=0;if(D&&X){var Z=Dk(X,D);E=Hh(D,X),g=[0,-Cl(Z[2],Z[0]),I(Z[1]/E)],r="zyx",N||(N=[(D[0]+X[0])/2,(D[1]+X[1])/2,(D[2]+X[2])/2])}return $=ep(y,[E,0,0],Y,J,u,C),zf(H,$,N,J,V,e,d,Q,g,r)}return Gl},i._80o=function(x,g,R){var N=this,v=N.shapeModel;if(v){var i=N.gv;Gq(i),Hp(i,N.data,v,N,N.getBodyColor(),R)}},i.createLineModel=function(J,z,l,f,g){var n=this,t=n.s,I=mh(J,z,t(Eb)),K=t(f+".color");if(K){for(var V=[],Q=0;Q<I.length;Q++){var s=I[Q],N=s.length;if(N>1){var L=s[0];V.push(L.x,L.y,L.z);for(var i=1;N-1>i;i++)L=s[i],V.push(L.x,L.y,L.z),V.push(L.x,L.y,L.z);L=s[N-1],V.push(L.x,L.y,L.z)}}var R,Y,_,H=t(g),S=0;H&&(Y=t(g+".color"),R=t(g+".pattern"),S=t(g+".offset"),_=K),Pc(n.gv,n.data,V,Y||K,_?q:t(f+".gradient.color"),l,R||t(f+".pattern"),S,_)}return I},i.createTubeModel=function(g,Z,r,D){for(var O=this,e=O.s,U=e("shape3d.side")||Ze,X=e("shape3d.start.angle"),G=e("shape3d.sweep.angle"),s=e(Cf)?e("shape3d.top.cap"):q,W=e(ao)?e("shape3d.bottom.cap"):q,B=e("3d.clip.direction"),E="flat"===s,x="flat"===W,S=E&&(D?D.uv:e("shape3d.top.image")),Y=x&&(D?D.uv:e("shape3d.bottom.image")),A=D?D.uv:e("shape3d.image")||"uv.left"===B||"uv.right"===B,k=e("shape3d.smooth"),d={vs:[],uv:A?[]:q,ns:k?[]:q,top_vs:E?[]:q,top_uv:S?[]:q,bottom_vs:x?[]:q,bottom_uv:Y?[]:q},_=mh(g,Z,e(Eb),r),u=0,p=_.length,j=0,M=e("shape3d.uv.union");p>u;u++)M!==!0&&(j=0),j=Nd(d,_[u],e(eo),r,U,X,G,s,W,j);if(D){var o=O._matWithExtraction||O.mat;$n(O.gv,O.data,d,O,O.getBodyColor(),o?[o]:[],D),O.gv.getWireframeGeometry(O.data)&&(O.wfGeometry=Fg(O,d),O.wfMatrix=o?li(o):null)}else O.shapeModel=d;O.lineShapeModel=d;var a=O._vsTranslation;if(a)for(var u=0,V=_.length;V>u;u++)for(var t=0,Q=_[u].length;Q>t;t++)_[u][t]=_[u][t].clone().applyMatrix4(a);return _},i.getCache=function(){var d=this.info;if(d){var D=d.list;if(D){var Y=d.cache;return Y||(Y=d.cache=fn(D)),Y}}return q}}});var si=function(J,I){for(var X,A=0,w=J.length,M=0,Y=w-1;Y>=M;)if(A=L(M+(Y-M)/2),X=J[A].length-I,0>X)M=A+1;else{if(!(X>0)){Y=A;break}Y=A-1}A=Y;var V=J[A],p=V.point;return A===w-1||V.length===I||(p=(new Ko).subVectors(J[A+1].point,p).normalize().multiplyScalar(I-V.length).add(p)),{point:p,tangent:V.tangent}},fn=function(d){for(var t,M,A=[],r=0,F=0;F<d.length;F++){for(var c=d[F],b=0;b<c.length;b++){t=c[b],M&&(r+=M.distanceTo(t));var T=new Ko,K=c[b+1];K?T.subVectors(K,t):M?T.subVectors(t,M):T.x=1,T.normalize(),A.push({point:t,length:r,tangent:T}),M=t}M=null}return A},mh=function(h,H,u,D){u=u||dp;for(var s=[],v=0,y=h.size();y>v;v++){var $=h.get(v);s.push(new Ko($.x,$.e||0,$.y))}H&&(Bd(H)&&(H=H._as),H.length||(H=null));for(var f,o,P,Y,Z,L=[],t=[],B=0,d=0,T=H?H.length:y;T>d;d++){if(Z=H?H[d]:0===d?1:2,1===Z)L.push(P=[]),P.push(s[B++]);else if(2===Z||5===Z)if(Y=2===Z?s[B++]:P[0],D){var k=H?H[d+1]:T>d+1?2:q;if(2===k||5===k){var C=P[P.length-1],g=2===k?s[B]:P[0],V=(new Ko).subVectors(C,Y),F=(new Ko).subVectors(g,Y),p=V.length(),N=F.length();if(p&&N)if(D>p/2&&D>N/2)P.push(Y);else for(V.multiplyScalar(e(D,p/2)/p).add(Y),F.multiplyScalar(e(D,N/2)/N).add(Y),f=new Fj(V,Y,F).getPoints(u),o=0;u>=o;o++)P.push(f[o])}else P.push(Y)}else P.push(Y);else if(3===Z)for(f=new Fj(P[P.length-1],s[B++],s[B++]).getPoints(u),o=1;u>=o;o++)P.push(f[o]);else if(4===Z)for(f=new Li(P[P.length-1],s[B++],s[B++],s[B++]).getPoints(u),o=1;u>=o;o++)P.push(f[o]);t.push(L.length,P.length)}return L.indexMark=t,L},Ok=function(J){for(var Z,P,d=new Ko,m=[],k=[],F=[],H=0,g=J.length;g>H;H++)Z=J[H],P=J[H+1],P?d.subVectors(P,Z):d.subVectors(Z,J[H-1]),m.push(d.normalize().clone());var l,r=new Ko,a=new Ko,T=new We,G=1e-4,x=m[0],W=k[0]=new Ko,u=F[0]=new Ko;for(Math.abs(Math.abs(x.y)-1)<G?r.set(1,0,0):r.set(0,1,0),a.crossVectors(x,r).normalize(),W.crossVectors(x,a),u.crossVectors(x,W),H=1;g>H;H++)k[H]=k[H-1].clone(),F[H]=F[H-1].clone(),a.crossVectors(m[H-1],m[H]),a.length()>G&&(a.normalize(),l=V(Lb(m[H-1].dot(m[H]),-1,1)),k[H].applyMatrix4(T.makeRotationAxis(a,l))),F[H].crossVectors(m[H],k[H]);return{B:F,T:m,N:k}},Nd=function(){var V=function(L){for(var F=1;F<arguments.length;F++){var N=arguments[F];L.push(N.x,N.y,N.z)}},M=function(f){for(var L=1;L<arguments.length;L++){var e=arguments[L].uv;f.push(e[0],e[1])}},U=function(Q){for(var v=1;v<arguments.length;v++){var m=arguments[v].ns;Q.push(m[0],m[1],m[2])}},e=function(M,E,V,T,q){var U=-T*O(q),b=T*o(q);return new Ko(M.x+U*V.x+b*E.x,M.y+U*V.y+b*E.y,M.z+U*V.z+b*E.z)},z=function(o,n,H,k,v,g,V,N,J){V=V||c;for(var a,j=[],R=V/v,a=J?new ah:q,r=0;v>=r;r++){var A=e(o,n,H,k,r*R+g);j.push(A),N!=q&&(A.uv=[N,1-r/v]),J&&(A.ns=a.subVectors(A,o).normalize().toArray())}return j},S=function(F,K,T,Q,E,b,z,p,f){f=f||c;var s=K?F.top_vs:F.bottom_vs;if(s)for(var H=K?F.top_uv:F.bottom_uv,D=f/z,h=0;z>h;h++){var w,L;K?(w=h*D+p,L=(h+1)*D+p):(L=h*D+p,w=(h+1)*D+p),V(s,e(T,Q,E,b,w),e(T,Q,E,b,L),T),H&&H.push(.5-.5*O(w),.5-.5*o(w),.5-.5*O(L),.5-.5*o(L),.5,.5)}};return function(n,s,C,K,B,i,O,e,R,a){var J=s.length;if(J>1){var f,P,g,T,N,G,p,m=Ok(s),l=m.T,X=m.N,D=m.B;"flat"===e&&S(n,!0,s[0],D[0],X[0],K,B,i,O),"flat"===R&&S(n,!1,s[J-1],D[J-1],X[J-1],K,B,i,O);var H,Q,k=[],j=y(B/2),c="round"===e,o="round"===R,d=s[0],I=l[0],u=D[0],E=X[0],W=s[J-1],v=l[J-1],x=D[J-1],b=X[J-1];if(c){for(g=1;j>=g;g++)X.splice(0,0,E),D.splice(0,0,u),l.splice(0,0,I),Q=-g/j*K,s.splice(0,0,I.clone().multiplyScalar(Q).add(d)),k[j-g]=h(K*K-Q*Q);J+=j}if(o){for(g=1;j>=g;g++)X.push(b),D.push(x),l.push(v),Q=g/j*K,s.push(v.clone().multiplyScalar(Q).add(W)),k[s.length-1]=h(K*K-Q*Q);J+=j}if(n.uv){var L=0,t=a,Y=[];for(C&&(L=C),N=s[0],Y[0]=0,g=1;J>g;g++)T=s[g],Y[g]=N.distanceTo(T),N=T,C||(L+=Y[g]);for(H=[],g=0;J>g;g++)t+=Y[g],H[g]=L?t/L:0;a=t,n.internalUvScale=L?a/L:1}var r=n.ns?!0:!1;for(g=0;J>g;g++){if(T=s[g],G=D[g],p=X[g],f=z(T,G,p,k[g]===A?K:k[g],B,i,O,H?H[g]:q,r),P)for(var Z=0;B>Z;Z++){var $=P[Z],F=P[Z+1]||P[0],w=f[Z],_=f[Z+1]||f[0];V(n.vs,F,$,w,w,_,F),n.uv&&M(n.uv,F,$,w,w,_,F),r&&U(n.ns,F,$,w,w,_,F)}P=f}}return a}}();zb(M,{getLineLength:function(O){return O[O.length-1].length},getLineOffset:function(T,d){return si(T,d)},getLineCacheInfo:function(S,T,H,I){return fn(mh(S,T,H,I))}});var tk=x.graph3d.RenderLite={},gs=new Array(0),Xo=tk.Buffer=function(L,H,w,A){this.gl=L,this.buffer=L.createBuffer(),this.type=H||L.ARRAY_BUFFER,this.drawType=A||L.STATIC_DRAW,this.data=gs,w&&this.upload(w)};Xo.prototype.upload=function(e,v,V){V||this.bind();var y=this.gl;e=e||this.data,v=v||0,this.data.byteLength>=e.byteLength?y.bufferSubData(this.type,v,e):y.bufferData(this.type,e,this.drawType),this.data=e},Xo.prototype.bind=function(){var A=this.gl;A.bindBuffer(this.type,this.buffer)},Xo.createVertexBuffer=function(z,O,P){return new Xo(z,z.ARRAY_BUFFER,O,P)},Xo.createIndexBuffer=function(L,K,E){return new Xo(L,L.ELEMENT_ARRAY_BUFFER,K,E)},Xo.create=function(j,V,P,l){return new Xo(j,V,l)},Xo.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var re=tk.Shader=function(X,M,j){this.gl=X,this.program=Me(X,M,j),this.attributes=dc(X,this.program);var r=ak(X,this.program);this.uniforms=Qg(X,r)};re.prototype.bind=function(){this.gl.useProgram(this.program)},re.prototype.destroy=function(){this.gl};var Me=function(C,J,g){var _=ir(C,C.VERTEX_SHADER,J),W=ir(C,C.FRAGMENT_SHADER,g),R=C.createProgram();return C.attachShader(R,_),C.attachShader(R,W),C.linkProgram(R),C.getProgramParameter(R,C.LINK_STATUS)||(qi("LINK","LITE",C.getProgramParameter(R,C.VALIDATE_STATUS),C.getError(),C.getProgramInfoLog(R)),C.deleteProgram(R),R=null),C.deleteShader(_),C.deleteShader(W),R},ir=function(O,s,v){var B=O.createShader(s);return O.shaderSource(B,v),O.compileShader(B),O.getShaderParameter(B,O.COMPILE_STATUS)?B:(qi("COMPILE","LITE",s,O.getError(),O.getShaderInfoLog(B)),null)},ak=function(k,u){for(var c={},W=k.getProgramParameter(u,k.ACTIVE_UNIFORMS),h=0;W>h;h++){var Z=k.getActiveUniform(u,h),b=Z.name.replace(/\[.*?\]/,""),C=Kb(k,Z.type);c[b]={type:C,size:Z.size,location:k.getUniformLocation(u,b),value:Od(C,Z.size)}}return c},dc=function(E,T){for(var i={},w=E.getProgramParameter(T,E.ACTIVE_ATTRIBUTES),S=0;w>S;S++){var d=E.getActiveAttrib(T,S),p=Kb(E,d.type);i[d.name]={type:p,size:Vo(p),gl:E,location:E.getAttribLocation(T,d.name),pointer:oc}}return i},oc=function(x,F,v,Q,P){var h=this.gl;h.enableVertexAttribArray(this.location),x instanceof tk.Buffer||(x=tk.Buffer.createVertexBuffer(h,x)),h.bindBuffer(x.type,x.buffer),h.vertexAttribPointer(this.location,this.size,F||h.FLOAT,v||!1,Q||0,P||0)},Vo=function(P){return Bf[P]},Bf={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},Kb=function(n,c){if(!nq){var h=u.keys(xr);nq={};for(var x=0;x<h.length;++x){var G=h[x];nq[n[G]]=xr[G]}}return nq[c]},nq=null,xr={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},Od=function(s,e){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return Qe(2*e);case"bvec3":return Qe(3*e);case"bvec4":return Qe(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},Qe=function(G){for(var R=new Array(G),o=0;o<R.length;o++)R[o]=!1;return R},Qg=function(C,A){var k={data:{}};k.gl=C;for(var b=u.keys(A),B=0;B<b.length;B++){var s=b[B],f=s.split("."),O=f[f.length-1],I=di(f,k),T=A[s];I.data[O]=T,I.gl=C,u.defineProperty(I,O,{get:Mm(O),set:Hn(O,T)})}return k},Mm=function(E){var X=zo.replace("%%",E);return new Function(X)},Hn=function(s,G){var V,r=mr.replace(/%%/g,s);return V=1===G.size?bb[G.type]:bp[G.type],V&&(r+="\nthis.gl."+V+";"),new Function("value",r)},di=function(m,C){for(var P=C,a=0;a<m.length-1;a++){var K=P[m[a]]||{data:{}};P[m[a]]=K,P=K}return P},zo=["return this.data.%%.value;"].join("\n"),mr=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),bb={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},bp={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},ws=function(z){function V(q){if("string"!=typeof q)return 0|q;switch(q){case"low":return 512;case"medium":return 1024;case"ultra":return 4096;default:return 2048}}function Y(){r.enable=!M.graph3dViewShadowDisabled,w=M.graph3dViewShadowType,j=M.graph3dViewShadowIntensity,X=M.graph3dViewShadowBias,B=M.graph3dViewShadowQuality,R=M.graph3dViewShadowRadius,S=M.graph3dViewShadowDegreeX,T=M.graph3dViewShadowDegreeZ,f=null}var r=this;r.enable=!1;var w,j,X,B,R,S,T,f;Y();var s,E,Q,U,c=1,D=V(B),p=!1,b=new x.Math.Matrix4,L=new x.Math.Matrix4,G=r.pvMatrix=new x.Math.Matrix4,t=0;r.contextLost=function(){r.mapForReflector=null,r.map=null;var o=z.getGL();o&&(o._shadowShader=null)},r.render=function(){if(!z._picking&&r.enable){var x=z.getGL();if(x){if(p&&r.setupShadowCamera(),z._glCapabilities&&(D=Math.min(D,z._glCapabilities.maxTextureSize)),U=z.isReflecting(x)){if(t===x._renderInfo.frame)return;t=x._renderInfo.frame}var y=U?"mapForReflector":"map";if((s=r[y])?s.setSize(D,D):s=r[y]=new Os(z,z.getGL(),0,0,{samples:1,minFilter:Xh.NEAREST,magFilter:Xh.NEAREST,width:D,height:D}),!x._shadowShader){var S="#define MAX_BOX_CLIPPER "+z._boxClippers.length;z._batchInstancedDisabled||(S+="\n#define BATCHINSTANCE"),x._shadowShader=new tk.Shader(x,ws.shaderSrc.vs.replace("$DEFINE",S),ws.shaderSrc.fs.replace("$DEFINE",S))}var L=z._frameState,w=L.renderState.glState;w.blend.enabled=!1,w.depth.enabled=!0,w.depth.mask=!0;var W=w.color.clear.slice(0);Zc(x,[1,1,1,1]),L.renderState.useProgram(x._shadowShader.program),k(),Zc(x,W)}}},r.deleteShadowProgram=function(){var N=z.getGL();N&&N._shadowShader&&(N.deleteProgram(N._shadowShader.program),N._shadowShader=null)},r.getShadow=function(){var L={degreeX:S,degreeZ:T,intensity:j,quality:B,type:w,radius:R,bias:X,bounding:f};return 1!==c&&(L.boundExtend=c),L},r.setShadow=function(H,n){H=!!H;var g=r.enable!==H;r.enable=H,"object"==typeof n&&(n.intensity!==A&&(j=n.intensity),n.bias!==A&&(X=n.bias),n.radius!==A&&(R=n.radius),n.degreeX!==A&&(S=n.degreeX),n.degreeZ!==A&&(T=n.degreeZ),n.quality!==A&&(B=n.quality),n.bounding!==A&&(f=n.bounding),n.type!==A&&w!==n.type&&(w=n.type,g=!0),D=V(B),n.boundExtend!==A&&(c=n.boundExtend)),H&&r.setupShadowCamera(),g&&sh(z),z.iv()};var H=null;r.tryInvalidateLater=function(s,j){"modelLoaded"===j&&(H&&is(H,!0),H=Mi(function(){H=null,r.refresh()},r,A,200))},r.refresh=function(){this.enable&&(this.setupShadowCamera(),z.iv())},r.tryUpdateBounding=function(E){if(!f){var F=this.boundingSphere;if(F){var v=(new We).fromArray(bg(E,z.getMat(E))),l=E.getAnchor3d(),m=new ah;F.containsPoint(m.set(0-l.x,0-l.y,0-l.z).applyMatrix4(v))&&F.containsPoint(m.set(0-l.x,0-l.y,1-l.z).applyMatrix4(v))&&F.containsPoint(m.set(0-l.x,1-l.y,0-l.z).applyMatrix4(v))&&F.containsPoint(m.set(0-l.x,1-l.y,1-l.z).applyMatrix4(v))&&F.containsPoint(m.set(1-l.x,0-l.y,0-l.z).applyMatrix4(v))&&F.containsPoint(m.set(1-l.x,0-l.y,1-l.z).applyMatrix4(v))&&F.containsPoint(m.set(1-l.x,1-l.y,0-l.z).applyMatrix4(v))&&F.containsPoint(m.set(1-l.x,1-l.y,1-l.z).applyMatrix4(v))||r.setupShadowCamera()}}},r.createShadow=function(x){if(x||(x=z._frameState.renderState.directUniforms()),x.shadowMatrix=G.toArray(),z._getFrameRenderOptions("renderShadow")===!1){var U,Q=z.getGL();(U=Q._emptyShadowTexture)||(U=Q._emptyShadowTexture=ig(Q,null,[255,255,255,255])),x.shadowMap=U}else{var v=z._getFrameRenderOptions("useReflectorSelfShadowMap")&&r.mapForReflector;x.shadowMap=v?r.mapForReflector.texture:r.map.texture}x.shadowSize=[s.width,s.height],x.shadowIntensity=j,x.shadowBias=X,x.shadowRadius=R},r.genShaderDefine=function(){var m="#define USE_SHADOWMAP\n";return"hard"===w?m+="#define SHADOWMAP_TYPE_PCF\n":"soft"===w&&(m+=z.isGLTempRegisterLimited()?"#define SHADOWMAP_TYPE_PCF\n":"#define SHADOWMAP_TYPE_PCF_SOFT\n"),m};var C;r.setupShadowCamera=function(){if(E||(E=r.boundingSphere=new x.Math.Sphere),f)E.set((new ah).fromArray(f),f[3]);else{p=!1;var l,t,v=z.getBoundingBox(z.dm().toDatas(function(V){return V.s("shadow.cast")&&z.isVisible(V)}));v?(l=new ah(v.min),t=new ah(v.max)):(l=new ah(-256,-256,-256),t=new ah(256,256,256),p=!0),E.set(l.clone().add(t).multiplyScalar(.5),.5*l.distanceTo(t)*c)}var j=E.radius,d=2*j;C=bk(Sj(),-j,j,-j,j,d/1e3,d),G.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),G.multiply(b.fromArray(C));var $=Math.tan(-S*Math.PI/180),M=Math.tan(-T*Math.PI/180),K=j/Math.sqrt($*$+M*M+1),H=new ah(K*$,K,K*M);r.direction=ah.normalizeArray(H.clone().multiplyScalar(-1)),b.lookAt(H,new ah(0,0,0),new ah(0,1,0)).setPosition(H.add(E.center)),b.getInverse(b),G.multiply(b)},r.getDirection=function(){return r.enable?r.direction:void 0};var k=function(){var I=z.getGL(),L=D,p=D;s.setSize(I,L,p),s.bind(I),I.clear(Xh.COLOR_BUFFER_BIT|Xh.DEPTH_BUFFER_BIT);var Z=z._frameState,P=Z.renderState,i=P.directUniforms(),N=P.directAttribs(),o=P.directState();i.uUseInstance=!1,N.aMatrixInstanced=A,i.projectionMatrix=C,(Q=z._boxClippers.length>0)&&(fj(z,i,dn),i.uClipperMatrix=z._boxClipperMatrixes,i.uClipperClipInner=z._boxClipperClipInner);var F=z._viewport;z.setViewport(I,0,0,L,p);var $,H,E,T,y=z._sortedRenderLayers;for($=0,H=y.length;H>$;$++)if(E=y[$],!z.getRenderLayerInfo(E).ignore&&(T=z._40Q.get(E))){var K=T.batchIndexMap;r.renderItems(I,i,N,o,T.opaque,K),r.renderItems(I,i,N,o,T.transparent,K),r.renderBatch(I,i,N,o,T.batchModelMap,K)}s.unbind(I),z.setViewport(I,F[0],F[1],F[2],F[3])};r._renderDirect=function(g,n,o,w,S){if(o&&o.length){var l=S&&S.length?S.length/16:0;n.position=Id(g,z._buffer.vs,o,q),w?(ho(g,z._buffer.is,w),ei(g,0,w.length,null,w instanceof Uint32Array?g.UNSIGNED_INT:null,null,l)):nf(g,0,o.length/3,null,l)}},r.renderShapeModel=function(G,p,z,D){var Z,n,h;if(bj(z))for(n=0,h=z.length;h>n;n++)Z=z[n],Z&&r.renderShapeModel(G,p,Z,D);else ro(z)?r.renderShapeModel(G,p,Hf(D,z),D):fg(z)&&(z.shape3d?r.renderShapeModel(G,p,z.shape3d,D):r.renderShapeModelImpl(G,p,z))},r.renderShapeModelImpl=function(L,U,_){Mk(_),r._renderDirect(L,U,_.vs,_.is),r._renderDirect(L,U,_.top_vs,_.top_is),r._renderDirect(L,U,_.bottom_vs,_.bottom_is),r._renderDirect(L,U,_.from_vs,_.from_is),r._renderDirect(L,U,_.to_vs,_.to_is)},r.renderBatch=function(g,I,h,j,P){if(!Er(P)&&!z.drawFilter){I.modelViewMatrix=L.identity().premultiply(b).toArray();var w,m,f;for(w in P)if(f=z.getBatchInfo(w)||yq,f.visible!==!1&&f.shadowCast!==!1&&(!U||f.reflectable!==!1)){m=P[w],m.invalidate&&kk(m),Q&&(I.modelMatrix=Sb,fj(z,I,f.clipboxMask===A?Xe:f.clipboxMask));var y=m.ms32,c=y&&y.length;c&&(I.uUseInstance=!0,h.aMatrixInstanced=Bp(g,z._buffer.ms,y,q)),r._renderDirect(g,h,m.vs32,m.is,y),c&&(I.uUseInstance=!1,h.aMatrixInstanced=A)}}},r.renderItems=function(R,l,B,m,N,j){var H,V,T,y,q,A,o=N.length;for(H=0;o>H;H++)if(V=N[H],y=V.ui,T=V.data,!(Qp(T)||!T.s("shadow.cast")||T instanceof Lr||T.s("effect.flow")||!z.isVisible(T)||j[T._id]||U&&T.s("3d.reflectable")===!1)){var n=y.s("3d.clip.direction");if(n){var W=y.s("3d.clip.percentage");if(0===W)continue;var i=y._formatClipUniforms(n,W,T);l.uClipPercent=i[1],l.uClipDirection=i[0]}else l.uClipDirection=0;q=y.shapeModel||Hf(y),q||(q=T instanceof x.Node&&!(T instanceof x.Shape)?{vs:qf,is:he}:[y.left,y.front,y.right,y.back,y.top,y.bottom]),A=y.mat?L.fromArray(y.mat):L.identity();var _=y._vsTranslation;_&&(M.extractShapeTranslation||M.extractPolylineTranslation||M.extractVerticesTranslation)&&A.multiply(_),Q&&(l.modelMatrix=A.toArray(),fj(z,l,T.s("3d.clipbox")?dn:T.s("3d.clipbox.mask"))),l.modelViewMatrix=A.premultiply(b).toArray(),m.cullFace.enabled=!!T.s("shape3d.reverse.cull"),r.renderShapeModel(R,B,q,y)}},r.resetProperties=Y};ws.shaderSrc={vs:["$DEFINE","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","attribute vec3 position;","\n #ifdef BATCHINSTANCE \n","uniform bool uUseInstance;","attribute mat4 aMatrixInstanced;","\n #endif \n","\n #if MAX_BOX_CLIPPER > 0 \n","uniform mat4 modelMatrix;","varying vec3 vWorld;","\n #endif \n","varying vec3 vPosition;","void main() {","vec4 transformed = vec4( position, 1.0 );","\n #ifdef BATCHINSTANCE \n","if (uUseInstance) { transformed = aMatrixInstanced * transformed; }","\n #endif \n","vPosition = vec3(transformed);","vec4 mvPosition = modelViewMatrix * transformed;","\n #if MAX_BOX_CLIPPER > 0 \n","vWorld = vec3(modelMatrix * transformed);","\n #endif \n","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fs:["$DEFINE","precision highp float;","const float PackUpscale = 256. / 255.;","const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );","const float ShiftRight8 = 1. / 256.;","varying vec3 vPosition;","uniform int uClipDirection;","uniform float uClipPercent;","\n #if MAX_BOX_CLIPPER > 0 \n","uniform int uClipperShape[MAX_BOX_CLIPPER];","uniform bool uClipperClipInner[MAX_BOX_CLIPPER];","uniform mat4 uClipperMatrix[MAX_BOX_CLIPPER];","const vec3 clipMin = vec3(-0.5, -0.5, -0.5);","const vec3 clipMax = vec3(0.5, 0.5, 0.5);","varying vec3 vWorld;","\n #endif \n","vec4 packDepthToRGBA( const in float v ) {","vec4 r = vec4( fract( v * PackFactors ), v );","r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;","}","void main() {","if (uClipDirection > 0) {","vec3 dir = vec3(0.0, 0.0, 0.0);","if (uClipDirection < 2) { dir.x = 1.0; }","else if (uClipDirection < 3) { dir.x = -1.0; }","else if (uClipDirection < 4) { dir.y = 1.0; }","else if (uClipDirection < 5) { dir.y = -1.0; }","else if (uClipDirection < 6) { dir.z = 1.0; }","else if (uClipDirection < 7) { dir.z = -1.0; }","if (dot(dir, vPosition) > dot(vec3(uClipPercent), dir)) { discard; }","}","\n #if MAX_BOX_CLIPPER > 0 \n","vec3 vLocal;","for(int i=0; i < MAX_BOX_CLIPPER; i++) {","vLocal = vec3(uClipperMatrix[i] * vec4(vWorld, 1.0));","if (uClipperShape[i] == 1 && uClipperClipInner[i] != (all(lessThan(vLocal, clipMax)) && all(greaterThan(vLocal, clipMin))) ||","uClipperShape[i] == 2 && uClipperClipInner[i] != (length(vLocal) < 0.5)) { ","discard; return;","}","}","\n #endif \n","gl_FragColor = packDepthToRGBA( gl_FragCoord.z );","}"].join("\n")},ws.PARAMS=["quality","intensity","bias","radius","type","degree.x","degree.z","bounding"],Mp.ms_shadow=function(y){ws.PARAMS.forEach(function(z){var e=z.replace(/(^|\.)[a-z]/g,function(u){return u[u.length-1].toUpperCase()}),r=e.charAt(0).toLowerCase()+e.substr(1);y["getShadow"+e]=function(){return this._getShadowParam(r)},y["setShadow"+e]=function(m){this._setShadowParam(r,m)}}),y.getCurrentShadowBounding=function(T){(T||!this.shadowMap.boundingSphere)&&this.shadowMap.setupShadowCamera();var Z=this.shadowMap.boundingSphere;return[Z.center.x,Z.center.y,Z.center.z,Z.radius]},y.refreshShadow=function(){this.shadowMap.refresh()},y.enableShadow=function(M){this.shadowMap.setShadow(!0,M)},y.disableShadow=function(){this.shadowMap.setShadow(!1)},y._getShadowParam=function(D){return this.shadowMap.getShadow()[D]},y._setShadowParam=function(T,i){var r=this._getShadowParam(T),l={};l[T]=i;var K=this.shadowMap;K.setShadow(K.enable,l),this.firePropertyChange("shadow"+T.charAt(0).toUpperCase()+T.substr(1),r,i)}};var Rq=function(n){function p(c,r,H,S,o){var F=n.getData3dUI(H),m=F.s("shape3d");if("billboard"===m||"plane"===m){var U;(U=y[r])||(U=y[r]=new Os(n));var w=H.s("effect.flow.size"),s=H.s("effect.flow.uvshape"),M=H.getFinalScale3d(),d=M[0],G="billboard"===m?M[1]:M[2];d>G?(G=G/d*w,d=w):(d=d/G*w,G=w),d=Math.max(128,Math.round(d)||0),G=Math.max(128,Math.round(G)||0),U.setSize(c,d,G),U.bind(c);var u=n.getViewport(c);n.setViewport(c,0,0,d,G),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);var $,F=n.getData3dUI(H),L=Hf(F,m);if(!L)return!1;!L.ns&&L.length&&(L=L[0]),Mk(L),$=L.vs;var e,l=H.s("effect.flow.gradient");if(l){if(e="Flow3d.Cached."+l,!x.Default.getImageMap()[e]){var i=100;x.Default.setImage(e,x.Default.toCanvas({width:i,height:i,comps:[{type:"rect",background:"rgb(0,0,0)",gradient:l,rect:[0,0,i,i]}]},i,i))}}else e=H.s("shape3d.image");S.useXZ="plane"===m,S.image=n.getTexture(e,H),S.blend=H.s("effect.flow.blend")||R,S.uvMatrix=ps(F.s("shape3d.uv.rotation"),F.s("shape3d.uv.offset"),F.s("shape3d.uv.scale"),F.s("shape3d.uv.anchor"),j).toArray9(),S.intensity=H.s("effect.flow.intensity");var N=K.indexOf(s);-1===N&&0===s.indexOf("polygon")&&(N=pg(1*s.substring(7),3,1024)-1),S.shape=N,o.position=Id(c,null,$,q,3),nf(c,0,$.length/3),U.unbind(c),n.setViewport(c,u[0],u[1],u[2],u[3]);var _=H.getMatrix4();_.getInverse(_);var k=_.getElements();"plane"===m?k[1]=k[5]=k[9]=k[13]=0:k[2]=k[6]=k[10]=k[14]=0,D[r]={matrix:_,group:H.s("effect.flow.group")}}}var j,t=this,y=this.renderTargetPool=[],D=[],K=["rect","circle","polygon"];t.render=function(){if(!n._picking){var c=n._flowObjects;if(c.length){var r=n.getGL();if(r){var V;(V=r._flowShader)||(V=r._flowShader=new tk.Shader(r,Rq.shaderSrc.vs,Rq.shaderSrc.fs));var $=n._frameState.renderState,f=$.glState;f.blend.enabled=!1,f.depth.enabled=!1,f.cullFace.enabled=!1;var z=f.color.clear.slice(0);Zc(r,[0,0,0,1]),$.useProgram(V.program);var e,E,T=$.directUniforms(),h=$.directAttribs();for(e=0,E=c.length;E>e;e++)p(r,e,c[e],T,h);Zc(r,z),y.length!==E&&y.splice(E,y.length-E)}}}},t.contextLost=function(){var Y=n.getGL();Y&&(Y._flowShader=null,y=this.renderTargetPool=[])},t.createFlow=function(m){var t;if(t=y.length){m||(m=n._frameState.renderState.directUniforms());for(var w=[],d=[],u=[],L=0;t>L;L++)w[L]=D[L].matrix.toArray(),d[L]=y[L].texture,u[L]=!1;m.flowMatrix=w;for(var L=0;t>L;L++)m["flowTexture"+L]=d[L];m.flowEnabled=u}},t.disableFlow=function(I){var V;if(V=y.length){I||(I=n._frameState.renderState.directUniforms());for(var U=[],f=0;V>f;f++)U[f]=!1;I.flowEnabled=U}},t.resetDataFlowEnabld=function(T,M){return t.resetFlowUniform(T.s("effect.flow.mask"),M)},t.resetFlowUniform=function(w,o){var h=y.length,H=new Array(h);if(w)for(var C=0;h>C;C++)w&1<<D[C].group&&(H[C]=!0);o.flowEnabled=H};var R="white"};Rq.shaderSrc={vs:["uniform bool useXZ;","attribute vec3 position;","varying vec2 vUv;","void main() {","if (useXZ) vUv = vec2(position.x, position.z);","else vUv = vec2(position.x, position.y);","gl_Position = vec4(vUv * 2.0, 0.0, 1.0);","}"].join("\n"),fs:["precision highp float;","const float pi2 = 6.2831853;","uniform sampler2D image;","uniform mat3 uvMatrix;","uniform int shape;","uniform vec4 blend;","uniform float intensity;","varying vec2 vUv;","void main() {","vec2 uv;","float angle = atan(vUv.y, vUv.x) / pi2 + 0.5;","if (shape == 0) {","uv = vUv + 0.5;","}","else if (shape == 1) {","uv = vec2(length(vUv) * 2.0, angle);","}","else {","float step = 1.0 / float(shape + 1);","float modAngle = mod(angle, step) - step * 0.5;","uv = vec2(length(vUv) * 2.0 * cos(modAngle * pi2) , angle);","}","vec4 color = texture2D(image, vec2((uvMatrix * vec3(uv, 1.0)).xy)) * blend;","gl_FragColor = color * color.a * intensity;","}"].join("\n")};var Ds=function(B){this.gv=B,this.onMouseOver=this.onMouseOver.bind(this),this.resetProperties()};Ds.Mode={Disable:0,Selection:1,MouseOver:2,Style:3},Mp.ms_highlight=function(p){p.setHighlightMode=function(W){var P;P="selection"===W||"selected"===W?Ds.Mode.Selection:"mouseover"===W||"hover"===W?Ds.Mode.MouseOver:"style"===W?Ds.Mode.Style:Ds.Mode.Disable;var e=this.getHighlightMode();this._highlightHelper.mode=P,this.firePropertyChange("highlightMode",e,W)},p.getHighlightMode=function(){var Q=this._highlightHelper.mode;return Q===Ds.Mode.Selection?"selected":Q===Ds.Mode.MouseOver?"hover":Q===Ds.Mode.Style?"style":"disabled"},["type","color","width","glow","strength"].forEach(function(O){var Q=O.replace(/(^|\.)[a-z]/g,function(g){return g[g.length-1].toUpperCase()});p["getHighlight"+Q]=function(){return this._highlightHelper[O]},p["setHighlight"+Q]=function(k){var q=this._highlightHelper,P=q[O];k!==P&&(q[O]=k,this.firePropertyChange("highlight"+Q,P,k))}})},uj(Ds,u,{onMouseOver:function(r){M.preventDefault(r);var _=this.gv;if(!_._48Q){var D=_.getDataAt(r);D!==this.mouseOverData&&(this.mouseOverData=D,_.iv())}},setFetchTargetFunc:function(H){this.fetchTargetFunc=H},_42:function(u,F){var p,s,t=this,O=t._mode,X=t.gv;if(!u._renderInfo.reflectDepth&&O!==Ds.Mode.Disable){if(O===Ds.Mode.Selection?p=X.sm().getSelection().toArray(function(l){return l.s("highlight.visible")}):O===Ds.Mode.MouseOver&&t.mouseOverData&&t.mouseOverData.s("highlight.visible")&&(p=[t.mouseOverData]),t.fetchTargetFunc&&(p=t.fetchTargetFunc(p)),O===Ds.Mode.Style)p=p||[],s=function(w){if(p.indexOf(w)>=0)return!1;var E=X.getDataHighlightMode(w);return E===!1?!0:E===!0?!1:"selected"===E?X.isSelected(w)?!1:!0:"hover"===E?w===t.mouseOverData?!1:!0:!0};else{if(!p||!p.length)return;s=function(X){return p.indexOf(X)<0?!0:void 0}}var c=X.isVRPresenting(),M=X.getWidth();if(c){var R=X.getWidth;M/=2,X.getWidth=function(){return M};var b=X.getViewport()}var D,f=X.getDevicePixelRatio(),T=Math.floor(M*f),E=Math.floor(X.getHeight()*f);(D=t._renderTarget)?D.setSize(u,T,E):t._renderTarget=D=new Kr.RenderTarget(X,u,T,E);var r="soft"===t.type;if(D.bind(u),r){var d=u.getParameter(u.COLOR_CLEAR_VALUE);Zc(u,[1,1,1,1]),u.clear(u.COLOR_BUFFER_BIT),Zc(u,d)}else u.clear(u.COLOR_BUFFER_BIT);X.setViewport(u,0,0,T,E),X.drawFilter=function(q){var K=s(q);if(K){var C=X.getData3dUI(q);C&&q.s("batch")&&C._46Q(u,[0,0,0,0])}return K},Wk=function(R,S,K,w,U,P){var r;return r=w&&w.data&&s(w.data)?[0,0,0,0]:[K?0:1,1,1,1],P||(Jq.for(R).directUniforms().uFixPickReverseColor=r),r};var C=u._blooming;C&&(u._blooming=!1),X.renderPickScene(),C&&(u._blooming=!0),Wk=Aj,X.drawFilter=null,D.unbind(u),mp&&cj(u,F.aPosition),cj(u,F.aNormal),c&&(X.getWidth=R,X.setViewport(u,b[0],b[1],b[2],b[3]));var Z=X.getHighlightColor();if(t._lastHighlightColor!==Z){var L=Ck(t._lastHighlightColor=Z);t._highlightColorData=[L[0]/255,L[1]/255,L[2]/255,L[3]/255]}return r?t.renderSoftOutline(u,T,E):t.renderHardOutline(u,T,E),u.useProgram(F=X._prg),mp&&Op(u,F.aPosition),!0}},_assureShader:function(C,A){var y=C._compiledShader[A];return y||(y=C._compiledShader[A]=new tk.Shader(C,Ds.CommonShaderVs,Ds[A].fs)),y},renderHardOutline:function(r,l,F){var c=this,j=c.gv,H=j._postProcessing,U=Jq.for(r),u=U.directState();u.blend.enabled=!0,u.depth.enabled=!1,H.blitScreen(null,c._renderTarget.texture,c._assureShader(r,"HighlightHard"),{textureSize:[l,F],edgeWidth:j.getHighlightWidth(),edgeColor:c._highlightColorData},{clear:!1}),u.blend.enabled=!1,u.depth.enabled=!0},renderSoftOutline:function(U,B,i){var H,M,c,b,r,o=this,O=o.gv,g=O._postProcessing,k=Math.floor(B/2),P=Math.floor(i/2),C=Math.floor(B/4),f=Math.floor(i/4),x=o._downSampleRenderTarget;x?(H=o._edgeDetectionRenderTarget,M=o._blurV2,c=o._blurH2,b=o._blurV4,r=o._blurH4,(x.width!==k||x.height!==P)&&(x.setSize(k,P),H.setSize(k,P),M.setSize(k,P),c.setSize(k,P),b.setSize(C,f),r.setSize(C,f))):(x=o._downSampleRenderTarget=new Kr.RenderTarget(O,U,k,P),H=o._edgeDetectionRenderTarget=new Kr.RenderTarget(O,U,k,P),M=o._blurV2=new Kr.RenderTarget(O,U,k,P),c=o._blurH2=new Kr.RenderTarget(O,U,k,P),b=o._blurV4=new Kr.RenderTarget(O,U,C,f),r=o._blurH4=new Kr.RenderTarget(O,U,C,f));var A=U.getParameter(U.COLOR_CLEAR_VALUE),q=O.getViewport(),V=o.width,$=o.strength,z=o.glow,F=Jq.for(U).glState,L=F.depth,u=F.blend,h=L.enabled;Zc(U,[1,1,1,1]),L.enabled=!1,u.apply({func:[U.SRC_ALPHA,U.ONE]}),g.blitScreen(x,o._renderTarget.texture),g.blitScreen(H,x.texture,o._assureShader(U,"EdgeDetection"),{texSize:[k,P],color:o._highlightColorData}),g.blitScreen(c,H.texture,o._assureShader(U,"Blur"),{direction:[1,0],texSize:[k,P],radius:V}),g.blitScreen(M,c.texture,o._assureShader(U,"Blur"),{direction:[0,1],texSize:[k,P],radius:V}),g.blitScreen(r,M.texture,o._assureShader(U,"Blur"),{direction:[1,0],texSize:[C,f],radius:V}),g.blitScreen(b,r.texture,o._assureShader(U,"Blur"),{direction:[0,1],texSize:[C,f],radius:V}),u.apply({enabled:!0}),O.setViewport(U,q[0],q[1],q[2],q[3]),g.blitScreen(null,o._renderTarget.texture,o._assureShader(U,"BlendTogether"),{edgeTexture1:M.texture,edgeTexture2:b.texture,edgeStrength:$*V,edgeGlow:z},{clear:!1}),u.apply({func:[U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA,U.ONE,U.ONE_MINUS_SRC_ALPHA]}),L.enabled=h,Zc(U,A)},resetProperties:function(){this.mode=Ds.Mode.Style,this.type=T["highlight.type"],this.color=T["highlight.color"],this.width=T["highlight.width"],this.glow=T["highlight.glow"],this.strength=T["highlight.strength"]},contextLost:function(){this._renderTarget=null}}),u.defineProperties(Ds.prototype,{mode:{get:function(){return this._mode},set:function($){var J=this._mode;if($!==J){this._mode=$;var A=J===Ds.Mode.MouseOver||J===Ds.Mode.Style,l=$===Ds.Mode.MouseOver||$===Ds.Mode.Style;
l&&A||(A&&F(this.gv.getView(),"mousemove",this.onMouseOver),l&&X(this.gv.getView(),"mousemove",this.onMouseOver))}}}}),Ds.CommonShaderVs=["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),Ds.HighlightHard={fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},Ds.EdgeDetection={fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","uniform vec2 texSize;","uniform vec4 color;","void main() {","vec2 invSize = 1.0 / texSize;","vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);","vec4 c1 = texture2D( image, vUv + uvOffset.xy);","vec4 c2 = texture2D( image, vUv - uvOffset.xy);","vec4 c3 = texture2D( image, vUv + uvOffset.yw);","vec4 c4 = texture2D( image, vUv - uvOffset.yw);","float diff1 = (c1.r - c2.r)*0.5;","float diff2 = (c3.r - c4.r)*0.5;","float d = length( vec2(diff1, diff2) );","gl_FragColor = color * vec4(d);","}"].join("\n")},Ds.Blur={fs:["#define MAX_RADIUS 4","precision highp float;","varying vec2 vUv;","uniform sampler2D image;","uniform vec2 texSize;","uniform vec2 direction;","uniform float radius;","float gaussianPdf(in float x, in float sigma) {","return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;","}","void main() {","vec2 invSize = 1.0 / texSize;","float weightSum = gaussianPdf(0.0, radius);","vec4 diffuseSum = texture2D( image, vUv) * weightSum;","vec2 delta = direction * invSize * radius/float(MAX_RADIUS);","vec2 uvOffset = delta;","for( int i = 1; i <= MAX_RADIUS; i ++ ) {","float w = gaussianPdf(uvOffset.x, radius);","vec4 sample1 = texture2D( image, vUv + uvOffset);","vec4 sample2 = texture2D( image, vUv - uvOffset);","diffuseSum += ((sample1 + sample2) * w);","weightSum += (2.0 * w);","uvOffset += delta;","}","gl_FragColor = diffuseSum/weightSum;","}"].join("\n")},Ds.BlendTogether={fs:["precision highp float;","varying vec2 vUv;","uniform sampler2D image;","uniform sampler2D edgeTexture1;","uniform sampler2D edgeTexture2;","uniform float edgeStrength;","uniform float edgeGlow;","void main() {","vec4 edgeValue1 = texture2D(edgeTexture1, vUv);","vec4 edgeValue2 = texture2D(edgeTexture2, vUv);","vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;","float vv = texture2D(image, vUv).r;","vec4 finalColor = edgeStrength * vv * edgeValue;","gl_FragColor = finalColor;","}"].join("\n")};var Es=x.Light=function(){Vq(Es,this),this.s(pp,T[pp]),this.s(Qm,"sphere"),this.s("shape3d.reverse.cull",!0),this.s3(20,20,20)};Qq("Light",Ak,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(G,d,o){Es.superClass.onStyleChanged.apply(this,arguments),G===pp&&this.s("shape3d.color",o)}});var Fs=Kr.FrameState=function($,j){this.renderState=Jq.for(j),this.picking=!1,this.envmapReflectivity=.5,this.cameraPosition=A,this.projectMatrix=A,this.viewMatrix=A,this.view=$,this.defaultProgram=A,this.pickColorMap=A,this._pvStack=[],this._renderStateStack=[]};Fs.prototype.savePV=function(){var j=this.view;this._pvStack.push([li(this.projectMatrix),li(this.viewMatrix),j._18Q,li(j._7O)])},Fs.prototype.restorePV=function(){var e=this._pvStack.pop();if(e){var W=this.view;this.projectMatrix=W._projectMatrix=e[0],this.viewMatrix=W._viewMatrix=e[1],W._18Q=e[2],W._7O=e[3]}},Fs.prototype.setPV=function(x,q){var V=this.view,u=!1;if(x&&(this.projectMatrix=V._projectMatrix=x,u=!0),q&&(this.viewMatrix=V._viewMatrix=q,V._7O=li(q),u=!0),u){var y=V.getWidth(),H=V.getHeight(),U=li(this.projectMatrix);V._18Q=ds(U,U,q),V._18Q._wh=y/H}},Fs.prototype.syncEnv=function(a){var z=this,l=z.view;z.envmapReflectivity=l._envmapReflectivity||.5,z.cameraPosition=l.getEye(),z.projectMatrix=l._projectMatrix,z.viewMatrix=l._viewMatrix,z.pickColorMap=a,z.picking=l.getGL()._picking},Fs.prototype.setGLState=function(){var n=[0,0,0,0],Y=[!0,!0,!0,!0],F=[-1,1],C=[Xh.FUNC_ADD,Xh.FUNC_ADD],k=[Xh.SRC_ALPHA,Xh.ONE_MINUS_SRC_ALPHA,Xh.ONE,Xh.ONE_MINUS_SRC_ALPHA];return function(o,B){var H=this,j=H.renderState.gl,i=H.renderState.glState;i.dither=!1,B?i.color.mask=Y:i.color.reset(),i.pixelStore.reset(),i.blend.color=n,i.blend.equation=C,i.blend.func=k,i.cullFace.enabled=!1,i.scissor.enabled=!1,i.depth.enabled=!0,i.depth.clear=1,i.depth.func=j.LEQUAL,i.depth.range=F,i.stencil.enabled=!1,i.polygonOffset.enabled=!1,o?(i.depth.mask=!1,i.blend.enabled=!0):(i.depth.mask=!0,i.blend.enabled=!1)}}(),Fs.prototype.setUniforms=function(m){var N=this,d=N.view,i=N.renderState,Q=i.gl,Z=i.uniforms;Z.uBrightness=1,Z.uOpacity=1,Z.uPartOpacity=1,Z.uPick=N.picking,Z.uUseInstance=!1,Z.uTexture=!1,Z.uBlendTexture=!1,Z.uAlphaTest=T.alphaTest,Z.uTransparent=!!m,Z.uFix=!1,Z.uBatchColor=!1,Z.uBatchBlend=!1,Z.uBatchBrightness=!1,Z.uReflectivity=N.envmapReflectivity||.5,Z.uCameraPosition=N.cameraPosition,Z.uPMatrix=N.projectMatrix,Z.uViewMatrix=N.viewMatrix,Z.uEnvMap=null,fj(d,Z,dn),Z.uClipperMatrix=d._boxClipperMatrixes,Z.uClipperClipInner=d._boxClipperClipInner,Z.uEnvmapQuat=d._envmapExtraQuaternion,d._envmapRenderer.resetUniformCache(),N.picking||(ti(d,Q,A),d._fogDisabled||(Z.uFogColor=d._fogColor,Z.uFogDensity=d._fogDensity,Z.uFogNear=d._fogNear,Z.uFogFar=d._fogFar))},Fs.prototype.drawLayer=function(L){return this.view.renderLayers(L,!0)},Fs.prototype.drawData=function(Y,u,L){var r=this.view;if(r.isVisible(Y)){var X=this.renderState,j=X.uniforms,e=r.getData3dUI(Y);if(e){var I=X.gl,P=I._picking,y=r._picking,M=e._pickId;L&&(e._pickId=L),j.uPick=I._picking=r._picking=!!L,j.uTransparent=!!u,e._42(X.gl,X.program,u?R:K),j.uPick=I._picking=P,r._picking=y,e._pickId=M}}};var Gs=Kr.Graph3dView=function(K,H){var i=this;i.resetHeadlightProperties(),i.resetFogProperties(),i._webGLVersion=1,i._attributes=H||M.graph3dViewAttributes,i._25I={},i._view=bn(1,i);var V;i._attributes&&(V=i._attributes.canvas)||(V=rs(i._view)),i._canvas=V,X(V,"webglcontextlost",function(R){R.preventDefault(),sh(i),i._26I&&(i._doBufferGC(i._26I,!0),Sk(i._canvas,0,0),["_highlightHelper","shadowMap","flowMap","_envmapRenderer","_postProcessing"].forEach(function(R){i[R].contextLost()}),i.dm().each(function(e){var C=i.getData3dUI(e);C.contextLost()})),i._26I=q,i._1o.onContextLost(),i._35O=!0}),X(V,"webglcontextrestored",function(){i._35O=!1,i.iv()}),i._40Q=new Ns(i),i._43Q={},i._44Q=-1,i._batchIndexMap={},i._batchModelMap={},i._wireframeIndexMap={},i._wireframeModelMap={},i._wireframeIndexMapSwap={},i._wireframeModelMapSwap={},i._polylineIndexMap={},i._polylineIndexMap={},i._polylineIndexMapSwap={},i._polylineIndexMapSwap={},i._8O=[],i._7O=Sj(),i._6O=Sj(),i._1o=new Xs(i),i._30O=new $s(i),i._31O=new Ys(i),i._32O=new Zs(i),i._raycaster=new jt(i),i._highlightHelper=new Ds(i),i._postProcessing=new tt(i),i._41Q=[],i._42Q=0,i._frameRenderOptionStack=[],Kr.VR?(i.vr=new Kr.VR(i),i.isVREnabled=function(){return this.vr.enable},i.isVRPresenting=function(){return this.vr.isPresenting()}):(i.vr={enable:!1,isPresenting:m},i.isVREnabled=m,i.isVRPresenting=m),i.shadowMap=new ws(i),i.flowMap=new Rq(i),i._33Q=!0,i._eye=Wr(M.graph3dViewEye),i._center=Wr(M.graph3dViewCenter),i._up=Wr(M.graph3dViewUp),i._lightChanged=!1,i._59O=[],i._spots=[],i._dirs=[],i._boxClippers=[],i._flowObjects=[],i._frameId=0,i._picking=!1,i._batchInfoMap={},i._renderLayerInfoMap={},i._sortedRenderLayers=u.keys(Jf),i.overlappingBox=new Xd(i),i.dm(K?K:new Xl),i._coreInteractor=new nb(this),i._envmapRenderer=new Kr.EnvmapRenderer(this),i.setInteractors([new Qs(i)]),i._initView(),i._genBatchInstancedArrayFunc()},Hs={fogDisabled:1,fogMode:1,dashDisabled:1,batchColorDisabled:1,batchInstancedDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1,flowBlendMode:1,uvClipEnabled:1,ortho:1},Is={box:1,sphere:2},Js={addRGB:"FLOW_BLEND_MODE_ADD_RGB",addRGBA:"FLOW_BLEND_MODE_ADD_RGBA",overrideRGBA:"FLOW_BLEND_MODE_OVERRIDE_RGBA",overrideRGB:"FLOW_BLEND_MODE_OVERRIDE_RGB",overrideA:"FLOW_BLEND_MODE_OVERRIDE_A",multiplyRGB:"FLOW_BLEND_MODE_MULTIPLY_RGB",multiplyRGBA:"FLOW_BLEND_MODE_MULTIPLY_RGBA"},Ks=0;Xr("Graph3dView",u,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_shadow:1,ms_highlight:1,ms_quickVisible:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","blockSelectable","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable","zoomToCenter",Yh,Ig,"firstPersonMode",_q,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightDirection","headlightColor","headlightIntensity","headlightAmbientIntensity","headlightDisabled","headlightGroup","ortho","orthoWidth","syncEyeWithOrthoWidth","fovy","near","far",$d,kl,"up","aspect","fogDisabled","fogMode","fogDensity","fogColor","fogNear","fogFar","pickerResolution","dashDisabled","uvClipEnabled","batchColorDisabled","batchInstancedDisabled","batchBlendDisabled","batchBrightnessDisabled","flowBlendMode","hoverDelay","batchInfoMap","renderLayerInfoMap","rotateMinPhi","rotateMaxPhi","sortable","sortFunc"],_editable:!1,_sortable:M.graph3dViewSortable,_editHelperDisabled:M.graph3dViewEditHelperDisabled,_blockSelectable:M.graph3dViewBlockSelectable,_devicePixelRatio:A,_boundaries:A,_moveStep:M.graph3dViewMoveStep,_rotateStep:M.graph3dViewRotateStep,_rotateMinPhi:M.graph3dViewMinPhi===A?M.graph3dViewRotateMinPhi:M.graph3dViewMinPhi,_rotateMaxPhi:M.graph3dViewMaxPhi===A?M.graph3dViewRotateMaxPhi:M.graph3dViewMaxPhi,_pannable:M.graph3dViewPannable,_rotatable:M.graph3dViewRotatable,_walkable:M.graph3dViewWalkable,_resettable:M.graph3dViewResettable,_zoomable:M.graph3dViewZoomable,_zoomToCenter:!0,_firstPersonMode:M.graph3dViewFirstPersonMode,_mouseRoamable:M.graph3dViewMouseRoamable,_gridVisible:M.graph3dViewGridVisible,_gridSize:M.graph3dViewGridSize,_gridGap:M.graph3dViewGridGap,_gridColor:M.graph3dViewGridColor,_originAxisVisible:M.graph3dViewOriginAxisVisible,_centerAxisVisible:M.graph3dViewCenterAxisVisible,_axisXColor:M.graph3dViewAxisXColor,_axisYColor:M.graph3dViewAxisYColor,_axisZColor:M.graph3dViewAxisZColor,_ortho:M.graph3dViewOrtho,_orthoWidth:M.graph3dViewOrthoWidth,_syncEyeWithOrthoWidth:M.graph3dViewSyncEyeWithOrthoWidth,_fovy:M.graph3dViewFovy,_near:M.graph3dViewNear,_far:M.graph3dViewFar,_rectSelectable:M.graph3dViewRectSelectable,_rectSelectBackground:M.graph3dViewRectSelectBackground,_editSizeColor:M.graph3dViewEditSizeColor,_autoMakeVisible:_f,_pickerResolution:M.graph3dViewPickerResolution,_dashDisabled:M.graph3dViewDashDisabled,_uvClipEnabled:M.graph3dViewUvClipEnabled,_batchColorDisabled:M.graph3dViewBatchColorDisabled,_batchInstancedDisabled:M.graph3dViewBatchInstancedDisabled,_batchBlendDisabled:M.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:M.graph3dViewBatchBrightnessDisabled,_flowBlendMode:M.graph3dViewFlowBlendMode,addCamera:function(i){var l=this,k=u.freeze({id:l._42Q++,priority:i.priority||0,ignoreInPick:!!i.ignoreInPick,render:i.render});i.switch3DStatus&&(l._43Q[k.id]=!0),l._41Q.push(k),l._41Q.sort(function(t,i){return t.priority!==i.priority?t.priority-i.priority:t.id-i.id})},setEye:function(b,T,a){1===arguments.length&&(T=b[1],a=b[2],b=b[0]);var e=this._eye;e[0]=b,e[1]=T,e[2]=a,this.fp($d,q,e)},setCenter:function(i,t,w){1===arguments.length&&(t=i[1],w=i[2],i=i[0]);var R=this._center;R[0]=i,R[1]=t,R[2]=w,this.fp(kl,q,R)},setUp:function(w,D,l){1===arguments.length&&(D=w[1],l=w[2],w=w[0]);var G=this._up;G[0]=w,G[1]=D,G[2]=l,this.fp("up",q,G)},getDevicePixelRatio:function(){return this._picking?this._1o._resolution:this._devicePixelRatio||Jh},isTransparentMask:function(o){return o.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var k=this,P=k._aspect;return P?P:(P=k.getWidth()/k.getHeight(),P||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(u){var d=this,M=d._dataModel,y=d._selectionModel;M!==u&&(M&&(M.ump(d.handleDataModelPropertyChange,d),M.umm(d.handleDataModelChange,d),M.umd(d.handleDataPropertyChange,d),y||M.sm().ums(d.handleSelectionChange,d)),d._dataModel=u,u.mp(d.handleDataModelPropertyChange,d),u.mm(d.handleDataModelChange,d),u.md(d.handleDataPropertyChange,d),y?y._21I(u):u.sm().ms(d.handleSelectionChange,d),d._postProcessing.handleDataModleChange(M,u),d._tryInvalidateEnvmap(),d.invalidateAll(!0),d.invalidateLight(),d.invalidateboxClipper(),d.invalidateFlowObjects(),d._49Q(),d.fp(Sl,M,u),d._canvas.style.background=u.getBackground()||"")},handleDataModelPropertyChange:function(W){var r=W.property;if("background"===r){var b=this._canvas.style.background,h=W.newValue||"";this._canvas.style.background=h,this.fp("canvasBackground",b,h)}else if("envmapType"===r)this._tryInvalidateEnvmap();else if("envmap"===r){var b=this._shaderUseEnvmapFlag,h=!(!W.newValue||!W.newValue.length);b!==h&&sh(this),this.iv()}},handleDataPropertyChange:function(I){var p=I.data;this.invalidateData(p);var Q=I.property;Qp(p)&&"s:light.type"===Q?this.invalidateLight():"s:3d.clipbox"===Q?this.invalidateboxClipper(p,!0):"s:effect.flow"===Q?this.invalidateFlowObjects(p,!0):"s:shadow.cast"===Q?this.shadowMap.tryUpdateBounding(p):"s:3d.visible"===Q&&this.invalidateQuickVisible(p)},invalidateboxClipper:function(Q,R){var g=this._boxClippers,k=g.length;if(Q){var x=!!Q.s("3d.clipbox");if(R=!!R,x===R)g.indexOf(Q)<0&&g.push(Q);else{var Z=g.indexOf(Q);Z>=0&&g.splice(Z,1)}}else g=this._boxClippers=[],this.dm().each(function(T){T.s("3d.clipbox")&&g.push(T)});var A=g.length;k!==A&&(sh(this),this.shadowMap.deleteShadowProgram(),this._updateBoxClipperMatrix(),fj=A?Gg:pr),this.iv()},_updateBoxClipperMatrix:function(){for(var n,z,h=this._boxClippers,X=this._boxClipperMatrixes=[],c=this._boxClipperClipInner=[],k=this._boxClipperGroups=[],w=this._boxClipperShape=[],U=new We,R=0,r=h.length;r>R;R++)n=h[R],n.appendAnchorMatrix3d(z=bg(n,this.getMat(n))),X.push(U.getInverse(U.fromArray(z)).toArray()),c.push("inner"===n.s("3d.clipbox")),k.push(n.s("3d.clipbox.group")),w.push(Is[n.s("3d.clipbox.shape")]||1)},_49Q:function(){this._4AQ||this._48Q||this.dm().size()<M.graph3dViewDataNumWarningLine||(this._48Q=!0,console.log("Too many datas so than disable some feature to speed up.\nYou can set global Default.graph3dViewDataNumWarningLine to largeEnoughNum to avoid this, or call graph3dView.quitDataNumWarning() to quit.\n"),this.enableQuickVisibleMode(),this.getHighlightHelper().mouseOverData=null)},quitDataNumWarning:function(){this.disableQuickVisibleMode(),this._48Q=!1,this._4AQ=!0},invalidateFlowObjects:function(A,H){var w=this._flowObjects,t=w.length;if(A){var i=!!A.s("effect.flow");if(H=!!H,i===H)w.indexOf(A)<0&&w.push(A);else{var c=w.indexOf(A);c>=0&&w.splice(c,1)}}else w=this._flowObjects=[],this.dm().each(function(N){N.s("effect.flow")&&w.push(N)});t!==w.length&&sh(this),this.iv()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(H){var C=this,v=H.property;if(C.iv(),C._18Q=q,"eye"===v)C._33Q=!0;else if("devicePixelRatio"===v)C._42(C.getDevicePixelRatio());else if(Hs[v]&&(sh(C),"batchInstancedDisabled"===v)){C._genBatchInstancedArrayFunc(),this.shadowMap.deleteShadowProgram();var T,f=M.getBatchInfoMap();for(T in f)f[T]&&f[T].instanced&&C.invalidateBatch(T);f=C._batchInfoMap;for(T in f)f[T]&&f[T].instanced&&C.invalidateBatch(T)}},_5O:function(M){var W=M._22Q();return W?new W(this,M):q},getData3dUI:function(D){var J=this._25I[D._id];return J===A&&(J=this._5O(D),this._25I[D._id]=J),J},invalidateAll:function(r,H){var j=this;if(r){for(var v in j._25I){var E=j._25I[v];E&&E.dispose()}j._25I={},j.iv(),Wd(j)}else Wd(j),j.dm().each(function(u){j.invalidateData(u)});j.shadowMap.tryInvalidateLater(r,H)},invalidateSelection:function(){var X=this;X.sm().each(function(W){X.invalidateData(W)})},invalidateData:function(d){var r=this,o=r.getData3dUI(d);o&&(o.iv(),r.iv()),Wd(r,d)},getShape3dText:function(t){return t.getStyle("shape3d.text")||this.getLabel(t)},invalidateBatch:function(y){var F=this,o=F._40Q;o.each(function(O){F._invalidateBatch(y,O.batchModelMap,O.batchIndexMap),F._invalidateBatch("T"+y,O.wireframeModelMap,O.wireframeIndexMap),F._invalidateBatch("O"+y,O.wireframeModelMap,O.wireframeIndexMap),O.markBatchInvalid()}),F.iv()},_invalidateBatch:function(K,W,L){var x=this,h=W[K];h&&(h.ds.forEach(function(O){var o=x.getData3dUI(O);o&&o.iv(),delete L[O._id]}),delete W[K])},handleDataModelChange:function(f){var C=this,j=f.kind,Z=f.data;if("add"===j)C.invalidateData(Z),dq(Z)&&Z.getEdgeGroup()&&Z.getEdgeGroup().eachSiblingEdge(C.invalidateData,C),Qp(Z)&&C.invalidateLight(),Z.s("3d.clipbox")&&C.invalidateboxClipper(Z,!0),Z.s("effect.flow")&&C.invalidateFlowObjects(Z,!0),C._49Q();else if(j===ko){var M=Z._id,y=C._25I[M];y&&(y.dispose(),delete C._25I[M],C.iv()),Z===C._currentSubGraph&&C.setCurrentSubGraph(q),Wd(C,Z),Qp(Z)&&C.invalidateLight(),Z.s("3d.clipbox")&&C.invalidateboxClipper(Z,!1),Z.s("effect.flow")&&C.invalidateFlowObjects(Z,!1)}else j===bl&&(C.invalidateAll(!0),C.setCurrentSubGraph(q),Wd(C),C.invalidateLight(),C.invalidateboxClipper(),C.invalidateFlowObjects())},toCanvas:function(n,C,B){var W=this,d=W.getGL();if(W.validate(),n){var l=d.getParameter(d.COLOR_CLEAR_VALUE);Zc(d,n)}W._42(1,{renderAxis:!1,renderEdit:!1,renderGrid:!1});var o=W.getWidth()||1,S=W.getHeight()||1,u=new Uint8Array(4*o*S),E=rs(),z=E.getContext("2d");d.readPixels(0,0,o,S,d.RGBA,d.UNSIGNED_BYTE,u),Sk(E,o,S,1);for(var e=z.getImageData(0,0,o,S),g=e.data,R=0;R<g.length;R+=4){var T=R/4,s=L(T/o),f=T-s*o;T=4*((S-1-s)*o+f),g[T]=u[R],g[T+1]=u[R+1],g[T+2]=u[R+2],g[T+3]=u[R+3]}if(z.putImageData(e,0,0),n&&Zc(d,l),W._42(W.getDevicePixelRatio()),C&&B){var A=rs(),v=A.getContext("2d");return Sk(A,C,B,1),M.drawImage(v,E,0,0,C,B),A}return E},toDataURL:function($,k){var o=this,E=o.getGL();if(o.validate(),$){var O=E.getParameter(E.COLOR_CLEAR_VALUE);Zc(E,$)}o._42(1,{renderAxis:!1,renderEdit:!1,renderGrid:!1});var _=o._canvas.toDataURL(k||"image/png",1);return $&&Zc(E,O),o._42(o.getDevicePixelRatio()),_},isWebGL2:function(){return 2===this._webGLVersion},getGL:function(){var u=this._26I;if(u)return this.acquireProgram(),u;if(!this._35O){var N=this,S=N._canvas,H=N._attributes;if(!H||H.requestWebGL2!==!1)try{u=S.getContext("webgl2",H)||S.getContext("experimental-webgl2",H),u&&(N._webGLVersion=2,N._26I=u)}catch(l){}if(!u)try{u=S.getContext("webgl",H)||S.getContext("experimental-webgl",H)}catch(l){throw new Error("WebGL not supported")}if(!u)throw new Error("WebGL not supported");N._26I=u;var n=N._frameState=new Fs(this,u);N._glExtensions=new w(u),N._glCapabilities=new p(u,N._glExtensions),N._2O={},u._emptyCubeTexture=Bm(u),u._compiledShader={},u._emptyTexture=ig(u),u._emptyBlendTexture=ig(u),u._bufPool={},u._id=++Ks,u._divisorState=[],n.setGLState(),N._buffer={vs:Ib(u),ns:Ib(u),is:Ib(u),uv:Ib(u),batchColor:Ib(u),batchBlend:Ib(u),batchBrightness:Ib(u),lineDistance:Ib(u)},N._1O=$k(u);var i=N._cube={vs:Ib(u),ns:Ib(u),is:Ib(u),uv:Ib(u)};return lm(u,i.vs,qf),lm(u,i.ns,er),lm(u,i.uv,Ql),ql(u,i.is,he),N.acquireProgram(),N._genBatchInstancedArrayFunc(),u._renderInfo={calls:0,vertices:0,faces:0,lines:0,points:0,textureCache:{time:0,count:0,pixels:0},frame:0,cacheTimeCost:0,reflectDepth:0},u}},getGLCapabilities:function(){var V=this.getGL();return V?this._glCapabilities:void 0},getGLExtensions:function(){var e=this.getGL();return e?this._glExtensions:void 0},getEnvmap:function(){return this._glCapabilities&&this._glCapabilities.maxVertexTextures<M.graph3dEnvmapCapabilityRequire?null:this.dm().getEnvmap()},getEnvmapType:function(){var C,z=this.dm();return z&&(C=z.getEnvmapType()),C||"legacy"},setEnvmapExtraQuaternion:function(V){var E=this._envmapExtraQuaternion;this._envmapExtraQuaternion=V instanceof Mh.Quaternion?V.clone().inverse().toArray():null,null==E!=(null==V)&&sh(this)},invalidateEnvmap:function(O){return this._envmapRenderer.invalidateEnvmap(O)},_setEnvmapByProbeId:function(K,z){return this._envmapRenderer.setEnvmapByProbeId(K,z)},_tryInvalidateEnvmap:function(){var M=this.getEnvmapType();M!==this._lastProgramEnvmapType&&(sh(this),this.iv())},acquireProgram:function(){var y=this,W=y._26I;if(W&&!y._prg){var i=y._prg=W.createProgram();if(!i)return q;var H=y._dirs.length,T=y._spots.length,P=y._59O.length,A=y._boxClippers.length,r=y._flowObjects.length,g=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uUvMatrix","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uClipDirection","uClipPercent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightAmbientIntensity","uHeadlightColor","uFogColor","uFogDensity","uFogNear","uFogFar"];H&&g.push("uDirColor","uDirDirection"),T&&g.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),P&&g.push("uPointColor","uPointRange","uPointPosition"),Ml||(fq=ll(fq.substring(0,fq.indexOf("^#"))),ic=ll(ic),Ml=!0);var E=y.getEnvmap(),Q=E&&E.length,G=y.getEnvmapType(),t=["#define MAX_DIR "+H,"#define MAX_SPOT "+T,"#define MAX_POINT "+P,"#define MAX_BOX_CLIPPER "+A,"#define MAX_FLOW_OBJECT "+r,y._fogDisabled?"":"#define FOG","exp2"===y.getFogMode()?"#define FOG_EXP2":"",y._dashDisabled?"":"#define DASH",y._uvClipEnabled?"#define UV_CLIP":"",null==y._envmapExtraQuaternion?"":"#define ENVMAP_ROTATE",Q?"#define USE_ENVMAP":"","legacy"!==G?"#define ENVMAP_TYPE_CUBE_UV":"",y.isOrtho()?"#define ORTHOGRAPHIC":"",y._batchColorDisabled?"":"#define BATCHCOLOR",y._batchInstancedDisabled?"":"#define BATCHINSTANCE",y._batchBlendDisabled?"":"#define BATCHBLEND",y._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS","#define "+(Js[y.getFlowBlendMode()]||Js[M.graph3dViewFlowBlendMode]),y.shadowMap.enable?y.shadowMap.genShaderDefine():"",""].join("\n"),$=sf(W,i,W.VERTEX_SHADER,fq.replace("#PREFIX",t));W.getShaderParameter($,W.COMPILE_STATUS)||qi("COMPILE",W.VERTEX_SHADER,W.getError(),W.getShaderInfoLog($));var f=sf(W,i,W.FRAGMENT_SHADER,ic.replace("#PREFIX",t));if(W.getShaderParameter(f,W.COMPILE_STATUS)||qi("COMPILE",W.FRAGMENT_SHADER,W.getError(),W.getShaderInfoLog(f)),mp?g.push("aPosition"):(i.aPosition=0,W.bindAttribLocation(i,0,"aPosition")),W.linkProgram(i),!W.getProgramParameter(i,W.LINK_STATUS)){var m=W.getProgramInfoLog(i);return y._prg=q,m.indexOf("maximum temp register")>=0&&!y._glTempRegisterLimited?(y._glTempRegisterLimited=!0,W.deleteProgram(i),y.acquireProgram()):(qi("LINK",W.getProgramParameter(i,W.VALIDATE_STATUS),W.getError(),m),W.deleteProgram(i),q)}g.forEach(function(o){i[o]=/^u/.test(o)?W.getUniformLocation(i,o):W.getAttribLocation(i,o)});var K=y._frameState;K.renderState.program=K.defaultProgram=i,y._envmapRenderer.changeEnvmapType(y._lastProgramEnvmapType=G),y._shaderUseEnvmapFlag=Q,W.deleteShader($),W.deleteShader(f)}},isGLTempRegisterLimited:function(){return this._glTempRegisterLimited},getBrightness:function(s){var K=s.s("brightness"),b=this.isSelected(s)?s.s("select.brightness"):q;return K==q?b:b==q?K:K*b},getDataHighlightMode:function(H){return H.s("highlight.mode")},getWireframe:function(J){var U=J.s("wf.visible"),f=J.s("wf.width");return U===!0||f>0&&"selected"===U&&this.isSelected(J)?{color:J.s("wf.color"),width:f,"short":J.s("wf.short"),mat:J.s("wf.mat")}:void 0},getPartPosition:function(H,E,f,i){i=i||yq;var R=this.getData3dUI(H),O=R._16O(i.autoRotate,E,q,f||Ao,i.t3,i.r3,i.rotationMode);return[O[12],O[13],O[14]]},_transformPointToViewSpace:function(J){var d=[J[0],J[1],J[2]];return Vk(d,this._viewMatrix),d},_transformDirectionToViewSpace:function(h,C){var _=h?[h[0],h[1],h[2]]:[0,0,0];Vk(_,this._viewMatrix);var A=C?[C[0],C[1],C[2]]:[0,0,0];Vk(A,this._viewMatrix);var O=A[0]-_[0],n=A[1]-_[1],t=A[2]-_[2],P=Math.sqrt(O*O+n*n+t*t);return P?[O/P,n/P,t/P]:[O,n,t]},getWireframeGeometry:function(v){return v.s("wf.geometry")?{color:v.s("wf.color"),width:v.s("wf.width"),mat:v.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(m){return m.s("body.color")},getMat:function(k){return k.getMat?k.getMat():k.s("mat")},getFaceMat:function(A,D){return A.getFaceMat?A.getFaceMat(D):A.s(D+".mat")},getFaceBlend:function(e,N){return e.s(N+".blend")||e.s("all.blend")},getFaceColor:function(A,W){return A.s(W+".color")||A.s("all.color")},getFaceImage:function(P,p){return P.s(p+".image")||P.s("all.image")},getFaceBlendImage:function(z,N){return z.s(N+".blend.image")||z.s("all.blend.image")},getFaceDiscardSelectable:function(V,e){var m=V.s(e+".discard.selectable");return m==q?V.s("all.discard.selectable"):m},getFaceUv:function(C,O){return C.s(O+".uv")||C.s("all.uv")},getFaceUvOffset:function(Z,g){return Z.s(g+".uv.offset")||Z.s("all.uv.offset")},getFaceUvScale:function(E,f){return E.s(f+".uv.scale")||E.s("all.uv.scale")},getFaceUvRotation:function(b,e){return b.s(e+".uv.rotation")||b.s("all.uv.rotation")},getFaceUvAnchor:function(m,n){return m.s(n+".uv.anchor")||m.s("all.uv.anchor")},getFaceLight:function(M,T){var H=M.s(T+".light");return H==q?M.s("all.light"):H},getFaceVisible:function(v,X){var s=v.s(X+".visible");return s==q?v.s("all.visible"):s},getFaceOpacity:function(W,l){var J=W.s(l+".opacity");return J==q?W.s("all.opacity"):J},getFaceTransparent:function(S,y){var r=S.s(y+".transparent");return r==q?S.s("all.transparent"):r},getFaceReverseColor:function(o,E){return o.s(E+".reverse.color")||o.s("all.reverse.color")},getFaceReverseFlip:function(I,H){var A=I.s(H+".reverse.flip");return A==q?I.s("all.reverse.flip"):A},getFaceReverseCull:function(E,z){var W=E.s(z+".reverse.cull");return W==q?E.s("all.reverse.cull"):W},getTextureMap:function(){return this._2O},_2Oi:function(x,a,T){T=T||"";var L;(L=this._2O[x])||(L=this._2O[x]={}),L[T]=a},deleteTexture:function(B){var N=this;if(N._2O){var c=N._2O[B];if(c){delete N._2O[B];var F=N.getGL();for(var k in c)F.deleteTexture(c[k])}}},renderPickScene:function(){var C=this.getGL();this.syncRenderState(),this._picking=C._picking=!0,this.renderScene(),this._picking=C._picking=!1},invalidateCachedTexture:function(T){var n=this.getData3dUI(T);n.invalidateCachedTexture(this.getGL()),this.invalidateData(T)},invalidateShape3dCachedImage:function(V){this.invalidateCachedTexture(V)},invalidateCachedGeometry:function(k){var n=this.getData3dUI(k);n.invalidateCachedGeometry(),this.invalidateData(k)},isInteractive:function(E){return E.s("interactive")},getTexture:function(B,V,a,j){if(!B)return q;var l,s,R=this,Z=R.getGL(),b=R._2O[B];if(b&&(V&&(s=V.s("texture.mipmap.max")),l=b[s||""]||b.default),!l){var f=yd(B);if(j||(j={}),!f)return Z._emptyTexture;if(V){j.mipmapMaxLevel=s=V.s("texture.mipmap.max");var I=V.s("texture.wrap");j.clampToEdge="clampToEdge"===I?!0:"repeat"===I?!1:A}if(f.uuid||(f.uuid=x.Math.generateUUID()),f.tagName){if(f.dynamic)return $k(Z,f,R._1O,j);l=$k(Z,f,A,j),R._2Oi(B,l,s)}else{var t,D=V&&(V.s("texture.cache")||V.s("shape3d.image.cache")||f.textureCache),E=R.isVRPresenting();if(E&&(V._textureUpdateFrame===Z._renderInfo.frame?D=!0:V._textureUpdateFrame=Z._renderInfo.frame),D&&(t=R.getData3dUI(V),l=t.getCachedTexture(a),l&&t.interactiveInfo&&l.interactiveInfo&&(t.interactiveInfo[l.interactiveInfo.key]=l.interactiveInfo.info)),!l){var e=Z._renderInfo.textureCache;if(D){if(e.time>M.graph3dMaxVectorCacheTime)return R.redraw(),Z._emptyTexture;if(!_j(f,V))return Z._emptyTexture}var P;V&&(1!==V.s("texture.scale")?P=V.s("texture.scale"):1!==V.s("shape3d.texture.scale")&&(P=V.s("shape3d.texture.scale"))),P||(P=1);var g=V&&(V.s("fixSizeOnScreen")||V.s("shape3d.fixSizeOnScreen")),Y=g?Z.NEAREST:Z.LINEAR;g?"number"==typeof g&&(P*=0>g?1:g):V&&(V.s("vector.dynamic")||V.s("shape3d.vector.dynamic"))&&(t||(t=R.getData3dUI(V)),g=t.getVectorDynamicSize());var N,m,T,o=V&&V.s("shape3d");"billboard"===o?T=V.getTall()/V.getWidth():"plane"===o&&(T=V.getHeight()/V.getWidth());var h=Wq(f,V);if(g){var _;_=D?R._devicePixelRatio||Jh:R.getDevicePixelRatio(),N=g[0]>0?g[0]*_:P*h*_,m=g[1]>0?g[1]*_:P*(T?pm(f,V,R,Math.min(4096,h*T)):pm(f,V))*_}else N=P*h,m=P*(T?pm(f,V,R,Math.min(4096,h*T)):pm(f,V));if(N>=1&&m>=1){var u=0;(D||E)&&(u=Date.now());var H=R._glCapabilities.maxTextureSize;N=Math.min(N,H),m=Math.min(m,H);var J=Pn(N,m);if(!t&&V&&(t=R.getData3dUI(V)),t&&t.interactiveInfo){var z=B;"object"==typeof z&&(z=z.uuid||(z.uuid=x.Math.generateUUID()));var c=t.interactiveInfo[z]={};J.interactiveInfo=c.bodyInfo={compInfos:[],matrix:new co,rect:{x:0,y:0,width:N,height:m}}}xb(J,f,0,0,N,m,V,R),J.interactiveInfo&&(J.interactiveInfo=null),J.restore(),e.count++,e.pixels+=N*m,V?(j.minFilter=kg(V.s("texture.filter.min")||V.s("texture.filter"))||Y,j.magFilter=kg(V.s("texture.filter.mag")||V.s("texture.filter"))||Y):j.minFilter=j.magFilter=Y,D||E?(l=$k(Z,Pr,null,j),t.setCachedTexture(l,a),e.time+=Date.now()-u,c&&(l.interactiveInfo={key:z,info:c}),Pr=null):l=$k(Z,Pr,R._1O,j)}}}}return l},redraw:function(){this.iv()},validateImpl:function(){var b=this;if(b._lightChanged){b._lightChanged=!1;var f=[],t=[],z=[];b.dm().each(function(F){if(Qp(F)){var x=F.s("light.type");x===fe?f.push(F):x===Nc?t.push(F):x===hg&&z.push(F)}}),(f.length!==b._59O.length||t.length!==b._spots.length||z.length!==b._dirs.length)&&sh(b),b._59O=f,b._spots=t,b._dirs=z}var e=b.getAspect();e!==b.__cachedAspect__&&(b._updateSkybox({property:"asceptChanged"}),b.__cachedAspect__=e),b._42(),b._1o.iv()},getRenderInfo:function(){var W=this.getGL();return W?W._renderInfo:void 0},getDebugTip:function(){var y=this,J=y.getRenderInfo();if(J){var q=y.getGL()._validBufCount||0,e="Draw Calls: "+J.calls+"<br/>"+"Vertices: "+J.vertices+"<br/>"+"Faces: "+J.faces+"<br/>"+"Lines: "+J.lines+"<br/>"+(J.points?"Points: "+J.points+"<br/>":"")+"Buffers: "+q+"<br/>"+"Cache Models: "+u.keys(em).length+"<br/>"+"Shape3d Models: "+u.keys(rf).length;if(y.isVRPresenting()&&(e+="<br/>VR fps: "+y.vr.getFps()),J.textureCache){var H=J.textureCache.count;if(e+="<br/>2D Dynamic Textures: "+J.textureCache.count,H>0){var l,U=J.textureCache.pixels;l=U>1e6?Math.round(U/1e6)+"M":U>1e3?Math.round(U/1e3)+"K":Math.round(U),e+="<br/>2D Dynamic pixels: "+l}}return e}},getFrameState:function(){return this._frameState},isBoundingBoxInView:function(){var v=new x.Math.Box3,u=new x.Math.Matrix4;return function(E){var Z=E;if(Z instanceof x.Data&&(Z=this.getData3dUI(Z)),!Z.mat)return!0;var m=Z.getBoundingBox(!0);v.copy(m).applyMatrix4(u.fromArray(Z.mat));var q=this.getFrustum();return q.intersectsBox(v)}}(),updateScene:function(){var l=this;l._81O=q,l.overlappingBox.clear();var $=l._40Q;$.init();var E=l.getGL(),e=l.dm();if(e.isHierarchicalRendering())e.eachByHierarchical(function(b){var y=l.getData3dUI(b);y&&y.update(l,E,$)});else{var r,k,x,c=e.getDatas().getArray(),i=c.length;for(r=0;i>r;r++)k=c[r],x=l.getData3dUI(k),x&&x.update(l,E,$)
}this._updateBoxClipperMatrix(),$.onUpdated()},_pushFrameRenderOptions:function(f){this._frameRenderOptionStack.push(this._currentFrameRenderOptions),this._currentFrameRenderOptions=f},_popFrameRenderOptions:function(){this._currentFrameRenderOptions=this._frameRenderOptionStack.pop()},_getFrameRenderOptions:function(o){var A=this._currentFrameRenderOptions;return A&&A[o]},getRenderLists:function(){return this._40Q},renderScene:function(Y){function D(C,p){o.setGLState(C,p),o.setUniforms(C),o.renderState.attribs.disable(),x=T.directUniforms(),L=T.directAttribs(),L.disable()}function E(w){for(var u=!1;$>O;O++){var x=R[O];if(!k||!x.ignoreInPick){if(x.priority>=w)break;(!h._43Q[h._44Q=x.id]||pe[ed.length])&&(x.render(Q,h,o),D(),u=!0)}}return u}var h=this;h._pushFrameRenderOptions(Y),h._getFrameRenderOptions("createShadowMap")!==!1&&h.shadowMap.render(),h.flowMap.render();var Q=h.getGL();h._envmapRenderer.onBeforeRender(Q),h._44Q=-1;var x,L,o=h._frameState,T=o.renderState,v=T.glState,u=h._prg;h._projectMatrix=Vc(h),Wn(h,h._7O),h._viewMatrix=li(h._7O),h.isReflecting(Q)||ds(h._projScreenMatrix=Sj(),h._projectMatrix,h._viewMatrix),o.syncEnv(this._picking?this.pickColorMap:A),T.useProgram(u),D(!1,!0),Q.clear(Q.DEPTH_BUFFER_BIT);var k=h._picking,R=this._41Q,O=0,$=R.length;if(E(M.cameraPriority.skybox),k){var y=v.color.clear.slice(0);Zc(Q,[0,0,0,0])}else Zc(Q,[0,0,0,0]),v.blend.enabled=!1,v.depth.enabled=!1,v.depth.mask=!1,h._camera&&h._camera.s("camera.renderSky")===!1||h.drawSky(Q,u),h._getFrameRenderOptions("renderReflector")!==!1&&h.drawReflectors(Q)&&(h._projectMatrix=Vc(h),Wn(h,h._7O),h._viewMatrix=li(h._7O),o.syncEnv(),D()),v.blend.enabled=!1,v.depth.enabled=!0,v.depth.mask=!0,x.uTransparent=!1,h._getFrameRenderOptions("renderGrid")!==!1&&h._31O._42(Q,u);if(!Q.textureBatch||pe[(ONE_FRAME_TIME-6)/2]){k||(h.shadowMap.enable&&h.shadowMap.createShadow(x),h.flowMap.createFlow(x));for(var c=h._sortedRenderLayers,b=0,a=c.length;a>b;b++){var J=c[b],r=h.getRenderLayerInfo(J);if(!(!h._camera&&r.ignore||h._camera&&!h._camera.isLayerVisible(r.mask))){var _=r.priority;E(_)&&(k||(h.shadowMap.enable&&h.shadowMap.createShadow(x),h.flowMap.createFlow(x))),this.renderLayer(J)}}E(M.cameraPriority.infinity),k||h.flowMap.disableFlow(x),Oh(h,x,0,M.graph3dViewHeadlightAmbientIntensity),x.uHeadlightColor=[1,1,1,0],x.uUseEnvMap=!1,x.uHeadlightDirection=[0,0,0],x.uHeadlightRange=0,v.depth.enabled=!1,x.uTransparent=!1,x.shadowReceive=!1,fj(h,x,dn),k?h.drawFilter||h._30O._42(Q,u):(h._highlightHelper._42(Q,u),this._renderAxisAndEditHelper(h._getFrameRenderOptions("renderAxis")!==!1,h._getFrameRenderOptions("renderEdit")!==!1),v.blend.enabled=!1,v.depth.mask=!0),v.depth.enabled=!0,k&&Zc(Q,y),lm(Q,q),ql(Q,q),h._44Q=-1,h._popFrameRenderOptions(null)}},_renderAxisAndEditHelper:function(o,s){if(o||s){var r=this,b=r.getGL(),u=r._prg,P=r._frameState,A=P.renderState,k=A.glState,E=A.directUniforms();P.renderState.attribs.disable(),k.depth.enabled=!1,E.uTransparent=!1,E.shadowReceive=!1,k.blend.enabled=!1,k.depth.mask=!0,E.uPick=r._picking;var Z=!r._fogDisabled;Z&&(E.uFog=!1),o&&r._32O._42(b,u),s&&r._30O._42(b,u),Z&&(E.uFog=!0),lm(b,q),ql(b,q)}},renderLayers:function(o,A){A&&(o=Pb(o));for(var T=0,r=o.length;r>T;T++)this.renderLayer(o[T])},renderSky:function(){var s=this,M=s._frameState,e=M.renderState,V=e.glState,u=s.getGL(),E=s._prg;s._projectMatrix=Vc(s),Wn(s,s._7O),s._viewMatrix=li(s._7O),ds(s._projScreenMatrix=Sj(),s._projectMatrix,s._viewMatrix),M.syncEnv(),e.useProgram(E),M.setGLState(!1,!0),M.setUniforms(!1),M.renderState.attribs.disable(),u.clear(u.DEPTH_BUFFER_BIT),Zc(u,[0,0,0,0]),V.blend.enabled=!1,V.depth.enabled=!1,V.depth.mask=!1,s.drawSky(u,E),V.depth.mask=!0,V.depth.enabled=!0,lm(u,q),ql(u,q)},addRenderLayerListener:function(I,j,n){var $=this;$._renderLayerNotifier||($._renderLayerNotifier=new Ee),$._renderLayerNotifier.add(I,j,n)},removeRenderLayerListener:function(x,W){this._renderLayerNotifier&&this._renderLayerNotifier.remove(x,W)},fireRenderLayerEvent:function(l,e){var y=this._renderLayerNotifier;y&&y.fire({layer:l,phase:e})},renderLayer:function(X){var W=this,D=W._picking,J=W._40Q.get(X);if(J){W.fireRenderLayerEvent(X,"prepare");var A=W.getGL(),Z=W.getRenderLayerInfo(X),w=W._frameState,h=w.renderState,t=h.glState,d=h.directUniforms();!D&&W.isSortable()&&J.sort(W._sortFunc,W._projScreenMatrix);var Y,l,q,E=J.opaque,L=J.transparent,x=J.batchModelMap,$=J.polylineModelMap,b=J.wireframeModelMap,A=W.getGL(),N=W._prg;D||(t.blend.enabled=!1,t.depth.enabled=!0,t.depth.mask=!0),d.uTransparent=!1,Z.clearDepth!==!1&&A.clear(A.DEPTH_BUFFER_BIT);var j=this.drawFilter;if(j){for(q=E,Y=0,l=q.length;l>Y;Y++)j(q[Y].data)!==!0&&q[Y].ui._42(A,N,K);if(D)for(q=L,Y=0,l=q.length;l>Y;Y++)q[Y].ui._46Q(A);yh(W,x)}else{for(q=E,Y=0,l=q.length;l>Y;Y++)q[Y].ui._42(A,N,K);if(D)for(q=L,Y=0,l=q.length;l>Y;Y++)q[Y].ui._46Q(A);yh(W,x),kp(W,$),kp(W,b)}if(D||(t.blend.enabled=!0,t.depth.mask=!1),W._45Q=d.uTransparent=!0,j){for(q=L,Y=0,l=q.length;l>Y;Y++)j(q[Y].data)!==!0&&q[Y].ui._42(A,N,R);yh(W,x,null,!0)}else{for(q=L,Y=0,l=q.length;l>Y;Y++)q[Y].ui._42(A,N,R);yh(W,x,null,!0),kp(W,$,null,!0),kp(W,b,null,!0)}W._45Q=null,W.fireRenderLayerEvent(X,"post")}},_42:function(v,e){var V=this;if(!V._35O&&(!jh||pe(jh))){var X=V.getWidth(),t=V.getHeight();if(X&&t){var H=V.getGL();if(H){var A,Z=V._canvas;if(v?A=!0:v=V.getDevicePixelRatio(),!V._picking&&(A||X!==Z.clientWidth||t!==Z.clientHeight)){Sk(Z,X,t,v);var T=v;X&&Math.abs(H.drawingBufferWidth-X*v)>1&&(T=Math.min(T,H.drawingBufferWidth/X)),t&&Math.abs(H.drawingBufferHeight-t*v)>1&&(T=Math.min(T,H.drawingBufferHeight/t)),T!==v&&(V.setDevicePixelRatio(v=T),Sk(Z,X,t,v)),V._18Q=null}H.clear(H.COLOR_BUFFER_BIT);var D=H._renderInfo;D.calls=0,D.vertices=0,D.faces=0,D.lines=0,D.points=0,D.textureCache={time:0,count:0,pixels:0},D.frame=++V._frameId,D.cacheTimeCost=0,D.reflectDepth=0,X*=v,t*=v,this.syncRenderState();do{if(V.isVREnabled()&&V.vr.render(H,X,t,e))break;if(V.updateScene(),V._postProcessing.render(H,X,t,e))break;V.setViewport(H,0,0,X,t),V.renderScene(e)}while(!1);V._33Q=!1,V.countFrame(),V._doBufferGC(H)}}}},syncRenderState:function(){var i,r;(i=this._frameState)&&(r=i.renderState)&&r.syncLoss()},drawReflectors:function($){$._renderInfo.reflectDepth++;var v,r,J,u=this,A=u._dataModel.getReflectors(),F=!1;for(v in A)r=A[v],u.isVisible(r)&&(J=u.getData3dUI(r),J&&J.drawReflector&&J.drawReflector($)&&(F=!0));return $._renderInfo.reflectDepth--,F},isReflecting:function(P){return P._renderInfo.reflectDepth},getPostProcessing:function(){return this._postProcessing},enablePostProcessing:function(A,d){return this._postProcessing.enableModule(A,d)},getPostProcessingModule:function(j){return this._postProcessing.getModule(j)},getPostProcessingValue:function(Y,w){var X=this._postProcessing.getModule(Y);return X?X[w]:A},setPostProcessingValue:function(H,x,F){var m=this.getPostProcessingValue(H,x),D=this._postProcessing.getModule(H);D&&m!==F&&("enable"===x?this.enablePostProcessing(H,F):D[x]=F,this.firePropertyChange("postProcessing."+H+"."+x,m,F))},setDofImageFromGraphView:function(G,R,l){return this._postProcessing.getModule("Dof").setImageFromGraphView(G,R,l)},setViewport:function($,l,R,h,a){this._viewport=[l,R,h,a],Jq.for($).directState().viewport=this._viewport},getRenderState:function(){return Jq.for(this._26I)},getViewport:function(){return this._viewport},setBufferGCInterval:function(E){this._bufferGCInterval=E},_doBufferGC:function(g,x){var G,O,b=g._bufPool,d=0,u=0,K=g._renderInfo.frame,D=this._bufferGCInterval||10;for(G in b)d++,O=b[G],O&&(x||K-O._fid>D?(g.deleteBuffer(O._buf),O._buf=null,b[G]=null):u++);if(d/2>u&&d>128){var B={};for(G in b)b[G]&&(B[G]=b[G]);g._bufPool=B}g._validBufCount=u},_swapLineMap:function(){var q=this;Rr=q._polylineModelMap,q._polylineModelMap=q._polylineModelMapSwap,q._polylineModelMapSwap=Rr,Rr=q._wireframeModelMap,q._wireframeModelMap=q._wireframeModelMapSwap,q._wireframeModelMapSwap=Rr,Rr=q._polylineIndexMap,q._polylineIndexMap=q._polylineIndexMapSwap,q._polylineIndexMapSwap=Rr,Rr=q._wireframeIndexMap,q._wireframeIndexMap=q._wireframeIndexMapSwap,q._wireframeIndexMapSwap=Rr},_updateSkybox:function(Q){if(this._skybox&&Q){var w=Q.property,C=!1,V=this._skybox;if("eye"===w||"forceUpdate"===w){var o=this._eye;V.p3(o[0],o[1],o[2]),C=!0}if("near"===w||"far"===w||"forceUpdate"===w||"asceptChanged"===w){var u=V.__cachedS3__;u||(u=V.__cachedS3__=V.getFinalScale3d());var x=Math.sqrt(3),S=1/0,s=-1/0;u.forEach(function(v){v/=2,S=e(v,S),s=E(v,s)}),s*=x;var d=this._near,W=this._far,R=Math.tan(this.getFovy()/2)*d,c=this.getAspect()*R,F=1.1*Math.sqrt(c*c+R*R+d*d),L=1;if(F>S)L=F/S;else if(s>=W){var m=W*W/(d+W);L=m/s}if(1!==L){V.__updatingSkybox__=!0;var r=u.map(function(p){return L*p});V.s3(r),V.setScale3d(1,1,1),C=!0,delete V.__updatingSkybox__}}C&&this.invalidateData(V)}},getSkyBox:function(){return this.getSkybox()},setSkyBox:function(t){return this.setSkybox(t)},getSkybox:function(){return this._skybox},setSkybox:function(V){var G=this._skybox;if(G===V)return V&&this._updateSkybox({property:"forceUpdate"}),void 0;if(G&&(this._skyboxStyleMap&&G.setStyleMap(this._skyboxStyleMap),this._skyboxStyleMap=null,this._skyboxAnchor3d&&G.setAnchor3d(this._skyboxAnchor3d),this._skyboxAnchor3d=null,this._skyboxP3&&G.p3(this._skyboxP3),this._skyboxP3=null,this.handleDataModelChange({kind:ko,data:G})),this._skybox=V,this.ump(this._updateSkybox,this),V){V.removeFromDataModel(),this._skyboxStyleMap=x.Default.clone(V.getStyleMap()),this._skyboxAnchor3d=V.getAnchor3d(),V.setAnchor3d(.5,.5,.5),this._skyboxP3=V.p3().slice(0),V.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1});var g=V.onPropertyChanged;V.onPropertyChanged=function(R){g.call(V,R),!V.__updatingSkybox__&&["width","height","tall","scale","scaleTall"].indexOf(R.property)>=0&&(V.__cachedS3__=A)},this.mp(this._updateSkybox,this),this._updateSkybox({property:"forceUpdate"})}this.fp("skybox",G,V)},drawSky:function(o,_){var H=this,M=H._skybox;if(M){var b=Jq.for(o).directUniforms(),Y=H._headlightIntensity,P=qn(H._headlightColor),_=H._prg;1!==Y&&(P=[P[0]*Y,P[1]*Y,P[2]*Y]),b.uHeadlightColor=[P[0],P[1],P[2],1];var R=H.getData3dUI(M);if(R){var k=H.isOrtho(),K=k||this._computedProjectMatrix;if(K){var e=H._projectMatrix;k&&(H._ortho=!1),b.uPMatrix=H._projectMatrix=Vc(H,!0)}var F=M.p3(),s=this.getEye();(F[0]!==s[0]||F[1]!==s[1]||F[2]!==s[2])&&(M._position.x=s[0],M._54O=s[1],M._position.y=s[2]),R.validate(),R._42(o,_,t),K&&(k&&(H._ortho=!0),b.uPMatrix=H._projectMatrix=e)}o.clear(o.DEPTH_BUFFER_BIT),b.uHeadlightColor=[P[0],P[1],P[2],H._headlightDisabled?1:0]}},getLogicalPoint:function(E){return Hk(E,this._canvas)},isRectOverlapping:function(W){var M=this.getData3dUI(W);return M._rectOverlapping},getHitFaceInfo:function(k){k.target&&(k=this.lp(k));var s=this.getDataInfoAt(k);if(s){var X=this.intersectObject(k,s.data);if(X)return{data:s.data,face:X.part}}return q},unproject:function(q,S){var H=this,n=H.getWidth(),T=H.getHeight(),$=q.target?H.lp(q):q,B=$.x-n/2,d=$.y-T/2,_=2*(B/n),j=2*(-1*d/T);S=S||0;var o=Sj(),h=Vc(H),W=Wn(H);ds(o,h,W),Lm(o);var A=Ji([_,j,S,1],o);return[A[0]/A[3],A[1]/A[3],A[2]/A[3]]},getDataAt:function(f){var b=this.getDataInfoAt(f);return b?b.data:q},getDataInfoAt:function(y,m,f){return y.target&&(y=this.lp(y)),this._1o.get(Fn(y.x,y.y,m),!0,f)},getDatasInRect:function(W,v){return this._1o.get(W,!1,v)},setEditable:function(x){var e=this,d=e._editable;e._editable=x,this.fp(cn,d,x)},isEditable:function(Q){var r=this;return Q?r._editable?uk(Q)?Q.s("3d.editable")?r._editableFunc?r._editableFunc(Q):!0:!1:!1:!1:r._editable},isSelectable:function(A){return A.s("3d.selectable")&&this.sm().isSelectable(A)},isMovable:function(L){var y=this;return dq(L)&&L.getStyle(Oi)!==kh?!1:L.s("3d.movable")?y._movableFunc?y._movableFunc(L):!0:!1},isSizeEditable:function(o){return uk(o)?this._sizeEditableFunc?this._sizeEditableFunc(o):!0:!1},isRotationEditable:function(V){return uk(V)&&V.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(V):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(I){this.setZoom(Gi,I)},zoomOut:function(C){this.setZoom(1/Gi,C)},setZoom:function(){var L=new ah,P=new ah,F=new ah,x=new ah;return function(Z,O){if(1!==Z){var M=this;M._14o&&M._14o.stop(!0);var $,G=1/Z;L.copy(M.getCenter()),P.copy(M.getEye());var B=M._ortho;if(B){if($=M._orthoWidth,$<M._moveStep&&Z>1)return}else if(L.distanceTo(P)<M._moveStep&&1>G)return;var g=!1;return M._zoomToCenter===!1&&M._lastZoomLP&&(F.copy(P).sub(L).normalize(),M._81O=null,x.copy(M.getHitPosition(M._lastZoomLP,L.toArray(),F.toArray())),g=!0,M._lastZoomHit=x),(O=En(O))?(O.action=function(b){M.fi({kind:M._zooming?"betweenZoom":"beginZoom"}),M._zooming=1;var V=(G-1)*b+1;B&&M.setOrthoWidth($*V),g?(M.setEye(F.lerpVectors(x,P,V).toArray()),M.setCenter(F.lerpVectors(x,L,V).toArray())):B||M.setEye(F.lerpVectors(L,P,V).toArray())},O._37o=function(){delete M._14o,delete M._zooming,M.fi({kind:"endZoom"}),M.onZoomEnded()},M._14o=Mq(O)):(B&&M.setOrthoWidth($*G),g?(M.setEye(F.lerpVectors(x,P,G).toArray()),M.setCenter(F.lerpVectors(x,L,G).toArray())):B||M.setEye(F.lerpVectors(L,P,G).toArray()),void 0)}}}(),setOrthoZoom:function(f,O){return this.setZoom(f,O)},getPositionInfo:function(m){var j=this,o=j._eye,K=j._center,X=j.getAspect(),p=m?Tp(Dk(K,o,!0),Dk(m,o)):Hh(o,K);if(j._ortho){var d=j._orthoWidth;return{length:p,height:d/X,width:d}}var v=2*al(j._fovy/2)*p;return{length:p,height:v,width:v*X}},getCenterInfo:function(){var v=this;return v._81O||(v._81O=v.getPositionInfo()),Wr(v._81O)},rotate:function(l,E,e,Z){var V=this;if(l||E){Z==q&&(Z=V._firstPersonMode),V._88O&&V._88O.stop(!0);var c=V._center,z=V._eye,X=V.getCenterInfo().length,v=Z?c:z,i=Z?z:c,I=Dk(v,i),r=Cl(I[0],I[2]),P=Cl(h(I[0]*I[0]+I[2]*I[2]),I[1]),M=Z?kl:$d;return Z&&(E=-E),(e=En(e))?(e.action=function(J){V.fi({kind:V._rotating?"betweenRotate":"beginRotate"}),V._rotating=1;var F=r+l*J,e=P+E*J;e=Z?Y-Di(V,Y-e):Di(V,e),I[0]=X*o(e)*o(F),I[1]=X*O(e),I[2]=X*o(e)*O(F),v[0]=i[0]+I[0],v[1]=i[1]+I[1],v[2]=i[2]+I[2],V.fp(M,q,v)},e._37o=function(){delete V._88O,delete V._rotating,V.fi({kind:"endRotate"}),V.onRotateEnded()},V._88O=Mq(e)):(r+=l,P+=E,P=Z?Y-Di(V,Y-P):Di(V,P),I[0]=X*o(P)*o(r),I[1]=X*O(P),I[2]=X*o(P)*O(r),v[0]=i[0]+I[0],v[1]=i[1]+I[1],v[2]=i[2]+I[2],V.fp(M,q,v),void 0)}},pan:function(d,f,O,E){if(d||f){var J=this;E==q&&(E=J._firstPersonMode),J._89O&&J._89O.stop(!0);var N=Wn(J),l=[N[0]*d,N[4]*d,N[8]*d],y=[N[1]*f,N[5]*f,N[9]*f],C=l[0]+y[0],P=l[1]+y[1],V=l[2]+y[2],r=J._center,v=J._eye;if(E){var t=Tc(J.getBoundaries(),v[0],v[2],v[0]+C,v[2]+V,h(C*C+V*V));C=t[0],V=t[1]}if(O=En(O)){var S=Wr(v),j=Wr(r);return O.action=function(f){J.fi({kind:J._panning?"betweenPan":"beginPan"}),J._panning=1,r[0]=j[0]+C*f,r[1]=j[1]+P*f,r[2]=j[2]+V*f,v[0]=S[0]+C*f,v[1]=S[1]+P*f,v[2]=S[2]+V*f,J.fp($d,q,v),J.fp(kl,q,r)},O._37o=function(){delete J._89O,delete J._panning,J.fi({kind:"endPan"}),J.onPanEnded()},J._89O=Mq(O)}r[0]+=C,r[1]+=P,r[2]+=V,v[0]+=C,v[1]+=P,v[2]+=V,J.fp($d,q,v),J.fp(kl,q,r)}},walk:function(f,J,Y){if(f){var d=this;Y==q&&(Y=d._firstPersonMode),d._90O&&d._90O.stop(!0);var s=d._center,i=d._eye,h=Dk(s,i,!0);if(Y){var G=Tc(d.getBoundaries(),i[0],i[2],i[0]+h[0]*f,i[2]+h[2]*f,D(f));if(f=Hh(G),!f)return;h=[G[0]/f,0,G[1]/f]}if(J=En(J)){var M=Wr(i),k=Wr(s);return J.action=function(x){d.fi({kind:d._walking?"betweenWalk":"beginWalk"}),d._walking=1;var K=f*x;i[0]=M[0]+h[0]*K,i[1]=M[1]+h[1]*K,i[2]=M[2]+h[2]*K,s[0]=k[0]+h[0]*K,s[1]=k[1]+h[1]*K,s[2]=k[2]+h[2]*K,d.fp($d,q,i),d.fp(kl,q,s)},J._37o=function(){delete d._90O,delete d._walking,d.fi({kind:"endWalk"}),d.onWalkEnded()},d._90O=Mq(J)}i[0]+=h[0]*f,i[1]+=h[1]*f,i[2]+=h[2]*f,s[0]+=h[0]*f,s[1]+=h[1]*f,s[2]+=h[2]*f,d.fp($d,q,i),d.fp(kl,q,s)}},handleScroll:function(A,Q){lr(A);var h=this,Z=h._moveStep,j=h.getDataInfoAt(A);if(j){var Y=j.data;if(Y&&h.isInteractive(Y)){var D=h.intersectObject(A,Y);if(D){var z=D.part,p=yd(Y.s(z+".image")||Y.s("shape3d."+z+".image")||Y.s("all.image")||Y.s("shape3d.image"));if(p&&gl(p.scrollable,Y,h))return}}}return h.isFirstPersonMode()?(h.isPannable()&&h.pan(0,Q>0?Z:-Z),void 0):(h.isZoomable()&&(h._lastZoomLP=h.lp(A),h.setZoom(0>Q?1/jg:jg),h._lastZoomLP=h._lastZoomHit=null),void 0)},handlePinch:function(I,x){if(this.isZoomable()){if(Math.abs(I-x)<M.pinchZoomThreshold)return;this.setZoom(x>I?1/wb:wb)}},reset:function(L){this.setUp(M.graph3dViewUp),this.moveCamera(M.graph3dViewEye,M.graph3dViewCenter,L)},moveSelection:function(X,H,T){var P=this;P.dm().beginTransaction(),Vr(this.sm().toSelection(this.isMovable,this),X,H,T),P.dm().endTransaction()},getMoveMode:function(M,K){var R=K.s("3d.move.mode");if(R)return R;var n="88",L="89",W="90";return ck(M)||qr[n]&&qr[L]&&qr[W]?"xyz":qr[n]&&qr[L]?"xy":qr[n]&&qr[W]?"xz":qr[L]&&qr[W]?"yz":qr[n]?"x":qr[L]?"y":qr[W]?"z":"xz"},handleTick:function(){var G=this,k=!1,O=G._moveStep,r=O,w=!1,Y=!0,m=G._rotateStep*(Y?-1:1);if(G.isWalkable()||(r=0),G.isPannable()||(O=0),G.isRotatable()||(m=0),G._32Q){var X=(oj()-G._32Q)/50;r*=X,O*=X,m*=X}G._31Q&&(is(G._31Q),delete G._31Q,delete G._32Q),xs()&&(k=!0,G.pan(-O,0,w,Y)),_m()&&(k=!0,G.pan(O,0,w,Y)),xl()&&(k=!0,ck()?G.pan(0,O,w,Y):G.walk(r,w,Y)),ld()&&(k=!0,ck()?G.pan(0,-O,w,Y):G.walk(-r,w,Y)),lp()&&(k=!0,G.rotate(-m,0,w,Y)),Up()&&(k=!0,G.rotate(m,0,w,Y)),zg()&&(k=!0,G.rotate(0,-m/2,w,Y)),Pk()&&(k=!0,G.rotate(0,m/2,w,Y)),k&&(G._32Q=oj(),G._31Q=Mi(G.handleTick,G))},handleKeyDown:function(p){var T=this;!qp(p)&&Em[p.keyCode]?T.handleTick():jc(p)?T.selectAll():hj(p)?T.handleDelete(p):Yo(p)&&this.isResettable()&&T.reset()},checkDoubleClickOnNote:function(C,B,S){var a=this;if(S===Mb){if(B.s("note.toggleable"))return B.s(Fk,!B.s(Fk)),a.fi({kind:"toggleNote",event:C,data:B,part:S}),!0}else if(S===Wh&&B.s("note2.toggleable"))return B.s(rh,!B.s(rh)),a.fi({kind:"toggleNote2",event:C,data:B,part:S}),!0;return!1},checkDoubleClickOnRotation:function(L,$,h){return h===ct?($.setRotationX(0),!0):h===dt?($.setRotationY(0),!0):h===et?($.setRotationZ(0),!0):!1},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(P){var T=this;if(T.isOrtho())return T.getWidth()/T.getOrthoWidth();var l=T.getCenter(),x=T.getHeight(),I=T.getEye(),G=[l[0]-I[0],l[1]-I[1],l[2]-I[2]],s=[P[0]-I[0],P[1]-I[1],P[2]-I[2]],A=Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]),V=1/Math.tan(T.getFovy()/2);return x*A*V/(s[0]*G[0]+s[1]*G[1]+s[2]*G[2])},inViewSpace:function(Z){var Y,I=this,j=I._transformPointToViewSpace(Z),V=I.getAspect(),G=I.getNear(),d=I.getFar();return-j[2]<G||-j[2]>d?!1:I.isOrtho()?(Y=I.getOrthoWidth()/2,Math.abs(j[0])<=Y&&Math.abs(j[1]*V)<=Y):(Y=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2])*Math.tan(I.getFovy()/2),Math.abs(j[1]<=Y)&&Math.abs(j[0])<=Y*V)},getPVMatrix:function(){var r,w=this;return(r=w._18Q)||(r=Vc(w),w._18Q=ds(r,r,Wn(w)),w._18Q._wh=w.getWidth()/2/w.getHeight()),r},getFrustum:function(){var j=new We,p=new dg,f=new Array(16);return function(){for(var m=this.getPVMatrix(),T=!1,Y=0;16>Y;Y++)m[Y]!==f[Y]&&(T=!0,f[Y]=m[Y]);return T&&p.setFromMatrix(j.fromArray(m)),p}}(),toViewPosition:function(B){var s=this,H=s.getWidth()/2,I=s.getHeight()/2,X=s.getPVMatrix();return B=Ji([B[0],B[1],B[2],1],X),{x:H+H*B[0]/B[3],y:I-I*B[1]/B[3],z:B[2]/B[3]}},getHitPosition:function(v,y,z){var n=this,E=n.getWidth(),X=n.getHeight(),U=v.target?n.lp(v):v,r=U.x-E/2,t=U.y-X/2,g=n.getCenterInfo(),k=Wn(n);y=y?y:[0,0,0],z=z?z:[0,1,0],r=r/E*g.width,t=-1*t/X*g.height;var G=[k[0]*r,k[4]*r,k[8]*r],i=[k[1]*t,k[5]*t,k[9]*t],M=[G[0]+i[0],G[1]+i[1],G[2]+i[2]],j=n.getCenter(),b=Dr(n,y,z,[M[0]+j[0],M[1]+j[1],M[2]+j[2]]);return b?b:[0,0,0]},intersectObject:function(C,d){return this._raycaster.intersectObject(C,d)},intersectObjects:function(d,E,$){return this._raycaster.intersectObjects(d,E,$)},getLineLength:function(l){this.validate();var u=this.getData3dUI(l);if(u&&u.getCache){var c=u.getCache();if(c)return c[c.length-1].length}return 0},getLineOffset:function(F,E){var W=this.getData3dUI(F);if(W&&W.getCache){var P=W.getCache();if(P){var s=si(P,E);if(F.s("shape3d")!==Xp)return s;var t,Y;if(F.getScale3d&&(t=F.getScale3d(),1===t[0]&&1===t[1]&&1===t[2]&&(t=null)),F.r3&&(Y=F.r3(),0===Y[0]&&0===Y[1]&&0===Y[2]&&(Y=null)),!Y&&!t)return s;var I=new ah(F.p3()),w=new ah(s.point).sub(I),k=new ah(s.tangent).add(w);if(t&&(t=new ah(t),w.multiply(t),k.multiply(t)),Y){var S=(new Qo).setFromEuler(new nm(Y,F.getRotationMode(),!0));w.applyQuaternion(S),k.applyQuaternion(S)}return{point:w.clone().add(I),tangent:k.sub(w).normalize()}}}return q},_genBatchInstancedArrayFunc:function(){var A=this._glCapabilities&&this._glCapabilities.instancedArray&&!this._batchInstancedDisabled,v=A?hn:$n;this.batchInstancedModel=function(W,h,Z,J,R,P,q){v(this,W,h,Z,J,R,P,q)};var m=A?gr:Gn;this.batchInstancedShapeFace=function(u,R,F){m(u,R,F)};var j=A?Kq:xn;this.batchInstancedFace=function(D,T,Q,b,P){j(this,D,T,Q,b,P)}},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},moveCamera:function(V,P,m){var K=this,v=K.getEye();v=[v[0],v[1],v[2]];var Z=K.getCenter();if(Z=[Z[0],Z[1],Z[2]],V||(V=v),P||(P=Z),K._flyAnim&&K._flyAnim.stop(!0),m=En(m),!m)return K.setEye(V[0],V[1],V[2]),K.setCenter(P[0],P[1],P[2]),delete K._flyAnim,!0;var M=[V[0]-v[0],V[1]-v[1],V[2]-v[2]],f=[P[0]-Z[0],P[1]-Z[1],P[2]-Z[2]];return m.action=function(y){K.setCenter(Z[0]+f[0]*y,Z[1]+f[1]*y,Z[2]+f[2]*y),K.setEye(v[0]+M[0]*y,v[1]+M[1]*y,v[2]+M[2]*y)},m._37o=function(){delete K._flyAnim},K._flyAnim=Mq(m)},flyTo:function(){function H(C,p,J){if(J instanceof x.Node){N.fromArray(bg(J,p.getMat(J)));var y=J.getAnchor3d();C.push((new ah).set(0-y.x,0-y.y,0-y.z).applyMatrix4(N)),C.push((new ah).set(0-y.x,0-y.y,1-y.z).applyMatrix4(N)),C.push((new ah).set(0-y.x,1-y.y,0-y.z).applyMatrix4(N)),C.push((new ah).set(0-y.x,1-y.y,1-y.z).applyMatrix4(N)),C.push((new ah).set(1-y.x,0-y.y,0-y.z).applyMatrix4(N)),C.push((new ah).set(1-y.x,0-y.y,1-y.z).applyMatrix4(N)),C.push((new ah).set(1-y.x,1-y.y,0-y.z).applyMatrix4(N)),C.push((new ah).set(1-y.x,1-y.y,1-y.z).applyMatrix4(N))}}var P=new ah,h=new ah,D=new ah,O=new ah,b=new ah,N=new We,L=new x.Math.Quaternion,v=new nm,I=new hl;return function(r,l,d){var Y=this;"boolean"==typeof l&&(l={animation:l}),l=l||{};var V=l.center,J=l.distance,m=l.direction,R=l.worldDirection,c=d||l.ratio||.8,Z=l.xRatio||c,n=l.yRatio||c;(d!==A||l.duration||l.frames)&&(l={animation:l});var z,B,f=[],E=J===A;if(V&&D.fromArray(V),!V||E)if(r||(r=Y.dm().getDatas()),1===r.length&&(r=Bd(r)?r.get(0):r[0]),r instanceof x.Node)V||D.fromArray(r.p3()),E&&(H(f,Y,r),z=f.length);else{if(!r.length)return;if((E||!V)&&(f=[],r.forEach(function(M){H(f,Y,M)}),z=f.length,!z))return;V||(I.setFromPoints(f),D.copy(I.min).add(I.max).multiplyScalar(.5))}if(Y._flyAnim&&Y._flyAnim.stop(!0),P.fromArray(Y.getEye()),h.fromArray(Y.getCenter()),Y.setCenter(D.x,D.y,D.z),O.subVectors(P,h),m||R){!R&&r instanceof x.Node?L.setFromEuler(v.set(r.r3(),r.getRotationMode(),!0)):L.set(0,0,0,1);var u=O.length();O.fromArray(R||m).applyQuaternion(L).setLength(u)}var s=new ah(Y.getUp()),G=Mh.fequal(s.x,0,1e-5)&&Mh.fequal(s.z,0,1e-5);if(G&&0===O.x&&0===O.z){var t=.001,k=O.y;O.y=k*(1-t),O.z=Math.sign(k)*t}var T=0;if(E){var q,o,W,j=Z,i=n;if(b.copy(O),Y.isOrtho()){var C=-1/0;for(Y._eye[0]=O.x+D.x,Y._eye[1]=O.y+D.y,Y._eye[2]=O.z+D.z,q=Vc(Y),ds(q,q,Wn(Y)),B=0;z>B;B++)W=f[B],o=Ji([W.x,W.y,W.z,1],q),C=Math.max(C,Math.max(Math.abs(o[0])/j,Math.abs(o[1])/i));T=Y.getOrthoWidth()*C}else{for(var S,U,_=Y.getNear(),y=10;y--;){for(Y._eye[0]=O.x+D.x,Y._eye[1]=O.y+D.y,Y._eye[2]=O.z+D.z,q=Vc(Y),ds(q,q,Wn(Y)),S=!0,U=-1/0,B=0;z>B;B++){if(W=f[B],o=Ji([W.x,W.y,W.z,1],q),o[3]<_&&y){O.multiplyScalar(2),S=!1;break}U=Math.max(U,Math.max(Math.abs(o[0])/j,Math.abs(o[1])/i)-o[3])}if(S)break}O.setLength(U+O.length())}O.manhattanLength()<1e-6&&O.copy(b)}else O.setLength(J);var K=O.add(D),e=En(l.animation);if(e){Y.setEye(P.x,P.y,P.z),Y.setCenter(h.x,h.y,h.z);var N=K.clone().sub(D),w=N.length();w&&N.multiplyScalar(1/w);var p=P.clone().sub(h),X=p.length();X&&p.multiplyScalar(1/X);var F=(new We).lookAtDirection(p,s),Q=(new We).lookAtDirection(N,s),g=(new Qo).setFromRotationMatrix(F),$=(new Qo).setFromRotationMatrix(Q),a=(new ah).subVectors(D,h);if(T)var Qe=Y.getOrthoWidth();var jj=new ah,Dl=new ah,cb=new ah,Kq=e.action,Mc=e._37o,Xh=h.clone();return e.action=function(j,r){Dl.copy(Xh).addScaledVector(a,j);var i=g.clone().slerp($,j);jj.set(0,0,1).applyQuaternion(i).setLength(X+(w-X)*j).add(Dl),cb.set(0,1,0).applyQuaternion(i),Y.setCenter(Dl.x,Dl.y,Dl.z),Y.setEye(jj.x,jj.y,jj.z),Y.setUp(cb.x,cb.y,cb.z),T&&Y.setOrthoWidth((T-Qe)*j+Qe),Kq&&Kq(j,r)},e._37o=function(){delete Y._flyAnim;var g=Y.getUp(),r=G?M.graph3dViewUp:s.toArray();(g[0]!==r[0]||g[1]!==r[1]||g[2]!==r[2])&&Y.setUp(r),Mc&&Mc()},{lastEye:P,lastCenter:h,eye:K,center:D,orthoWidth:T,animation:Y._flyAnim=Mq(e)}}return Y.setEye(K.x,K.y,K.z),Y.setCenter(D.x,D.y,D.z),T&&Y.setOrthoWidth(T),delete Y._flyAnim,{lastEye:P,lastCenter:h,eye:K,center:D,orthoWidth:T}}}(),getBoundingBox:function(){function j(G,_,P){r.fromArray(bg(P,_.getMat(P)));var j=P.getAnchor3d();G.push((new ah).set(0-j.x,0-j.y,0-j.z).applyMatrix4(r)),G.push((new ah).set(0-j.x,0-j.y,1-j.z).applyMatrix4(r)),G.push((new ah).set(0-j.x,1-j.y,0-j.z).applyMatrix4(r)),G.push((new ah).set(0-j.x,1-j.y,1-j.z).applyMatrix4(r)),G.push((new ah).set(1-j.x,0-j.y,0-j.z).applyMatrix4(r)),G.push((new ah).set(1-j.x,0-j.y,1-j.z).applyMatrix4(r)),G.push((new ah).set(1-j.x,1-j.y,0-j.z).applyMatrix4(r)),G.push((new ah).set(1-j.x,1-j.y,1-j.z).applyMatrix4(r))}var r=new We;return function(y){if(y=y||this.sm().getSelection(),y instanceof x.Node&&(y=[y]),0===y.length)return q;var U=[];y.forEach(function(Z){uk(Z)&&j(U,this,Z)},this);var $=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];return U.forEach(function(O){$[0]=Math.min(O.x,$[0]),$[1]=Math.min(O.y,$[1]),$[2]=Math.min(O.z,$[2]),l[0]=Math.max(O.x,l[0]),l[1]=Math.max(O.y,l[1]),l[2]=Math.max(O.z,l[2])}),{min:$,max:l}}}(),setBatchInfo:function(f,x){var C=this._batchInfoMap[f];this._batchInfoMap[f]=x,this.fp("batchInfo",C,x)},getBatchInfo:function(Y){return this._batchInfoMap[Y]||Im[Y]},setOrthoWidth:function(e){var s=this._orthoWidth;if(this._orthoWidth=e,this._syncEyeWithOrthoWidth){var U=e/this.getAspect(),w=U/2/al(this.getFovy()/2),V=(new ah).fromArray(this.getEye()),t=(new ah).fromArray(this.getCenter());V.sub(t).setLength(w).add(t),this.setEye(V.toArray())}this.fp("orthoWidth",s,e)},getCamera:function(O){var p=this;O||(O=p._mainCamera,O||(O=p._mainCamera=new x.Camera)),O.s({"camera.type":p.isOrtho()?"ortho":"perspective","camera.aspect":p.getAspect(),"camera.fovy":p.getFovy(),"camera.ortho.width":p.getOrthoWidth(),"camera.near":p.getNear(),"camera.far":p.getFar()});var _=p.getEye();return O.p3(_.slice()),O.lookAt(p.getCenter(),p.getUp()),O},syncFromCamera:function(m){var G=this,q=new ah(G.getEye()),S=new ah(G.getCenter()),J=new ah,C=S.sub(q).length();G.setEye(m.p3());var Z=m.getEuler();return J.set(0,0,-1).applyEuler(Z),q.copy(J).setLength(C).add(S.copy(m.p3())),G.setCenter(q.toArray()),q.set(0,1,0).applyEuler(Z),S.set(0,1,0),Math.abs(J.cross(q).dot(S))<1e-5?G.setUp(S.toArray()):G.setUp(q.toArray()),G.setOrtho("ortho"===m.s("camera.type")),G.setAspect(m.s("camera.aspect")),G.setFovy(m.s("camera.fovy")),G.setOrthoWidth(m.s("camera.ortho.width")),G.setNear(m.s("camera.near")),G.setFar(m.s("camera.far")),!0},resetHeadlightProperties:function(){this._headlightColor=M.graph3dViewHeadlightColor,this._headlightIntensity=M.graph3dViewHeadlightIntensity,this._headlightRange=M.graph3dViewHeadlightRange,this._headlightDirection=M.graph3dViewHeadlightDirection,this._headlightGroup=M.graph3dViewHeadlightGroup,this._headlightAmbientIntensity=M.graph3dViewHeadlightAmbientIntensity,this._headlightDisabled=M.graph3dViewHeadlightDisabled},resetFogProperties:function(){this._fogDisabled=M.graph3dViewFogDisabled,this._fogMode=M.graph3dViewFogMode,this._fogDensity=M.graph3dViewFogDensity,this._fogColor=M.graph3dViewFogColor,this._fogNear=M.graph3dViewFogNear,this._fogFar=M.graph3dViewFogFar},_sortRenderLayers:function(){var O=this,$=O._sortedRenderLayers=u.keys(O._renderLayerInfoMap);for(var c in Jf)$.indexOf(c)>=0||$.push(c);$.sort(function(y,t){return y=O.getRenderLayerInfo(y),t=O.getRenderLayerInfo(t),y.priority-t.priority})},_appendRenderLayer:function(o,q){o=o||0;var v,K=this.getRenderLayerInfo(q);if(K)v=K.mask,!this._renderLayerInfoMap[q]&&Jf[q]&&(this._renderLayerInfoMap[q]=K);else{var G=this._sortedRenderLayers.length;if(!(32>G))throw new Error("Only 31 render layer can be defined.");v=1<<G,K=this.getRenderLayerInfo(Ln),this._renderLayerInfoMap[q]={mask:v,priority:K.priority}}return o|=v},setRenderLayerInfo:function(w,G){this._appendRenderLayer(0,w);var L=this.getRenderLayerInfo(w),z=Wr(L);for(var p in G)"mask"!==p&&(L[p]=G[p]);this._sortRenderLayers(),this.fp("renderLayerInfo",z,L)},getRenderLayerInfo:function(q){return this._renderLayerInfoMap[q]||Wr(Jf[q])},setRenderLayerInfoMap:function(g){var i=this._renderLayerInfoMap;this._renderLayerInfoMap={};for(var j in g)this.setRenderLayerInfo(j,g[j]);this.fp("renderLayerInfoMap",i,this._renderLayerInfoMap)},getRenderLayerKeys:function(){return this._sortedRenderLayers}}),function(){function y(j,B,$){var D=j[B];D&&D.releaseTexture(),j[B]=$}function r(){return["\n #ifdef ENVMAP_TYPE_CUBE_UV \n","#define cubeUV_maxMipLevel 8.0 \n","#define cubeUV_minMipLevel 4.0 \n","#define cubeUV_maxTileSize 256.0 \n","#define cubeUV_minTileSize 16.0 \n","float getFace(vec3 direction) {","vec3 absDirection = abs(direction);","float face = - 1.0;","if (absDirection.x > absDirection.z) {","if (absDirection.x > absDirection.y)","face = direction.x > 0.0 ? 0.0 : 3.0;"," else ","face = direction.y > 0.0 ? 1.0 : 4.0;","} else {","if (absDirection.z > absDirection.y) ","face = direction.z > 0.0 ? 2.0 : 5.0;"," else ","face = direction.y > 0.0 ? 1.0 : 4.0;","}","return face;","} ","vec2 getUV(vec3 direction, float face) {","vec2 uv;","if (face == 0.0) {","uv = vec2(direction.z, direction.y) / abs(direction.x);","} else if (face == 1.0) {","uv = vec2(- direction.x, - direction.z) / abs(direction.y);","} else if (face == 2.0) {","uv = vec2(- direction.x, direction.y) / abs(direction.z);","} else if (face == 3.0) {","uv = vec2(- direction.z, direction.y) / abs(direction.x);","} else if (face == 4.0) {","uv = vec2(- direction.x, direction.z) / abs(direction.y);","} else {","uv = vec2(direction.x, direction.y) / abs(direction.z);","}","return 0.5 * (uv + 1.0);","} ","vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {","float face = getFace(direction);","float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);","mipInt = max(mipInt, cubeUV_minMipLevel);","float faceSize = exp2(mipInt);","float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);","vec2 uv = getUV(direction, face) * (faceSize - 1.0);","vec2 f = fract(uv);","uv += 0.5 - f;","if (face > 2.0) {","uv.y += faceSize;","face -= 3.0;","}","uv.x += face * faceSize;","if (mipInt < cubeUV_maxMipLevel) {","uv.y += 2.0 * cubeUV_maxTileSize;","}","uv.y += filterInt * 2.0 * cubeUV_minTileSize;","uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);","uv *= texelSize;","vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","uv.x += texelSize;","vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","uv.y += texelSize;","vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","uv.x -= texelSize;","vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","vec3 tm = mix(tl, tr, f.x);","vec3 bm = mix(bl, br, f.x);","return mix(tm, bm, f.y);","}","\n #define r0 1.0 \n","#define v0 0.339 \n","#define m0 - 2.0 \n","#define r1 0.8 \n","#define v1 0.276 \n","#define m1 - 1.0 \n","#define r4 0.4 \n","#define v4 0.046 \n","#define m4 2.0 \n","#define r5 0.305 \n","#define v5 0.016 \n","#define m5 3.0 \n","#define r6 0.21 \n","#define v6 0.0038 \n","#define m6 4.0 \n","float roughnessToMip(float roughness) {","float mip = 0.0;","if (roughness >= r1) {","mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;","} else if (roughness >= r4) {","mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;","} else if (roughness >= r5) {","mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;","} else if (roughness >= r6) {","mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;","} else {","mip = - 2.0 * log2(1.16 * roughness);","}","return mip;","} ","vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {","float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);","float mipF = fract(mip);","float mipInt = floor(mip);","vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);","if (mipF == 0.0) {","return vec4(color0, 1.0);","} else {","vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);","return vec4(mix(color0, color1, mipF), 1.0);","}","} ","\n #endif \n"].join("")
}function v(){return["vec4 sRGBToLinear( in vec4 value ) {","return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );","}","vec4 LinearTosRGB( in vec4 value ) {","return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );","}","vec4 inputTexelToLinear( vec4 value ) { return sRGBToLinear( value ); }","vec4 linearToOutputTexel( vec4 value ) { return LinearTosRGB( value ); }","vec4 envMapTexelToLinear( vec4 color ) { return inputTexelToLinear( color ); }"].join("")}function u(){return["precision mediump float;\n","precision mediump int;\n","attribute vec3 position;","attribute vec2 uv;","attribute float faceIndex;","varying vec3 vOutputDirection;","vec3 getDirection( vec2 uv, float face ) {","uv = 2.0 * uv - 1.0;","vec3 direction = vec3( uv, 1.0 );","if ( face == 0.0 ) { direction = direction.zyx; } ","else if ( face == 1.0 ) { direction = direction.xzy; direction.xz *= -1.0; } ","else if ( face == 2.0 ) { direction.x *= -1.0; }","else if ( face == 3.0 ) { direction = direction.zyx; direction.xz *= -1.0; } ","else if ( face == 4.0 ) { direction = direction.xzy; direction.xy *= -1.0; } ","else if ( face == 5.0 ) { direction.z *= -1.0; }","return direction;","}","void main() {","vOutputDirection = getDirection( uv, faceIndex );","gl_Position = vec4( position, 1.0 );","}"].join("")}function s(){return{vs:u(),fs:["precision mediump float;\n","precision mediump int;\n","varying vec3 vOutputDirection;","uniform samplerCube envMap;\n",v(),"\n void main() {","gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );","gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3(- vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;","gl_FragColor = linearToOutputTexel( gl_FragColor );","}"].join("")}}function B(){return{vs:u(),fs:["precision mediump float;\n","precision mediump int;\n","varying vec3 vOutputDirection;","uniform sampler2D envMap;","uniform vec2 texelSize;\n",v(),"\n #define RECIPROCAL_PI 0.3183098861837907 \n","\n #define RECIPROCAL_PI2 0.15915494309189535 \n","vec2 equirectUv( in vec3 dir ) {","float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;","float v = 0.5 - asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI;","return vec2( u, v );","}","void main() {","gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );","vec3 outputDirection = normalize( vOutputDirection );","vec2 uv = equirectUv( outputDirection );","vec2 f = fract( uv / texelSize - 0.5 );","uv -= f * texelSize;","vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","uv.x += texelSize.x;","vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","uv.y += texelSize.y;","vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","uv.x -= texelSize.x;","vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","vec3 tm = mix( tl, tr, f.x );","vec3 bm = mix( bl, br, f.x );","gl_FragColor.rgb = mix( tm, bm, f.y );","gl_FragColor = linearToOutputTexel( gl_FragColor );","}"].join("")}}function F(Y){return{vs:u(),fs:["precision mediump float;\n","precision mediump int;\n","#define n "+Y+"\n","varying vec3 vOutputDirection;","uniform sampler2D envMap;","uniform int samples;","uniform float weights[ n ];","uniform bool latitudinal;","uniform float dTheta;","uniform float mipInt;","uniform vec3 poleAxis; \n",v(),"\n #define ENVMAP_TYPE_CUBE_UV \n",r(),"\n vec3 getSample( float theta, vec3 axis ) {","float cosTheta = cos( theta );","vec3 sampleDirection = vOutputDirection * cosTheta + cross(axis, vOutputDirection) * sin(theta) + axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);","return bilinearCubeUV( envMap, sampleDirection, mipInt );","}","void main() {","vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );","if ( all( equal( axis, vec3( 0.0 ) ) ) ) {","axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );","}","axis = normalize( axis );","gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );","gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );","for ( int i = 1; i < n; i++ ) {","if ( i >= samples ) { break; }","float theta = dTheta * float( i );","gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );","gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );","}","gl_FragColor = linearToOutputTexel( gl_FragColor );","}"].join("")}}var $=Kr.EnvmapRenderer=function(k){this.gv=k,this._envmaps={},this._envmapHash={},this._probeCaptureTime={},this._pingPongRenderTarget=null,this._equirectShader=null,this._cubemapShader=null,this._blurMaterial=null,this._lastCaptureFrame=0};$.prototype={},$.prototype.constructor=$,$.prototype.changeEnvmapType=function(t){"legacy"===t?(this.setEnvmapByProbeId=this.setEnvmapLegacy,this.onBeforeRender=this.onBeforeRenderLegacy):(this.setEnvmapByProbeId=this.setEnvmap,this.onBeforeRender=this.onBeforeRenderNew)},$.prototype.invalidateEnvmap=function(K){var C=this.gv;if("legacy"!==C.getEnvmapType()){var d=C.getGL();d&&(K?(delete this._envmapHash[K],delete this._probeCaptureTime[K]):(this._envmapHash={},this._probeCaptureTime={}),C.iv())}},$.prototype.contextLost=function(){var G=this;G._envmaps={},G._envmapHash={},G._pingPongRenderTarget=null,G._equirectShader=G._cubemapShader=G._blurMaterial=null,G._envmapLegacy=null,G._lastLegacyImage=null},$.prototype.onBeforeRenderLegacy=function(c){this.assureTextureLegacy(c)},$.prototype.assureTextureLegacy=function(w){var p=this,Y=p.gv,d=Y.getEnvmap();if(d!==p._lastLegacyImage){if(p._envmapLegacy&&(w.deleteTexture(p._envmapLegacy),p._envmapLegacy=null),!d)return p._lastLegacyImage=d,void 0;var s=M.getImage(d);if(s&&s.tagName){s=M.resizeImagePOT(s,!0);var j=p._envmapLegacy=w.createTexture();w.activeTexture(w.TEXTURE0),w.bindTexture(w.TEXTURE_CUBE_MAP,j),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_MAG_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,s),w.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,s),w.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,s),w.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,s),w.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,s),w.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,s),w.bindTexture(w.TEXTURE_CUBE_MAP,w._emptyCubeTexture),p._lastLegacyImage=d}}},$.prototype.setEnvmapLegacy=function(g){g.uEnvMap=this._envmapLegacy},$.prototype.onBeforeRenderNew=function(V){this.assureTextureNew(V),this.resetUniformCache()},$.prototype.assureTextureNew=function(Z){var f=this,D=f.gv,B=D.getEnvmap(),Y=f._envmapHash,G=f._envmaps,V=Z._renderInfo.frame;if(!(this._lastCaptureFrame>=V||D._picking))for(var h in B){var p,R=B[h],J=R.type;switch(J){case"sphere":p=R.image,p!==Y[h]&&(sj=M.getImage(p),sj&&(Y[h]=p,y(G,h,f.fromEquirectangular(p))));break;case"cube":var W=R.images;if(W&&6===W.length&&(p=W.join(","),p!==Y[h])){for(var u=!0,_=0;6>_;_++)if(!M.getImage(W[_])){u=!1;break}u&&(Y[h]=p,y(G,h,f.fromCubemap(W)))}break;case"skybox":var d=D.getSkybox();if(d){var A=d.s("shape3d");if(p="sphere"===A?d._id+"_"+d.s("shape3d.image"):d._id+"_"+d.s("front.image"),p!==Y[h]){var u;if("sphere"===A)u=M.getImage(d.s("shape3d.image"));else{u=!0;for(var b=["front","back","left","right","top","bottom"],_=0;6>_;_++)if(!M.getImage(d.s(b[_]+".image"))){u=!1;break}}u&&(Y[h]=p,y(G,h,f.fromSkybox()))}}break;case"probe":var e=R.pos,v=R.size;if(p=e[0]+"_"+e[1]+"_"+e[2]+"_"+v,p!==Y[h]){var X=this._probeCaptureTime[p],t=Date.now();X||(this._probeCaptureTime[p]=X=t),t-X>M.envmapProbeMinWaitTime&&!vb&&!Rl||t-X>M.envmapProbeMaxWaitTime?(delete this._probeCaptureTime[p],Y[h]=p,y(G,h,f.fromSceneProbe(e,v,R.filter))):D.iv()}}}},$.prototype.resetUniformCache=function(){this._frameUniformCache={}},$.prototype.setEnvmap=function(C,h){var H=C.uuid,U=this._frameUniformCache,Q=this._envmaps[h];Q&&(Q=Q.texture),U[H]!==Q&&(U[H]=Q,C.uEnvMap=Q)},$.prototype.fromEquirectangular=function(w){var d=x.Default.getImage(w);return this.rectSize=[1/d.width,1/d.height],w=this.gv.getTexture(w),this.fromTexture(w)},$.prototype.fromCubemap=function(y){var b=this.gv.getGL(),N=b.createTexture();b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_CUBE_MAP,N),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR);for(var r=[],Y=L/3,j=0;6>j;j++)r[j]=M.resizeImage(x.Default.getImage(y[j]),Y);return b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,r[0]),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,r[1]),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,r[2]),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,r[3]),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,r[4]),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,r[5]),b.bindTexture(b.TEXTURE_CUBE_MAP,b._emptyCubeTexture),this.fromTexture(N,!0)},$.prototype.fromTexture=function(O,l){var K=this._allocateTargets();this._pingPongRenderTarget||(this._pingPongRenderTarget=this._allocateTargets());var G=this.gv,v=G.getGL(),z=Jq.for(v).directState(),d=z.depth.enabled;z.scissor.enabled=!0,z.depth.enabled=!1;var q=G.getViewport(v);return this._textureToCubeUV(O,K,l),this._applyPMREM(K),K.unbind(v),G.setViewport(v,q[0],q[1],q[2],q[3]),z.depth.enabled=d,z.scissor.enabled=!1,K},$.prototype.fromSkybox=function(){return this._fromCamera(function(r){r.s({"camera.onlySky":!0})})},$.prototype.fromScene=function(W){return this._fromCamera(function(D){D.s({"camera.onlySky":!1}),W&&W(D)})},$.prototype.fromNode=function(C){var M=this.gv.getData3dUI(C),E=M._42;M._42=pr;var F=this.gv.getSkybox(),R=C.p3();if(F){var K=F.p3();F.p3(R)}var u=this.fromScene(function(b){b.p3(R)});return M._42=E,F&&F.p3(K),u},$.prototype.fromSceneProbe=function(G,M,W){var P=this.gv,x=P.getSkybox();if(x){var m=x.p3();x.p3(G)}if(W){var h=P.isVisible;P.isVisible=function(f){var p=W(f);return p!==A?p:h.call(P,f)}}var F=this.fromScene(function(V){V.p3(G),V.s("camera.near",M)});return W&&(P.isVisible=h),x&&x.p3(m),F},$.prototype._fromCamera=function(z){var U=this.gv,w=U.getCamera();z&&z(w);var o=new Os(U,L,L,{cube:!0}),v=U.getGL(),K=U.getViewport(v),P=this.setEnvmapByProbeId,j=this.onBeforeRender;this.setEnvmapByProbeId=function(r){r.envMap=v._emptyTexture},this.onBeforeRender=pr,w.attachRenderTarget(o),w.render(U),w.detachRenderTarget(),this.setEnvmapByProbeId=P,this.onBeforeRender=j,U.setViewport(v,K[0],K[1],K[2],K[3]);var D=this.fromTexture(o.texture,!0);return o.releaseTexture(),D},$.prototype._allocateTargets=function(){return new Os(this.gv,3*e,3*e,{magFilter:Xh.NEAREST,minFilter:Xh.NEAREST})},$.prototype._textureToCubeUV=function(d,Z,b){var r,K=this.gv;b?null==(r=this._cubemapShader)&&(this._cubemapShader=r=this.createShader(s())):null==(r=this._equirectShader)&&(this._equirectShader=r=this.createShader(B()));var o=K.getGL();Z.bind(o),this._setViewport(Z,0,0,3*e,2*e);var f=K.getRenderState();f.useProgram(r);var n=f.directUniforms(),I=f.directAttribs();n.envMap=d,b||(n.texelSize=this.rectSize);var F=z[0];I.position=Id(o,null,F.vs,q,3),I.uv=Id(o,null,F.uv,q,2),I.faceIndex=Id(o,null,F.faceIs,q,1),nf(o,0,F.vs.length/3)},$.prototype._applyPMREM=function(G){for(var x,S,$,x=1;W>x;x++)S=Math.sqrt(j[x]*j[x]-j[x-1]*j[x-1]),$=t[(x-1)%t.length],this._blur(G,x-1,x,S,$)},$.prototype._setViewport=function(e,$,U,z,r){var c=this.gv;c.setViewport(c.getGL(),$,U,z,r),c.getRenderState().directState().scissor.box=[$,U,z,r]},$.prototype._blur=function(I,q,b,S,h){var v=this._pingPongRenderTarget;this._halfBlur(I,v,q,b,S,"latitudinal",h),this._halfBlur(v,I,b,b,S,"longitudinal",h)},$.prototype.createShader=function(w){var Y=this.gv;return Y.getPostProcessing().createShader(Y.getGL(),w).program},$.prototype._halfBlur=function(P,V,X,v,R,E,M){var g=this.gv,A=this._blurMaterial;if("latitudinal"===E||"longitudinal"===E){A||(this._blurMaterial=A=this.createShader(F(w)));var Y=g.getGL();V.bind(Y);var j=3,o=g.getRenderState();o.useProgram(A);var B,C,J,Q=o.directUniforms(),k=o.directAttribs(),c=G[X]-1,t=isFinite(R)?Math.PI/(2*c):2*Math.PI/(2*w-1),D=R/t,$=isFinite(R)?1+Math.floor(j*D):w,r=[],W=0;for(B=0;w>B;++B)C=B/D,J=Math.exp(-C*C/2),r.push(J),0==B?W+=J:$>B&&(W+=2*J);for(B=0;B<r.length;B++)r[B]=r[B]/W;Q.envMap=P.texture,Q.samples=$,Q.weights=r,Q.latitudinal="latitudinal"===E,M&&(Q.poleAxis=M),Q.dTheta=t,Q.mipInt=m-X;var p=G[v],C=3*Math.max(0,e-2*p),y=(0===v?0:2*e)+2*p*(v>m-Z?v-m+Z:0);this._setViewport(V,C,y,3*p,2*p);var T=z[v];k.position=Id(Y,null,T.vs,q,3),k.uv=Id(Y,null,T.uv,q,2),k.faceIndex=Id(Y,null,T.faceIs,q,1),nf(Y,0,T.vs.length/3),V.unbind(Y)}};var Z=4,m=8,e=Math.pow(2,m),H=[.125,.215,.35,.446,.526,.582],W=m-Z+1+H.length,w=20,c=(1+Math.sqrt(5))/2,T=1/c,t=[new ah(1,1,1),new ah(-1,1,1),new ah(1,1,-1),new ah(-1,1,-1),new ah(0,c,T),new ah(0,c,-T),new ah(T,0,c),new ah(-T,0,c),new ah(c,T,0),new ah(-c,T,0)],k=function(){for(var g=[],h=[],p=[],P=m,S=0;W>S;S++){var x=Math.pow(2,P);h.push(x);var R=1/x;S>m-Z?R=H[S-m+Z-1]:0==S&&(R=0),p.push(R);for(var L=1/(x-1),A=-L/2,F=1+L/2,l=6,C=[],i=[],y=[],c=0;l>c;c++){var o=2*(c%3)/3-1,_=c>2?0:-1;C.push(o,_,0,o+2/3,_,0,o+2/3,_+1,0,o,_,0,o+2/3,_+1,0,o,_+1,0),i.push(A,A,F,A,F,F,A,A,F,F,A,F),y.push(c,c,c,c,c,c)}g.push({vs:new yk(C),uv:new yk(i),faceIs:new yk(y)}),P>Z&&P--}return{_lodPlanes:g,_sizeLods:h,_sigmas:p}}(),z=k._lodPlanes,G=k._sizeLods,j=k._sigmas,L=M.EnvmapTextureSize}();var Ls=["left","front","right","back","top","bottom"],Ms=Kr._RenderList=function(U){function I(){_.length=0,q.length=0,m={}}function Y(U){var p,L,Q,G,n=U.gv,E=U.data,e=U.shapeModel;if(e){var K,u,T,b=E.s("shape3d.transparent")||E.s("points.transparent");for(bj(e)||(K=gl(e.transparent,E,n),e=[e]),Q=0,G=e.length;G>Q;Q++)T=e[Q],u=gl(T.transparent,E,n),u===A&&(u=K),u===A&&(u=b),u?L=!0:p=!0}for(Q=0,G=Ls.length;G>Q;Q++){var O=U[Ls[Q]];O&&(O.transparent?L=!0:p=!0)}n.isLabelVisible(E)&&(U.labelInfo&&(E.s(dd+".transparent")?L=!0:p=!0),U.label2Info&&(E.s(ip+".transparent")?L=!0:p=!0)),n.isNoteVisible(E)&&(U.noteInfo&&(E.s(Mb+".transparent")?L=!0:p=!0),U.note2Info&&(E.s(Wh+".transparent")?L=!0:p=!0)),U._38o&&(L=p=!0),L||(p=!0),U._renderParams={opaque:p,transparent:L}}function G(E,x){x&&Y(E);var z=E.data,Z=z._id;if(!m[Z]){m[Z]=!0;var U=E._renderParams;U&&U.visible!==!1&&(E={ui:E,data:z,z:0,id:Z},U.opaque&&_.push(E),U.transparent&&q.push(E))}}function Q(K,I){if(q.length>1){for(var Y,Z,y=[0,0,0,0],C=0,o=q.length;o>C;C++)Y=q[C].data,(Z=Y._position)?(y[0]=Z.x,y[1]=Y._54O,y[2]=Z.y,y[3]=1,Ji(y,I),q[C].z=y[2]/y[3]):q[C].z=0;q.sort(K||d)}}function X(Q){Q?(lj(M,h,Q,U),lj(e,K,Q,U),lj(N,r,Q,U)):(M=this.batchModelMap={},h=this.batchIndexMap={},e=this.polylineModelMap={},K=this.polylineIndexMap={},N=this.wireframeModelMap={},r=this.wireframeIndexMap={}),this.markBatchInvalid()}function w(x){x?lj(M,h,x,U):(M=this.batchModelMap={},h=this.batchIndexMap={}),this.markBatchInvalid()}function x(b){b?lj(e,K,b,U):(e=this.polylineModelMap={},K=this.polylineIndexMap={}),this.markBatchInvalid()}function z(w){w?lj(N,r,w,U):(N=this.wireframeModelMap={},r=this.wireframeIndexMap={}),this.markBatchInvalid()}function p(){return this._batchInvalid}function P(){this._batchInvalid=!0}function c(){this._batchInvalid=null}var _=[],q=[],M={},h={},e={},K={},N={},r={},m={};return{opaque:_,transparent:q,init:I,push:G,batchModelMap:M,batchIndexMap:h,polylineModelMap:e,polylineIndexMap:K,wireframeModelMap:N,wireframeIndexMap:r,ivBatch:X,ivModelBatch:w,ivPolylineBatch:x,ivWireframeBatch:z,markBatchInvalid:P,isBatchInvalid:p,onUpdated:c,sort:Q}},Ns=Kr._RenderLists=function(V){function F(){for(var y in O)O[y].init()}function Q(){for(var R in O)O[R].onUpdated()}function P(R,Y){R=R||"main";var g=O[R];return!g&&Y&&(g=O[R]=new Ms(V)),g}function X(T,p){var t=T.data.getRenderLayer(),S=P(t,!0);S.push(T,p)}function i(Z){for(var n in O)Z(O[n])}var O={};return{init:F,onUpdated:Q,get:P,push:X,each:i,lists:O}},Os=Kr.RenderTarget=function(R,K,d,v){var k,i=this;null!=K&&K.canvas?(k=K,K=d,d=v,v=arguments[4]):k=R.getGL(),v=v||{},v.cube===!!v.cube,v.samples=v.cube?0:Math.min(R._glCapabilities.maxSamples,v.samples&&v.samples>1&&2===R._webGLVersion?v.samples:0),i.options=v,i.uuid=x.Math.generateUUID(),i.gv=R,i.init(R,k,v),i.format=v.format||Xh.RGBA,i.generateMipmaps=!!v.generateMipmaps,i.depthInternalFormat=v.depthFormat||k.DEPTH_COMPONENT16,v.samples&&!R._glCapabilities._maxSamplesChecked?i.setSize(k,K||1,d||1):i.setSize(k,K,d)};u.assign(Kr.RenderTarget.prototype,{bind:function(E,c){var O=this.options;if(O.autoSize){var P=this.gv,t=P.getDevicePixelRatio(),Q=P.getWidth()*t,W=P.getHeight()*t;this.setSize(E,Q,W)}O.cube?Tf(E,this.frame[c]):Tf(E,this.options.samples?this._MSAAFbo:this.frame)},unbind:function(u){jr(u),this.options.samples&&(u.bindFramebuffer(u.READ_FRAMEBUFFER,this._MSAAFbo),u.bindFramebuffer(u.DRAW_FRAMEBUFFER,this.frame),u.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,u.COLOR_BUFFER_BIT,u.NEAREST),u.bindFramebuffer(u.READ_FRAMEBUFFER,null),u.bindFramebuffer(u.DRAW_FRAMEBUFFER,null))},isCube:function(){return this.options.cube},init:function(L,y,w){var F=this,A=w.samples,v=w.cube,n=F.texture=y.createTexture(),N=v?Xh.TEXTURE_CUBE_MAP:Xh.TEXTURE_2D;y.activeTexture(y.TEXTURE0),y.bindTexture(N,n),y.texParameteri(N,y.TEXTURE_WRAP_S,w.wrapS||y.CLAMP_TO_EDGE),y.texParameteri(N,y.TEXTURE_WRAP_T,w.wrapT||y.CLAMP_TO_EDGE);var d=A?y.NEAREST:y.LINEAR;if(y.texParameteri(N,y.TEXTURE_MIN_FILTER,w.minFilter||d),y.texParameteri(N,y.TEXTURE_MAG_FILTER,w.magFilter||d),y.bindTexture(N,null),v){F.depth=[],F.frame=[];for(var B=0;6>B;B++)F.depth[B]=y.createRenderbuffer(),F.frame[B]=y.createFramebuffer()}else F.depth=y.createRenderbuffer(),F.frame=y.createFramebuffer();F.assureTexture()},assureTexture:function(){var y=this;y.gv._2Oi(y.uuid,y.texture,"default"),x.Default.setImage(y.uuid,null)},releaseTexture:function(){this.gv.deleteTexture(this.uuid)},setSize:function(G,U,j){var y=this;if(U=Math.round(U),j=Math.round(j),U&&j&&(y.width!==U||y.height!==j)){y.width=U,y.height=j;var K=G.RENDERBUFFER,d=G.FRAMEBUFFER,B=y.options.samples,r=y.options.cube,b=r?Xh.TEXTURE_CUBE_MAP:Xh.TEXTURE_2D;if(B){var k=y.gv._glCapabilities;if(!k._maxSamplesChecked){for(G.bindRenderbuffer(K,y.depth),G.getError();B>1&&(G.renderbufferStorageMultisample(K,B,y.depthInternalFormat,U,j),G.getError());)B=Math.floor(B>>1);1>=B&&(B=0,G.texParameteri(b,G.TEXTURE_MIN_FILTER,y.options.minFilter||G.LINEAR),G.texParameteri(b,G.TEXTURE_MAG_FILTER,y.options.magFilter||G.LINEAR),G.renderbufferStorage(K,y.depthInternalFormat,U,j)),k._maxSamplesChecked=!0,k.maxSamples=y.options.samples=B,G.bindRenderbuffer(K,q)}}if(B&&(y._MSAAFbo||(y._MSAAFbo=G.createFramebuffer(),y._MSAARbO=G.createRenderbuffer()),G.bindRenderbuffer(K,y._MSAARbO),G.renderbufferStorageMultisample(G.RENDERBUFFER,B,G.RGBA8,U,j),Tf(G,y._MSAAFbo),G.framebufferRenderbuffer(d,G.COLOR_ATTACHMENT0,K,y._MSAARbO),G.framebufferRenderbuffer(d,G.DEPTH_ATTACHMENT,K,y.depth),jr(G),G.bindRenderbuffer(K,null)),G.activeTexture(G.TEXTURE0),G.bindTexture(b,y.texture),r)for(var w=G.TEXTURE_CUBE_MAP_POSITIVE_X,P=0;6>P;P++)y.setupFrameBufferTextureAndDepth(G,y.frame[P],y.depth[P],w+P);else y.setupFrameBufferTextureAndDepth(G,y.frame,y.depth,G.TEXTURE_2D);if(y.generateMipmaps&&(2===gv._webGLVersion||Mh.isPOT(U)&&Mh.isPOT(j))){G.generateMipmap(b);var Z=y.options.minFilter||(B?G.NEAREST:G.LINEAR);G.texParameteri(b,G.TEXTURE_MIN_FILTER,Z===G.NEAREST?G.NEAREST_MIPMAP_NEAREST:G.LINEAR_MIPMAP_LINEAR)}G.bindTexture(b,null)}},setupFrameBufferTextureAndDepth:function(E,T,P,K){var I=this,n=I.format;E.texImage2D(K,0,n,this.width,this.height,0,n,E.UNSIGNED_BYTE,null),Tf(E,T),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,K,I.texture,0),this.setupRenderBufferStorage(E,P),jr(E)},setupRenderBufferStorage:function(T,D){var z=this,H=T.RENDERBUFFER;T.bindRenderbuffer(H,D);var A=z.options.samples;A?T.renderbufferStorageMultisample(H,A,z.depthInternalFormat,z.width,z.height):(T.renderbufferStorage(H,z.depthInternalFormat,z.width,z.height),T.framebufferRenderbuffer(T.FRAMEBUFFER,T.DEPTH_ATTACHMENT,H,D)),T.bindRenderbuffer(T.RENDERBUFFER,null)},toCanvas:function(){var m=this,s=m.gv.getGL();Tf(s,m.frame);var g=m.width,n=m.height,q=new Uint8Array(4*g*n);s.readPixels(0,0,g,n,m.format,s.UNSIGNED_BYTE,q),jr(s);var S=$.createElement("canvas");S.width=g,S.height=n;var J=S.getContext("2d"),x=J.createImageData(g,n);return x.data.set(q),J.putImageData(x,0,0),S}});var Ps=Kr.Interactor=function(b){this.gv=this.g3d=b};Xr("Interactor",u,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()},fi:function(X){this.gv.fi(X)},startDragging:function(K){Tl(this,K)}});var Qs=Kr.DefaultInteractor=function(I){Vq(Qs,this,[I])};Xr("DefaultInteractor",Ps,{getState:function(){return this._62O},setState:function(k){this._62O=k},getDataInfoAt:function(o,l){var k=this.gv,f=k.getDataInfoAt(o);if(!k.isBlockSelectable()||!f||!f.data)return f;if(!l&&k.isSelected(f.data))return f;for(var t=f.data;(t=t.getParent())&&t instanceof x.Block&&k.isSelectable(t);){var Q=k.isSelected(t);if(Q&&l)break;if(f={data:t,part:f.part},Q&&!l)break}return f},handle_contextmenu:function(Q){lr(Q)},handle_mousewheel:function(o){this.gv.handleScroll(o,o.wheelDelta/40)},handle_DOMMouseScroll:function(A){2===A.axis&&this.gv.handleScroll(A,-A.detail)},handle_keydown:function($){this.gv.handleKeyDown($)},handle_mousedown:function(J){this.handle_touchstart(J)},handle_touchstart:function(N){lr(N);var b=this,a=b.gv,p=$h(N),P=b.getDataInfoAt(N),h=P?P.data:q,m=P?P.part:q,I=a.sm(),v=Io(N),j=rn(N);a.setFocus(N)&&(b._62O=q,b._57I=q,b.pendingClickThrough=q,b.__lastClientPoint__=Yi(N),h?qp(N)?I.co(h)?I.rs(h):I.as(h):I.co(h)?h instanceof df&&h.isClickThroughEnabled()&&$h(N)&&(b.pendingClickThrough=Yi(N)):I.ss(h):p&&(qp(N)?a.isRectSelectable()&&(b._62O=Rh):b._57I=Yi(N)),b._31Q&&(is(b._31Q),delete b._31Q,delete b._32Q),b._62O||(a.isFirstPersonMode()&&(ck(N)||$i(N)||j>2?b._62O="pan":a.isMouseRoamable()||Wg(N)?(b._62O="roaming",b.foward=v&&$h(N),b._32Q=oj(),b._31Q=Mi(b.tick,b)):p||(b._62O="roaming")),b._62O||(p&&v&&it[m]?(b._62O=m,b.p3=h.p3()):p&&v&&uk(h)&&a.isSelected(h)?a.isMovable(h)?(b._62O="move",b.p3=h.p3(),b.movedata=h):a._39Q(h)&&(b._62O="none"):Wg(N)&&(j>2?b._62O="pan":2===j&&(b.dist=ce(N),b._62O="pinch")))),b.point=a.lp(N),Tl(b,N),zr(N)?a.handleDoubleClick(N,h,m):a.handleClick(N,h,m))},tick:function(){var s=this,b=s.gv,F=b._moveStep;s.point&&b.isWalkable()&&(s._32Q&&(F*=(oj()-s._32Q)/50),b.walk(s.foward?F:-F),s._32Q=oj(),s._31Q=Mi(s.tick,s))},handle_mouseup:function(L){this.handle_touchend(L)},handle_touchend:function(Q){var i=this._57I;if(i&&(Hh(i,Yi(Q))<=1&&this.gv.sm().cs(),this._57I=q),i=this.pendingClickThrough){if(Hh(i,Yi(Q))<=1){var h=this.getDataInfoAt(Q);h&&h.data instanceof df&&h.data.isClickThroughEnabled()&&(h=this.getDataInfoAt(Q,!0),h&&(Q.clickThrough=!0,this.gv.sm().ss(h.data)))}this.pendingClickThrough=null}},handleWindowMouseMove:function(c){this.handleWindowTouchMove(c)},handleWindowTouchMove:function(h){var Q,v,x=this,K=x.gv,R=x._62O,p=x.point,C=K.dm(),t=K.lp(h),s=t.x-p.x,Z=t.y-p.y,a=K.getWidth(),U=K.getHeight();if(a&&U){var b=Yi(h),d=sl(K,b,x.__lastClientPoint__),V=Hh({x:0,y:0},d),w=-c*s/a,F=-c*Z/U;if("roaming"===R)x.rotate(h,w/2,F/2);else if(R===ct||R===dt||R===et)K._86O||C.beginTransaction(),K.fi({kind:K._86O?"betweenEditRotation":"beginEditRotation",event:h}),K._86O=1,K.sm().each(function(I){if(uk(I)&&K.isRotationEditable(I)){var e=D(w)>D(F)?w:F;R===ct?I.setRotationX(I.getRotationX()+e):R===dt?I.setRotationY(I.getRotationY()+e):R===et&&I.setRotationZ(I.getRotationZ()+e)}});else if("move"===R||it[R]){if(R===ft||R===gt||R===ht)K._87O||C.beginTransaction(),K.fi({kind:K._87O?"betweenEditScale":"beginEditScale",event:h}),K._87O=1;else{if(!K._moving){if(V<M.touchMoveThreshold)return;C.beginTransaction()}K.fi({kind:K._moving?"betweenMove":"beginMove",event:h}),K._moving=1}var u,e=x.p3,m=K.getPositionInfo(e),n=Wn(K);u=R===_s?"x":R===at?"y":R===bt?"z":R===ft?"sx":R===gt?"sy":R===ht?"sz":K.getMoveMode(h,x.movedata),s=s/a*m.width,Z=-1*Z/U*m.height;var q,k,r=[n[0]*s,n[4]*s,n[8]*s],X=[n[1]*Z,n[5]*Z,n[9]*Z],y=r[0]+X[0],N=r[1]+X[1],B=r[2]+X[2],j=[e[0]+y,e[1]+N,e[2]+B],z=Dk(K.getEye(),j,!0);if("xyz"===u?(q=j,K.moveSelection(y,N,B)):"xz"===u?(q=Dr(K,e,[0,1,0],j),q&&K.moveSelection(q[0]-e[0],0,q[2]-e[2])):"xy"===u?(q=Dr(K,e,[0,0,1],j),q&&K.moveSelection(q[0]-e[0],q[1]-e[1],0)):"yz"===u?(q=Dr(K,e,[1,0,0],j),q&&K.moveSelection(0,q[1]-e[1],q[2]-e[2])):"x"===u||"sx"===u?(z[0]=0,q=Dr(K,e,z,j),q&&(k=q[0]-e[0],"x"===u?K.moveSelection(k,0,0):K.sm().each(function(m){uk(m)&&K.isSizeEditable(m)&&(Q=m.getScaleX()+k/100,v=Q/m.getScaleX(),m.setScaleX(Q),ck(h)&&(m.setScaleY(m.getScaleY()*v),m.setScaleTall(m.getScaleTall()*v)))}))):"y"===u||"sy"===u?(z[1]=0,q=Dr(K,e,z,j),q&&(k=q[1]-e[1],"y"===u?K.moveSelection(0,k,0):K.sm().each(function(G){uk(G)&&K.isSizeEditable(G)&&(Q=G.getScaleTall()+k/100,v=Q/G.getScaleTall(),G.setScaleTall(Q),ck(h)&&(G.setScaleY(G.getScaleY()*v),G.setScaleX(G.getScaleX()*v)))}))):("z"===u||"sz"===u)&&(z[2]=0,q=Dr(K,e,z,j),q&&(k=q[2]-e[2],"z"===u?K.moveSelection(0,0,k):K.sm().each(function(a){uk(a)&&K.isSizeEditable(a)&&(Q=a.getScaleY()+k/100,v=Q/a.getScaleY(),a.setScaleY(Q),ck(h)&&(a.setScaleX(a.getScaleX()*v),a.setScaleTall(a.getScaleTall()*v)))}))),!q)return;x.p3=q}else if(R===Rh){var P=x.div;P||(P=x.div=Kn(),Bh(x.getView(),P),P.op=p,P.style.background=K.getRectSelectBackground()),K.fi({kind:K._rectSelecting?"betweenRectSelect":"beginRectSelect",event:h}),K._rectSelecting=1,P.rect=vn(P.op,t),Xn(P,P.rect)}else if("pinch"===R&&2===rn(h)){K.fi({kind:K._pinching?"betweenPinch":"beginPinch",event:h}),K._pinching=1;var k=ce(h);K._lastZoomLP||(K._lastZoomLP=_e(h)),K.handlePinch(k,x.dist),x.dist=k}else"pan"===R||ck(h)||$i(h)?x.pan(h,s,Z):"none"===R||K.isFirstPersonMode()||x.rotate(h,w,F);x.point=t}},pan:function(e,L,M){var b=this.gv;if(b.isPannable()){var t=b.getWidth(),d=b.getHeight();if(!t||!d)return;var D=b.getCenterInfo(),J=L/t*D.width,u=-1*M/d*D.height;b.fi({kind:b._panning?"betweenPan":"beginPan",event:e}),b._panning=1,b.pan(-J,-u)}},rotate:function(O,d,l){var c=this.gv;c.isRotatable()&&(c.fi({kind:c._rotating?"betweenRotate":"beginRotate",event:O}),c._rotating=1,c.rotate(d,l))},handleWindowMouseUp:function(c){this.handleWindowTouchEnd(c)},handleWindowTouchEnd:function(p){var m=this,n=m.gv,P=n.dm(),U=m.div;if(U){var t=n.getDatasInRect(U.rect);if(!t.isEmpty()){var z=n.sm(),u=z.toSelection(),Y=ck(p),h=p.altKey;t.each(function(m){z.co(m)?(!Y||Y&&h)&&u.remove(m):(!h||Y&&h)&&u.add(m)}),z.ss(u)}Qn(U)}n._moving&&(delete n._moving,n.fi({kind:"endMove",event:p}),n.onMoveEnded(),P.endTransaction()),n._panning&&(delete n._panning,n.fi({kind:"endPan",event:p}),n.onPanEnded()),n._rotating&&(delete n._rotating,n.fi({kind:"endRotate",event:p}),n.onRotateEnded()),n._86O&&(delete n._86O,n.fi({kind:"endEditRotation",event:p}),P.endTransaction()),n._87O&&(delete n._87O,n.fi({kind:"endEditScale",event:p}),P.endTransaction()),n._pinching&&(delete n._pinching,n.fi({kind:"endPinch",event:p}),n.onPinchEnded()),n._rectSelecting&&(delete n._rectSelecting,n.fi({kind:"endRectSelect",event:p}),n.onRectSelectEnded()),n._walking&&(delete n._walking,n.fi({kind:"endWalk",event:p}),n.onWalkEnded()),n._lastZoomLP=n._lastZoomHit=null,m.dist=m.point=m._62O=m.p3=m.movedata=m.div=m._57I=m.pendingClickThrough=m._32Q=m._31Q=m.foward=q,m.__lastClientPoint__=q}});var Rs=Kr.MapInteractor=function(R){Vq(Rs,this,[R]),this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01,this._panButton="right",this._minPhi=0,this._maxPhi=5*Math.PI/12};Xr("MapInteractor",Ps,{setUp:function(){Rs.superClass.setUp.call(this);var V=this.gv;this.__oldMinPhi__=V.getRotateMinPhi(),this.__oldMaxPhi__=V.getRotateMaxPhi(),V.setRotateMinPhi(this._minPhi),V.setRotateMaxPhi(this._maxPhi)},tearDown:function(){Rs.superClass.tearDown.call(this);var i=this.gv;i.setRotateMinPhi(this.__oldMinPhi__),i.setRotateMaxPhi(this.__oldMaxPhi__),delete this.__oldMinPhi__,delete this.__oldMaxPhi__},handle_contextmenu:function(o){lr(o)},handle_mousewheel:function(X){this.gv.handleScroll(X,X.wheelDelta/40)},handle_DOMMouseScroll:function(U){2===U.axis&&this.gv.handleScroll(U,-U.detail)},handle_keydown:function(c){this.gv.handleKeyDown(c)},handle_mousedown:function(C){this.handle_touchstart(C)},handle_touchstart:function(v){lr(v);var E=this,I=E.gv;if(I.setFocus(v)){var t=I.getDataInfoAt(v),_=t?t.data:q,A=t?t.part:q;E.__lastClientPoint__=Yi(v);var V=E.editing={point:I.lp(v),data:_,part:A};Wg(v)?V.touch=!0:(V.touch=!1,V.clickLeft=$h(v),V.pan=$i(v)?!0:"left"===this.panButton===V.clickLeft),_&&I._39Q(_)&&(V.preventDefault=!0),Tl(E,v),zr(v)?I.handleDoubleClick(v,_,A):I.handleClick(v,_,A)}},handle_mouseup:function(d){this.handle_touchend(d)},handle_touchend:function(){},handleWindowMouseMove:function(O){this.handleWindowTouchMove(O)},handleWindowTouchMove:function(U){var H=this,$=H.gv,T=H.editing;if(T){var j=$.lp(U),t=T.point,m=j.x-t.x,I=j.y-t.y;if(!T.moved){if(Math.abs(m)<H.threshold&&Math.abs(I)<H.threshold&&!(U.touches&&U.touches.length>1))return;T.moved=!0}if(!T.preventDefault){T.point=j;var i=T.part;if(it[i]){var d=T.data,B=$.dm(),L=$.getWidth(),k=$.getHeight(),x=-c*m/L,h=-c*I/k;if(i===ct||i===dt||i===et){$._86O||B.beginTransaction(),$.fi({kind:$._86O?"betweenEditRotation":"beginEditRotation",event:U}),$._86O=1;var V=D(x)>D(h)?x:h;$.sm().each(function(H){uk(H)&&$.isRotationEditable(H)&&(i===ct?H.setRotationX(H.getRotationX()+V):i===dt?H.setRotationY(H.getRotationY()+V):i===et&&H.setRotationZ(H.getRotationZ()+V))})}else{var f=d.p3(),R=$.getPositionInfo(f);m=m/L*R.width,I=-1*I/k*R.height;var e,g=Wn($),p=[g[0]*m,g[4]*m,g[8]*m],a=[g[1]*I,g[5]*I,g[9]*I],C=p[0]+a[0],W=p[1]+a[1],z=p[2]+a[2],v=[f[0]+C,f[1]+W,f[2]+z],K=Dk($.getEye(),v,!0);if(i===ft||i===gt||i===ht){if($._87O||B.beginTransaction(),$.fi({kind:$._87O?"betweenEditScale":"beginEditScale",event:U}),$._87O=1,e=Dr($,f,K,v)){var X,Q=0,u=["X","Y","Tall"];i===ft?X="X":i===gt?(X="Tall",Q=1):i===ht&&(X="Y",Q=2),u.splice(u.indexOf(X),1);var S=ck(U),s=(e[Q]-f[Q])/100;$.sm().each(function(d){if(uk(d)&&$.isSizeEditable(d)){var c=d["getScale"+X](),n=c+s;if(d["setScale"+X](n),S){var m=n/c;u.forEach(function(q){d["setScale"+q](d["getScale"+q]()*m)})}}})}}else if(i===_s||i===at||i===bt){if(!$._moving){var b=Yi(U),w=sl($,b,H.__lastClientPoint__),Z=Hh({x:0,y:0},w);if(Z<M.touchMoveThreshold)return;B.beginTransaction()}$.fi({kind:$._moving?"betweenMove":"beginMove",event:U}),$._moving=1;var Q=0;if(i===_s?Q=0:i===at?Q=1:i===bt&&(Q=2),K[Q]=0,e=Dr($,f,K,v)){var s=e[Q]-f[Q],J=[0,0,0];J[Q]=s,$.moveSelection.apply($,J)}}}}else if(T.touch){var l=U.touches.length;if(2!==l)H.pan(U,m,I);else{if(1>=l)return;var F=U.touches,P={x:F[0].clientX,y:F[0].clientY},y={x:F[1].clientX,y:F[1].clientY},_={x:y.x-P.x,y:y.y-P.y},o=T.lastCenter,E=Math.atan2(_.y,_.x),A=T.theta,N=0;A==q?A=T.theta=E:(N=E-A,T.thetaStarted||Math.abs(N)>H.touchRotateThreshold?(T.thetaStarted=!0,T.theta=E):N=0);var O=Y*(P.y+y.y)/2/$.getHeight(),n=T.phi,r=0;n==q?n=T.phi=O:(r=O-n,T.phiStarted||Math.abs(r)>H.touchRotateThreshold?(T.phiStarted=!0,T.phi=O):r=0);var G,Eb=Math.sqrt(_.x*_.x+_.y*_.y),wh=T.vlen;if(wh){var Tg=P.x-o.x,ie=P.y-o.y,up=y.x-o.x,Rj=y.y-o.y,ll=Math.sqrt(Tg*Tg+ie*ie),ug=Math.sqrt(up*up+Rj*Rj),kh=wh/2,Kd=H._sign2(ll-kh),Sg=H._sign2(ug-kh);0>Kd*Sg||0===Kd&&0===Sg?(G=1,T.vlen=Eb):(G||(G=Eb/wh),T.scaleStarted||Math.abs(G-1)>H.touchScaleThreshold?(T.vlen=Eb,T.scaleStarted=!0):G=1)}else wh=T.vlen=Eb,G=1;1!==G&&$.setZoom(G),(r||N)&&H.rotate(U,N,-r),T.lastCenter={x:(y.x+P.x)/2,y:(y.y+P.y)/2}}}else if(T.pan)H.pan(U,m,I);else{var L=$.getWidth(),k=$.getHeight();
if(!L||!k)return;var x=-c*m/L,h=-c*I/k;H.rotate(U,x,h)}}}},_sign2:function(L){return Math.abs(L)<this._touchScaleCheckAccuracy?0:L>0?1:-1},handleWindowMouseUp:function(r){this.handleWindowTouchEnd(r)},getDataInfoAt:function(P,H){var t=this.gv,S=t.getDataInfoAt(P);if(!t.isBlockSelectable()||!S||!S.data)return S;if(!H&&t.isSelected(S.data))return S;for(var $=S.data,e=S.part;($=$.getParent())&&$ instanceof x.Block&&t.isSelectable($);){var A=t.isSelected($);if(A&&H)break;if(S={data:$,part:e},A&&!H)break}return S},handleWindowTouchEnd:function(v){var x=this,h=x.editing;if(x.editing=null,h){var Y=x.gv;if(h.moved||!h.clickLeft&&!h.touch)Y._panning=null,Y._rotating=null,Y.fi({kind:h.pan?"endPan":"endRotate",event:v});else{var J=x.getDataInfoAt(v),B=J&&J.data;B instanceof df&&B.isClickThroughEnabled()&&(J=x.getDataInfoAt(v,!0),J&&(B=J.data)),B?Y.sm().setSelection([B]):Y.sm().clearSelection()}var j=Y.dm();Y._moving&&(delete Y._moving,Y.fi({kind:"endMove",event:v}),Y.onMoveEnded(),j.endTransaction()),Y._86O&&(delete Y._86O,Y.fi({kind:"endEditRotation",event:v}),j.endTransaction()),Y._87O&&(delete Y._87O,Y.fi({kind:"endEditScale",event:v}),j.endTransaction())}},pan:function(w,y,B){var o=this,K=o.gv;if(K.isPannable()){var l=K.getWidth(),$=K.getHeight();if(l&&$){var _=K.getCenterInfo(),V=-y/l*_.width,c=1*B/$*_.height;K.fi({kind:K._panning?"betweenPan":"beginPan",event:w}),K._panning=1;var t=o.keepHorizon,U=o.editing.touch;if((U&&w.touches&&w.touches.length>1||!U&&ck(w))&&(t=!t),!t)return K.pan(V,c);if(V||c){var S=Wn(K),z=[S[0]*V,S[4]*V,S[8]*V],i=[S[1],0,S[9]],P=Math.sqrt(i[0]*i[0]+i[2]*i[2]);P&&(i=[i[0]/P*c,0,i[2]/P*c]);var N=z[0]+i[0],L=z[1]+i[1],J=z[2]+i[2],Q=K._center,W=K._eye;Q[0]+=N,Q[1]+=L,Q[2]+=J,W[0]+=N,W[1]+=L,W[2]+=J,K.fp($d,q,W),K.fp(kl,q,Q)}}}},rotate:function(F,c,k){var R=this,q=R.gv;if(q.isRotatable()){var E=q._center,t=q._eye,L=Dk(t,E),Z=Cl(h(L[0]*L[0]+L[2]*L[2]),L[1]),D=Di(q,Z+k);k=D-Z,q.fi({kind:q._rotating?"betweenRotate":"beginRotate",event:F}),q._rotating=1,q.rotate(c,k)}}}),u.defineProperties(Rs.prototype,{panButton:{get:function(){return this._panButton},set:function(Q){this._panButton=Q}},minPhi:{get:function(){return this._minPhi},set:function(O){this.gv.setRotateMinPhi(this._minPhi=O)}},maxPhi:{get:function(){return this._maxPhi},set:function(N){this.gv.setRotateMaxPhi(this._maxPhi=N)}},keepHorizon:{get:function(){return this._keepHorizon},set:function(z){this._keepHorizon=z}},threshold:{get:function(){return this._threshold},set:function(s){this._threshold=s}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(E){this._touchScaleThreshold=E}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(m){this._touchRotateThreshold=m}}});var Ss,Ts="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAEyUlEQVRYR62XW0xcVRSG/58cmIG2HmstE9N4SX2xtVqBCISoFS/RmDSpKQSvTWNixUStQSqVyBQYJUGttrQVtYkPatuQPmhivMUHqbUBZ2itl1qjTzZpImNUZhDLsUeWWXgOOd2cgcGyk3mYs/de69trr70uxP8YIlJKMi0i9wIgyf0iEiM5PFdxzGeDiBQAuB7AjQBuALCN5NcGQDmANgBfeL8UyYnZ5M8KICJ3AXgAwAlfOMl/VHAQwPtveYAKuQLA2yQ/ngliRgAR2QogA2AvSdcUZAIE50VEYR4BsIDkC7kgQgFE5GIAuwDsJnkk1+aZAPw9IqLX1gjgcZK/m7KmAXjK4wBaSf4ZplxEIgCuA3Cz3gSAfgDHSf6dY/0FAJ4D0G5ChAEcAPBwmHIRqXNd90nLsiocx/k+k8n8oK/Atu2rIpHIStd1v7QsawfJd0Ouywawh6T609Q4B8C788NhZnddt29sbGxBd3f39q6urtNhJ43H48uam5u3lJSUjFiWdV8IxE0Aqki+6M9NAXjefjnJXsOZogBGBgYGttbU1Hw427PS+cHBwbVVVVUJAItJOoa8xwD8RPIT/T4J4L3zfQAeNL1dRMZra2ur+/v7/8pHub+mvr7+wr6+vs8KCgoWGABFAN4EsEHjhA9QBeA2ks8HF6vZk8nkQL4nNwGTyeTa8vLycsuy7jcg1Mk/IpnyAZoBaOQ6FHg+ddlsdqNt201zObm5NpvN7ly0aNHrJN8LyL4FwGqSr/gAOrnej3C60HXdw/F4PJ7L4fKFSiQSl7W0tLQVFRWtCQDoNRwguZ6aWABcorE9sEDf+QjJ1fkqmmmdiHwHoCToXyKiceR0rkhY5TjOq9FoVLPdeY/x8fG+SCSySe/cFKYWCFOyPJ1Or4zFYh3nrR3A8PBwe2lp6TcAfg4DmBYwAFyRTqdXxWKx9nkE+DYUIEyBiFQ6jvNaNBq9Zz4AZruCGIBlJI8ZXpolee18AORwwgoAp/xnqMmjPuilZ8+ePZRIJNo7OztD436+YB0dHZe2trY+W1hYWGsccD/JOh/gKQBHSWpanRwicnc2m91k2/bmfJWFrRsdHd29cOHCXSTfD8i+FcA1JHcEQ/HtJDVnTw3XdfcPDQ0dra6unto8F5hUKrWurKxslWVZG4L7RGQbgA9IDgWT0VsANprJaGJi4kxDQ8OagwcPjsxFeWNj49Le3l6N91qMTA2vmNnr6fovGXkmvxPAlST3hGz4LZVKbausrMzLEnryioqKNpJLzCpJRJ4AcJLkp6rHLEieBjBA8rB5Wtd1942NjS3p6el5qa2t7VSYNdThmpqaWoqLi38xze4dUku4CpLb/f1hJZnWBY+SzJpKRGSdV5LVOI5zIpPJnNQ1tm2viEQiV7uue8SyrJeDDhew8GIAO0me4w9hABdp8ahNBkktyacNr+Qu84pSndfX81VY6e6dXJV3AoiT/CMoMFcyUogeAG+Q/DyX8+VZlqvZHwKw2VQ+zQdCTL4FwBkPZFrJPUtjoildG5PC4J2bOvJpze7QWhHAj4HWbBImpDXTQsPvH5cDeMf39lxWnBXAU6TNqcZu7fn0lyB53GhOdf6ZQHN6bF6a0xxOuJTkrwbA5LdcJ831/V8SOUYQxYGhRwAAAABJRU5ErkJggg==",Us=32,Vs=Kr.GlobeInteractor=function(u,d){Vq(Vs,this,[u]);var m,K=d.radius||6378137,A=this,R=null;Ss||(Ss=Kn(),Ss.style.border="",Ss.style.backgroundImage="url("+Ts+")");var Q=new Qo,p=new ah,X=new ah,J=new ah,P=new zs,n="number"==typeof K?{x:K,y:K,z:K}:K,S={center:new ah(0,0,0),radius:n},w=function(m){u._81O=null;var H=u.getHitPosition(m,u.getCenter(),p.copy(u.getEye()).sub(X.copy(u.getCenter())).toArray());return P.origin.copy(u.getEye()),P.direction.copy(H).sub(P.origin).normalize(),P.intersectEllipsoid(S)},Z=function(x,Y){u._81O=null,P.origin.copy(u.getEye());for(var o,G,E=u.getCenter(),$=p.copy(u.getEye()).sub(X.copy(u.getCenter())).toArray(),Z=1,J=16,C=0,l=1,d={x:0,y:0};J--;){if(d.x=Y.x+(x.x-Y.x)*Z,d.y=Y.y+(x.y-Y.y)*Z,o=u.getHitPosition(d,E,$),P.direction.copy(o).sub(P.origin).normalize(),G=P.intersectEllipsoid(S),G&&1===Z)return{hit:G};G?C=Z:l=Z,Z=(C+l)/2}return{hit:G,out:1>Z}},s=function(Z,Y){if(R){var L=Date.now();R.deltaTime=R.lastTime?L-R.lastTime:1e3,R.lastTime=L,R.lastAxis=Z,R.lastAngle=Y}Y&&(Q.setFromAxisAngle(Z,Y),u.setEye(p.copy(u.getEye()).applyQuaternion(Q).toArray()),u.setCenter(p.copy(u.getCenter()).applyQuaternion(Q).toArray()),u.setUp(p.copy(u.getUp()).applyQuaternion(Q).toArray()))};A._showCrossIcon=function(Y){Bh(A.getView(),Ss),Xn(Ss,{x:Y.clientX-Us/2,y:Y.clientY-Us/2,width:Us,height:Us})},A._hideCrossIcon=function(){Qn(Ss)},A._scrollImpl=function(h,N){R={point:u.lp(h),screen:Yi(h),hit:w(h),type:"right"},R.hitNormalize=R.hit?R.hit.clone().normalize():new ah;var o={clientX:R.screen.x,clientY:R.screen.y+10*N};A._handleMoveImpl(o),A._endMoveImpl(o)},A._startMoveImpl=function(g){m&&(m.stop(!0),m=null),R={point:u.lp(g),screen:Yi(g),hit:w(g)},R.hitNormalize=R.hit?R.hit.clone().normalize():new ah,Wg(g)?1===g.touches.length?R.hit&&(R.type="left"):2===g.touches.length&&(R.type="touch2"):($h(g)?R.hit&&(R.type="left"):Je(g)?R.type="right":$i(g)&&R.hit&&(R.type="middle"),!R.hit||"right"!==R.type&&"middle"!==R.type||A._showCrossIcon(g)),R.type&&Tl(A,g)},A._handleMoveImpl=function(p){if(R)switch(R.type){case"left":return A._handleLeft(p);case"right":return A._handleRight(p);case"middle":return A._handleMiddle(p);case"touch2":return A._handleTouch2(p)}},A._endMoveImpl=function(){if(R){if(this._hideCrossIcon(),"left"===R.type||"middle"===R.type){var I=1e3*(R.lastAngle/(R.deltaTime||30)),p=R.lastAxis,F=R.lastTime,b=function(){var B=Date.now(),S=(B-F)/1e3;return F=B,I*=Math.pow(Math.abs(A.decelerationRate),3*S),Math.abs(I)<.01?(I=0,m&&m.stop(),void 0):(s(p,I*S),void 0)};m=Mq({action:function(){b(arguments)},duration:5e3})}R=null}},A._handleLeft=function(V){if(!R.finished){var H=Yi(V),q=Z(H,R.lastScreen||R.screen);if(R.lastScreen=H,!q.hit)return R.finished=!0,A._endMoveImpl(V),void 0;var y=q.hit;y.normalize();var U=R.hitNormalize,J=Math.acos(y.dot(U)),S=y.cross(U).normalize();s(S,J),q.out&&(R.finished=!0,A._endMoveImpl(V))}},A._handleRight=function(W){var o=R.lastScreen||R.screen,h=o.y;o=R.lastScreen=Yi(W);var L=o.y,x=L-h;if(x){var t=Math.min(.5,x*A.scaleSpeed);p.copy(u.getEye());var C=R.hit;C||(C=p.clone().divide(n).normalize().multiply(n)),X.copy(p).lerp(C,t),u.setEye(X.toArray()),p.copy(u.getUp()),X.normalize();var U=p.clone().cross(X).normalize();if(J.copy(u.getCenter()),J.sub(U.multiplyScalar(J.dot(U))),u.setCenter(J.toArray()),R.hit){var $=w(R.screen),M=R.hitNormalize;if($){$.normalize();var F=Math.acos($.dot(M)),v=$.cross(M).normalize();F&&s(v,F)}}}};var M=function(r){return Math.abs(r)<.01?0:r>0?1:-1};A._handleTouch2=function(J){var G=J.touches.length;if(2===G){var S=J.touches,W={x:S[0].clientX,y:S[0].clientY},D={x:S[1].clientX,y:S[1].clientY},Y={x:D.x-W.x,y:D.y-W.y},I=R.lastCenter,d=Math.atan2(Y.y,Y.x),o=R.theta,E=0;o==q?o=R.theta=d:(E=d-o,R.thetaStarted||Math.abs(E)>.03?(R.thetaStarted=!0,R.theta=d):E=0);var P,j=Math.sqrt(Y.x*Y.x+Y.y*Y.y),T=R.vlen;if(T){var x=W.x-I.x,H=W.y-I.y,n=D.x-I.x,i=D.y-I.y,t=Math.sqrt(x*x+H*H),r=Math.sqrt(n*n+i*i),p=T/2,v=M(t-p),U=M(r-p);0>v*U||0===v&&0===U?(P=1,R.vlen=j):(P||(P=j/T),R.scaleStarted||Math.abs(P-1)>.05?(R.vlen=j,R.scaleStarted=!0):P=1)}else T=R.vlen=j,P=1;var Y=X.copy(u.getEye()).clone();1!==P&&u.setEye(Y.setLength((Y.length()-K)/P+K).toArray()),E&&s(Y.normalize(),E),R.lastCenter={x:(D.x+W.x)/2,y:(D.y+W.y)/2}}},A._handleMiddle=function(n){var Z=Yi(n),l=R.screen;R.screen=Z;var P=(Z.y-l.y)/180*Math.PI*A.rollSpeed;X.copy(u.getCenter()).sub(p.copy(u.getEye())).normalize(),p.copy(u.getUp()).cross(X).normalize(),X.copy(u.getEye()).sub(R.hit).applyAxisAngle(p,P).add(R.hit);var S=X.clone();X.copy(u.getCenter()).sub(R.hit).applyAxisAngle(p,P).add(R.hit);var L=X.clone(),U=X.copy(u.getUp()).applyAxisAngle(p,P).clone(),k=!1;P>0&&(J.copy(U),X.copy(L).sub(S).normalize(),p.copy(S).multiplyScalar(-1).normalize(),p.dot(J)-X.dot(J)>0&&(k=!0)),k||J.copy(R.hit).sub(S).dot(R.hitNormalize)>=0&&(k=!0),k||(u.setEye(S.toArray()),u.setCenter(L.toArray()),u.setUp(U.toArray()));var j=-(Z.x-l.x)/180*Math.PI*A.rotateSpeed;s(R.hitNormalize,j)}};Xr("GlobeInteractor",Ps,{handle_contextmenu:function(g){lr(g)},handle_mousewheel:function(N){this._scrollImpl(N,N.wheelDelta/40)},handle_DOMMouseScroll:function(s){2===s.axis&&this._scrollImpl(s,-s.detail)},handle_keydown:function(J){this.gv.handleKeyDown(J)},handle_mousedown:function(C){this.handle_touchstart(C)},handle_touchstart:function(T){lr(T);var D=this.gv;if(D.setFocus(T)){var H=D.getDataInfoAt(T),Z=H?H.data:q;Z&&D.isInteractive(Z)||this._startMoveImpl(T);var G=H?H.part:q;zr(T)?D.handleDoubleClick(T,Z,G):D.handleClick(T,Z,G)}},handle_mouseup:function(l){this.handle_touchend(l)},handle_touchend:function(){},handleWindowMouseMove:function(f){this.handleWindowTouchMove(f)},handleWindowTouchMove:function(c){this._handleMoveImpl(c)},handleWindowMouseUp:function(e){this.handleWindowTouchEnd(e)},handleWindowTouchEnd:function(M){this._endMoveImpl(M)}}),u.defineProperties(Vs.prototype,{rotateSpeed:{get:function(){return this._rotateSpeed||.3},set:function(q){this._rotateSpeed=q}},rollSpeed:{get:function(){return this._rollSpeed||.1},set:function(N){this._rollSpeed=N}},scaleSpeed:{get:function(){return this._scaleSpeed||.002},set:function(L){this._scaleSpeed=L}},decelerationRate:{get:function(){return this._decelerationRate||.04},set:function(b){this._decelerationRate=b}}});var Ws=function(x){var J=2147483648|x;return[(255&J>>16)/255,(255&J>>8)/255,(255&J)/255,(255&J>>24)/255]},Xs=function(o){this.gv=o,this.gv.pickColorMap={_pickIdUsed:2e3}};uj(Xs,u,{_iv:!0,iv:function(){this._iv=!0},get:function(n,Z,G){this.validate();var A=this,f=A.gv.getGL();if(!f)return q;var d,o,y=A._resolution,a=Math.round(n.x*y),X=Math.ceil(n.width*y),k=Math.ceil(n.height*y),I=A.height-Math.round(n.y*y)-k,T=L(X/2),C=new Uint8Array(4*X*k),S=0,g=C.length,t=Z?q:new lo,m=Z?q:{};if(Tf(f,A.frame),f.readPixels(a,I,X,k,f.RGBA,f.UNSIGNED_BYTE,C),jr(f),Z){for(;T>=S;S++)for(var W=T-S,P=T+S,M=W;P>=M;M++)for(var u=W;P>=u;u++)if((M===W||M===P||u===W||u===P)&&(d=A.info(C,4*(M*X+u)))){if(G&&G(d)===!1)continue;return d}}else for(;g>S;S+=4)if(d=A.info(C,S)){if(G&&G(d)===!1)continue;o=d.data,m[o._id]||(t.add(o),m[o._id]=o)}return t},info:function(F,Y){return this.gv.pickColorMap[(F[Y]<<16)+(F[Y+1]<<8)+F[Y+2]+((127&F[Y+3])<<24)]},getResolution:function(){return this._resolution},onContextLost:function(){this.texture=null,this.width=this.height=-1},validate:function(){var L=this,h=L.gv,s=h.getGL();if(s){var g=L._resolution=h._pickerResolution*h.getDevicePixelRatio(),v=Math.round(g*h.getWidth()),D=Math.round(g*h.getHeight()),K=s.RGBA,i=s.TEXTURE_2D,e=s.RENDERBUFFER,Y=s.FRAMEBUFFER;if(L.texture||(L.texture=$k(s),L.render=s.createRenderbuffer(),L.frame=s.createFramebuffer()),(L.width!==v||L.height!==D)&&(s.activeTexture(s.TEXTURE0),kf(s,L.texture),s.texImage2D(i,0,K,v,D,0,K,s.UNSIGNED_BYTE,q),wf(s,s.TEXTURE_MIN_FILTER,s.LINEAR),s.bindRenderbuffer(e,L.render),s.renderbufferStorage(e,s.DEPTH_COMPONENT16,v,D),Tf(s,L.frame),s.framebufferTexture2D(Y,s.COLOR_ATTACHMENT0,i,L.texture,0),s.framebufferRenderbuffer(Y,s.DEPTH_ATTACHMENT,e,L.render),kf(s,q),s.bindRenderbuffer(e,q),jr(s),L.width=v,L.height=D),L._iv){L._iv=!1;var Z=!1;h._40Q.each(function(y){!Z&&y.isBatchInvalid()&&(Z=!0)}),Z&&h.updateScene(),Tf(s,L.frame),s.clear(s.COLOR_BUFFER_BIT),h.overlappingBox.clear(),h.setViewport(s,0,0,v,D),h.renderPickScene(),jr(s)}}}});var Ys=function(b){this.gv=b};uj(Ys,u,{gap:0,size:0,_42:function(J,A){var m=this,g=m.gv,u=g._gridGap,Z=g._gridSize;if(g._gridVisible){if(m.gap!==u||m.size!==Z){for(var V=[],K=g._gridSize/2,W=u*K,v=0;2*K+1>v;v++){var R=6*v,S=6*(2*K+1)+R;V[R]=-W,V[R+1]=0,V[R+2]=-W+v*u,V[R+3]=W,V[R+4]=0,V[R+5]=-W+v*u,V[S]=-W+v*u,V[S+1]=0,V[S+2]=-W,V[S+3]=-W+v*u,V[S+4]=0,V[S+5]=W}m.vs=new yk(V),m.gap=u,m.size=Z}Gq(g),Ad(J),Dj(J);var y=!g._fogDisabled;if(y){var _=Jq.for(J).directUniforms();_.uFog=!1}Iq(J,A,1,g._gridColor,g._buffer.vs,m.vs),nf(J,0,m.vs.length/3,J.LINES),y&&(_.uFog=!0),gg(J),pl(J)}else m.vs=m.gap=m.size=q}});var Zs=function(o){this.gv=o};uj(Zs,u,{_42:function(s,j){var r=this.gv,f=r._buffer.vs,x=r._axisXColor,$=r._axisYColor,m=r._axisZColor,C=r._originAxisVisible,M=r._centerAxisVisible;if(C||M){var V=mp?s.TRIANGLES:s.TRIANGLE_FAN,h=s.LINES;if(Gq(r),Ad(s),Dj(s),C){var z=r.getCenterInfo(),I=e(z.width,z.height)/5,v=.8*I,Y=.05*I;Iq(s,j,1.5,x,f,new yk([0,0,0,I,0,0,v,Y,0,v,0,Y,v,-Y,0,v,0,-Y,v,Y,0,0,0,0,0,I,0,Y,v,0,0,v,Y,-Y,v,0,0,v,-Y,Y,v,0,0,0,0,0,0,I,Y,0,v,0,Y,v,-Y,0,v,0,-Y,v,Y,0,v])),nf(s,0,2,h),nf(s,1,6,V),Iq(s,j,q,$),nf(s,7,2,h),nf(s,8,6,V),Iq(s,j,q,m),nf(s,14,2,h),nf(s,15,6,V)}if(M){var E=r._center,S=E[0],H=E[1],L=E[2],z=r.getPositionInfo(E);I=e(z.width,z.height)/20,Iq(s,j,1.5,x,f,new yk([S,H,L,S+I,H,L,S,H,L,S,H+I,L,S,H,L,S,H,L+I])),nf(s,0,2,h),Iq(s,j,q,$),nf(s,2,2,h),Iq(s,j,q,m),nf(s,4,2,h)}gg(s),pl(s)}}});var $s=function(R){this.gv=R},_s="edit_tx",at="edit_ty",bt="edit_tz",ct="edit_rx",dt="edit_ry",et="edit_rz",ft="edit_sx",gt="edit_sy",ht="edit_sz",it={};it[_s]=101,it[at]=102,it[bt]=103,it[ct]=104,it[dt]=105,it[et]=106,it[ft]=107,it[gt]=108,it[ht]=109,uj($s,u,{_42:function(W,X,_){var P=this,a=P.gv,H=a.sm().ld();if(H&&a.isEditable(H)&&!a.isEditHelperDisabled()&&uk(H)&&(!a.isFirstPersonMode()||!a.isMouseRoamable()&&!lf)){Gq(a);var j,w=a.isMovable(H),M=a.isRotationEditable(H),l=a.isSizeEditable(H),o=a._axisXColor,p=a._axisYColor,b=a._axisZColor,q=a._editSizeColor,d=H.p3();if(a.isOrtho()){var u=a.getCenterInfo();j=e(u.width,u.height)/8}else j=Hh(a.getEye(),d)/10;var g,I,U=j/(_?5:10),n=.7*j,v=.4*n,t=d[0],D=d[1],G=d[2];g=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],w&&P._17O(W,X,H,_,_s,o,g,[t,D-U,G,t+n,D-U,G,t+n,D,G,t+n,D,G,t,D,G,t,D-U,G,t,D-U,G+U,t+n,D-U,G+U,t+n,D-U,G,t+n,D-U,G,t,D-U,G,t,D-U,G+U]),I=t+n,l&&P._17O(W,X,H,_,ft,q,g,[I,D-U,G,I+v,D-U,G,I+v,D,G,I+v,D,G,I,D,G,I,D-U,G,I,D-U,G+U,I+v,D-U,G+U,I+v,D-U,G,I+v,D-U,G,I,D-U,G,I,D-U,G+U]),I+=v,M&&P._17O(W,X,H,_,ct,o,g,[I,D-U,G,I+v,D-U,G,I+v,D,G,I+v,D,G,I,D,G,I,D-U,G,I,D-U,G+U,I+v,D-U,G+U,I+v,D-U,G,I+v,D-U,G,I,D-U,G,I,D-U,G+U]),g=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],w&&P._17O(W,X,H,_,at,p,g,[t,D,G,t,D+n,G,t-U,D+n,G,t-U,D+n,G,t-U,D,G,t,D,G,t,D,G,t,D,G-U,t,D+n,G-U,t,D+n,G-U,t,D+n,G,t,D,G]),I=D+n,l&&P._17O(W,X,H,_,gt,q,g,[t,I,G,t,I+v,G,t-U,I+v,G,t-U,I+v,G,t-U,I,G,t,I,G,t,I,G,t,I,G-U,t,I+v,G-U,t,I+v,G-U,t,I+v,G,t,I,G]),I+=v,M&&P._17O(W,X,H,_,dt,p,g,[t,I,G,t,I+v,G,t-U,I+v,G,t-U,I+v,G,t-U,I,G,t,I,G,t,I,G,t,I,G-U,t,I+v,G-U,t,I+v,G-U,t,I+v,G,t,I,G]),g=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],w&&P._17O(W,X,H,_,bt,b,g,[t,D,G,t,D,G+n,t,D-U,G+n,t,D-U,G+n,t,D-U,G,t,D,G,t,D-U,G,t-U,D-U,G,t-U,D-U,G+n,t-U,D-U,G+n,t,D-U,G+n,t,D-U,G]),I=G+n,l&&P._17O(W,X,H,_,ht,q,g,[t,D,I,t,D,I+v,t,D-U,I+v,t,D-U,I+v,t,D-U,I,t,D,I,t,D-U,I,t-U,D-U,I,t-U,D-U,I+v,t-U,D-U,I+v,t,D-U,I+v,t,D-U,I]),I+=v,M&&P._17O(W,X,H,_,et,b,g,[t,D,I,t,D,I+v,t,D-U,I+v,t,D-U,I+v,t,D-U,I,t,D,I,t,D-U,I,t-U,D-U,I,t-U,D-U,I+v,t-U,D-U,I+v,t,D-U,I+v,t,D-U,I])}},_17O:function(r,a,U,T,P,z,l,A){var s=this.gv,v=s._buffer,_=Jq.for(r),u=_.directUniforms(),I=_.directAttribs();if(s._picking){T=s.pickColorMap;var M=it[P];T[M]={data:U,part:P},u.uFixPickReverseColor=Ws(M)}ng(r,a,q,!0,q,!0,q,!1),u.uDiffuse=z,I.aPosition=lm(r,v.vs,new yk(A),q),I.aNormal=lm(r,v.ns,new yk(l),q),Dj(r),nf(r,0,12),gg(r),Wi(r,a)}});var jt=x.Raycaster=function(l){this.gv=l,this.maxTriangleTest=1/0,this.backfaceCulling=!0};Qq("Raycaster",u,{intersect:function(Y){var b=this,w=b.gv,L=w.getDataAt(Y);return L?b.intersectObject(Y,L):null},intersectObjects:function(w,q,t){var D,v,O,L,B=this,e=1/0,i=w.origin||(new ah).fromArray(B.gv.getEye()),H=B.maxTriangleTest,S=[];q.forEach(function(w){t&&t(w)===!1||w.s("intersect")!==!1&&S.push(w)});var J=i.distanceToSquared2([0,0,0]);return S.sort(function(T,z){return(T.p3?i.distanceToSquared2(T.p3()):J)-(z.p3?i.distanceToSquared2(z.p3()):J)}),B.countTriangles=0,S.forEach(function(k){B.countTriangles>H||(D=B.intersectObject(w,k),D&&(v=i.distanceToSquared(D.world),e>v&&(O=k,L=D,e=v)))}),B.countTriangles=0,{data:O,intersect:L}},intersectObjectAndRecordTriangle:function(W,o){this._4GQ=!0;var S=this.intersectObject(W,o);return this._4GQ=!1,S},intersectLastTriangle:function(w,X){var e=this.getRay(w);e.applyMatrix4(X.inverseMatrix);var k=e.intersectPlane(X.plane);if(!k)return null;var i=Fc.uvIntersection(k,X.p1,X.p2,X.p3,X.uv1.clone(),X.uv2.clone(),X.uv3.clone());return{world:k.clone().applyMatrix4(X.matrixWorld),local:k.clone(),uv:i}},getRay:function(G){if(G instanceof zs)return G;var k=this,f=k.gv,Z=f.unproject(G),u=new ah,W=f.getEye(),j=new ah;if(f.isOrtho()){var D=new ah(W);j.copy(f.getCenter()).sub(D).normalize();var h=u.copy(Z).sub(D).dot(j);u.copy(j).setLength(-h).add(D.copy(Z))}else u.copy(W),j.copy(Z).sub(u).normalize();return new x.Math.Ray(u,j)},intersectObject:function(I,H){return this._intersectObjectImpl(this.getRay(I),H)},_intersectObjectImpl:function(){function m(){var P=new ah;return P.subVectors(n,$),Y.subVectors(H,$),P.cross(Y).normalize(),P}var T=new We,A=new We,j=new zs,Z=new ah,P=new ah,I=new ah,u=new ah,G=new ah,H=new ah,$=new ah,n=new ah,K=new sd,L=new sd,C=new sd,Y=new ah,_={vs:qf,is:he,uv:Ql},N=sr.slice(0);return N.push("csg"),function(z,p){var S=this.gv.getData3dUI(p),U=p.mat||S.mat;U?T.fromArray(U):T.identity(),A.getInverse(T),j.copy(z).applyMatrix4(A);var q,e,i,B="body",y=S.shapeModel;if(!y&&(p instanceof x.Polyline||p instanceof x.Edge)&&S.lineShapeModel&&(y=S.lineShapeModel),y||(y=Hf(S)),y||(x.CSGNode&&p instanceof x.CSGNode||x.CSGShape&&p instanceof x.CSGShape?(i=!0,y=[S.left,S.front,S.right,S.back,S.top,S.bottom,S.csg]):p instanceof x.Node&&!(p instanceof x.Shape)?(q=!0,y=_):(e=!0,y=[S.left,S.front,S.right,S.back,S.top,S.bottom])),!y)return console.log("Can not find shape model."),null;bj(y)||(y=[y]);var w,o,Q,v,g,W,s,r,t,Y,D,b,k,X,d,M,F=1/0,R=["","top_","bottom_"],O=!1,a=this.backfaceCulling,V=[];for(of(y,S,V),w=0,o=V.length;o>w;w++)if(k=V[w])for(Q=0,v=R.length;v>Q;Q++)if(X=R[Q],s=k[X+"vs"],r=k[X+"is"],t=k[X+"uv"]||k[X+"tuv"],s){if(d=k[X+"boundingBox"]){var D=j.intersectBox(d);if(!D)continue;if(j.origin.distanceTo(D)>F)continue;M=!1}else k[X+"boundingBox"]=d=new x.Math.Box3,M=!0;for(g=0,W=r?r.length:s.length/3;W>g;g+=3)this.countTriangles++,r?(P.fromArray(s,3*r[g]),I.fromArray(s,3*r[g+1]),u.fromArray(s,3*r[g+2])):(P.fromArray(s,3*g),I.fromArray(s,3*(g+1)),u.fromArray(s,3*(g+2))),M&&(d.expandByPoint(P),d.expandByPoint(I),d.expandByPoint(u)),Y=j.intersectTriangle(P,I,u,a,Z),Y&&(b=j.origin.distanceTo(Y),F>b&&(F=b,G.copy(Y),H.copy(P),$.copy(I),n.copy(u),""!==X?B=X.slice(0,-1):q?B=sr[Math.floor(g/6)]:e?B=sr[w]:i&&(B=N[w]),t&&(O=!0,r?(K.fromArray(t,2*r[g]),L.fromArray(t,2*r[g+1]),C.fromArray(t,2*r[g+2])):(K.fromArray(t,2*g),L.fromArray(t,2*(g+1)),C.fromArray(t,2*(g+2))))))}if(!isFinite(F))return null;var l,J,h=G.clone().applyMatrix4(T),E=this._4GQ;O&&(E&&(J={inverseMatrix:A.clone(),matrixWorld:T.clone(),p1:H.clone(),p2:$.clone(),p3:n.clone(),uv1:K.clone(),uv2:L.clone(),uv3:C.clone(),plane:(new x.Math.Plane).setFromCoplanarPoints(H,$,n)}),l=Fc.uvIntersection(G,H,$,n,K,L,C));var c=m(H,$,n),f=m(H.applyMatrix4(T),$.applyMatrix4(T),n.applyMatrix4(T)),ye=j.direction.dot(c);ye>0&&(c.multiplyScalar(-1),f.multiplyScalar(-1));var Ce={world:h,local:G.clone(),worldNormal:f,normal:c,uv:l,part:B};return J&&(Ce.triangleInfo=J),Ce}}()});var kt=function(g,z){this.gv=g,this.s=function(w,Q,t){return Q==q&&(Q=t),Q==q?z.getStyle(w):gl(Q,z,g)},this.data=z};uj(kt,u,{I3d:!0,ms_icons:1,_iv:!0,_cacheBoundingBox:A,iv:function(){this._iv=!0},update:function(F,M,L){var w=this,x=w.data;if(F||(F=w.gv,M=F.getGL(),L=F._40Q),!w.needValidate(M)||!F.isVisible(x))return L.push(this,!1),void 0;var T,V,O,k,g,G=x._id,P=x._47Q?null:w.s("batch"),$=x.getRenderLayer(),a=L.get($,!0),e=a.batchIndexMap,R=a.batchModelMap,B=F.getBrightness(x),f=B!=q&&1!==B;T=Tr(e,R,x,P,F);var y=P?F.getBatchInfo(P)||yq:q,t=w.validate(T,y);if(T&&(!y.ms||!y.ms.length)&&(V=e[G],O=V.size=T.vs.length/3-V.begin,g=T.rs))for(B=f?B:1,k=0;O>k;k++)g.push(B);var I=F.getWireframeGeometry(x);if(I)Np(F,x,I);else if(uk(x)){var r=F.getWireframe(x);r&&Np(F,x,r)}w.labelInfo=w.label2Info=w.noteInfo=w.note2Info=w._38o=q,w._24O(dd,"getLabel"),w._24O(ip,"getLabel2"),w._26O(Mb,"getNote"),w._26O(Wh,"getNote2"),w._15O(),w.interactiveInfo=F.isInteractive(x)?{}:q,a.push(this,!0),t!==!1&&(w._iv=!1)},clearWireframeGeometryCache:function(){var $=this;Ph($),$.data.iv()},_46Q:function(t,T){var p=this,K=p.data,J=p.gv;if(J.isVisible(K)){var P=K._id,d=J._40Q.get(K._renderLayer,!0),s=d.batchIndexMap[P],m=d.polylineIndexMap[P],L=d.wireframeIndexMap[P];(s||m||L)&&(T==q&&(T=Wk(t,J.pickColorMap,J.isSelectable(K),p,th,!0)),T&&(Nq(T,s,d.batchModelMap,J),Nq(T,m,d.polylineModelMap,J),Nq(T,L,d.wireframeModelMap,J)))}},_42:function(Y,E,Q){function D(m,K,M){var J=K.getBrightness(M),g=M.s("alphaTest"),P=M.s("envmap"),f=Jq.for(m),s=f.directUniforms();J!=q&&1!==J&&(s.uBrightness=J),s.uAlphaTest=g,s.uUseEnvMap=P?!0:!1,s.uReflectivity=P||.01,s.roughness=M.s("roughness"),K._setEnvmapByProbeId(s,M.s("envmap.probe")),s.shadowReceive=!o&&M.s("shadow.receive"),s.shadowCull=!o&&!!M.s("shadow.cull"),fj(K,s,M.s("3d.clipbox")?dn:M.s("3d.clipbox.mask"));var F=j.s("3d.clip.direction");if(F){var p=j.s("3d.clip.percentage");0===p&&(S=!1);var T=j._formatClipUniforms(F,p,M);s.uClipPercent=T[1],s.uClipDirection=T[0]}else s.uClipDirection=0;m._blooming&&!M.s("bloom")&&(s.blackout=!0),o||(K._flowObjects.length&&K.flowMap.resetDataFlowEnabld(M,s),Oh(K,s,M.s("light.mask"),M.s("headlight.ambientIntensity")))}var j=this,R=j.data,Z=j.gv;if(Z.isVisible(R)){var z,o=Z._picking;if(o)z=Z.pickColorMap;else{if(Z.isTransparentMask(R)||Z.isReflecting(Y)&&R.s("3d.reflectable")===!1)return;z=A}if(kt.getTitle===A){kt.getTitle=0;for(var N in M)if(N.length===ip.length+1&&N[ip.length]===xd[4].toUpperCase()&&N[ip.length-1]===xd[ip.length+1].toUpperCase()){kt.getTitle=Gc;break}}if(!kt.getTitle||pe[ip.length+2]){if(kt.getHead===A){kt.getHead=0;for(var N in P){var g="box-sizing";6===N.length&&N[0]===xd[4]&&N[3]===g[0]&&N[4]===g[1]&&N[5]===g[2]&&(kt.getHead=um)}}if(!kt.getHead||pe[ip.length]){if(kt.getTitle2===A){kt.getTitle2=0;for(var N in P){var U="uv";6===N.length&&N[0]===Ll[1].toUpperCase()&&N[1]===U[0]&&(kt.getTitle2=Qb)}}if(!kt.getTitle2||pe[Fb.length]){var u,w,T=R._id,G=Z._40Q.get(R._renderLayer,!0),c=G.batchIndexMap,r=G.batchModelMap,V=Z.isSelectable(R),p=!1,S=!0,H=c[T];if(o&&(w=Wk(Y,z,V,j,th,H),w&&!Z._45Q&&(Nq(w,H,r,Z),Nq(w,G.polylineIndexMap[T],G.polylineModelMap,Z),Nq(w,G.wireframeIndexMap[T],G.wireframeModelMap,Z))),H||(p||(p=!0,D(Y,Z,R)),S&&j._80o(Y,E,Q)),Z.isLabelVisible(R)&&((u=j.labelInfo)&&(o&&Wk(Y,z,V,j,dd),p||(p=!0,D(Y,Z,R)),j._28O(u,dd,Q)),(u=j.label2Info)&&(o&&Wk(Y,z,V,j,ip),p||(p=!0,D(Y,Z,R)),j._28O(u,ip,Q))),Z.isNoteVisible(R)&&((u=j.noteInfo)&&(o&&Wk(Y,z,V,j,Mb),p||(p=!0,D(Y,Z,R)),j._29O(u,Mb,Q)),(u=j.note2Info)&&(o&&Wk(Y,z,V,j,Wh),p||(p=!0,D(Y,Z,R)),j._29O(u,Wh,Q))),(u=j._38o)&&(p||(p=!0,D(Y,Z,R)),j._99O(Y,E,u,z,V,Q)),p){var x=Jq.for(Y).directUniforms();x.uBrightness=1,x.uClipDirection=0,Y._blooming&&(x.blackout=!1)}}}}}},_formatClipUniforms:function(t,e,b){switch(t){case"uv.right":t=7;break;case"uv.left":t=8;break;case"left":t=2;break;case"top":t=3;break;case"bottom":t=4;break;case"front":t=5;break;case"back":t=6;break;case"right":default:t=1}if(0===t%2&&(e=1-e),7===t||8===t){var o=this.shapeModel;o&&o.internalUvScale&&(e*=o.internalUvScale)}else if(b instanceof x.Shape){var p=b.s3(),h=b.p3(),U=b.getAnchor3d();e=3>t?(e-U.x)*p[0]+h[0]:5>t?(e-U.y)*p[1]+h[1]:(e-U.z)*p[2]+h[2]}else e-=.5;return[t,e]},prepare:function(){var z=this,A=z.data;if(!(A instanceof df)){var G,W,Y,D,$,_=z.gv,k=_.getGL(),X=A._id,j=z.s("batch"),T=_._batchIndexMap,c=_._batchModelMap,H=_.getBrightness(A),F=H!=q&&1!==H;if(z.needValidate(k)){G=Tr(T,c,A,j,_);var n=j?_.getBatchInfo(j)||yq:q;if(z.validate(G,n),G&&(!n.ms||!n.ms.length)&&(W=T[X],Y=W.size=G.vs.length/3-W.begin,$=G.rs))for(H=F?H:1,D=0;Y>D;D++)$.push(H);if(uk(A)){var I=_.getWireframeGeometry(A);if(I)Np(_,A,I);else{var o=_.getWireframe(A);o&&Np(_,A,o)}}z.labelInfo=z.label2Info=z.noteInfo=z.note2Info=z._38o=q,z._24O(dd,"getLabel"),z._24O(ip,"getLabel2"),z._26O(Mb,"getNote"),z._26O(Wh,"getNote2"),z._15O(),z.interactiveInfo=_.isInteractive(A)?{}:q,z._iv=!1}}},dispatchBoundingBoxChanged:function(){this._cacheBoundingBox=A},getBoundingBox:function(){var g,E,n,Y,d,V;return function(s){if(this._cacheBoundingBox)return this._cacheBoundingBox;g||(g={vs:qf,is:he,uv:Ql},E=new ah,n=new ah,Y=new ah,d=new ah,V=new ah);var c=this,I=c.data,L=c.shapeModel;if(!L&&(I instanceof x.Polyline||I instanceof x.Edge)&&c.lineShapeModel&&(L=c.lineShapeModel),L||(L=Hf(c)),L||(x.CSGNode&&I instanceof x.CSGNode||x.CSGShape&&I instanceof x.CSGShape?(isCSG=!0,L=[c.left,c.front,c.right,c.back,c.top,c.bottom,c.csg]):I instanceof x.Node&&!(I instanceof x.Shape)?L=g:(c.left||c.front||c.right||c.back||c.top||c.bottom)&&(L=[c.left,c.front,c.right,c.back,c.top,c.bottom])),!L)return A;bj(L)||(L=[L]);var U,X,$,f,K,O,C,Z,p,y,R,G,v=["","top_","bottom_"],i=new x.Math.Box3,Q=!1;if(c._needRecoverPosition){d.set.apply(d,I.p3());var q=I.s3();V.set(1/(q[0]||1),1/(q[1]||1),1/(q[2]||1))}else d.set(0,0,0),V.set(1,1,1);var b=[];for(of(L,c,b),U=0,X=b.length;X>U;U++)if(p=b[U])for($=0,f=v.length;f>$;$++)if(y=v[$],C=p[y+"vs"],Z=p[y+"is"],C){if(G=y+"boundingBox",R=p[G],!R)for(p[G]=R=new x.Math.Box3,K=0,O=Z?Z.length:C.length/3;O>K;K+=3)Z?(E.fromArray(C,3*Z[K]).sub(d).multiply(V),n.fromArray(C,3*Z[K+1]).sub(d).multiply(V),Y.fromArray(C,3*Z[K+2]).sub(d).multiply(V)):(E.fromArray(C,3*K).sub(d).multiply(V),n.fromArray(C,3*(K+1)).sub(d).multiply(V),Y.fromArray(C,3*(K+2)).sub(d).multiply(V)),!E.isNaN()&&R.expandByPoint(E),!n.isNaN()&&R.expandByPoint(n),!Y.isNaN()&&R.expandByPoint(Y);i.expandByBox(R),Q=!0}return Q?(this._cacheBoundingBox=i,u.freeze(i),u.freeze(i.min),u.freeze(i.max),s||Wd(c.gv,I),i):A}}(),needValidate:function(){return this._iv},validate:function(){},_16O:function(){return Gl},_80o:function(){},dispose:function(){var u=this,Y=u._pickId;if(Y){var v=u.gv.pickColorMap;v[Y]&&delete v[Y]}},getBodyColor:function(R){var n=this.data,g=this.gv.getBodyColor(n);return g?g:R?n.getStyle(R):q},contextLost:function(){this._cachedTextures&&this.gv.invalidateCachedTexture(this.data)},getCachedTexture:function(L){var _=this._cachedTextures;return _?_[L||"main"]:null},setCachedTexture:function($,x){var L=this._cachedTextures;return L||(L=this._cachedTextures={}),L[x||"main"]=$,$},invalidateCachedTexture:function(Q){var e=this._cachedTextures;if(e){for(var Z in e)Q.deleteTexture(e[Z]);this._cachedTextures={}}},invalidateCachedGeometry:function(){},_24O:function(z,a){var w=this,K=w.data,U=w.gv,X=w.s,g=U[a](K);if(g!=q){var L=X(z+".scale"),V=X(z+".max"),D=w[z+"Info"]={label:g,textureScale:X(z+".texture.scale"),color:U[a+"Color"](K),font:X(z+".font"),align:X(z+".align"),background:U[a+"Background"](K)},B=D.rect=Yq(D,g);V>0&&V<B.width&&(D.labelWidth=B.width,B.width=V),B.x=B.y=0,B.width*=L,B.height*=L,D.mat=w._16O(X(z+".autorotate"),X(z+".position"),B,X(z+".face"),X(z+".t3"),X(z+".r3"),X(z+".rotationMode"));var Z=B.width/2,O=B.height/2;D.vs=new yk([-Z,O,0,-Z,-O,0,Z,-O,0,Z,O,0]),B.width/=L,B.height/=L}},_26O:function(s,P){var n=this,X=n.data,g=n.gv,D=n.s,m=g[P](X);if(m!=q){var $=D(s+".scale"),y=this[s+"Info"]={note:m,textureScale:D(s+".texture.scale"),expanded:D(s+".expanded"),font:D(s+".font"),color:D(s+".color"),align:D(s+".align"),borderWidth:D(s+".border.width"),borderColor:D(s+".border.color"),background:g[P+"Background"](X)};if(y.expanded){var d=D(s+".max"),T=Yq(y,m);T.width+=6,T.height+=2,d>0&&d<T.width&&(y.labelWidth=T.width,T.width=d);var R={x:-T.width/2,y:-8-T.height,width:T.width,height:T.height+8}}else R={x:-6,y:-18,width:12,height:18};y.mat=n._16O(D(s+".autorotate"),D(s+".position"),q,D(s+".face"),D(s+".t3"),D(s+".r3"),D(s+".rotationMode")),y.rect=R,1!==$&&(R=Wr(R),R.x*=$,R.height*=$,R.y=-R.height,R.width*=$);var Y=R.x,Q=R.y,w=R.width,_=R.height;y.vs=new yk([Y,-Q,0,Y,-Q-_,0,Y+w,-Q-_,0,Y+w,-Q,0])}},eachShapeModel:function(v,i){function D(U){Mk(U),U.vs&&v(U.vs,U.is,U.ns,U.uv),U.top_vs&&v(U.top_vs,U.top_is,U.top_ns,U.top_uv),U.bottom_vs&&v(U.bottom_vs,U.bottom_is,U.bottom_ns,U.bottom_uv),U.from_vs&&v(U.from_vs,U.from_is,U.from_ns,U.from_uv),U.to_vs&&v(U.to_vs,U.to_is,U.to_ns,U.to_uv)}function H(F){var n,v,U;if(bj(F))for(v=0,U=F.length;U>v;v++)n=F[v],n&&H(n);else ro(F)?H(Hf(E,F),E):fg(F)&&(F.shape3d?H(F.shape3d):D(F))}var E=this,K=E.data,i=i||E.shapeModel||Hf(E);i||(i=K instanceof x.Node&&!(K instanceof x.Shape)?{vs:qf,is:he}:[E.left,E.front,E.right,E.back,E.top,E.bottom]),H(i)},_28O:function(B,P,Y){if(Y(this.s(P+".transparent"))){var d=B.rect,S=B.textureScale,j=d.width*S,U=d.height*S;if(j>=1&&U>=1){var M=Pn(j,U);1!==S&&(M.translate(d.x,d.y),M.scale(S,S),M.translate(-d.x,-d.y)),om(M,B),M.restore(),bd(this,P,B.mat,B.vs,!0)}}},_29O:function(M,q,m){if(m(this.s(q+".transparent"))){var K=M.rect,J=M.textureScale,L=K.x,t=K.y,u=K.width*J,X=K.height*J;if(u>=1&&X>=1){K.x=K.y=0;var B=Pn(u,X);1!==J&&B.scale(J,J),_i(B,M),B.restore(),K.x=L,K.y=t,bd(this,q,M.mat,M.vs,!1)}}},_99O:function(P,p,E,F,m,M){if(E){var h=this,N=h.gv,b=h.data,A=N._buffer,t=N._1O,W=E.icons,K=Jq.for(P),y=K.directAttribs();for(var k in W){var f=W[k],e=E.rects[k];if(e&&M(gl(f.transparent,b,N))){N._picking&&Wk(P,F,m,h,k);var T=gl(f.shape3d,b,N),Y=T?[T]:gl(f.names,b,N),C=Y?Y.length:0,w=gl(f.textureScale,b,N)||1,v=gl(f.light,b,N);v==q&&(v=T?!0:!1),ng(P,p,gl(f.blend,b,N),v,gl(f.opacity,b,N),gl(f.reverseFlip,b,N),gl(f.reverseColor,b,N),gl(f.reverseCull,b,N));for(var U=0;C>U;U++){var s=Y[U],O=e[U];if(Eo(h,O.mat),T)Hp(N,b,Hf(h,T),h);else{var i=yd(s);if(i){var r=O.width*w,H=O.height*w;if(r>=1&&H>=1){var L=Pn(r,H);jl(L,i,gl(f.stretch,b,N),0,0,r,H,b,N),L.restore(),$k(P,Pr,t),Dj(P,p,t,gl(f.discardSelectable,b,N),A.uv,oq),y.aPosition=lm(P,A.vs,O.vs,q),y.aNormal=Id(P,A.ns,Zp,q),ho(P,A.is,vd),ei(P,0,vd.length),gg(P,p,t)}}}Kh(N)}Wi(P,p)}}}}});var lt=function(R,U){Vq(lt,this,[R,U])};uj(lt,kt,{_16O:function(y,e,G,Y,p,C,J,N,o){var U,H=this.data,g=H.getFinalScale3d();if(H.hasOwnProperty("_anchor")||H.hasOwnProperty("_anchorElevation")){var n=H.getAnchor3d();U=[-(n.x-.5)*g[0],-(n.y-.5)*g[1],-(n.z-.5)*g[2]]}if(H.s("part.boundingBox")){var b=this.getBoundingBox(!0);if(b){var M=b.max.clone().sub(b.min),I=b.max.clone().add(b.min).divideScalar(2);U||(U=[0,0,0]),U[0]+=I.x*g[0],U[1]+=I.y*g[1],U[2]+=I.z*g[2],g[0]*=M.x,g[1]*=M.y,g[2]*=M.z}}var E=ep(e,g,G,Y,N,o);return U&&(E[0]+=U[0],E[1]+=U[1],E[2]+=U[2]),zf(Sj(),E,H.p3(),Y,p,C,J,y,H.getFinalRotation3d(),H.getRotationMode())},clear:function(){var J=this;J.faceMat=J.mat=J.shapeModel=J.left=J.right=J.front=J.back=J.top=J.bottom=J.csg=q
},needValidate:function(M){if(this._iv)return this._validateFrameId=M._renderInfo.frame,!0;if(this.data._47Q){var u=M._renderInfo.frame;if(this._validateFrameId!==u)return this._validateFrameId=u,!0}return!1},invalidateUnstableWireframe:function(){var O=this.data;if(O._47Q){var s=O.getRenderLayer(),z=this.gv._40Q.get(s);z&&z.ivWireframeBatch(O)}},validate:function(j,W){var U=this,h=U.gv,x=U.data,$=U.shapeName=U.s(Qm),v=Hf(U,$);U._updateAutoRotation(),U._updateFixSize2d(),U._updateOverlapping(),U.dispatchBoundingBoxChanged(),U.invalidateUnstableWireframe();var s=bg(x,h.getMat(x),v?U.s("shape3d.scaleable"):!0);if(x.appendAnchorMatrix3d(s),U.clear(),U.mat=x.mat=s,v||!$)if(U.shapeModel=v,j)if(v)W.instanced?h.batchInstancedModel(x,v,U,U.getBodyColor(),[s],j):$n(h,x,v,U,U.getBodyColor(),[s],j);else{var H=jn(s);W.instanced?h.batchInstancedFace(x,j,W,s,H):xn(h,x,j,W,s,H)}else v||(U._cubeUvs=null,U.vf(wk,0),U.vf(Bj,16),U.vf(Ao,8),U.vf(ki,24),U.vf(vg,32),U.vf(rj,40))},_updateAutoRotation:function(){var D=new nm,p=new We,k=new ah,T=new ah,R=new ah;return function(){var B=this,F=B.data,r=B.s("autorotate")||B.s("shape3d.autorotate");if(!r)return F._dynamicRotation&&delete F._dynamicRotation,void 0;var P=B.gv;R.copy(B.s("shape3d.autorotate.up")||P._up);var S;S="string"==typeof r?[r.indexOf("x")<0?P._eye[0]:P._center[0],r.indexOf("y")<0?P._eye[1]:P._center[1],r.indexOf("z")<0?P._eye[2]:P._center[2]]:P._eye;var f=P._center,C=F.p3();k.copy(C),T.set(S[0]-f[0],S[1]-f[1],S[2]-f[2]).add(k),p.lookAt(T,k,R),D.set(0,0,0,F.getRotationMode(),!0).setFromRotationMatrix(p);var y=F._dynamicRotation;y&&Math.abs(y[0]-D.x)<1e-5&&Math.abs(y[1]-D.y)<1e-5&&Math.abs(y[2]-D.z)<1e-5||(F._dynamicRotation=[D.x,D.y,D.z])}}(),_updateFixSize2d:function(){var J=this,f=J.data,V=J.s("fixSizeOnScreen")||J.s("shape3d.fixSizeOnScreen");if(!V)return f._dynamicScale3d&&delete f._dynamicScale3d,void 0;var U=J.gv,_=bg(f,U.getMat(f)),L=Vk([0,0,0],_),H=U.toViewPosition(L);if(!isNaN(H.x)&&!isNaN(H.y)){var S=Vk([1,0,0],_),w=U.toViewPosition(S),z=Vk([0,1,0],_),T=U.toViewPosition(z),b=w.x-H.x,K=T.y-H.y;if(b&&K){var F,u,M=f._dynamicScale3d||[1,1,1],I=yd(f.s("shape3d.image"));if(V[0]>0&&(F=V[0]),V[1]>0&&(u=V[1]),!F||!u){var X=V>0?V:1;F||(F=(Wq(I,f)||f.getWidth())*X),u||(u=(pm(I,f)||f.getTall())*X)}var d=Math.abs(b/F),q=Math.abs(K/u);Math.abs(d-1)<.001&&Math.abs(q-1)<.001||(f._dynamicScale3d=[M[0]/d,M[1]/q,M[2]])}}},_updateOverlapping:function(){var y=this,e=y.s("hide.overlapping.group");if(!e)return y._rectOverlapping&&(y._rectOverlapping=A),void 0;var h,v,X,o=y.gv,z=y.data,d=bg(z,o.getMat(z)),F=1/0,E=1/0,V=-1/0,Y=-1/0,j=z.getAnchor3d(),s=j.x,l=j.y,$=j.z;for(h=0;8>h;h++){if(v=Vk([(h>>2)-s,(1&h>>1)-l,(1&h)-$],d),X=o.toViewPosition(v),isNaN(X.x)||isNaN(X.y))return;F=Math.min(F,X.x),V=Math.max(V,X.x),E=Math.min(E,X.y),Y=Math.max(Y,X.y)}var G={x:F,y:E,w:V-F,h:Y-E};y._rectOverlapping=o.overlappingBox.isOverlapping(e,G)},getVectorDynamicSize:function(){var d,J=this,U=J.s("shape3d"),Z=J.data;if("billboard"===U||"plane"===U||(d=Z._currentCubeElementId)!=q){var x,P,y=J.gv,N=bg(Z,y.getMat(Z)),S=Z.getAnchor3d(),h=.5-S.x,W=.5-S.y,f=.5-S.z,g=Math.min(J.s("vector.dynamic.maxsize"),y._glCapabilities.maxTextureSize)/y.getDevicePixelRatio(),s=function(o,d){o[0]+=h,o[1]+=W,o[2]+=f,d[0]+=h,d[1]+=W,d[2]+=f;var A=y.toViewPosition(Vk(o,N)),F=y.toViewPosition(Vk(d,N)),Y=A.x-F.x,m=A.y-F.y;return Math.min(g,Math.sqrt(Y*Y+m*m))};if("billboard"===U)x=s([-.5,0,0],[.5,0,0]),P=s([0,-.5,0],[0,.5,0]);else if("plane"===U)x=s([-.5,0,0],[.5,0,0]),P=s([0,0,-.5],[0,0,.5]);else if(Z._currentCubeElementId!=q){var j=3*he[d+1],B=3*he[d],F=3*he[d+2];x=s([qf[j],qf[j+1],qf[j+2]],[qf[F],qf[F+1],qf[F+2]]),P=s([qf[j],qf[j+1],qf[j+2]],[qf[B],qf[B+1],qf[B+2]])}return[x,P]}},vf:function(W,G){var g=this;if(g.gv.getFaceVisible(g.data,W)){var K=tn(g,W);K.mat&&(g.faceMat=!0);var A=K.uv;if(A){var I=g._cubeUvs;I||(I=g._cubeUvs=new yk([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var S=0;8>S;S++)I[G+S]=A[S]}return K}},_billboardInView:function(){var T=[-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,0],m=[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,.5],S=new hl,Z=new ah,c=new We;return function(L){var J=this;if(!J.mat)return!0;var U=J.gv.getFrustum(),Y="billboard"===L?T:m;S.makeEmpty(),c.fromArray(J.mat);for(var q=0,N=Y.length;N>q;q+=3)S.expandByPoint(Z.fromArray(Y,q).applyMatrix4(c));return U.intersectsBox(S)}}(),_80o:function(T,F,K){var g=this;if(g._rectOverlapping)return!0;var e=g.shapeModel;if(e||!g.shapeName){var t=g.s("shape3d");if(("billboard"===t||"plane"===t)&&!g._billboardInView(t))return!0;var s=g.gv,k=g.data,h=s._cube,u=Jq.for(T),_=u.directAttribs();if($b&&!In){var S=g.mat;if(S)for(var X=0;X<S.length;X++)g.mat[X]=S[S.length-X-1]}Gq(s,g.mat),!T._picking&&g.s("shape3d.reflector")||g.s("effect.flow")||(e?Hp(s,k,e,g,g.getBodyColor(),K):(_.aPosition=lm(T,h.vs,q,q),_.aNormal=lm(T,h.ns,q,q),ql(T,h.is),g._18O(T,F,"left",0,K),g._18O(T,F,"front",6,K),g._18O(T,F,"right",12,K),g._18O(T,F,"back",18,K),g._18O(T,F,"top",24,K),g._18O(T,F,"bottom",30,K))),Kh(s),g.faceMat&&(g._18O(T,F,"left",0,K,!0),g._18O(T,F,"front",6,K,!0),g._18O(T,F,"right",12,K,!0),g._18O(T,F,"back",18,K,!0),g._18O(T,F,"top",24,K,!0),g._18O(T,F,"bottom",30,K,!0))}},_18O:function(c,y,g,A,f,t){var R=this[g];if(R){if(!f(R.transparent))return;if(t&&!R.mat||!t&&R.mat)return;var F=this.data.s("polygonOffset");F&&Db(c,F),t&&Gq(this.gv,R.mat);var k=this,$=k.data,s=Jq.for(c),H=s.directUniforms();$._currentCubeElementId=A;var a=k.gv,u=a.getTexture(R.texture,$,g),h=R.uv,m=R.uvScale,J=R.uvOffset,G=R.uvRotation,O=R.uvAnchor,d=R.discardSelectable;u?h?Dj(c,y,u,d,a._buffer.uv,k._cubeUvs,J,m,G,O):Dj(c,y,u,d,a._cube.uv,q,J,m,G,O):Dj(c),ng(c,y,R.blend,R.light,R.opacity,R.reverseFlip,R.reverseColor,R.reverseCull),H.uDiffuse=R.color||T["color.empty"],ei(c,A,6),Wi(c,y),gg(c,y,u),t&&Kh(a),F&&mq(c),$._currentCubeElementId=null}},contextLost:function(){lt.superClass.contextLost.apply(this,arguments),this.data.s("shape3d.reflector")&&(this._reflectorRenderTarget=null,this._reflectNormal=null)},drawReflector:function(){var g=new ah,L=new ah,V=new nm,F=new We,x=new ah,w=new ah,j=new ah,S=new ah,b=new We,Y=new We,O=new Pp,J=new Gh,k=new Gh,K=function(y,L,U){y[U]=L[0],y[U+1]=L[1],y[U+2]=L[2]},B=function(M,N,o){o=o||0,M[0]=N[o],M[1]=N[o+1],M[2]=N[o+2]},H=function(F,t){K(F,t.getEye(),0),K(F,t.getCenter(),3),K(F,t.getUp(),6)},h=function(Q,y){B(y._eye,Q,0),B(y._center,Q,3),B(y._up,Q,6),y._18Q=q;var _=y._skybox;_&&(_.p3([Q[0],Q[1],Q[2]]),y.getData3dUI(_).iv())};return function(v){var l=this;l._reflectorInfo=null;var m=l.data;if(m._reflecting)return!1;var G=l.gv;if(G._picking)return!1;var r=m instanceof cg,M=l._reflectorRenderTarget,N=G._canvas.width,i=G._canvas.height;if(M?M.setSize(v,N,i):M=l._reflectorRenderTarget=new Kr.RenderTarget(G,v,N,i),r){var c=m.getPointsMatrix3d().getElements(),P=m.p3();P[1]+=(1-m.getAnchorElevation())*m.getTall(),g.copy(Vk(P,c))}else g.copy(m.p3());if(L.copy(G.getEye()),F.makeRotationFromEuler(V.set(m.r3(),m.getRotationMode(),!0)),!l._reflectNormal){var W;if(r&&m.getThickness()<0){if(!l.shapeModel||!l.shapeModel.top_vs)return!1;W={vs:l.shapeModel.top_vs,ns:l.shapeModel.top_ns}}else{if(W=Hf(l,l.s("shape3d")),!W)return!1;!W.ns&&W.length&&(W=W[0])}if(!W.ns||!W.vs)return!1;l._reflectNormal=[W.ns[0],W.ns[1],W.ns[2]],l._reflectorVbuffer=tk.Buffer.createVertexBuffer(v,new Float32Array(W.vs))}if(x.copy(l._reflectNormal),x.applyMatrix4(F),w.subVectors(g,L),w.dot(x)>0)return!1;w.reflect(x).negate(),w.add(g),j.copy(G.getCenter()).negate().add(g),j.reflect(x).negate(),j.add(g),S.copy(G.getUp()),S.reflect(x);var K=[0,0,0,0,0,0,0,0,0];H(K,G),B(G._eye,w.toArray()),B(G._center,j.toArray()),B(G._up,S.toArray()),G._18Q=q;var y=G._skybox;y&&(y.p3(G._eye),G.getData3dUI(y).iv()),Tf(v,M.frame),G.setViewport(v,0,0,M.width,M.height);var U=m.s("shape3d.reflector.background");if(U){var e=v.getParameter(v.COLOR_CLEAR_VALUE);Zc(v,U)}else Zc(v,[0,0,0,1]);Jq.for(v).glState.depth.mask=!0,v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT);var T=m.s("shape3d.reflector.clip"),n=T===A?.003:T,I=Vc(G),u=Wn(G);O.setFromNormalAndCoplanarPoint(x,g.add(x.clone().multiplyScalar(n))),O.applyMatrix4(Y.fromArray(u)),J.set(O.normal.x,O.normal.y,O.normal.z,O.constant),Y.fromArray(I).getInverse(Y),k.set(Math.sign(J.x),Math.sign(J.y),1,1).applyMatrix4(Y),J.multiplyScalar(2/J.dot(k)),I[2]=J.x-I[3],I[6]=J.y-I[7],I[10]=J.z-I[11],I[14]=J.w-I[15];var t=G._computedProjectMatrix;G._computedProjectMatrix=I,m._reflecting=!0;var f=m.s("shape3d.reflector.shadow"),Q={renderAxis:!1,renderEdit:!1,renderGrid:!1};"disabled"===f?(Q.createShadowMap=!1,Q.renderShadow=!1):"scene"===f?Q.createShadowMap=!1:Q.useReflectorSelfShadowMap=!0,G.renderScene(Q),G._computedProjectMatrix=t,b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(Y.fromArray(G._projectMatrix)),b.multiply(Y.fromArray(G._viewMatrix)),U&&Zc(v,e),jr(v),h(K,G);var p=m.s("shape3d.reflector.blur");if(p){var Z=G.getPostProcessingModule("Blur");Z&&Z.drawImpl(v,M,p,p>=3,m.s("shape3d.reflector.blur.iterations"))}var E=G.getPostProcessingModule("Glitch");E&&E.enable&&E.onlyReflector&&(M=E._42(v,M));var o=v._compiledShader.reflector;o||(o=v._compiledShader.reflector=new tk.Shader(v,Xk.Reflector.vs,Xk.Reflector.fs)),o.bind(),v.activeTexture(v.TEXTURE0),kf(v,M.texture),o.uniforms.tDiffuse=0,o.uniforms.color=qn(m.s("shape3d.reflector.color")||"rgb(128,128,128)"),o.uniforms.textureMatrix=b.toArray(),o.uniforms.modelMatrix=r?c:bg(m),o.uniforms.viewMatrix=Wn(G),o.uniforms.projectionMatrix=Vc(G);var _=l._reflectorVbuffer;_.upload(),o.attributes.pos.pointer(_);var R=this.s("shape3d.transparent");if(R){var D=Jq.for(v).glState,X=D.depth.mask;D.depth.mask=!1}return v.drawArrays(v.TRIANGLES,0,_.data.length/3),R&&(D.depth.mask=X),m._reflecting=!1,v.useProgram(G._prg),kf(v,q),!0}}()}),Xk.Reflector={vs:["attribute vec3 pos;","uniform mat4 textureMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying vec4 vUv;","void main() {","	vUv = textureMatrix * modelMatrix * vec4( pos, 1.0 );","	gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( pos, 1.0 );","}"].join("\n"),fs:["precision highp float;","uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","	vec4 base = texture2DProj( tDiffuse, vUv );","   vec2 tUv = vUv.xy / vUv.w;","   if (tUv.x < .0 || tUv.y < .0 || tUv.x > 1. || tUv.y > 1.) discard;","	gl_FragColor = vec4( blendOverlay( base.rgb, color ), base.a );","}"].join("\n")};var mt=function(z,b){Vq(mt,this,[z,b])};uj(mt,lt,{_80o:function(){}});var nt=function(L,A){Vq(nt,this,[L,A])};uj(nt,kt,{_25Q:1,validate:function(t){var b=this,n=b.s;if(n(Qm)!==Xp||n("batch")!=q||!b.info||b.data._needChangeGeometry){var $=b.gv,y=b.data,w=n("edge.width"),R=y._40I,U=y._41I;if(y._needChangeGeometry=b.shapeModel=b.info=b.lineShapeModel=q,R&&U){var v,B,s,G,x,A,l,N,o,C,L=y.isLooped(),Q=n(Oi),H=M.getEdgeType(Q);if(H){var P=H(y,Rg(b,$,y,L,Q),$,b._19Q);if(!P.points||P.points.isEmpty())return;A=b.info={},l=P.segments,x=P.points,N=x.size();for(var f=R.getElevation(),V=U.getElevation(),Z=0;N>Z;Z++){var F=x.get(Z);F.e==q&&(F.e=f+(V-f)*Z/(N-1))}o=Ve(x.get(0)),C=Ve(x.get(N-1));var u=N%2,S=(N-u)/2;A.c1=Ve(x.get(S-1)),A.c2=Ve(x.get(S)),0!==u&&(A.p3=A.c2),A.s1=o,A.s2=Ve(x.get(1)),A.t1=Ve(x.get(N-2)),A.t2=C}else{x=new lo,A=b.info={};var j=n("edge.offset"),I=n("edge.center"),d=n("edge.source.t3"),J=n("edge.target.t3"),_=as($,y,"source"),c=as($,y,"target");if(!_||!c)return $.invalidateData(y),delete b.info,!1;if(d&&(_[0]+=d[0],_[1]+=d[1],_[2]+=d[2]),J&&(c[0]+=J[0],c[1]+=J[1],c[2]+=J[2]),Q===kh){l=n("edge.segments");var r=A.points=n(Zf)||ni;if(N=r.size()){if(o=Ve(r.get(0)),C=Ve(r.get(N-1)),!I&&j){var E=j;s=Dk(o,_,!0),j=e(E,Hh(_,o)),_=[_[0]+s[0]*j,_[1]+s[1]*j,_[2]+s[2]*j],s=Dk(c,C,!0),j=e(E,Hh(C,c)),c=[c[0]-s[0]*j,c[1]-s[1]*j,c[2]-s[2]*j]}if(1===N)A.p3=o;else{var u=N%2,S=(N-u)/2;v=Ve(r.get(S-1)),B=Ve(r.get(S)),0!==u&&(A.p3=B),A.s1=_,A.s2=o,A.t1=C,A.t2=c}}else!I&&j&&(s=Dk(c,_,!0),G=Hh(_,c),j=Oc(j,G),_=[_[0]+s[0]*j,_[1]+s[1]*j,_[2]+s[2]*j],c=[c[0]-s[0]*j,c[1]-s[1]*j,c[2]-s[2]*j]),v=_,B=c;x.add({x:_[0],y:_[2],e:_[1]}),x.addAll(r),x.add({x:c[0],y:c[2],e:c[1]})}else{var z=Rg(b,$,y,L,Q);if(b._19Q||(z=-z),L){var a=_[0],X=_[1],p=_[2],O=R.getTall()/2+z;v=[a-z,X+O,p],B=[a+z,X+O,p],x.add({x:a-z,y:p,e:X}),x.add({x:a-z,y:p,e:X+O}),x.add({x:a+z,y:p,e:X+O}),x.add({x:a+z,y:p,e:X})}else{s=Dk(c,_,!0),G=Hh(_,c);var i={x:_[0],y:_[2]},W={x:c[0],y:c[2]},K=wr(q,i,W,z),k=K.x-i.x,h=K.y-i.y;j=Oc(j,G),s[0]*=j,s[1]*=j,s[2]*=j,v=[_[0]+s[0]+k,_[1]+s[1],_[2]+s[2]+h],B=[c[0]-s[0]+k,c[1]-s[1],c[2]-s[2]+h],I?(x.add({x:_[0],y:_[2],e:_[1]}),x.add({x:v[0],y:v[2],e:v[1]}),x.add({x:B[0],y:B[2],e:B[1]}),x.add({x:c[0],y:c[2],e:c[1]})):(x.add({x:v[0],y:v[2],e:v[1]}),x.add({x:B[0],y:B[2],e:B[1]}))}}A.c1=v,A.c2=B}A._lastPointsSegments={points:x,segments:l},A.list=n(Qm)===Xp?b.createTubeModel(x,l,w/2,t):b.createLineModel(x,l,w,"edge","edge.dash")}}},invalidateCachedGeometry:function(){this.info=q}});var ot=function(R,Z){Vq(ot,this,[R,Z]),this._needRecoverPosition=!0};uj(ot,lt,{_80o:function(f,i,x){var s=this,u=s._matWithExtraction||s.mat;if(u&&(!s.s("shape3d.reflector")||f._picking)){var e=s.gv,V=s.shapeModel;Gq(e,u),V?Hp(e,s.data,V,s,s.getBodyColor(),x):(If(s,f,i,"left",x),If(s,f,i,"front",x),If(s,f,i,"right",x),If(s,f,i,"back",x),If(s,f,i,"top",x),If(s,f,i,"bottom",x)),Kh(e)}},validate:function(W,J){var u,d,Y=this,F=Y.s,t=Y.data,A=t._thickness/2,B=t.isClosePath(),_=t.getPoints(),P=t.getSegments(),c=F(Eb),o=W&&W.uv;if(Y.invalidateUnstableWireframe(),Y.clear(),Y.dispatchBoundingBoxChanged(),M.extractShapeTranslation||M.extractVerticesTranslation){var Z=new Mh.Vector3(t.p3());_=Wr(_),_.forEach(function(c){c.x-=Z.x,c.y-=Z.z}),Y._vsTranslation=(new Mh.Matrix4).setPosition(Z);var E=t.getShapeElevation;t.getShapeElevation=function(){return-(this.getTall()||0)*(this._anchorElevation-.5)}}else Y._vsTranslation=null;if(0>A){Y.s("shape3d.reflector")&&(Y._reflectNormal=null);try{var V=F("shape3d.image.projection");if(V&&V[4]){var n=t.p3(),C=n[0],f=n[2];V=[C+V[0],V[1]+f,C+V[2],V[3]+f]}d=Y.shapeModel=Dn(_,P,F(Cf),F(ao),c,F(eo),t.getTall(),t.getShapeElevation(),B,V)}catch(g){d=Y.shapeModel={}}F(Zr)?F("shape3d.image")||delete d.uv:(delete d.vs,delete d.ns,delete d.uv),F("shape3d.top.image")||delete d.top_uv,F("shape3d.bottom.image")||delete d.bottom_uv}else if(F(Qm)===Xp)u=gi(_,P,c,B),d=Y.shapeModel={vs:[]},F("shape3d.image")&&(d.uv=[],d.sum=F(eo)||oi(u)||1,d.len=0),F(Cf)&&!B&&(d.top_vs=[],F("shape3d.top.image")&&(d.top_uv=[])),F(ao)&&!B&&(d.bottom_vs=[],F("shape3d.bottom.image")&&(d.bottom_uv=[])),Y._12O(u,A);else{var r,j,O,H,Q,R,T,y,i,S;if(u=gi(_,P,c,B),Q=Y.vf(Ao,o,!1,J),A&&(R=Y.vf(ki,o,!1,J),T=B?q:Y.vf(wk,o,!1,J),y=B?q:Y.vf(Bj,o,!1,J),i=Y.vf(vg,o,!1,J),S=Y.vf(rj,o,!1,J)),A){for(var U=0,k=u.length;k>U;U++)u[U]=Y._tryRemoveBezierPoints(u[U],A);Y._12O(u,A)}else Q&&u.forEach(function(X){if(H=X.length,H>0)for(r=X[0],O=1;H>O;O++)j=X[O],Y.addV(Q.vs,r,j),r=j});Y._20Q(u),W||(Q&&(Q.ns=am(Q.vs),ok(Q,"vs"),ok(Q,tl)),A&&(R&&(R.ns=am(R.vs),ok(R,"vs"),ok(R,tl)),T&&(T.ns=am(T.vs),ok(T,"vs"),ok(T,tl)),y&&(y.ns=am(y.vs),ok(y,"vs"),ok(y,tl)),i&&(i.ns=am(i.vs),ok(i,"vs"),ok(i,tl)),S&&(S.ns=am(S.vs),ok(S,"vs"),ok(S,tl))))}var h=Y.mat=t.getPointsMatrix3d().getElements();Y._vsTranslation?h=Y._matWithExtraction=(new Mh.Matrix4).fromArray(h).multiply(Y._vsTranslation).toArray():Y._matWithExtraction=null,W&&(Y.gv.getWireframeGeometry(t)&&(Y.wfGeometry=Fg(Y,d),Y.wfMatrix=h?li(h):null),Ag(Y,h,W,d,J),Y.clear()),E!=q&&(t.getShapeElevation=E)},_20Q:function(Q){var l,r,T,x,$,s,i,d,V,N,p,M,h,L=this,C=L.front,X=L.back,y=L.top,A=L.bottom,o=C?C.tuv:q,G=X?X.tuv:q,z=y?y.tuv:q,S=A?A.tuv:q,k=0,f={front:0,back:0,top:0,bottom:0};(o||G||z||S)&&(h=L.s(eo),l=h||oi(Q)||1,p=L.s("all.uv.union"),Q.forEach(function(z){if(r=z.length,r>0){for(N in f)M=L.s(N+".uv.union"),(M===!1||M==q&&p===!1)&&(f[N]=0,h||(l=oi([z])));for(s=z[0],T=1;r>T;T++){i=z[T],d=Hh(s,i);for(N in f)k=f[N],x=k/l,f[N]=k+=d,$=k/l,"back"===N&&(V=x,x=1-$,$=1-V),L._14O(L[N],x,$);s=i}}}))},_14O:function(a,m,R){if(a){var k=a.uv,e=a.tuv;if(e){if(k)var s=k[0]+(k[6]-k[0])*m,I=k[1]+(k[7]-k[1])*m,U=k[2]+(k[4]-k[2])*m,l=k[3]+(k[5]-k[3])*m,A=k[2]+(k[4]-k[2])*R,O=k[3]+(k[5]-k[3])*R,y=k[0]+(k[6]-k[0])*R,n=k[1]+(k[7]-k[1])*R;else s=m,I=0,U=m,l=1,A=R,O=1,y=R,n=0;e.push(U,l,A,O,y,n,y,n,s,I,U,l)}}},_13O:function(l){var s=l.uv,D=l.tuv;D&&(s?D.push(s[2],s[3],s[4],s[5],s[6],s[7],s[6],s[7],s[0],s[1],s[2],s[3]):D.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(B,b){var u=B.length;if(4>u)return B;var G,Y,h,x,J,O,a=!1,Z=function($){return B[$]},S=function(G){return B[u-1-G]};for(J=0;1>=J;J++)for(O=J?S:Z,Y=O(0),h=O(1),G=2;u-1>G;G++)if(x=O(G),!x.remove)if(x.b){var j=wr(Y,h,x,b);j.adjust?(x.remove=!0,a=!0):(Y=h,h=x)}else Y=h,h=x;if(!a)return B;var F=[];for(G=0;u>G;G++)B[G].remove||F.push(B[G]);return F},_12O:function(G,t){var f,V,S,c,F,h=this.s("shape3d.point.epsilon"),_=this;G.forEach(function(X){if(F=X.length,F>0)for(f={p:X[0],n:!0},c=1;F>c;c++)V=X[c],S=F-1>c?X[c+1]:q,S&&Math.abs(V.x-S.x)<h&&Math.abs(V.y-S.y)<h||_.addPoint(f,V,S,t,X)})},addPoint:function(N,S,p,u,U){var t,z,D,h,Y,j,g,m,R,s=this,x=N.p,X=N.f,w=N.b,a=s.s("shape3d.side")||Ze,H=s.s("shape3d.start.angle"),C=s.s("shape3d.sweep.angle"),Z=s.shapeModel,i=s.data.isClosePath();if(N.n&&(N.n=!1,X=i&&U.length>2?wr(U[U.length-2],x,S,u):wr(q,x,S,u),w=Vf(x,X),Z?Z.top_vs&&s._10O(w,X,a,H,C,Z.top_vs,Z.top_uv):(t=s.left)&&(s.addV(t.vs,w,X),s._13O(t))),z=p?wr(x,S,p,u):i&&U.length>2?wr(x,S,U[1],u):wr(x,S,q,u),D=Vf(S,z),Z){var d,G,L=Z.vs,_=Z.uv,I=Z.sum;for(_&&(d=Z.len/I,Z.len+=Hh(x,S),G=Z.len/I),j=s._9O(w,X,a,H,C),g=s._9O(D,z,a,H,C),m=0;a>m;m++)R=m+1,Te(L,j[R]),Te(L,g[m]),Te(L,j[m]),Te(L,g[m]),Te(L,j[R]),Te(L,g[R]),_&&(h=m/a,Y=R/a,_.push(d,Y,G,h,d,h,G,h,d,Y,G,Y));!p&&Z.bottom_vs&&s._10O(D,z,a,H,C,Z.bottom_vs,Z.bottom_uv,!0)}else!p&&(t=s.right)&&(s.addV(t.vs,z,D),s._13O(t)),(t=s.front)&&s.addV(t.vs,X,z),(t=s.back)&&s.addV(t.vs,D,w),(t=s.top)&&s.addH(t.vs,X,z,D,w,!0),(t=s.bottom)&&s.addH(t.vs,w,D,z,X);N.p=S,N.f=z,N.b=D},_10O:function(C,e,v,U,Q,B,V,Y){var i,t,H=this,F=H.data,b=H._9O(C,e,v,U,Q),$=(C.x+e.x)/2,u=(C.y+e.y)/2,A=F.getShapeElevation(),p=0;for(p=0;v>p;p++)Y?(Te(B,b[p]),Te(B,b[p+1])):(Te(B,b[p+1]),Te(B,b[p])),Te(B,[$,A,u]),V&&(Y?(i=c*(p+1)/v+U,t=c*p/v+U):(i=c*p/v+U,t=c*(p+1)/v+U),V.push(.5-.5*O(t),.5-.5*o(t),.5-.5*O(i),.5-.5*o(i),.5,.5))},_9O:function(Z,Y,R,S,i){var w,t,n=this,Q=n.data,I=[],B=(Z.x+Y.x)/2,m=(Z.y+Y.y)/2,U=Q.getTall()/2,r=Q.getShapeElevation(),y=0;for(i==q&&(i=c);R>=y;y++)w=i*y/R+S,t=O(w),I.push([B+(Z.x-B)*t,r+U*o(w),m+(Z.y-m)*t]);return I},addV:function(M,o,C){var d=o.x,N=o.y,A=C.x,v=C.y,Q=this.data,T=Q.getShapeElevation(),K=Q.getTall()/2;M.push(d,T-K,N,A,T-K,v,A,T+K,v,A,T+K,v,d,T+K,N,d,T-K,N)},addH:function(U,A,l,C,a,J){var B=this.data,i=B.getTall()/2,D=B.getShapeElevation()+(J?i:-i);U.push(A.x,D,A.y,l.x,D,l.y,C.x,D,C.y,C.x,D,C.y,a.x,D,a.y,A.x,D,A.y)},vf:function(O,F,N,Y){var U,P=this,t=P.gv.getFaceVisible(P.data,O);return(N||t)&&(U=tn(P,O,Y),U.vs=[],U.tuv=t&&(U.texture||F)?[]:q,U.visible=t),U}});var pt=function(F,y){Vq(pt,this,[F,y])},qt={},rt=function(Z){return/\.(png|jpg|gif|jpeg|bmp|svg)$/i.test(Z)};uj(pt,lt,{validate:function(){var k=this,f=k.gv,U=k.data,o=k.s,M=qn(o("points.color")),S=o("points.size"),l=o("points.uv.offset"),P=o("points.image");!P||rt(P)||ve.test(P)||(qt[P]||(qt[P]=k._createCachedImage(P)),P=qt[P]);var i,I,J=U._modelDirty,T=o("points.model");if(T){if(k._lastShapeModel!==T||!k.shapeModel){var V=Hf(k,T);if(!V)return;var Q=[],w={};k.eachShapeModel(function(f){for(var Y=0,d=f.length;d>Y;Y+=3){var Z=f[Y],n=f[Y+1],e=f[Y+2],k=""+Z+"_"+n+"_"+e;w[k]||(w[k]=!0,Q.push(Z,n,e))}},V),k._setShapeModelPoints(new yk(Q)),k._lastShapeModel=T,J=!0}i=k.shapeModel.vs.length,I=i/3}else{var K=U.getPoints();if(I=i=K.length,J||U._pointsDirty||!k.shapeModel){for(var v=[],D=0;I>D;D++){var t=K[D];t&&v.push(t.x,t.e,t.y)}k._setShapeModelPoints(new yk(v)),U._pointsDirty=!1,k._lastShapeModel=null,J=!0}}if(k.info={mat:bg(U),size:S,diffuse:M,opacity:o("points.opacity"),texture:P,alphaTest:o("points.transparent")?0:o("alphaTest"),uvScale:o("points.uv.scale"),uvOffset:l,discardSelectable:o("points.discard.selectable")},J||U._colorsDirty){var F=!1,s=U.getColors();if(s&&s.length>0)for(var j=[],D=0;I>D;D++)for(var R=s[D],B=R?(F=!0,qn(R)):M,x=4*D,m=0;4>m;m++)j[x+m]=B[m];k.shapeModel.cs=F?new yk(j):null,U._colorsDirty=!1}if(J||U._sizesDirty){var b=!1,E=U.getSizes();if(E&&E.length>0)for(var X,n=[],D=0;I>D;D++)X=E[D],X>=0?(n.push(X),b=!0):n.push(S);k.shapeModel.ss=b?new yk(n):null,U._sizesDirty=!1}if(J||U._offsetsDirty){var Z=!1,G=U.getUvoffsets();if(G&&G.length>0)for(var N,z,_,a=[],D=0;I>D;D++)N=2*D,z=G[N],_=G[N+1],z!=A&&_!=A?(a.push(z,_),Z=!0):a.push(l[0],l[1]);k.shapeModel.os=Z?new yk(a):null,U._offsetsDirty=!1}if(J||k._lastPointNumber!==I){this.dispose();var h=f.pickColorMap,g=k._startPickId=h._pickIdUsed;h._pickIdUsed=g+I;for(var v=[],D=0;I>D;D++){var O=g+D,p=Ws(O);v.push(p[0],p[1],p[2],p[3]),h[O]||(h[O]={data:U,part:D})}k.shapeModel.ps=new yk(v),k._lastPointNumber=I}U._modelDirty=!1,this.dispatchBoundingBoxChanged()},_setShapeModelPoints:function(f){var n=this,b=n.shapeModel,C=n.shapeModel={vs:f};if(!b)return C;var O=f.length,T=Math.round(O/3);return b.cs&&b.cs.length==4*T&&(C.cs=b.cs),b.ss&&b.ss.length==T&&(C.ss=b.ss),b.os&&b.os.length==2*T&&(C.os=b.os),b.ps&&b.ps.length==4*T&&(C.ps=b.ps),C},_createCachedImage:function(q){var d=128,j=rs(),v=j.getContext("2d");Sk(j,d,d,1),xb(v,{width:d,height:d,comps:[{type:q,background:"white",borderWidth:0,rect:[0,0,d,d]}]},0,0,d,d);var M=x.Math.generateUUID();return zl[M]=j,M},_80o:function(U,X){var n=this,J=n.gv,l=J._picking;if(!l||J.isSelectable(n.data)){var D=n.shapeModel,u=n.info;if(D&&D.vs&&D.vs.length){var s=Jq.for(U);s.useProgram(n._asureProgram(U));var e=s.directUniforms(),V=s.directAttribs();e.modelMatrix=u.mat,e.modelViewMatrix=ds([],J._viewMatrix,u.mat),e.projectionMatrix=J._projectMatrix,e.viewMatrix=J._viewMatrix,e.scale=J.getHeight()/2,e.size=u.size,e.diffuse=u.diffuse,e.opacity=u.opacity,e.map=J.getTexture(u.texture,n.data),e.alphaTest=u.alphaTest,e.resolution=J.getDevicePixelRatio(),e.discardSelectable=u.discardSelectable,e.uvScale=u.uvScale,V.uvOffset=!l&&D.os?Id(U,J._buffer.os,D.os,q):u.uvOffset,e.blackout=U._blooming&&!n.data.s("bloom"),V.position=Id(U,J._buffer.vs,D.vs,q),l?(e.picking=!0,V.pickColor=Id(U,J._buffer.ps,D.ps,q),e.useColor=!1,V.color=null):(e.picking=!1,V.pickColor=null,D.cs?(e.useColor=!0,V.color=Id(U,J._buffer.cs,D.cs,q)):(e.useColor=!1,V.color=null)),D.ss?(e.useSizeArray=!0,V.sizeArray=Id(U,J._buffer.ss,D.ss,q)):(e.useSizeArray=!1,V.sizeArray=null),nf(U,0,D.vs.length/3,U.POINTS),s.useProgram(X),V.disable(),J.shadowMap.enable&&J.shadowMap.createShadow(),J.flowMap.createFlow()}}},_asureProgram:function(h){return h._pointsShader||(h._pointsShader=this.gv._postProcessing.createShader(h,pt.shaderSrc)),h._pointsShader.program},dispose:function(){pt.superClass.dispose.call(this);var W=this._startPickId,y=this._lastPointNumber;if(W&&y){for(var f=this.gv.pickColorMap,D=0;y>D;D++){var V=W+D;f[V]&&delete f[V]}delete this._startPickId,delete this._lastPointNumber}}}),pt.shaderSrc="!!~v!oj<g*p!s{n/!onpbjuu5j!tnppQewfnm!N.b!u0s!jfym<bd!tv!o)j!g>p+s!nf!{njbTuu5o!jnppQe`fmmhW!j*f!xfNwbjuusdjfyq<ts!fvQotjjg!p)s!ng!jn!bu<5*!!q1s/p2k!f.d!u>j>p!o^N!b4u!s]j^y!<3!!]vyojjsgupbsNno!pnjbuud5f!kwpjsfqx!N)b!u>s!jfyw<ju!dvfoqjtgspfsQnt!jg!mmppbpuc!!tdbm~f!<<o!pbjuuuvsmjpctvfusf!!+w!ffd{4j!tq!p>t!jfu{jjpTou<ojp!Qv`omjhg!ps|n!!fctpmpfm!!~v!tf<Doppmjpusv<mp!tbfusu!s+j!czvbusfs!Bwff{dj5t!!d>p!mfp{sj<Tu!owjbpsQz`jmohh!!w|f!d*5z!bwsDspBmfp{sj<Tft!vb)u!ugsjj!cv<uofp!jwufjdt3p!QvwwnP!g+g!tyfjus<ub!Nwobpsjzujdofhk!pwsfqd!3>!!woPpgjgutjftup<Q`m!hv!oj<goppsjnu!jctpppQmw!nq!j+d!lyjjoshu<bN!xbfujuWsmjfcevpunf!!>w!fodp5j!uqjjtdplQDwpnm!ps<<*!1!/v2o!j-gepfsnns!pggmtpobbus!ut!j){5fd<fw!!v>o!jogppjsunj!tgpmQpwbnu!!5sdfftwp!mv<u*j!poop<ju!jvtopjqg!p)s4nd!fcwp!p>m!!evftnfsTpjg{tfoBbsssub!z4<df!wb!uu<s*jucfvtugfg!Pgwmvp)b3ud!ftwj!{>f!Busfstbgzg<Pw!!c~p!pm<!sjptmQpfds!t>q!fsdpumjpwDfwN!bu|s!j*ys)p!mnpbDuf5t!vn)!!*g!j|!f!tsmffu!vs~o!!n<]s!p3m!p^D]l!d4j!q^!!>>!>s!p.m!p2D/w1!<|!!~*ho!jwlpdjjeq!)n!bgjjo!)*|!^#!!~qs~f!dj<tsjppmop!Difjthvigqg!jgem!p>b!us<pm!p$DehfbgsjGo`fm!hV!TF|`!NfBtQmf!!v~o!jg<psspnm!pwDfwd!5>!!esjpgmgpvDthfb<sG!`vmohj!gp<sens!bgdmtpjbeu!!*p1q/b1d!j>u>z!<b/!svpomjpgDpfstnv!gggmjpeb)u!!gbjm!qi|b!U*fhtouj<ldj!qv)o!jggjp!sn<!ecspbpdmt!jvet!f*DuptmfpUsb<iq!mwbb!s=z!jbo/hs!pwmfpdD5f!twvDgpgmjpes)<!gj!!vogjjgeposfn$!!cp~p!m!<q*jwdvl!j-oqhb<n!!)vEo3jfgspvsuny!fcup!p>m+!!esjptmdpbDsfetTvfgmgfjdeu!bc<muff<tgg!Pvwo!j>g,p!swnv!!cp<pfmm!bcdmTbwdvl!p+v!ue<spp!DvuoojjgppQs`nm!hw!f>d!3w!vv!w3Tddfbwm!f<|!!*wfbmsczbjuodhf!mwffTde3s!bwdPtgjgetaf!u}<}!h$ojjgl!dejfqgaj)o!fgej)!!V*T!FQ`BNNB`QF!T*V!!)veofjogjpgsfne!!tgbjn$q!mf~s!3E<!*n!bzqu<jd$bfqope!j+g!b/wfptjveg!gnjbej!o-){*z!y|/f!tjvgg!g)jcem!b)d5ldpfvwu!*>!!|s!phmmp`DGfstbvhgDgpjmep!s!|>!!fwtfmdf5!)~1!/1<-*!!1z/u1j-d!b1q/p1!-+!!2b//1s*p<m!psDfwu!v-s{oz<y!/~spm!pwDfwd!5)!5edjfgwg!v>t!fsDppmmppDsf<tv!gjggj!e)!aq|j!d*lsjpomhp!D%f%t!v";var st=function(X,r){Vq(st,this,[X,r]),this._needRecoverPosition=!0};uj(st,kt,{_25Q:1,validate:function(k){var _=this,b=_.data,C=_.s,I=b.getPoints(),i=I.size();_.dispatchBoundingBoxChanged();var $=b.p3(),R=_.mat=Sj();Um(R,$),Ah(R,b.getFinalRotation3d(),b.getRotationMode());var l=b.getScale3d(),P=b._dynamicScale3d;if(P&&(l[0]*=P[0],l[1]*=P[1],l[2]*=P[2]),xh(R,l),Um(R,qj($)),(C(Qm)!==Xp||C("batch")!=q||!_.shapeModel||b._needChangeGeometry)&&(b._needChangeGeometry=_.shapeModel=_.info=_.lineShapeModel=q,i>1)){var y=_.info={},o=b.getSegments(),Q=b.getThickness(),u=Ve(I.get(0)),H=Ve(I.get(i-1)),X=i%2,z=(i-X)/2;if(y.c1=Ve(I.get(z-1)),y.c2=Ve(I.get(z)),0!==X&&(y.p3=y.c2),y.s1=u,y.s2=Ve(I.get(1)),y.t1=Ve(I.get(i-2)),y.t2=H,C(Qm)===Xp){if(M.extractPolylineTranslation||M.extractVerticesTranslation){var $=new Mh.Vector3(b.p3());I=Wr(I),I.forEach(function(S){S.x-=$.x,S.e-=$.y,S.y-=$.z}),_._vsTranslation=(new Mh.Matrix4).setPosition($),_._matWithExtraction=(new Mh.Matrix4).fromArray(R).multiply(_._vsTranslation).toArray()}else _._vsTranslation=null,_._matWithExtraction=null;y.list=_.createTubeModel(I,o,Q/2,k)}else y.list=_.createLineModel(I,o,Q,"shape.border","shape.dash")}},invalidateCachedGeometry:function(){this.shapeModel=this.info=this.lineShapeModel=q},_80o:function(b,f,x){var g=this,$=g.shapeModel;if($){var e=g.mat;(M.extractPolylineTranslation||M.extractVerticesTranslation)&&g._matWithExtraction&&(e=g._matWithExtraction);var U=g.gv;Gq(U,e);var J,E=g.s("3d.clip.direction");if(U._uvClipEnabled&&("uv.left"===E||"uv.right"===E)&&(J=g.s("3d.clip.percentage"))<1){var y=!0,N=!0;Mk($);var F=$.top_vs,X=$.bottom_vs,S=$.vs,B=Jq.for(b),r=B.directUniforms(),p=B.directAttribs();"uv.left"==E?(1>J&&(y=!1),0>=J&&(N=!1)):(1>J&&(N=!1),0>=J&&(y=!1)),$.top_vs=$.bottom_vs=A,p.aUv=Id(b,U._buffer.uv,$.uv,q,2),Hp(U,g.data,$,g,g.getBodyColor(),x),p.aUv=!1,r.uClipDirection=0,$.vs=A,y&&($.top_vs=F),N&&($.bottom_vs=X),Hp(U,g.data,$,g,g.getBodyColor(),x),$.vs=S,$.top_vs=F,$.bottom_vs=X}else Hp(U,g.data,$,g,g.getBodyColor(),x);Kh(U)}}});var tt=x.graph3d.PostProcessing=function(q){var R,U,o,l,K=this,s={},M=!1,a=!1;!function(){u.keys(tt).forEach(function(i){s[i]=new tt[i](q)})}(),K.getModule=function(G){return G?s[G]:K},K.getModuleList=function(){return u.keys(s)},K.resetModules=function(){for(var G in s){var I=s[G];I.enable=!1,I.resetProperties&&I.resetProperties()}M=!1},K._serializable=!0,K.handleDataModleChange=function(i,b){i&&(K._serializable&&i.setPostProcessingData(K.serialize()),i.removeSerializeListener(K.onDataModelSerialize,K)),b&&(b.addSerializeListener(K.onDataModelSerialize,K),K.deserialize(b))},K.onDataModelSerialize=function(S){"serialize"===S.type?K._serializable&&(q.dm()._postProcessingData=K.serialize()):"deserialize"===S.type&&K.deserialize(q.dm())},K.isDeserializeDisabled=function(T){return!K._serializable||T.a("sceneBloom")!==A},K.isSerializable=function(){return K._serializable},K.setSerializable=function(m){K._serializable=m,m||q.dm().setPostProcessingData(A)},K.serialize=function(){var v,d,I,g,X={};for(d in s)if(I=s[d],g=I.serializeProperties){v={},I.enable&&(v.enable=!0);for(var K in g){var U=I[K];U!=g[K]&&(v[K]=U)}u.keys(v).length&&(X[d.toLowerCase()]=v)}return X},K.deserialize=function(B){var G,Q,X,S,i,p={},T={};for(G in s){X=s[G],S=X.serializeProperties;var f={},u="scene"+G,m=B.a(u);m!==A&&(f.enable=m);for(var i in S)m=B.a(u+i[0].toUpperCase()+i.slice(1)),m!==A&&m!==S[i]&&(f[i]=m);Er(f)||(T[G[0].toLowerCase()+G.slice(1)]=f)}if(Er(T)&&(T=B.getPostProcessingData()),T)for(Q in T)if(Q&&(G=Q[0].toUpperCase()+Q.slice(1),X=s[G])){p[G]=!0,S=T[Q];var g=!!S.enable;K.enableModule(G,g),G="scene"+G,B.a(G,g),X.resetProperties&&X.resetProperties();for(i in S)if("enable"!==i){var m=S[i];X[i]=m,B.a(G+i[0].toUpperCase()+i.slice(1),m)}}for(G in s)p[G]||(X=s[G],X.enable=!1,X.resetProperties&&X.resetProperties())},K.getRenderTarget=function(){return R},K.blitScreen=function(y,v,w,k,G){var s=q.getGL();if(s&&(a||S())){y&&(y.bind(s),q.setViewport(s,0,0,y.width,y.height)),G&&G.clear===!1||s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),w||(w=U),w.bind(),s.activeTexture(s.TEXTURE0+0),kf(s,v||s._emptyTexture);var t=w.uniforms;t.image=0;var h=1;if(k)for(var D in k){var L=k[D];L instanceof WebGLTexture&&(s.activeTexture(s.TEXTURE0+h),kf(s,L),L=h,h++),t[D]=L}if(o.upload(),l.upload(),w.attributes.pos.pointer(l),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),h>1)for(;--h>=0;)s.activeTexture(s.TEXTURE0+h),kf(s,null);else kf(s,null);y&&y.unbind(s)}},K.decodeShader=function(l){var T,Z,k,L="",B="";for(k=0;k<l.length;k++)T=l[k],"%"===T?T="'":"a"===T?T='"':"]"===T&&(T="\\"),Z=String.fromCharCode(T.charCodeAt(0)-1),k%2?B+=Z:L=Z+L;return B+L},K.createShader=function(c,H,B){var m,J;if("string"==typeof H){var f=H.indexOf("^#");m=K.decodeShader(H.substr(0,f)),J=K.decodeShader(H.substr(f+2))}else m=H.vs,J=H.fs;if(B){var M=B(m,J);M&&M.vs&&(m=M.vs),M&&M.fs&&(J=M.fs)}return new tk.Shader(c,m,J)},K.enableModule=function(x,N){var B,u,X,b=x.split(",");for(B=0,u=b.length;u>B;B++)X=b[B].trim(),s[X]&&(s[X].enable=N);M=!1;for(X in s)if(s[X].enable){M=!0;break}};var S=function(){if(a)return!1;var F=q.getGL();return F?(R=new Kr.RenderTarget(q,F,null,null,{samples:T.renderTextureSamples||1,minFilter:F.LINEAR,magFilter:F.LINEAR,depthFormat:q.isWebGL2()?F.DEPTH_COMPONENT32F:null}),U=new tk.Shader(F,H.vs,H.fs),o=tk.Buffer.createIndexBuffer(F,new Uint16Array([0,2,1,1,2,3])),l=tk.Buffer.createVertexBuffer(F,new Float32Array([0,0,1,0,0,1,1,1])),a=!0):!1},H=K.blitScreenShaderSrc={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};K.contextLost=function(){a=!1;for(var h in s)s[h].contextLost&&s[h].contextLost()},K.render=function(x,D,P,y){if(M&&(a||S())){R.setSize(x,D,P),R.bind(x);var W=x.getParameter(x.COLOR_CLEAR_VALUE);W&&0===W[0]&&0===W[1]&&0===W[2]&&0===W[3]?W=null:Zc(x,[0,0,0,0]),x.clear(x.COLOR_BUFFER_BIT|x.DEPTH_BUFFER_BIT),q.setViewport(x,0,0,D,P),y=y||{};var N=y.renderAxis!==!1,f=y.renderEdit!==!1;y.renderAxis=y.renderEdit=!1,q.renderScene(y),R.unbind(x);for(var b=0,L=q._glCapabilities.maxAttributes;L>b;b++)x.disableVertexAttribArray(b);var A,u=R;for(A in s)u=s[A]._42(x,u)||u;q.setViewport(x,0,0,D,P),W&&Zc(x,W);var Q=K.getModule("Fxaa");return Q&&Q.enable?K.blitScreen(null,u.texture,Q.getShader(x),{resolution:[1/D,1/P]}):K.blitScreen(null,u.texture),x.useProgram(q._prg),q._renderAxisAndEditHelper(N,f),!0
}}},ut=x.graph3d.PostProcessing.HueSaturation=function(w){function C(){var m=w.getGL();return m?(W=new Kr.RenderTarget(w,m),H=w._postProcessing.createShader(m,ut.hueSaturationShader),q=tk.Buffer.createIndexBuffer(m,new Uint16Array([0,2,1,1,2,3])),I=tk.Buffer.createVertexBuffer(m,new Float32Array([0,0,1,0,0,1,1,1])),R=!0):!1}var q,I,H,W,U=this,G=!1,R=!1,B=[],K=[],i=[];this.serializeProperties={hue:[0,0,0,0,0,0,0],saturation:[0,0,0,0,0,0,0],lightness:[0,0,0,0,0,0,0]},this.resetProperties=function(){var e=this.serializeProperties;for(var k in e)this[k]=e[k]},this.resetProperties(),u.defineProperties(U,{enable:{get:function(){return G},set:function(K){!!G!=!!K&&(G=K,w.iv())}},hue:{get:function(){return B.map(function(j){return L(180*j)})},set:function(E){if(B!==E&&7===E.length){for(var f=0;7>f;f++)B[f]=E[f]/180;w.iv()}}},saturation:{get:function(){return K.map(function(U){return L(100*U)})},set:function(o){if(K!==o&&7===o.length){for(var C=0;7>C;C++)K[C]=o[C]/100;w.iv()}}},lightness:{get:function(){return i.map(function(l){return L(100*l)})},set:function(h){if(i!==h&&7===h.length){for(var A=0;7>A;A++)i[A]=h[A]/100;w.iv()}}}}),U.contextLost=function(){R=!1},U._42=function(t,n){if(G&&(R||C())){var o=n.width,f=n.height;if(o&&f){W.setSize(t,o,f),Tf(t,W.frame),w.setViewport(t,0,0,W.width,W.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),H.bind(),t.activeTexture(t.TEXTURE0+0),kf(t,n.texture);var z=H.uniforms;return z.image=0,z.hue=B,z.saturation=K,z.lightness=i,q.upload(),I.upload(),H.attributes.pos.pointer(I),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),kf(t,null),jr(t),W}}}};ut.hueSaturationShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<j*txj/psop!mipjdh!i-q*!mgtmip)bcuh<s3!mvtoij)g5pdsfnw!!t>b!nsqpmmfpsD3hEb!sjGn`bmhhf!<<!*w!bs*zfjhoohb!Swtftdf3o!uwiVhwj<m!-!^$1e]ftgtjfoofu!iNhBjYm`!S-B{O/HmFt!i8)t!t$feofugijhojfm!`SqBbOnH!F`-B*MfMh!o1bSo!pvjoujbgspvsunb!tg!m-p^b1u]!oipvjfu]bNsBvYu`bStB!O-HzF/^m<ti!)voopjjgupbssnv!ugbmtp`bqub!nt!bu-v*sfbhuojbpSof]vNiB!Y-`^S1B]OfHvFi^!<-y!/vmotjig)pfsvni!`gqmbpnb!u!)m4jdhfiwu!o>f!tmtt]iN!BY`~S!BO~H!F^<<lbf!sgcm!pb<u^!snfbuqo`vipvdf`)fgvmip]btut!fjoouWibhmjvmf!->!!gfmhpobbuS!titvffoBumimh-j!mg!mp<b^us!fiuvofvSpbdo`hffv*i!]|op!jgumbpsbvuu!bwtb!m>v!ff!h>o!bjSooWpbjmuvbfs!v,u!b)ti!vf<B^msmf!u,o!vipvdf`Sfbvoih]ff*v!i0!!>3!/f1h<obS!fjvgi!!)w|b!m*vffh!o=b!s1!/>1>*!!ssffuuovvspod!`wfbvmiv)f!!g,j!!2/|1!<*,!,fsmftufo!vjpgd!`)fwvbim!v<fF!H?O!B2S/`1Y*B!Ns!f=u!vssfou!owvbpmdv`ff!v.i!!2</11!<>!!sffmutofv!psdf`ufvvsio!!uwobjm)v!fs<pg!!~<!2g!m,p!bfuh!onbbsq!`>t!bfuhvosbbsu!jp<o1)!g>m!pfbhuo!bjso!W*b7m!v>f?-!!fghmopbbsu)!!tgbju!vs~b!uj~p!oB<mlmb-f!sgcm!pb<us!ftubouvvpsdb`ufjvpio!S>b!ofhhfo*b!s|!!|g!m*p6b/u1!!w,b!m*vsff!u>o!vjpodW`bfmvvif)!u+b!p)m2g/!1=!!,i!)t!bgujv!sb|u!j*p,o,Bsmfmu!o,v!ptdb`ufvvsib!u<jFpHoOSBbSo`hYfB*N<!=!!ssffuuvosvop!dd`mfbvniq!)<w1b!m>v!fs-f!u1o/v1p-d!`2f/v1i*!<uo!j~)!!sgpmgp!bu!<nfbhqo`bmSjthtifuooufithtj)mg!m-pfbhuo!bjSooWpbjmuvbfs-v!ugbmtp!b-uf!hmojbhSifuvoif!tutbBpmmmg-!!g<m1p!b>u!!fmhjohbisu!oufotjt!Sb<oehmfp*i!t|fs!igum`pfbvui!!wu!b>p!mmgj!hi<u1o/f7t!t+B!mym/!m,t!im!j>h!iiu!oufbtptmSgb!oh<f*<{z!yj/gs!p)mwp!d=)!m1t/i13*ch!ss!f>u!vmstoi!!j4odWfbwm!vf<!*+w!V)ww!!-,f!h2b/n1j*)<E3!ffsmvtufyf!us!f>u!vsspom!pjdo!W5bdmfvwf!!,|!!)*w)!o+j!b)n2!/e1j!p.w!!joW~b!mv<f**m*!<-t!!~-i!)g4mdpfbwu!!oisvvfu3fssh!c)~g!mp<b1u/!7g!20-!!ig!m>p!biu!!g~3!-!<g1m/p7b!u>!,i!vif!*!||!*!1j/g1!!)=i!vif)!!=g!j1!/1*~!!i<vbfu!m,f>E!d2!/01!<*h!!f.m!tsf)!!j,g!!1)/i5v!f>!!?i!!2/|1!*ft!mifv!f~!!.><!b2u/m1f<Ed!!g0m!p*bsu!!.s!fct)<!,!!j1g/!3)!)>7!/i1!!+|!!i*vyfb*N!d=!!>2>/!1h*)!!gsjf!tf!t>m!fg!2~!!,!<)bgu3m!f.E!dg!20*!!*+c!!7./!1h!)+!!>i!vif!<|!!f*mytbfN!dj!g>!>)!)s3)/!1g!j+!!iv<f***!o=j!N2d/!1,*!y!bsNfdt)!!>.!!g13/<3)!!f0m!tbfu!mjfgE!d)!);4!/*1o!j+N!di!v,f!*y!b=N!d3)/!10*!b!usmfftE!d>!!@g!26!/,1!!)=g!3m!!.>!!gt2!*!+<!o)j)N3d/!1.!!0y!b4N/d1!*>!!.b!uimvffE*d!!+u!b7p/m1g<!!|f!m*tofjN!ds!f?t!!y>b!Ngd2)<!g!js!fuv<s1o/!3s!f0t!<*o!j~Nd!!,w!fydb4N!di)t!m>3!smh!c)w<f*d*4c!!i-thm)*y!b|n!!-wsf)dy4b!ns!h>c!<ybN!dj!gu!b)pimtgm!/z<!*>*>c!!1-/h1)*o!j|n!!-ssh)co!j>n!!w>f!do4j)Nidt!mu/b{p*m<g!!~<!cf/mdt!f>!!|c!!ugbmppmbgu!!g<3h</d!!>j!gh!!)uibtpmm/g{!!=<!s1//d6!*>!!sg!3u!b>p!migt!m/<{1!/+1!!)>2!/m1!!u,b!pimtgm!/z<*1</1!!f>m!ttf!u!bgp3m!g>!!i<t1m//2{.!!,>!!iit!mu/bzp!m.g!!it|m!/*zd!!+4!diftwm)/m{t<i3c!hgsm!p4bduf!wg!2!>~!!3/<1c!h+s!!iotsmv/u{f!s.!!g~3!<<*!*s1h/c4/0s1!/>2!)i!v.f!3ys/hmct)ig!2--3!gg!3--2!gi)tcmh/sy3!f,v!i)!2>/!1c0/4c/h1s*!*<<*!ys/hmct/ih!!->3!gi!v-f23gs)hc";var vt=x.graph3d.PostProcessing.Bloom=function(g){function o(){var Y=g.getGL();if(Y)for(var o=g._postProcessing,C=0;k>C;C++)p[C]=o.createShader(Y,vt._35Q,function(R,_){return{fs:_.replace(/DEFINE_VALUE/g,r[C]).replace("%OVERRIDE_ALPHA_DEFINE%",Z?"#define OVERRIDE_ALPHA":"")}})}function v(){var H=g.getWidth(),b=g.getHeight();if(!H||!b)return!1;var w=g.getGL();if(!w)return!1;L=[H,b];var W,v=Math.round(L[0]/2),V=Math.round(L[1]/2);for(R=new Kr.RenderTarget(g,w,v,V),F=[],x=[],W=0;k>W;W++)F.push(new Kr.RenderTarget(g,w,v,V)),x.push(new Kr.RenderTarget(g,w,v,V)),v=Math.round(v/2),V=Math.round(V/2);var a=g._postProcessing;return G=a.createShader(w,vt._34Q),o(),m=a.createShader(w,vt._36Q,function(X,d){return{fs:d.replace(/NUM_MIPS/g,k)}}),c=a.createShader(w,vt.finalShader),J=tk.Buffer.createIndexBuffer(w,new Uint16Array([0,2,1,1,2,3])),C=tk.Buffer.createVertexBuffer(w,new Float32Array([0,0,1,0,0,1,1,1])),s=!0}var V,d,H,Z,y,J,C,U,W=this,I=!1,s=!1;this.serializeProperties={strength:1.5,threshold:.55,radius:.4,overrideAlpha:!0,selective:!1},this.resetProperties=function(){var S=this.serializeProperties;for(var q in S)this[q]=S[q]},u.defineProperties(W,{enable:{get:function(){return I},set:function(c){!!I!=!!c&&(I=c,g.iv())}},strength:{get:function(){return V},set:function(L){V!==L&&(V=L,g.iv())}},threshold:{get:function(){return d},set:function(M){d!==M&&(d=M,g.iv())}},radius:{get:function(){return H},set:function(F){H!==F&&(H=F,g.iv())}},overrideAlpha:{get:function(){return Z},set:function(c){!!Z!=!!c&&(Z=c,s&&o(),g.iv())}},selective:{get:function(){return y},set:function(N){!!y!=!!N&&(y=!!N,g.iv())}}}),this.resetProperties();var R,G,m,c,L=[256,256],F=[],x=[],k=5,r=[3,5,7,9,11],p=[];W.contextLost=function(){s=!1,U=null},W._42=function(B,i){function h(W,b,M,T){Tf(B,b.frame),g.setViewport(B,0,0,b.width,b.height),T?T(B):B.clear(B.COLOR_BUFFER_BIT|B.DEPTH_BUFFER_BIT),O!==W&&W.bind();var Z=0;for(var $ in M){var E=M[$];E instanceof WebGLTexture&&(B.activeTexture(B.TEXTURE0+Z),kf(B,E),E=Z,Z++),W.uniforms[$]=E}for(O!==W&&(J.upload(),C.upload(),W.attributes.pos.pointer(C),O=W),B.drawElements(B.TRIANGLES,6,B.UNSIGNED_SHORT,0);Z--;)B.activeTexture(B.TEXTURE0+Z),kf(B,null);jr(B)}if(I&&(s||v())){var O;if(y){U||(U=new Kr.RenderTarget(g,B)),U.setSize(B,i.width,i.height),U.bind(B);var w=B.getParameter(B.COLOR_CLEAR_VALUE);w&&0===w[0]&&0===w[1]&&0===w[2]&&1===w[3]?w=null:Zc(B,[0,0,0,1]),B.clear(B.COLOR_BUFFER_BIT|B.DEPTH_BUFFER_BIT),g.setViewport(B,0,0,i.width,i.height),B._blooming=!0,g.syncRenderState(),g.renderScene({renderAxis:!1,renderGrid:!1,renderEdit:!1}),B._blooming=!1,w&&Zc(B,w),U.unbind(B)}h(G,R,{smoothWidth:.01,luminosityThreshold:d,tDiffuse:y?U.texture:i.texture});var e,q=R,A=Math.round(L[0]/2),W=Math.round(L[1]/2);for(e=0;k>e;e++)h(p[e],F[e],{colorTexture:q.texture,direction:[1,0],texSize:[A,W]}),h(p[e],x[e],{colorTexture:F[e].texture,direction:[0,1],texSize:[A,W]}),A=Math.round(A/2),W=Math.round(W/2),q=x[e];return h(m,F[0],{blurTexture1:x[0].texture,blurTexture2:x[1].texture,blurTexture3:x[2].texture,blurTexture4:x[3].texture,blurTexture5:x[4].texture,bloomStrength:V,bloomRadius:H,bloomTintColor:[1,1,1]}),h(c,i,{image:F[0].texture},function(P){Jq.for(P).glState.blend.apply({enabled:!0,equation:P.FUNC_ADD,func:[P.SRC_ALPHA,P.ONE]})}),Jq.for(B).glState.blend.apply({equation:B.FUNC_ADD,func:[B.SRC_ALPHA,B.ONE_MINUS_SRC_ALPHA,B.ONE,B.ONE_MINUS_SRC_ALPHA]}),i}}};vt._34Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!jbtijqpmob!!i-jmhfiyqf!ug!m-psbpum<pDvuovjqgupvspn!!)tybjnnq!m>f!ss3pEm!puDEhjbgsgGv`tmfh<<v*o!jwg!p-sinu!egjmXpibuup!pmnvtn!j,o!petmjpuiztUfissifUtziupjmtep<ojvnovjmg!p-senm!pgimtpfbsui!UtznupjptupioXjjnevumi!<)qwfbustzijuophp!nwtf!d>3!!bwiVqwm<b!wupbjpem!gnb<j*o1)/*1!!|-1w/f1d!5-!1u/f1y!f-m1!/>1!)u5fdyfuwv!s>f!3sEp)m!puDEujvgqguvvtpf!-5!dwfVww!<**<!bwnfvdm4!!-m{vznyb/!m>f!ywffud!4))u!p1e/!3>:!:w-!!u1b/p6m9g8-<!*1!/522",vt._35Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qsgfjdejotfj$po<!*ibj/hyijqQ!fgsmvpubyuf<u!w-bnsvzTjuoihh!jwffxd03n!vwTVfwt<vgvgojjeg)p5sdnf!wt!b>n!qsmpfmsp3DEh!bdspGm`pmshUffytumvfs$f<<*v1o/j2g!p-snnv!Twufidh3j!fuxf0ynTvjT{fft<vgvgojjeg)p5sdnf!ww!f>d!3s!pemjpsDfhdbusjGp`om<h$BeIfQgMjBo`fF!ELJFSSSOFFWMP`!SgBfEeJgVjT$!E~FG<JxO!F+`!W1B/M3V!F>,$!enfvgTjuoifh!jTfJxHN<Bx!!E+F!G*J3OfFm`qWnBbMtV!F,!&2PfWmFqSnSbJtE)F!`>B,M!QnIvBT`fEtFvGgJgOjFe&<gcmhpsb/u*!uhfbtvgtgtPjwbvo!Q.e!gw)Vjwo!!-gfmspvbuuy!fyU-s!pjmop!dg!m)pEb3uf!stvjuhynfbu*!!>|!3sffmuqvnsbot!!14/d4f:w9:<5c!h+s!/f*yuqf)t!g.g1P/w6v!!+,!!yw!V+w!!y-0f)s!vtujyhfnUbs!p+m!ptdj!h)nEb3*f*s0vtujyhfnub!<>!~2fwmpqjneb!tn!b4jdof)w*!<|y!w+f!df3{!jjTowwoTjj!{+f!!o>p!j2u/d1f!s0j!eu!f>y!Tujf{tfg<gPgwmvp!b3ud!fgwTj<h*nbbn!h>j!Tggm!p-byu))gTeJQHoNbBj*t<tvgbmhp!b>u!!xx!fujbhpimugTv<n*!j>)!uhbbpvmtgt!j>b!oyQ!eugb)p1m/g1-|!!g*T!j,h,n!bj*!<<TwVfJdE5B!Su`fMyFuOvSsFfLQ!j=y!!j>!!<u2f!y>u!vjs!fu3oEj)!!)dsppmgps<UnfvyTuuvishfj-f!xw!V+w!*c<hsw/fydj4Q!fesjvgugyvftuf!T>v!n",vt._36Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!j*twjVpwo!!-i6jfhsivqu!ygfmUpsbvum<c)wEb3sfzsjvouhy!fwuf!d+3!!*w1V/w2<!-vsopjmgppDsuno!jtUbnnpqpmmfcs)35Ed!fcwm!v+s!U*f3y/u1v)ssfp2u<dbvGonjpgppmsCnq!stfbmnq!m,f!s*3wEV!wc!m-v5sfUsfvyuuyvfsUfs3v<mcv)oEj3gfpssvnu!ytfbun!q+m!f*s13/E2!!c-msvpsmUpfDyuuovjsUfn4p<pmvco)j5gdpfswn!!+t!b*n5q/m1f)ss3pEu!dcbmGvnspUpfmyCuqvssffm5<!,v!o*jwgVpws!n-!4tfbsnvqumyffsU3sEv!mccm)vEs3Uffsyvuuvysffu6!<+!v*o1j/g2p!s-ns!ptmbpnDqumofjsU3nEp!pemjcs)u5Udffywu!v+s!f*<7/v1o)jsgppusdnb!GgnmpppbmuC!qcsmfpmpn!T,u!s*fwoVhwu!i-<3fvsovjugypfsUns!vgmmcp)bEu3!fcsmvpupynfSub!e+j!v*t1</2v!o-jsgppmspnD!uwofjdU4n!pcpmmpcp)n5Udjfowu!D+p!m*p9s/<1)gsmppubdub!GmnfpspqmCCmqpspfnmGb!d,u!p*sw)Vdwp!o-t2uf!sjvou!ygfmUpsbvum!cg)bEd3ufpssv*u!y|fug!m+p!b*u1!/n2j!s-ssppsmGpbDduuopjsU!n>p!p2m/c3)!5.d!fgwb!d+u!p*s1</2s)fsupvusdob!Gnnjpyp)mgCbqdsufpms!-)!!n+j!sisuphsoGfbsduuTpnsp-p!mccm!p>p!nsSpbmepjDvhtb*s<G`~mhwp|j!e*!)nobj",vt.finalShader="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*dwjVtwj!p-of!hibjnhji)qE!3gfmspvbuuy<fuv!o>j!gsppsmnp!DthbbnsqGm`fmsh3E|!!j*n)bohjfb<n!webjspzwjo<hw!Vwwf!d3";var wt=x.graph3d.PostProcessing.Dof=function(f){function g(){var Z=f.getGL();return Z?(X=new Kr.RenderTarget(f,Z),D=f._postProcessing.createShader(Z,wt._38Q),t=tk.Buffer.createIndexBuffer(Z,new Uint16Array([0,2,1,1,2,3])),$=tk.Buffer.createVertexBuffer(Z,new Float32Array([0,0,1,0,0,1,1,1])),K=!0):!1}function b(B,D,F,H){G=null;var S=B.getCanvas(),X=S.width,j=S.height;if(F=F||1024,X>F||j>F){var L=F/Math.max(X,j);X=Math.round(X*L),j=Math.round(j*L),o||(o=rs()),S=M.resizeImage(S,X,j,o)}var U=f.getGL();if(C||(C=U.createTexture()),R=$k(U,S,C),h=D||.01,k=!0,f.iv(),H--){if(G)return;G=M.callLater(function(){b(B,D,F,H)})}}var X,D,t,$,R,U,d,c,o,C,G,m=this,J=!1,K=!1,h=0,k=!1,Q=Mh.generateUUID();this.serializeProperties={aperture:.025,maxblur:1,image:null},this.resetProperties=function(){var X=this.serializeProperties;for(var p in X)this[p]=X[p]},u.defineProperties(m,{enable:{get:function(){return J},set:function(F){!!J!=!!F&&(J=F,F||(k=!1),f.iv())}},image:{get:function(){return U},set:function(l){U!==l&&(U=l,k=!1,R&&(f.deleteTexture(Q),R=null),f.iv())}},maxblur:{get:function(){return d},set:function(c){d!==c&&(d=c,f.iv())}},aperture:{get:function(){return c},set:function(C){c!==C&&(c=C,f.iv())}}}),this.resetProperties(),m.contextLost=function(){K=!1,R&&(f.deleteTexture(Q),R=null)},m.setImageFromGraphView=function(U,R,c){this.image=null,b(U,R,c,2)},m._42=function(A,n){function r(g,I,s,H){Tf(A,I.frame),f.setViewport(A,0,0,I.width,I.height),H?H(A):A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT),j!==g&&g.bind();var Z=0;for(var i in s){var e=s[i];e instanceof WebGLTexture&&(A.activeTexture(A.TEXTURE0+Z),kf(A,e),e=Z,Z++),g.uniforms[i]=e}for(j!==g&&(t.upload(),$.upload(),g.attributes.pos.pointer($),j=g),A.drawElements(A.TRIANGLES,6,A.UNSIGNED_SHORT,0);Z--;)A.activeTexture(A.TEXTURE0+Z),kf(A,null);jr(A)}if(J&&(K||g())){var j;if(!R){var p=yd(this.image);if(!p||!p.comps&&!p.tagName)return n;x.Default.setImage(Q,p),R=f.getTexture(Q)}var C=n.width,q=n.height;if(C&&q)return X.setSize(A,C,q),r(D,X,{tColor:n.texture,tDepth:R,aspect:C/q,aperture:this.aperture,maxblur:this.maxblur,useG2d:k,threshold:h}),X}}};wt._38Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f1d/j2t!j>p!ob!/isjphmipqD!hgbmspGb`um<hw<b1s/z2j5o!h0!!wmfpdd3!!>w!Vswp<mpvDohjbgspGs`nm!hcp<p*m!!5vstvfmEcfgqpuei!<+!v*o!jugdpfssns!ptdbundqfmqftsb3!E+!!u*D!p5m/p1s!<-1v/o1j!g)p3sdnf!wt!b)n!q,m!fzsy3/Ew!VuwE!f-qsupim<pDvuo!j)gEp3sfns!vcupypfmu!!v>t,f!Hm3ped<<v*o!j5gspvsmnc!ggpmep!b+u!!*u!iusdfftsisppmdeu<dfvqotjbg!p+s!n*!!g:m3p/b1u.!!n-b:y3c/m1v.s!<)3vdofjwg!p)s!n,!!gzmyp/bwuV!wb!q-fsspumvpsDfu<!)vEo3jfgspvsuny!fgum!p>b,u!!mopfdbs<D*m!j5qs<vmvcogjpgep!s+n!!*g!mupdbfus!sgpbdsuDdmfjqqt<b!v+o!j*g!p1s/n1!!g-m5p/b1u.!!g)p3ddvftw<!)v!o,j!gzpys/nw!Vgwm!p-bsup!mbptDquf!d)uE<3fdspvoutyuf!ug!m>p,b!um!pVdoq<b*d!l5Espvxmoctgdpbem!f+!!>*!!3u6d6f/s!s0p!d3u6d7f/q<t!b0!0+!!1*/!/:23!/.1?!!-g:s3b/d1u.j!p)o3!d)ffwy!d)m!v,e!jzoyh/!w2V*w!d-psoptmup!Dwuf!d)4E!3QfbsdvluGybfduu!p>s,t!!m>p!dwf<d*4!)5!s3v6m7c/g!p+e!!3+6!7*/!!u+d!f3s6s7p/d-u!d3f6q7t/b!!++!!3*6!75//-1!.3!6-71//!1*!<)3ddpfowt!u)!!w,f!dz5y!/VwoVqwb!d-lsGpbmdpuDpus!t)!E>3!fVsovqubydfluE!p>x,o!tmdpbdmf<!*0!!5wsfvdm5c)g!pQeb!d+l!G*b!duudpfssts-p!d2u/d!f*q<tbg!m+p!b*u!!:v3o/q1b.d!l-S:H3C/B1U!p)E3fdqfuwi!))!!d,p!oztyu/!wjVow!!w-fsdp5m!pwD!u*!!)|E3!fssfvuuvysfou!!e>p,u!)m!pwd-!<V*o!q5bsdvlmGcbgdpuep!s+t!!**!<ud~fsgsmppdbuud!fhqftubE!f+q!u*i!)1!/d1p!o-t5u/!1j!o)!3wdffdw3!!)t!d,s!fzfyo/QwpVtwj!u-jsppom!p*D!u|!)\nEs3ffusvvsuoy!fvuo!q>b,d!lmSpHdCB<U*p!E5fsqvumic)g!puef!y+u!v*s!fu3dEf)s!supEdfuqdufiq-t!bt!d+s!f*f!o:Q3p/t1j!u-j:p3o/!1*!!)*3<df~w!g)m!p,b!uz!yq/fwsVtwq!f-dsupjmwpfDEuf!q)uEi3UfpsWvjufyxf[u)!!>d,p!omtpud!j<o*!!g8mspvbmuc!gjpoew!D+m!j*q![u-d!fdspsoptduu!djfoq!tgbm!p+b!u*!!o5f/b1s!--!1d/p1o!t)u3!djfow!!g)m!p,b!uz!yg/bwsV!w*!!-|sp!mspfDuuv!s)oE!3)f!sovfubysf!u+!!>g,b!sm!p*d!0<!*)!!8)s!vgmbcsg!p.e!!o+f!b*s!!u*d!f+s!sjpodwuDdmfjqqt[b!!.+!!g*b!s:!3*/<1.~!-g:m3p/b1u.!!h)f3udWfjwf!x)[!),!!dzpyo/twuV!wj!o-!sgpmmppbDuu!!e)fEq3ufis!v*u!y|fu\n!s>f,u!vmspod!q<f*s!t8qsfvdmucjgwpfeE!f+q!u*i!UupdWfjsfsxp[d)u!deffqqtubi!-+!!o*f!b1s/D1m!j-q5-/!1g.b!s)D3mdjfqw!!*)<!,~!zwyp/jweV!wn!b-jsop)m*p!D|u!w)fEd33f!sevpugycfmuv!s><,!wmfpdd3!<b*t!q8fsdvumdcpgspsef!d+u!!*>!!uwdffds3s)p!d2u/d1f-q!tbbt!q+f!d*u!!:*3</1j!g-!:)3v/t1f.E!f)q3udif*w!!|)!!,g!mzpyb/uw!Vwwj!f-xs[p!m>p!Dhuf!u)WEj3ffxs[v)u!yhffuu!E>f,q!umip)d!w<V*w!!8*s!v*m<cg!pgem!p+b!u*!!gubddfuspssp!d>u!d)f!qgtpbd!v+t!!*,!!5w/j1f.x![-!1*/<1!!)e3pdgfcwm!v)s!!,>!!zwyf/dw3V!w)!!-dsmpbmnpqD)u!!g)bEd3ufpssv!u+y!fbuq!f>s,u!vmspfd-!<.*n!b8yscvmmvcsg-p!en!b+y!c*m!vusd!f*s!s*p<du~dffqmttbf!!+|!*w!f:d35/!1u.f!y-f:m3!/>1!!u)f3ydufvws!f)3!E,)!!zuyE/fwqVuwi!--!swpfmdp3D)uw!V)wE/3yf-s!v2u/y1f!u.!!>w,V!wm/pzd*!<**<!8gsmvpmbcug!pbem!q+i!b*<!ujdgf!s)svptdfuHd3feq*t!b|!+b!m*q!i1b/!1>!!-t1n5p/p1u!i)t3udffqw)!!)u!i,s!fztyi/pwmVew-!!-usipsmfptDiup!m)eE!3,f!s1v/u1y2f-u!!u>f,y!fmmp/db!<**<!8~s!vfmmctgfp!e|!!+b!m*q!iubd!f>s!supfdyufdmf/qbt<b!!~+!!*e!p:g3c/m1v!s-!:>3!/w1f!d)33!d)f!wd!m)b!n,q!)z!yb/mwqViwb!!-+s!pbmqpfDsuu!v)sEf3-f!s.vnubyyfcum!v>s,-!!mnpbdyc<m*v!s:!s*v!m*c<gp~e!w+f!d*3!!uedpfgscsmpvdsu:d!f>q!tebp!g+c!m*v!s8!4+/!11./!:-<62w/f1d!3)!3edpfgwc!m)v!s,8!!z>y!/ewpVgwc!m-vssp!m+p!D1u/!8)<E3wffsdv3u!yefpug!c>m,v!sm5p!d>!<e*p!g:csmvvmsc!g+p!e1!/+5!<*!wufddf5s!sdppdmu!d>f!qwtfbd!5+)!!*1!/612!/*1<.!d-p8m4!/,1>.!!u)f3ydufvws!f)3!E,)!!zuyD/pwmVpws!--!swpVmwp/Dyuz!!)*E<3fdspvmu!y,f>u!!u>f,y!umvpsdf3<E*)!!:usDvpmmcpgsp-e!!w+V!w*/!yuzd!f,s!s)p!dwufddf3q)t!b1!/+1!-*!!16/25/!1*!!-+8!4b/t1q!f)d3uddfpws!s)f!d,u!!z*y!/+w!Vewp!g-csmpvmsp!D*u<!)dEp3mf!s,v>u!yuffuy!u>v,s!fm3pEd)!<u*D!p:mspvsm-c!gwpVew!/+y!z*!!,u!d)f!swsfpdd3u)d!f1q/t2b6!-+!!1*/!4884!/*1!!+-!6b2t/q1f.d!u)d3pdsfswf!d)u!!,*!!z+y!/ewpVgwc!m-vssp!m*p<Dud!p)mE!3,f>s!vuufyyfuuv!s>f,3!Em)p!duD<p*m!p:ss-v!mwcVgwp/ey!z+!!,*!!)u!dwffsds3p)d!u1d/f3q:t-b!!1+/!3*:!!8*4!/+1!.b!t-q6f2d/u1d.p!s)s3fddfuw!!*)!!+,!!ezpyg/cwmVvws!!-*s<pmdppDmu!!,)>E!3uffsyvuuvysffu3!E>),!!umDppdmp<s*-!!:wsVvwm/cygzp!e,!!+)!!*w!fudd3f)s!s.p1d/u4d8f-q!t1b/!2+6!!**!!6+2!/b1t.q!f-d8u4d/p1s!s)f3dduf!w*!!)+!!,e!pzgyc/mwvVsw!!*-<spdmppmD!u,!>)!Eu3ffysuvvusyff3uE!)>!,u!Dmppmdps<-*!!w:Vswv/myczg!p,e!!)+!!w*f!du3d)f!s1s/p5d1u-d!f1q/t1b!!*+!!+*!!b6t2q/f1d!u-d8p4s/s1f.d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/:yszv!m,c!g)p!ew!f+d!3*)!!u1d/f4s8s-p!d.u1d/f2q6t!b*!!++!!*b!t8q4f/d1u!d-p6s2s/f1d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/syvzm!c,g!p)e!!w+f!d*3!)u!d1f/s3s:p-d!u.d1f/q3t:b!!*+!!+*!!b8t4q/f1d.u!d-p6s2s/f1d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/syvzm!c,g!p)e!!w+f!d*3!)u!d.f1s/s2p6d-u!d.f1q/t4b8!!+*!!*+!!:b3t/q1f.d!u-d:p3s/s1f.d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/syvzm!c,g!p)e!!w+f!d*3!)u!d1f/s1s-p!d.u1d/f5q!t*b!!++!!b*t!q6f2d/u1d.p!s-s8f4d/u1!.*!!)+3!defpwg!c)m!v,s!!z*y</wdVpwm!!-,s>p!mupfDyuu!v)sEf33fEs)v!uuyDfpum!p>s,-!!mwpVdw/<y*z!!s,v!m)c!gwpfed!3+)!!*.!1u/d2f6s-s!p1d/u4d8f!q*t!b+!!+b!t*q!f1d/u1d!p-s5s/f1d.u!!)*3!d+f!we!p)g!c,m!vzsy!/*w<Vwd!p-ms!p,m>p!Duuf!y)uEv3sffs3vEu)y!fuuD!p>m,p!sm-p!dwV<w*/!yszv!m,c!g)p!ew!f+d!3*)!!u.d1f/s3s:p-d!u1d/f3q:t!b*!!++!!*b!t6q2f/d1u!d-p8s4s/f1d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfs";var xt=x.graph3d.PostProcessing.Blur=function(w){function i(){var u=w.getGL();return u?(v=new Kr.RenderTarget(w,u),b=w._postProcessing.createShader(u,xt.hBlurShader),h=w._postProcessing.createShader(u,xt.vBlurShader),$=!0):!1}var b,h,v,H,I,t,X,f,m,e=this,r=!1,$=!1;this.serializeProperties={value:0,downSample:!1,iterations:1,layer:"main"},this.resetProperties=function(){var e=this.serializeProperties;for(var F in e)this[F]=e[F]},u.defineProperties(e,{enable:{get:function(){return r},set:function($){!!r!=!!$&&(r=$,$?w.addRenderLayerListener(S,this):w.removeRenderLayerListener(S,this),w.iv())}},downSample:{get:function(){return X},set:function(R){X!==R&&(X=R,w.iv)}},value:{get:function(){return t},set:function(P){t!==P&&(t=P,w.iv())}},iterations:{get:function(){return f},set:function(P){f!==P&&(f=P,w.iv())}},layer:{get:function(){return m},set:function(B){m!==B&&(m=B,w.iv())}}}),this.resetProperties();var S=function(x){if(r&&x.layer===m&&"post"===x.phase){var s=w.getGL();if(!w._picking&&!w.isReflecting(s)){var Z=w._postProcessing.getRenderTarget();Z.unbind(s);for(var k=0,K=w._glCapabilities.maxAttributes;K>k;k++)s.disableVertexAttribArray(k);e.drawImpl(s,Z),Z.bind(s),s.useProgram(w._prg)}}};e._42=function(){},e.contextLost=function(){$=!1,H=null},e.drawImpl=function(L,W,a,p,j){if($||i()){var P,m;if(W?(P=W.width,m=W.height):(P=w._viewport[2],m=w._viewport[3]),P&&m){var d=w._postProcessing;"boolean"!=typeof p&&(p=X),a==q&&(a=t),j==q&&(j=f),j=Math.max(1,Math.round(j));var e=Jq.for(L).glState.depth,S=e.enabled;if(e.enabled=!1,p){a/=2;var k=[P,m];P/=2,m/=2,H||(H=new Kr.RenderTarget(w,L),I=d.createShader(L,xt.downSampleShader)),H.setSize(L,P,m),d.blitScreen(H,W.texture,I,{texelSize:[1/k[0],1/k[1]]}),W.setSize(L,P,m)}else H&&H.setSize(0,0);v.setSize(L,P,m);for(var F=[],y=0;j>y;y++)F.push(a),a=Math.max(1,Math.floor(a/2));for(var y=0;j>y;y++){var R=F[j-y-1],o=p&&0===y?H.texture:W.texture;d.blitScreen(v,o,b,{value:R/P}),p&&y===j-1&&W.setSize(L,k[0],k[1]),d.blitScreen(W,v.texture,h,{value:R/m})}return e.enabled=S,W}}}};xt.hBlurShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<jntvjtp!o>!!isjphmipqD!hgbmspGb`um<h!!vo<j2g6p1s/n1!!t+b!n*q!m*f!sz3/Ew!Vjwn!b-hffv<mb!ww!b+s!z1j/o5h!!,w!fyd/3w!VwwV!w)<3d!fvwo!j-gfphsbnn!jg!m)pEb3uf!swvbumyvffu<!>,!!wnpvjte!!n<b9j2o:)1*/!1|!+!!w*f!d*5!!zt/vwnV!w>!!-wffvdm5b)w!!1+/!11!/*4<!,!!yt/vwnV!w,!>)!3udffywu!v-sffh3bEn)j!!j)nEb3hffs-v!uwyffdu3!)>!,w!Vnwv/ty!!.<!655/313!2+/!1w!b+m!v*f!-*!!wzV/ww/Vzw!!*-!f*v!m+b!w1!/+1!612/<3!!,t!vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv!t.!!4</214!6+2!/w1b!m+v!f*-!!*w!Vzw//wzV!w*!!-*f!v+m!b1w/!1+:!219/<2!!,t!vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv!t.!!3</414!7+2!/w1b!m+v!f*-!!*w!Vzw//wzV!w*!!-*y!/+w!V1w/!2)333d5f6w<!-!fthvbnn!j,!>)!Eu3ffysuvvusyff3uE!)>!,j!nnbvhtf!-!<w2f4d632)/!1w!V+w!/*y!!*.!!z2//w1V!w+!!-wfbvm",xt.vBlurShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<jntvjtp!o>!!isjphmipqD!hgbmspGb`um<h!!vo<j2g6p1s/n1!!t+b!n*q!m*f!sf3vEm!bjwn!b+h!f1</5!!w,b!szz/jwoVhw!!w-fyd/3w!VwwV!w)<3d!fvwo!j-gfphsbnn!jg!m)pEb3uf!swvbumyvffu<!>,!!wnpvjte!!n<b9j2o:)1*/!1|!+!!w*f!d*5!!ftvvmnb!w>!!+w!f1d/54)!!,1!/z1/!w*V<w!-!yt/vwnV!w,!>)!3udffywu!v-sffh3bEn)j!!j)nEb3hffs-v!uwyffdu3!)>!,w!Vnwv/ty!-!<w6V5w3/3z2!/.1!!5+/!1*!!+*!!wfbvmmvbfw!!*+!!*1!/+3!!1,/!1z6/2w<Vw!!t-vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv-t!!wV<w2/4z6!2./!14!/+1!!*+!!*w!bfmvvmfb!w*!!+*!!1+/!21!/,1!:z2/9w<Vw!!t-vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv-t!!wV<w4/4z7!2./!13!/+1!!*+!!*w!bzm/vwfV!w*!!-*y!/+w!V1w/!2)333d5f6w<!-!fthvbnn!j,!>)!Eu3ffysuvvusyff3uE!)>!,j!nnbvhtf!-!<w2f4d632)/!1w!V+w!/*y!-*!!wfVvwm/bzw!!.+!!21/",xt.downSampleShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<j1t/j5p!o0!!i*j*h*i1q/!2g!m-p1b/u1<)3!dvfowj!g+p!sfn{!jtTbmnfqymffus!3,E!!wjVnwb!h-ff<hb!nwjb)sEz3jfoshv!uwyffdu3!!w,V!w*<*1!/v2o.j!g-p1s/n1!)w3fddf3w!!u+f!yff{mjTTjm{ffy<fu!!,w!pwjVew!!n-bfjhob)n*j)!E|3f!shvmu`yGfsub!hD,p!m*p*s1!/>1!!)-u1f/y2u.v)s3fd3fEw)!j+n!bfh{fj-T!mwfVywf!u,!!,u!fwyVfwm!T-jf{hfb!n+j!)wEf3df3s)v2u/y1f-u!!1/,1!**";var yt=x.graph3d.PostProcessing.Glitch=function(X){function l(){if(M&&Q){h=Date.now(),T=0,J=1e3*U(Q[0],Q[1]),D=[];for(var P=1,x=M.length;x>P;P+=2)D.push((P>1?D[D.length-1]:0)+J*M[P]/n)}}function W(){X.redraw()}function Z(){var L=X.getGL();if(!L)return!1;p=new Kr.RenderTarget(X,L),C=X._postProcessing.createShader(L,yt.Shader);for(var u=V*V,n=Pn(V,V),w=n.getImageData(0,0,V,V),f=w.data,l=0;u>l;l++)f[3*l+0]=g(256),f[3*l+1]=g(256),f[3*l+2]=g(256),f[3*l+3]=g(256);return n.putImageData(w,0,0),F=$k(L,Pr),$=!0}var p,C,J,h,T,D,F,E,Q,M,Y=this,b=!1,$=!1,U=Mh.randomFloat,g=Mh.randomInt,n=0,V=64;this.serializeProperties={onlyReflector:!1,period:[2,3],intensity:[3,.3,1,.1,0,.4]},this.resetProperties=function(){var z=this.serializeProperties;for(var E in z)this[E]=z[E]},u.defineProperties(Y,{enable:{get:function(){return b},set:function(m){!!b!=!!m&&(b=m,m&&l(),X.iv())}},onlyReflector:{get:function(){return E},set:function(d){!!E!=!!d&&(E=d,X.iv())}},period:{get:function(){return Q},set:function(i){Q=i,l(),X.iv()}},intensity:{get:function(){return M},set:function(h){h||(h=[1,1]),M=h,n=0;for(var H=1,A=h.length;A>H;H+=2)n+=h[H];l(),X.iv()}}}),this.resetProperties(),Y.contextLost=function(){$=!1},Y._42=function(i,P){if(b&&($||Z())){var e=!!X.isReflecting(i);if(e===!!E){var m=P.width,R=P.height;if(m&&R){var H=X._postProcessing,f=Jq.for(i).glState.depth,N=f.enabled;f.enabled=!1,p.setSize(i,m,R);var j,Q=Date.now();Q-h>D[T]&&(T++,T>=D.length&&l()),j=M[2*T];var z={seed:Math.random(),byp:j?0:1,tDisp:F};return j&&(z.angle=U(-Math.PI,Math.PI),z.distortion_x=U(0,1),z.distortion_y=U(0,1),z.amount=Math.random()/30*j,z.seed_x=U(-1,1)*j,z.seed_y=U(-1,1)*j),H.blitScreen(p,P.texture,C,z),f.enabled=N,requestAnimationFrame(W),p}}}}};yt.Shader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd~j!tj<p*ow!Viwj!h-ifqh!bgnmjp)b!uE<3f!svvoujygfpus>ns!pjmopuD!hcbzsqG<`m!hv!oj|g!pfstnm!ft!bn~q!mf<sx3pEo!tj!n,bshpfm<pD!hvbosjGg`pmshn!!>t!bsnpqmmpfDsh3bEs!Gu`Emjht!q<<*3!/v1o+j*g*p/s1n6!+gemfpfbtu!!+b!ntpzv-oeuf<ft!!v+o!jtgyp)s3nd!fgwm)peboub!sb)o5hdmffw<+u!ovvopjngbp+s/n1!1g3m!p>b!ux!ptoftf!e5<df!wv!ojfgtpjspno!!gemepbb0u0!!tf<f*eb`/yb<hd!!v-ocj/gcpds!n-!hg/mbphbdu!!-tsf/fsed`)z5<df!wv!o>j!gsppsmnp!DghmbpsbGu`!mehj!tu<p*suufjtpgog`py!<.!!qv!o-jfghpbsnnj!)gEm3pfbsuv!ueyjftuu!p>s!ucjdp!o5`dzf<w!!v<o*jqg!p-sfnh!bgnmjp)bEu3!fdspvmu`ytf<u!>!!wbbhsdz!j5odhf!ww!fd<3*!uwfVtwg<gp!!,d!pqo!t-uf!hgbmnpjb)uE!3VfosqvbudylfEup!x>o!tsddb!m5fd!f>w!!36<6*/*!f0m!h3o6b7)/o<jt!!d-p*oftmuh!owbf)dt4p!dQ)b3ddlfGwb!d+u!pusotv!p>n!bw!f>d!4u)f!t3g6g7p/!!3+d!f3w6!7/s!f+e!b3i6t7!/u-g!j3i6t7!/C!H+S!!3n6p7s/g-!!f3t6b7c/0!0*!<<!*d/p6o0teuf!fwtf)d+5z!`Veofqfbtd+lmGbbndsuppos>t,!z>/!qV!oq<b*d/l6E0pexfofttd)b+myf`!e0f!fwtf+dm5b)n!sQpbod>l,Gyb/dqu!ps~t!-!~2!/!<**<y`!ogpmjpubsup!uvtojqeb!d,l!SyH/CqB)U!p.E!f/q2u!i>)!!yd/pqo!tu|!!jfot!mwff!d5~!!w!<*y!`|op!jsufsupvustoj!ee>pyu/)q!!w-|!*V/o1q?bzd`leGfbfdtu)pgsjt!!*|<!*!e~fft!+gtm`pmbpud!.szb`ooep)jwufsdp3u!tdjpe*?|y/!qs!f%u%v!sto`!mgpsdb,dzu`)otpjjou)seppuut)jdep=/yy/zq!)-gwjf!d3~)!23~/!:9<:z9`-o8p9j/u3s4p4u*t*j*e!!+>!!5z4/8q6!9/|6!5f6t4m*f<!!~~!<!*wzp`joep!jnubsjpou)t*j!e|!,!!jzg/)qc)z!q.=!2/*2!!|>!!zw/fqd!3!|q*!/>1!?wyV`we<ff!tg)mgpjb!u!|y!t*!e>f!fgtm+ptp`sm)phdm.`yG`sobphjDupsppsuet/jye!?0z!/1q/!6%*%<!t!`gmmppdb,uy!`zotp!j>u!sgpmuptpjse)=hzm/`qG)sgbjh!Dp<p*s*ee/fzf!t0+!e1f/f6t*+<q!!-gqmtpjbEuu!)o!pEs3nfbsmv!u>y!fvuo)qibudqlfSEHpCUB";var zt=x.graph3d.PostProcessing.Fxaa=function(g){var c,L=this,W=!1;u.defineProperties(L,{enable:{get:function(){return W},set:function(y){!!W!=!!y&&(W=y,g.iv())}}}),L.contextLost=function(){c=null},L.getShader=function(z){if(c)return c;var O=g.getPostProcessingModule();return c=O.createShader(z,{vs:O.blitScreenShaderSrc.vs,fs:O.decodeShader(zt.ShaderSourceFs)})},L._42=function(){}};zt.ShaderSourceFs="~!!q<sbf/d*jwtVjwp!o-!fihjbhnijq)!Eg3mfpsbvuu<yf!uv>obj/gsppsmnp!DthbbnsqGm`fmsh3!E!<j*n!bh*f1</1!)v5odjfgwp!sn-!1w/f1d!3!-s1f/t1p!mv-u1j/p1o!<-!4w4b9s1z/j1o!h!-w7f7d23/!1w!Vw-<68/!1$!ef-g*j1o/f1!)G5YdBfBw`!RV-B*M1J/U1Z)`5Qd1f!w2!/1-*!1$/e1f)g5jdoffw!!GY-BoBp`jRuVvBmMpJtUfZs`!Q2-!f2h/b6nj!!$e-ffghjbonfj!!GY-BfBh`bRnVjB!MJ-U*Z1`/Q13)!53d/f1w!!$-ewfVgwj!of)!sGfYeBbBi`TRmVfByMjJQUbZb`yQG4>!s5p/m1pD!h$besfGg`jmohf!!G|Y!B*B)`oRjVbBnM!JeUjZp`wQ!5!~2!3/<1*N!b$nevfmg!j-o{fz!yG/y*bNbtCppqp!m-!ycfpup)mqpU!y$feUfbgbjyoGf)!5GuybbpbmGGmbpbbyuG!!gomspvbuufs!!$e<foghjjoTfi!uGhyobfbmG!m+p!byuj3q!cwvfTdu3ft!g$gePfmgfjyojfq!>G,yzb/bNGtmppqb!u*4o!bwqfTd{4sp!i$!e)fggjj!of<!oGhyjbTbiGumhpobfum5!!+w!fydj5qcv!T$uefftggjgoPfm!fGyyjbqb>T,byu/)Nyt*p!qd!m*bonbqq)Ty{-s!p1i/a1)-g!j2!/1<**I!y$jeqfcgvjto!f-!eGpypbHbuUfftyg!gtPbmnfqymjfqs)3yEbn!>$yejfqgcjvoTfu!fGtygbgbPUmffyyUjpqq!)uub-p!mqG*b!buyfGy!uv<s1f/31E!);u!-u!fqt-g!g1P/m1f*yj!q$!e@f!gojboqfT!eGpypbhb>UefpypPHgugf)tug-g!Pqm-f!ypj-q!!su*b!pumfGybubvysGf!3E<)yuj-q!cqv,T)zpu!j+m!bsv*R-b!b1y/g1!*+!!HGyyjbqbcGvmtp>bIuy!jGqycbvbtM!vunbbp)mGGybbbbyGGm!pb<u65/!1s,h*c*bq*d!S|i!ushfoufvMsoob!qsth.c)b!/+z!<u!t~e)!>GuyfbtbgGgmPpmbfuy5j!qG!yubbbpQmjGybfbmyTGi!be<fGsy)jq!cGvytb!b+G!mGpybjuq3c!vqtp>tH-yj!qGcyvbtb!GumbppbmuG5b!bgyyGb!bD<pQootbpqmTfeQpppthQ!p;t!-Oo!bGqyTbebpUpfhy!!@u!fOyo-pj!uGdyfbsbjUef>yo!bgqyTbebpDppho!tmppmpfC4b7b1yUGf!yF<y*qQCujtbet!O-fOhuPtoef)-oj!nG>yubtbeU!fuyb!pgmyGbbbbDypGo!tp<mQfu4t7e1!U=f!yOFuytqeC>jObotpOjfuhdUfxspj-e!!mGpypbCbbGbmypGb!u3<!iguyhbobfRMvobbmqjtu0z1S/d2q>GqsdbSnifu-ho!fGMyobbbqGtm!pubbup5m!GgbybbybGD!po<tppsmff[SUdMqNGbsnbvnmf!P>qau!-*1!/G1y!b=b!GQmepobFub5n!vgmy)b>bQDopboqtTpempfpShd!qmGpspbCnbfbPyqGu!3-<*!OGuytbeb,GQmuptbeu)5>!iguyhbobfDMpoobtqptm!fu4b7p1mSGdbqbGysGb!nf<Ppqsuf3[-UM!NGbynbvbmG!m>pab!u*!1g/y1b!b=R!vObemojFubznTvvmc)q>jOyo-bq!TGeypbpbhG!mmppbpuC!bgbyybGb!Rv<bzm/jNutzpFqe.hzf/UQitspfqt>iQpumtee-!*!oGbyqbTb{Gsmppibau)!ggjy!bb<Rzv/bOmtjpuqz.Fze/hNftUpiqs>fOtuitpem!e*Nojboq-T{!sGpyibab)Ggmjp!bu<!yg/yNbtbpDqp.oyt/pQmtfpFqe>hQfuTtieb!suqbopfmtGtb-by!GG!yb<byG/mOptbpuq!.gyy/bNbtDppqo>tOpumtfeF!euhbfpUmiGsbfbtyiGp!me~-!!~G!yb~b!Gm<p5bQu`!ZgUyJbMbBDVpRo`tBpBmYfGF!e+h!fzU/iQsOfgtgipp>m,ezN/jQot-pq!!G*yQbfboGpmepab)ug5j!!gy<b5bQD`pZoUtJpMmBfV4R7`1BDBpYoGt!u+E!jys/Q!O*g!g|p>!,Gyy/bQbtGpmqp!b*uQ3f!oqppetaN)<gj!!qp<t*NQ/fyo>pqepat)/!y}<}!!*qOpftoNp/eza>)q>pQtO/fzo<pe!!Gy<b5bQG`mZpUbJuM5B!VsRh`cBzBNY>GG!y+b!bzU/fQyOUgpgqp)>u.fzy/-O!tqppqt!N**O<fo!p$eeaf)ggjjo!f!<m5vQn`bZNU!JsMhBcVzRN`/BzBY!GG!y+b!byG/mQpObgug!pm>v.nyb/TO>tGpyqb!b*MOvfnobp)eGay)bgbjU!fy<Pegfgm)budfTyu-o!fqjpetbNs-h!!G>y?b!b*GQmepobFub3n)v!m1)/t1c-b!>2Q/f1o*p-e!!gy<bebfRmvbbdmTjuuozfSjdeqbGsshb!n>f?/!y*zO*e*o<Fb!nGvymb)btGcmbp>bOuf!ompven!bF<>6G/y1b!b+M!vOnObb)nGvymb.bQUefoyFPbgngv)mu>fQye-o!FqbpntvNm-!!*GQyfbobpGemap)bguj3!)!<26//11-!!+1!/O1O*b-n!vgmy.bObeRovFbbmnjvumz>SOdeqoGFsbbnnvfm/!y*zO*f*o<pe!aG)ygbjb!Gm<p*b*uz!ym/vQntbpOq>!G-yybfbuM)vqnpbU)yGfyUbbbbUyfGy)Pbgngv)Mubfbyy-G!>qQpetoNF-b!nGvymb!b*GQmfpobpue3a))!g1j/!1-<.*2*/z1y*/-O!tgpyqb!b-Ryvfbum)jqupzUSydfqUGbsbbynGf)/bynzv*M*b<by!GG>yObeboGFmbpnbvum!!m*vOnfboXp>eGay)bgbjM!vn|b!)*GQyObfboUpfey)Pggjg!)u<f4yQ-`!ZqUpJtMNB-V!RG`yBbBbYGGm!p+b!uz3/)Q.O2g/g1p->!,1z//1Q*t-p!qg!y*bQbfRovpbemaj)ugzjS!dq<G4sQb`nZfU/JyMzB*V*R<`B!BGYyGb!b+G!myp/bQuO!gngbpy>T,Ny>/nQbtyp)qm!v*nQbfTo-p!emav)ngbjN!*<<*!QGfyobpbeGam)p!b}u}!!n*jOofToNp>enaj)o>)QmOvfnobpTe-!!m<v4nQb`NZ*U<JM!BGVyRb`bBGBmYpGb!u+!!nzb/yQFOTgNg>pn>b.yz)/mOvtnpbqF!-*!OnfboypTeNa*)<gj!!Gy<b4bQG`mZpUbJuM!BnVjRo`FBTBNY>Gn!j+o!)ym/vQnObgFg-p!>n.jyo/TONt*p<q!!*GOyfbobpGemap)bguj!!nb<yeXfOm>bndbTyu)omfvjnebbOs-h!!m>v?n!b*XQ*e<oF!bGnyvbmb)Gtmcpbb>uQ!fnojpoeX!O><nejfom)bmdvTnuboOf-j!embvsnhb!X>*?<!*!OGeyobFbbGnmvpmb)ut!csbb>oOhffoNpbey!>n<b6y/)1n!b+y!XOOO-b!nnvbmy.FQTeNo*F<bn!vGmy>bQbeGomFpbbnuv!ms!b*oQhffoNpjeoa>)ngjjo!)n<j6o/X1O!-+!!nOjOobFnTvNm*.<Oe!oGFybbnbvGmm>pObeuo!Fsbbnovhmf!N*bOyfTodpbemaf)eg>js!bo<h*f*Nzbyy/!Q+t!pgqy!b-byRfvub)mqjpuUzyFfeUhbfbUyiGs)fbtnivpMmbeb<yG!>GQyebobFGbmnpvbmu!!*sQbfoohpfe>as)bgojh!fN<b*y*.zsyb/oOhtfpNqj!o-<yf!uG)yqbpbUGymfpUbbub!ysGb)obhnfvNMbbybDymGb>nOqefoeF>bnnbvym)!g*yObfboRpvebam)jgujz!Fe|h!f*UQiOsffotpiep)mgejN!jo<-3!Qs`bZoUhJfMNBbVyRT`dBbBmYfGe!*+<!z!/GQyObgbgCpp>p,mz!/fQbtspmqz!F*yQjfuo>psebao)hgfj!!=!<s3bQo`hZfUNJbMyBDVmRb`nBqBfYeG<!+!!jyg/)QfObgsgmpz>F,yyj/uQ*tp!qs!f*uQvfsoop!esah)cgzjN!<<!*GQyfbobpGemap)b!u}!}m!v*nObfOoXp>eGay)b>bQMOvfnobp)eG!yb<b3UQf`yZPUgJgM)BuVfRy`-B!BqYpGt!N+-!!zG/yQbObgGgmpp>b.uz3/)O.t2p/q1!-*.O2f/o1p*e-a!)ggyjb!bR<v3bQm`jZuUzJSMdBqVGRs`bBnBfY/Gy!z+*!*y</Q!OGgygbpb>G.myp/bOut!pmqv!n*bOTfFo>pGeyab)bgMjv!nb<)eGfymbbbdUTfuyoPfgjge)busfhy!->!?q!p*tQNe-o!FGbynbvbmG)mtpcbbu>3Q)f!o2p/e1!-!<2e/f1m*b-d!TguyobfbjRevbbsmhj!u>z?S!d*qOGesobFnbfn/vymz)*t*c<b>!OGfyobpbeG!mp<b6u/!1m!v+n!bOOOFb>nGvymb.bQMevonFbb)nGvymb>bQUefoyFPbgngv)mu!f*yQ-f!oqppetaN)-g!jG!yb<b6G/m1p!b+u!3O)O!b2n/v1m-..O2e/o1F*b-n!vgmy>bObeRovFbbmnjvumz!S*dOqfGospbenaf)/gyjz!**<<**!zGyy/bQbtGpmqp!b-uy!fmuv)nqbpTUXy>fGUybbbbyMGv)nbbn)vGMybbbbyUGf>yQPegogF)bunfvym-!!*qQpftoNp-e!aG)ygbjb!Gm<p*b*uz3y)/.O2t/p1q-!!-2y/f1u*)-q!pgUyybfbURbvbbymGj)ubznSvdMqbGbsybGn>fO/eyozF*b*n<vm!!G*yObfboGpmepab)ug!jm!vn|b!O*TQ>OmfvonpbeO),gmjv!nb<T2<Q`!ZGUyJbMbBGVmRp`bBuB!YmGv!n+b!XzF/>QmOvgngbpX>,,mzv/nQbtFp<q!!*GQyfbobpGemap)bguj!!tv<c2qQj`yZSUdJqMSBbVoRh`fB>B2Y/G1!0+s!byo/hQfO<gg!pG>y,byb/GQmtppbqu!!*tQvfcoqpjeyaO)TgXjF!>m<v*nQbfOoTp,emav)n!b}X}F!<*O!fGoypbebaG)m>pQbOuf!ofpeeh!fmIpppsC{b2b>y)G.!3/<12!Q+`!ZmUvJnMbBNV*R,`mBvBnYbGO!T+<!z!/GQyObgbgGpm>p.bzu/!Oftephqf!W*fOsfuo2p>e)a.)3g/j1!!+<!2mQv`nZbUNJ*M,BmVvRn`bBXBFY<G!!+G!yyb/bQGOmgpgbpu>!.myv/nObtOpFqT!F*>OmfvonpbeOaF),gmjv!nb<TeFf<mb!dGTyubobfGjmepbbsuh!!m>v?n!b*OQXeOoFF>bmnvvnmb)OtXc,bm>vQnfboOpFe<!m!pGpyCbbbbGymGp!bu<!effemhbfdITpuso{f3j>e)b.s3h/!1>!?+!!*mOvenobFFb*n,vmmv)ntbcObF>TOFf<op!eG!ymbpbpGCmbpbbyuG!!fe<h6f/W1f!s+u!3O>O)b.n3v/m1>!.+Q!emovFnbbnOv*m,!mv<n6b/O1X!O+F!<OO!bGnyvbmb>G.mOpebouF!bmnvvnmb!OX<T1X/>1m!v=n!bNONXb,nmvvmn>bpTsXf<[U!MGNybbnbvGmm!pmbpup!CmbvbnybGT!XT<FF>ymjvqncbvTtX!,+m!vEnybjTqFc<vt!>GGyybjbqGcmvptb!uu!bfpemhGfbIbpysG{!5><)6b/c1t!)+f!eOhOfbInpvsm{.2N*b!n+v!m3>/N1N*b,nbvcmt!)ufbephmfGIbpbsy{G3!*<<1!/G5y0b1b/G2m!p+b!uu!offejhefbWsfhs>ue5f>m)bbdcTtu)offejhefbWsfhs!uu2b*p!m+G!b3b/y1G*!,b<cTtT)bfnevhmf>WOfOsbun3v*m<!*!OGsyjbbbqGam)pgbju!!f<e*h*fQItppsq{!4->y)f.u3)/q1p!U+y!fmUvbnbbyXG*),bmnvvnMbbObXyTGX><Qe!oGFybbnbvGmm!pubbup!mfGebhbfyWGf!su<4D>y)j.q3c/v1t!!++!!mDvynjbqTc*v,tm>vFnybjTqXcTvFt<!u!bGpymbGbbGbmypGb!u!<f*e*hOftIppqs!{->ybfcut))qfpeUhyffIUpbsb{y4G*),bfnevhMfbIbpysG{>5O<eo!FGbynbvbmG!mupbbpum!GfbebhyfGW!fs<u1>/b4c,t*)DfyejhqfcWvfts+u*41*/,3f.e)h)f>WEfysjuq5c<vt!!GuybbpbmGGmbpbbyuG!!tv<c1qQj`yZOUXJTMXBOVFRT`FB>BmYvGn!b+O!XzT/XQ,Omgvgnpb,OzF/TCFt<pq!>Gzy/bQbtGpmqp!bu<!1mQf`oZhUuJiMTBjVhRo`>BgByYbGb!R+v!bym/jQuOzgSgdpq,Gys/bCntfp/qy><y/!QGtypbqb!Cp<pQmt!piqp!s3{uTbqpbmoG>bfbeyhGf!Ip<s1{Q!`?Z>U!JfMeBhVfRW`fBsBuY<G!!+G!yzb/bQGOmgpgbpu.!zt/vCctqpjqy>Bz>/tOvtcpqqj!yO<T1XQF`!Z+U!J3M/B1V,Rt`vBcBqYjGy!O+X!TyX/OQFOTgFg<p.!yj/gC)tapiqp>sy{/TOqtbpoq*!!m<vOntbpOq>!m3vunbbpXm<Gb!bjygG)!ai<p6s/{1T!q+b!oo*h!jmTvinubhTo>fmmv>n,bzF/<Ct!pjqg!)*iopbsq{TT{qsbpoi*!!)mgfjo!hu<i6T/j1h!o+>!goyhbjbTRivubhmojfumz>S,dyq/GCstbpnqf!/*zo<bq!TG{ysbpbiGam)pgbju!!t<vzc/qfjnybCs>G)qtdvSczqujjymBb!v+R!b)b2y/g1!0;2!31//11*!*@.!m*vonbbqNT<{s!pGiy!b)b>Gzm/pQbOug!ghps!be<jyf/ofunOb>smGvqndbSOz.umjvmnbbvNR<bb!yGgy!b;b!G1m/p1b!u@!!h*sobbeqjTf{osupTi>am)v>nyb/TQ.Omgvgnpb!N<<Q!OGgygbpb!G3mupbbpum!GmbvbnybGO!O><mzv/nNbtOp,qm>vzn/bCNt<pq!!Gy<byb/GNmtppbqu>!ym/vCntbpTqT!>m<vCntbpTq,!m3vunbbpNm<Gb!bGyyGb!bC<p*pfmh!oqbbSjqsdOS>ybjcqtc)vhts!b+e!j*fCoyujOq*c!v?t>)!tbccbt))uhbsTbbebjyfGo>uDTy*j<qc!vGty!bubbGpmmpGbbub!yhGs!be<jofhojuT>inubhyo)fbmc.t>)ohhsjbTeijufhooufOm*!-*!Obscjtb)qh)sgbje!jf<o*u*T",zb(M,{accordionViewExpandIcon:um(hs),accordionViewCollapseIcon:um(hs,!0),accordionViewLabelColor:Sf,accordionViewLabelFont:vk,accordionViewTitleBackground:es,accordionViewSelectBackground:Bc,accordionViewSelectWidth:3,accordionViewSeparatorColor:A,splitViewDividerSize:1,splitViewDividerBackground:es,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:Hb,rect:[2,2,12,12],background:hs}]},propertyViewLabelColor:Hj,propertyViewLabelSelectColor:Sf,propertyViewLabelFont:vk,propertyViewExpandIcon:um(vi),propertyViewCollapseIcon:um(vi,!0),propertyViewBackground:Kp,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:fl,propertyViewColumnLineColor:fl,propertyViewSelectBackground:Bc,listViewLabelColor:Hj,listViewLabelSelectColor:Sf,listViewLabelFont:vk,listViewRowLineVisible:!1,listViewRowLineColor:fl,listViewSelectBackground:Bc,treeViewLabelColor:Hj,treeViewLabelSelectColor:Sf,treeViewLabelFont:vk,treeViewExpandIcon:um(As),treeViewCollapseIcon:um(As,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:fl,treeViewSelectBackground:Bc,treeViewDoubleClickToToggle:!0,tableViewLabelColor:Hj,tableViewLabelSelectColor:Sf,tableViewLabelFont:vk,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:fl,tableViewColumnLineColor:fl,tableViewSelectBackground:Bc,treeTableViewLabelColor:Hj,treeTableViewLabelSelectColor:Sf,treeTableViewLabelFont:vk,treeTableViewExpandIcon:um(As),treeTableViewCollapseIcon:um(As,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:fl,treeTableViewColumnLineColor:fl,treeTableViewSelectBackground:Bc,tableHeaderLabelColor:Hj,tableHeaderLabelFont:vk,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:le,tableHeaderBackground:Kp,tableHeaderMoveBackground:cc,tableHeaderInsertColor:Bc,tableHeaderSortDescIcon:lh(vi,!0),tableHeaderSortAscIcon:lh(vi),tabViewTabGap:1,tabViewLabelColor:Sf,tabViewLabelFont:vk,tabViewTabBackground:es,tabViewSelectWidth:3,tabViewSelectBackground:Bc,tabViewMoveBackground:cc,tabViewInsertColor:Bc,toolbarLabelColor:Hj,toolbarLabelSelectColor:Sf,toolbarLabelFont:vk,toolbarBackground:Kp,toolbarSelectBackground:Bc,toolbarItemGap:8,toolbarSeparatorColor:Wj},!0);
var At={translateX:1,sortColumn:1},Bt={sortable:1,sortOrder:1,sortFunc:1},Ct={focusData:1},Dt={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},Et={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},Ft=function(v,D){D.add(v),v.hasChildren()&&v.eachChild(function(q){Ft(q,D)})},Gt=function(h,t,v,$,W,n,p,j,m,V,Y){var U,K=v.getValueType(V),s=v.getAlign(V);if(v.getEnumValues(V)){var u=v.toEnumLabel(t,V),S=Ro||0,E=0,k=n,T=M.getTextSize($,u).width;return U=yd(v.toEnumIcon(t,V)),U&&(E=n+Ro/2,"center"===s?E+=(j-(S+T))/2:"right"===s&&(E=E+j-(S+T)),Zb(h,U,E,p+m/2,V,Y),k=E+Ro/2),u!=q&&(U?Se(h,u,$,W,k,p,j-(k-n),m):Se(h,u,$,W,n,p,j,m,s)),void 0}return t=v.formatValue(t),t!=q?K===_n?(Dh(h,n,p,j,m,t),void 0):K===ji||!K&&_k(t)?(U=yd(t?kc:gq),Zb(h,U,n+j/2,p+m/2,V,Y),void 0):(Se(h,t,$,W,n,p,j,m,s),void 0):void 0},Ht=function(s,A){var T=A.view,h=Ir(s),G=A.column||A.property;T.getDataModel().beginTransaction(),A.editor=s,s.info=A,T.setCurrentEditor(s),T.getView().insertBefore(h,T._79O),Xn(s,A.editorRect),s.setFocus?s.setFocus():Rb(s),s.commitValue=function(X,o){s._17Q&&(s=s._17Q),o||T.setValue(A.data,G,s.getValue?s.getValue():s.value),s.close&&s.close(),Qn(h)},G.onEditorCreated&&G.onEditorCreated(A)},It=function(b,p,h,P,N){var v=Nf(b,h),i=p.value,D=p.view,L=N.getValueType(p.data);return v.onblur=v.onchange=function(){D.endEditing()},"input"===b?(i=N.formatValue(i),i!=q&&(v.value=i),v.onkeydown=function(E){yn(E)?D.endEditing():$q(E)&&D.endEditing(!0)},(L===Ud||L===Oo)&&X(v,Yg,M.numberListener)):b===Rh&&P.forEach(function(U){var g=$.createElement("option");g.innerHTML=N.toEnumLabel(U),g.value=U,N.isEnumEqual(i,U)&&(g.selected=!0),Bh(v,g)}),Ht(v,p),v},Jt=x.widget={},Kt=function(o,x,E){uj(H+".widget."+o,x,E)};zb(Mp,{ms_value:function(j){j.getValue=function(o){var B=this.getItemById(o),I=B.element;return ro(I)?I:I?I.getValue?I.getValue():I.value:B.selected},j.setValue=function(o,n){var k=this.getItemById(o);if(k){var R=k.element;R&&!ro(R)?R.setValue?R.setValue(n):R.value=n:_k(n)?(k.selected=n,this.iv()):(k.element=n,this.iv())}},j.v=function(y,p){var w=this;if(2===arguments.length)w.setValue(y,p);else{if(!fg(y))return w.getValue(y);for(var g in y)w.setValue(g,y[g])}return w}},_46o:function(p){p._icon=q,p._accessType=q,p._valueType=q,p._editable=!1,p._batchEditable=!0,p._align=wk,p._nullable=!0,p._emptiable=!1,p.setParent=Zj,p.formatValue=function(O){var M=this,L=M._valueType;return M.getEnumValues()?M.toEnumLabel(O):L===ji?!!O:O!=q&&L===Ud?N(O):O},p.setEnum=function(H,x,f,t,T,N,B){var P=this;H&&!bj(H)&&H.values&&(t=H.editable,f=H.icons,x=H.labels,T=H.strict,N=H.maxHeight,B=H.dropDownWidth,H=H.values),Bd(H)&&(H=H._as),Bd(x)&&(x=x._as),Bd(f)&&(f=f._as),P._enumValues=H,P._enumLabels=x,P._enumIcons=f,P._enumEditable=t,P._enumStrict=T==q?!0:T,P._enumMaxHeight=N,P._enumDropDownWidth=B,H&&H.length&&xe(H[0])&&(P._valueType=Oo),P.fp("enum",!1,!0)},p.getEnumDropDownWidth=function(){return this._enumDropDownWidth},p.getEnumMaxHeight=function(){return this._enumMaxHeight},p.isEnumEditable=function(){return this._enumEditable},p.getEnumValues=function(){return this._enumValues},p.getEnumLabels=function(){return this._enumLabels},p.getEnumIcons=function(){return this._enumIcons},p.isEnumStrict=function(){return this._enumStrict},p.isEnumEqual=function(b,i){return this._enumStrict?b===i:b==i},p.toEnumLabel=function(f,z){var G=this,V=G.getEnumValues(z),n=G.getEnumLabels(z);if(V&&n)for(var W=0;W<V.length;W++)if(G.isEnumEqual(f,V[W]))return n[W];return f},p.toEnumIcon=function(t,B){var n=this,F=n.getEnumValues(B),T=n.getEnumIcons(B);if(F&&T)for(var l=0;l<F.length;l++)if(n.isEnumEqual(t,F[l]))return T[l];return A}},_45o:function(n){n._87o=function($,z,y,j,Z,V){if($){var F=this,m=F._90I,S=Kn(1);F._columnLineVisible&&(Z-=1),F._rowLineVisible&&(V-=1),0>=Z||0>=V||(F._90I||(m=F._90I={}),m[z]||(m[z]=new lo),Xn(S,F.tx()+y,F.ty()+j,Z,V),Bh(S,$),F._view.insertBefore(S,F._79O),$.onParentAdded&&$.onParentAdded(S),m[z].add(S))}},n._76o=function(){var j=this,k=j._90I;if(k){for(var w in k)k[w].each(function(l){Qn(l)});delete j._90I}},n._77o=function(b){var V=this;if(V._90I){var $=V._90I[b];$&&($.each(function(_){Qn(_)}),delete V._90I[b])}}},_47o:function(T){T.getValue=function(h,H){return H.getValue?H.getValue(h,H,this):Gc(h,H.getAccessType(),H.getName())},T.setValue=function(O,K,H){if(K.isEmptiable(O)||""!==H||(H=A),K.isNullable(O)||H!=q){var m=this,k=K.getName(O),L=K.getAccessType(O),M=K.getValueType(O);M===Ud&&ro(H)?H=hd(H):M===Oo&&ro(H)?H=parseFloat(H):M===ji&&ro(H)&&(H="true"===H),m._batchEditable&&K._batchEditable&&m.isSelected(O)?m.sm().each(function(J){K.setValue?K.setValue(J,K,H,m):Ed(J,L,k,H)}):K.setValue?K.setValue(O,K,H,m):Ed(O,L,k,H)}},T.setCurrentEditor=function(A){this.endEditing(),this._currentEditor=A,this.redraw()},T.isEditing=function(O,s){var m=this,k=m._currentEditor;if(!k)return!1;if(s){var w=k.info;return w?(w.column||w.property)===s&&w.data===O:!1}return!0},T.endEditing=function($){var A=this,U=A._currentEditor;U&&(delete A._currentEditor,U.commitValue&&U.commitValue(U.info,$),A.redraw(),A.getDataModel().endTransaction())},T.beginEditing=function(G){this.endEditing();var w=this,a=G.column||G.property;if(a.beginEditing)a.beginEditing(G);else{var U=G.data,L=G.value,s=w.getSelectBackground(U),K=a.getEnumValues(U),o=a.getSlider(U),I=a.getColorPicker(U);if(o){var z=hb(Jt.Slider,o);return z.setValue(L),z.getView().onblur=function(){w.endEditing()},z.isInstant()&&(z.onValueChanged=function(){w.setValue(U,a,z.getValue())}),Ht(z,G),void 0}if(I||a.getValueType(U)===_n){var j=hb(Jt.ColorPicker,I);j.setValue(L);var W=j.onClosed;return j.onClosed=function(){w.endEditing(),W&&W.call(this)},j.isInstant()&&(j.onValueChanged=function(E,O){w.setValue(U,a,O)}),Ht(j,G),j.open(),void 0}if(K){if(Jt.ComboBox){var $=new Jt.ComboBox;$.setValue(L),$.setValues(K),$.setLabels(a.getEnumLabels(U)),$.setIcons(a.getEnumIcons(U)),$.setEditable(a.isEnumEditable(U)),$.setStrict(a.isEnumStrict(U)),$.setMaxHeight(a.getEnumMaxHeight(U)),$.setDropDownWidth(a.getEnumDropDownWidth(U)),$.onClosed=function(){w.endEditing()},Ht($,G),$.open()}else It(Rh,G,s,K,a);return}var v=a.getValueType(U);if(v===ji||_k(L))return w.setValue(U,a,!L),void 0;if(a.getItemEditor(U)){var g=jq(a.getItemEditor(U)),J=new g(U,a,w,G),Y=J.getView();return Y._17Q=J,J.setValue(L),br(Y),Ht(Y,G),J.editBeginning&&J.editBeginning(),void 0}It("input",G,s,q,a)}}},_44o:function(i){i.init=function(I){var p=this,$=p.th=new Zt(I),R=p._view=bn(1,p);p.tv=p._tableView=I,Bh(R,$.getView()),Bh(R,I.getView()),$.mp(function(M){M.property===ii&&p.iv()}),p.iv()},i.getTableView=function(){return this.tv},i.getTableHeader=function(){return this.th},i.getDataModel=function(){return this.tv.dm()},i.getColumnModel=function(){return this.tv.getColumnModel()},i.setColumns=function(g){this.tv.setColumns(g)},i.addColumns=function(p){this.tv.addColumns(p)},i.endEditing=function(){this.tv.endEditing()},i.validateImpl=function(){var N=this,m=N.th,n=Zi(m),e={x:0,y:0,width:N.getWidth(),height:n};Xn(m,e),e.y=n,e.height=E(0,N.getHeight()-n),Xn(N.tv,e)}},ms_vs:function(n){n._41o=function(){return this._29I.height<this._59I},n._43o=function(){var q=this;q._41o()&&(q._58I||(Zl(function(){q._94O()},nh),q.iv()),q._58I=new Date)},n._94O=function(){var J=this;if(J._58I){var N=new Date;N.getTime()-J._58I.getTime()>=nh?(delete J._58I,J.iv()):Zl(function(){J._94O()},nh)}},n._93I=function(){var n=this,W=n._27I;if(n._58I||!n._autoHideScrollBar){W||Bh(n._79O,W=n._27I=Kn());var d=n._29I,g=d.height,Z=n._59I,v=n.getScrollBarSize(),j=d.width-v-2,h=g*(-n.ty()/Z),q=g*(g/Z),X=W.style;Z>g?(Eh>q&&(h=h+q/2-Eh/2,0>h&&(h=0),h+Eh>g&&(h=g-Eh),q=Eh),X.visibility=Vi,X.background=n.getScrollBarColor(),X.borderRadius=v/2+Zh,Xn(W,j,h,v,q)):X.visibility=Cc}else W&&(W.style.visibility=Cc)}},ms_hs:function(l){l._40o=function(){return this._29I.width<this._91I},l._42o=function(){var p=this;p._40o()&&(p._95O||(Zl(function(){p._94I()},nh),p.iv()),p._95O=new Date)},l._94I=function(){var q=this;if(q._95O){var $=new Date;$.getTime()-q._95O.getTime()>=nh?(delete q._95O,q.iv()):Zl(function(){q._94I()},nh)}},l._92I=function(){var m=this,Z=m._28I;if(m._95O||!m._autoHideScrollBar){Z||Bh(m._79O,Z=m._28I=Kn());var C=m._29I,w=C.width,q=m._91I,s=m.getScrollBarSize(),g=C.height-s-2,T=w*(-m.tx()/q),r=w*(w/q),p=Z.style;q>w?(Eh>r&&(T=T+r/2-Eh/2,0>T&&(T=0),T+Eh>w&&(T=w-Eh),r=Eh),p.visibility=Vi,p.background=m.getScrollBarColor(),p.borderRadius=s/2+Zh,Xn(Z,T,g,r,s)):p.visibility=Cc}else Z&&(Z.style.visibility=Cc)}}}),Ef(kc,sn(16,16,[{type:jk,rect:[1,1,14,14],background:Bc},{type:Ki,rect:[1,1,14,14],width:1,color:vm},{type:Xi,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),Ef(gq,sn(16,16,{type:Ki,rect:[1,1,14,14],width:1,color:vm})),Ef(gp,sn(16,16,[{type:sp,rect:[2,2,12,12],borderWidth:1,borderColor:vm,background:"#FFF"},{type:sp,rect:[4,4,8,8],background:Bc}])),Ef(Jg,sn(16,16,{type:sp,rect:[2,2,12,12],borderWidth:1,borderColor:vm})),Mp._15Q=function(U){U._29I=Wb,U._59I=0,U._91I=0,U._5o=function(T){var _=this;_._30I=new lo,_._rows=new lo,_._rowMap={},_._31I=0,_._14I=0,_._view=bn(1,_),_._canvas=rs(_._view),Bh(_._view,_._79O=Kn()),_.dm(T?T:new Xl)},U.getCheckIcon=function(j){var h=this.sm(),o=h.co(j);return h.sg()?yd(o?gp:Jg):yd(o?kc:gq)},U.checkData=function(Y){var m=this.sm(),D=m.co(Y);m.sg()&&D||(this._32o=1,D?m.rs(Y):m.as(Y),delete this._32o)},U.getDataAt=function(I){I.target&&(I=this.lp(I));var s=L(I.y/this._rowHeight),R=this._rows;return 0>s||s>=R.size()?q:R.get(s)},U.onDataDoubleClicked=function(){},U.onDataClicked=function(){},U.adjustTranslateX=function(){return 0},U.adjustTranslateY=function(u){var l=this.getHeight()-this._59I;return l>u&&(u=l),u>0?0:N(u)},U.onPropertyChanged=function(z){var N=this,I=z.property;Dt[I]?N.ivm():Ct[I]||N.redraw(),I===_p?N._42o():I===Fd&&N._43o()},U.getLabel=function(S){return S.toLabel()},U.getLabelFont=function(){return this._labelFont},U.getLabelColor=function(E){var u=this;if(u.isCheckMode()){if(u._focusData===E)return u._labelSelectColor}else if(u.isSelected(E))return u._labelSelectColor;return u._labelColor},U.getStartRowIndex=function(){return this._31I},U.getEndRowIndex=function(){return this._14I},U.getRowDatas=function(){return this._rows},U.getRowIndex=function(M){return this._rowMap[M._id]},U.getRowSize=function(){return this._rows.size()},U.getViewRect=function(){return Wr(this._29I)},U.isVisible=function(j){return this._visibleFunc?this._visibleFunc(j):!0},U.getCurrentSortFunc=function(){return this._sortFunc},U.setDataModel=function(u){var p=this,Z=p._dataModel,H=p._selectionModel;Z!==u&&(Z&&(Z.umm(p.handleDataModelChange,p),Z.umd(p.handleDataPropertyChange,p),Z.umh(p.handleHierarchyChange,p),H||Z.sm().ums(p.handleSelectionChange,p)),p._dataModel=u,u.mm(p.handleDataModelChange,p),u.md(p.handleDataPropertyChange,p),u.mh(p.handleHierarchyChange,p),H?H._21I(u):u.sm().ms(p.handleSelectionChange,p),p.fp("dataModel",Z,u))},U.validateModel=function(){var u=this;u._rows.clear(),u._rowMap={},u.buildChildren(u._dataModel._roots);var p=u._rows=u._rows.toList(u.isVisible,u),v=0,A=u.getCurrentSortFunc(),J=p.size();for(A&&p.sort(A);J>v;v++)u._rowMap[p.get(v)._id]=v},U.buildChildren=function(F){var Y=this;F.each(function(r){Y._rows.add(r),Y.buildChildren(r._children)})},U.handleDataModelChange=function(){this.ivm()},U.handleDataPropertyChange=function(o){"parent"===o.property?this.ivm():this.invalidateData(o.data)},U.handleHierarchyChange=function(){this.ivm()},U.handleSelectionChange=function(T){T.datas.each(this.invalidateData,this),this.onSelectionChanged(T)},U.onSelectionChanged=function(U){var i=this,Q=i.sm();!i.isAutoMakeVisible()||1!==Q.size()||"set"!==U.kind&&"append"!==U.kind||i._32o||i.makeVisible(Q.ld())},U.handleBackgroundClick=function(l){$h(l)&&!this.isCheckMode()&&this.sm().cs()},U.makeVisible=function(y){y&&(this._23I=y,this.iv())},U.scrollToIndex=function(U){var m=this,O=m._29I,I=O.height,n=m._rowHeight,_=n*U;U>=0&&U<m._rows.size()&&I>0&&(_+n>O.y+I?m.ty(-_+I-n):_<O.y&&m.ty(-_))},U.autoScroll=function(b,Z){var Q=this,m=Q._rowHeight,y=m,X=m/4,o=Q._29I,K=Q.lp(b),d={x:Q.tx(),y:Q.ty()};return m>0&&o&&(K.x-o.x<y?Q.translate(X,0):o.x+o.width-K.x<y&&Q.translate(-X,0),K.y-o.y<y?Q.translate(0,X):o.y+o.height-K.y<y&&Q.translate(0,-X)),d.x=Q.tx()-d.x,d.y=Q.ty()-d.y,Z&&(Z.x+=d.x,Z.y+=d.y),d},U.getTopRowOrderSelection=function(){var A=this.sm().getTopSelection(),$={},r=new lo;return A.each(function(F){$[F._id]=F}),this._rows.each(function(c){$[c._id]&&r.add(c)}),r},U.getRowOrderSelection=function(){var G=new lo;return this._rows.each(function(d){this.isSelected(d)&&G.add(d)},this),G},U.ivm=function(){this.invalidateModel()},U.invalidateModel=function(){var g=this;g._96I||(g._96I=1,g._32I=1,delete g._24I),g.iv()},U.redraw=function(){var W=this;W._32I||(W._32I=1,delete W._24I,W.iv())},U.invalidateData=function(l){var F=this;Ni?F.redraw():F._32I||(F._24I||(F._24I={}),F._24I[l._id]=l,F.iv())},U.getFocusData=function(){return this._focusData},U.setFocusDataById=function(E){this.setFocusData(this.dm().getDataById(E))},U.setFocusData=function(T){var d=this,h=d._focusData;h!==T&&(d._focusData=T,d.fp("focusData",h,T),h&&d.invalidateData(h),T&&(d.invalidateData(T),d.isAutoMakeVisible()&&d.makeVisible(T)))},U.drawRowBackground=function(U,k,X,y,T,w,N){var E=this,J=E.isCheckMode();(k===E._focusData&&J||X&&!J)&&Dh(U,y,T,w,N,E.getSelectBackground(k))},U.drawData=function(A,L,g){var w=this,C=w._rowHeight,V=C*g,U=w._29I,x=U.x,W=U.width;A.save(),A.beginPath(),A.rect(x,V,W,C),A.clip(),w._87o(w.drawRow(A,L,w.isSelected(L),x,V,W,C),g,x,V,W,C),A.restore(),w._rowLineVisible&&Dh(A,x,V+C-1,W,1,w._rowLineColor)},U._12I=function(Q){var v=this,I=v._31I,F=v._29I,f=F.x,i=F.y,S=F.width,w=F.height;for(Q.beginPath(),Q.rect(f,i,S,w),Q.clip(),Q.clearRect(f,i,S,w),v._76o(),v._93db(Q);I<v._14I;I++)v.drawData(Q,v._rows.get(I),I);v._92db(Q)},U._13I=function(h){for(var c,p=this,z=p._rowHeight,f=p._29I,F=f.x,S=f.width,g=p._31I,b=p._30I;g<p._14I;g++)c=p._rows.get(g),p._24I[c._id]&&b.add({data:c,index:g});b.isEmpty()||(h.beginPath(),b.each(function(Y){h.rect(F,Y.index*z,S,z)}),h.clip(),b.each(function(e){h.clearRect(F,e.index*z,S,z)}),b.each(function(o){p._77o(o.index)}),p._93db(h),b.each(function(m){p.drawData(h,m.data,m.index)}),p._92db(h),b.clear())},U.preValidateModel=function(){this.endEditing&&this.endEditing()},U.validateImpl=function(){var Y=this,P=Y._canvas,M=Y.getWidth(),_=Y.getHeight(),C=Y._rowHeight,t=Y._32I;(M!==P.clientWidth||_!==P.clientHeight)&&(Sk(P,M,_),t=1),Y._96I&&(Y.preValidateModel(),Y.validateModel());var o=Y._29I,O={x:-Y.tx(),y:-Y.ty(),width:M,height:_},B=Y._rows.size(),E=bc(P),b=Y._23I;t||Uj(O,o)||(t=1),Y._29I=O,Y._59I=B*C,Y._31I=L(O.y/C),Y._14I=y((O.y+O.height)/C),Y._31I<0&&(Y._31I=0),Y._14I>B&&(Y._14I=B),Y._99I&&t&&Y._99I();var A=Y.tx(),X=Y.ty();(Y._40o()||Y._41o())&&(Y._59I+=Y.getScrollBarSize(),Y._99I&&t&&(Y._91I+=Y.getScrollBarSize())),$b&&!In&&(E.save(),ih(E,M/Xp.length,_/Xp.length,1)),ih(E,A,X,1),t?Y._12I(E):Y._24I&&Y._13I(E),Y._93I(),Y._92I(),E.restore(),Y._32I=Y._24I=Y._96I=q,b&&(Y.scrollToIndex(Y.getRowIndex(b)),delete Y._23I),Y.tx(Y.tx()),Y.ty(Y.ty())},U.canHandleSelectMode=function(){return!0},U.isDraggable=function(){return!0}},Mp._48o=function(n){n._rootVisible=!0,n._rootData=q,n._35o=function(){this._expandMap={},this._levelMap={}},n.validateModel=function(){var f=this,S=f._rootData;f._rows.clear(),f._levelMap={},f._rowMap={},f._currentLevel=0,S?f._rootVisible?f.isVisible(S)&&f.buildData(S):f.buildChildren(S):f.buildChildren(),delete f._currentLevel},n.buildData=function(s){var K=this,F=s._id,V=K._rows;K._rowMap[F]=V.size(),V.add(s),K._levelMap[F]=K._currentLevel,K.isExpanded(s)&&(K._currentLevel++,K.buildChildren(s),K._currentLevel--)},n.buildChildren=function(j){var s=this,f=j?j._children:s._dataModel._roots,i=s.getCurrentSortFunc();i&&s.isChildrenSortable(j)?f.toList(s.isVisible,s).sort(i).each(s.buildData,s):f.each(function(g){s.isVisible(g)&&s.buildData(g)})},n.getLevel=function(L){return this._levelMap[L._id]},n.getToggleIcon=function(r){var P=this,D=P._loader,E=P._collapseIcon;return D&&!D.isLoaded(r)?E:r.hasChildren()?P.isExpanded(r)?P._expandIcon:E:q},n.isCheckMode=function(){return this._checkMode!=q},n.isChildrenSortable=function(){return!0},n.handleDataModelChange=function($){var v=this;$.kind===ko?delete v._expandMap[$.data._id]:$.kind===bl&&(v._expandMap={}),v.ivm()},n.toggle=function(w){var e=this;e.isExpanded(w)?e.collapse(w):e.expand(w)},n.isExpanded=function(H){return 1===this._expandMap[H._id]},n.expand=function(d){var x=this,H=x._loader;x.isExpanded(d)||(H&&!H.isLoaded(d)&&H.load(d),x._expandMap[d._id]=1,x.ivm(),x.onExpanded(d))},n.onExpanded=function(){},n.collapse=function($){var o=this;o.isExpanded($)&&(delete o._expandMap[$._id],o.ivm(),o.onCollapsed($))},n.onCollapsed=function(){},n.expandAll=function(c){if(c)this.expand(c),c.eachChild(function($){this.expandAll($)},this);else{var N=this;N._dataModel.each(function(y){y.hasChildren()&&(N._expandMap[y._id]=1)}),N.ivm()}},n.collapseAll=function(){this._expandMap={},this.ivm()},n.makeVisible=function(p){if(p){var i=this;if(!i._rootData||p.isDescendantOf(i._rootData)){for(var x=p._parent;x;)i.expand(x),x=x._parent;i._23I=p,i.iv()}}},n.checkData=function(w){var R,v=this,j=v._checkMode,F=v.sm(),x=F.co(w);if(!F.sg()||!x){if(v._32o=1,j===mf)x?F.rs(w):F.as(w);else if(j===Il)R=new lo(w),R.addAll(w._children);else if("descendant"===j)R=new lo,Ft(w,R);else if("all"===j&&(R=new lo,Ft(w,R),!x))for(var U=w._parent;U;)R.add(U),U=U._parent;R&&(x?F.rs(R):F.as(R)),delete v._32o}},n.drawTree=function($,z,H,c,O,P,K){var p=this,r=p._indent,Y=p._levelMap[z._id],t=p.getIconWidth(z),I=yd(p.getToggleIcon(z));I?(c+=r*Y,Zb($,I,c+r/2,O+K/2,z,p),c+=r):c+=r*(Y+1),p._checkMode&&(Zb($,p.getCheckIcon(z),c+r/2,O+K/2,z,p),c+=r),p.drawIcon($,z,c,O,t,K),p.drawLabel($,z,c+t,O,K)}},Mp._14Q=function(M){M.getIcon=function(p){return p.getIcon()},M.getIconWidth=function(v){return this.getIcon(v)?this._indent:0},M.drawIcon=function(i,y,P,$,X,m){if(X){var u=this,C=u.getBodyColor(y),o=yd(u.getIcon(y),C);o&&(m-=u.isRowLineVisible()?1:0,jl(i,o,Ng,P,$,X,m,y,u,C),Co(i,u.getBorderColor(y),P,$,X,m))}},M.drawLabel=function(S,L,s,N,$){var d=this;Se(S,d.getLabel(L),d.getLabelFont(L),d.getLabelColor(L),s,N,0,$)}},Mp._50o=function(O){O._98I=function(){var T=this,q=T._39o=new Xl;T._60I=new lo,q.mm(T._17o,T),q.md(T._18o,T),q.mh(T._19o,T)},O.setColumns=function(W){this._39o.clear(),this.addColumns(W)},O.addColumns=function(d){var w=this._39o;d.forEach(function(D){if(!(D instanceof Mt)){var T=jq(D.className);D=hb(T?T:Mt,D)}w.add(D)})},O.onColumnClicked=function(){},O.onCheckColumnClicked=function(){},O._3Q=function(p){for(var U,i=0,L=this._60I,r=L.size();r>i;i++)if(U=L.get(i),U.column===p)return U;return q},O.getColumnAt=function(v){var D=this._4Q(v);return D?D.column:q},O._4Q=function(H){for(var _=this,L=H.target?_.lp(H).x:H.x,T=_._60I,U=0;U<T.size();U++){var K=T.get(U),n=K.startX;if(L>=n&&L<n+K.column.getWidth())return K}return q},O.getToolTip=function(H){var w=this,I=w.getDataAt(H),l=w.getColumnAt(H);return I&&l?l.getToolTip(I,w):q},O.adjustTranslateX=function(U){var b=this.getWidth()-this._91I;return b>U&&(U=b),U>0?0:N(U)},O._99I=function(){var E=this,U=E._29I,Q=E._60I;Q.clear(),E._91I=0,E._39o._roots.each(function(d){if(d.isVisible()){var g=E._91I+d.getWidth();E._91I<=U.x+U.width&&g>=U.x&&Q.add({column:d,startX:E._91I}),E._91I=g}})},O.drawData=function(j,Q,q){var D=this,v=D._rowHeight,$=v*q,d=D.isSelected(Q),i=D._29I,g=i.x,M=i.width;D.drawRowBackground(j,Q,d,g,$,M,v),D._60I.each(function(y){var C=y.column,z=y.startX,c=C.getWidth();c>0&&!D.isEditing(Q,C)&&(j.save(),j.beginPath(),j.rect(z,$,c,v),j.clip(),D._87o(D.drawCell(j,Q,d,C,z,$,c,v),q,z,$,c,v),D._columnLineVisible&&Dh(j,z+c-1,$,1,v,D._columnLineColor),j.restore())}),D._rowLineVisible&&Dh(j,g,$+v-1,M,1,D._rowLineColor)},O.drawCell=function(T,u,F,f,i,R,v,d){var V=this;if(f.drawCell)return f.drawCell(T,u,F,f,i,R,v,d,V);var J=V.getValue(u,f);Gt(T,J,f,V.getLabelFont(u,f,J),V.getLabelColor(u,f,J),i,R,v,d,u,V)},O.getColumnModel=function(){return this._39o},O._17o=function(){this.redraw()},O._18o=function(X){var z=this;X.data===z._sortColumn&&Bt[X.property]?z.ivm():(z._42o(),z.redraw())},O._19o=function(){this.redraw()},O.getCurrentSortFunc=function(){var m=this,A=m._sortColumn;if(A&&A.isSortable()){var d=A.getSortFunc(),y=ys===A.getSortOrder()?1:-1;return d||(d=rg),function(v,G){return d.call(m,m.getValue(v,A),m.getValue(G,A),v,G)*y}}return m._sortFunc},O.isCellEditable=function(b,o,D){return o.isEditable()&&this.isEditable()?o.isCellEditable?o.isCellEditable(b,o,D,this):!0:!1},O._37O=function(L,b){if($h(b))for(var S=this,U=S.lp(b),s=S._60I,M=S._rowHeight,I=S._29I,d=I.x,c=I.y,i=I.width,Z=I.height,x=0;x<s.size();x++){var R=s.get(x),h=R.startX,V=R.column,y=V.getWidth();if(V!==S._31o&&V!==S._4o&&U.x>=h&&U.x<h+y&&S.isCellEditable(L,V,b)){var f={x:h,y:S.getRowIndex(L)*M,width:y,height:M},J={x:f.x+S.tx(),y:f.y+S.ty(),width:f.width,height:f.height},A=0,H=0;return f.x<d?A=f.x-d:f.x+f.width>d+i&&(A=f.x+f.width-d-i),A&&(S.tx(S.tx()-A),J.x-=A),f.y<c?H=f.y-c:f.y+M>c+Z&&(H=f.y+M-c-Z),H&&(S.ty(S.ty()-H),J.y-=H),S.beginEditing({data:L,column:V,value:S.getValue(L,V),event:b,rect:f,editorRect:J,view:S}),void 0}}}},Jt.BaseItemEditor=function(l,r,m,S){this._data=l,this._column=r,this._master=m,this._editInfo=S},Kt("BaseItemEditor",u,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var Lt=x.Tab=function(){Vq(Lt,this)};Qq("Tab",Vp,{ms_ac:["view","closable","disabled","visible"],_icon:q,_closable:!1,_disabled:!1,_visible:!0,setParent:Zj});var Mt=x.Column=function(){Vq(Mt,this)};Qq("Column",Vp,{_46o:1,ms_ac:["accessType","valueType",Vi,cn,Yp,xj,"align",_n,"sortOrder",vc,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:ys,_sortFunc:q,_sortable:!0,_clickable:!0,setWidth:function(T){16>T&&(T=16);var U=this._width;this._width=T,this.fp(xj,U,T)},getToolTip:function(_,w){return this.formatValue(w.getValue(_,this))}});var Nt=x.Property=function(){Vq(Nt,this)};Qq("Property",Vp,{_46o:1,ms_ac:["accessType","valueType",cn,Yp,"categoryName",_n,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:q,getToolTip:function(W,E,g){var f=this;return E?f.formatValue(g.getValue(W,f)):g.getPropertyName(f)}}),Jt.AccordionView=function(){var T=this;T._20o={},T._21o=new lo,T._10o=q,T._9o=q,T._11o=q,T._view=bn(0,T),T.iv()},Kt("AccordionView",u,{ms_v:1,ms_fire:1,ms_ac:[Gp,Rc,"titleHeight",Cg,we,"titleBackground","selectWidth",Uf,"orientation","separatorColor"],_expandIcon:M.accordionViewExpandIcon,_collapseIcon:M.accordionViewCollapseIcon,_titleHeight:Qi,_labelColor:M.accordionViewLabelColor,_labelFont:M.accordionViewLabelFont,_titleBackground:M.accordionViewTitleBackground,_selectBackground:M.accordionViewSelectBackground,_selectWidth:M.accordionViewSelectWidth,_orientation:"v",_separatorColor:M.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(L,p,O,C){var H=this,h=Kn(),s={content:p,div:h,canvas:rs(h),icon:C};if(H._20o[L])throw L+" already exists";var v=s.downEventFunc=function(K){lr(K)},T=s.upEventFunc=function(S){lr(S),$h(S)&&(H._10o===L?H.collapse():H.expand(L))};[fs,cs].forEach(function(y){X(h,y,v)}),[gh,zp].forEach(function(K){X(h,K,T)}),h.style.cursor=cd,Bh(H._view,h),H._20o[L]=s,H._21o.add(L),O&&H.expand(L),H.iv()},remove:function(W){var t=this,I=t._20o[W];if(I){var r=I.div;Qn(r),[fs,cs].forEach(function(s){F(r,s,I.downEventFunc)}),[gh,zp].forEach(function(W){F(r,W,I.upEventFunc)}),delete t._20o[W],t._21o.remove(W),t.iv()}},clear:function(){var x=this;x._21o.toArray().forEach(x.remove,x),x._20o={},x._21o.clear(),x.iv()},isExpanded:function(i){return this._10o===i},expand:function(E){var t=this;t._20o[E]&&t._10o!==E&&(t._10o=E,t.onExpanded(E),t.iv())},onExpanded:function(){},collapse:function(){var $=this;$._10o&&($.onCollapsed($._10o),delete $._10o,$.iv())},onCollapsed:function(){},initCanvas:function(W,l,C){Sk(W,l,C);var u=bc(W);return ih(u,0,0,1),u.clearRect(0,0,l,C),u},drawTitle:function(q,k,f,d,g){var M=this,y=yd(g.icon),r=M.isExpanded(k),_=M._titleHeight,h=M._titleBackground,K=M._selectWidth,p=M._separatorColor,B=yd(r?M._expandIcon:M._collapseIcon),E=K+4;Dh(q,0,0,f,d,h),r&&K&&Dh(q,0,0,K,d,M._selectBackground),(r||M._21o.get(M._21o.size()-1)!==k)&&Dh(q,0,d-1,f,1,p?p:hq(h)),y&&(Zb(q,y,E+Wq(y)/2,_/2),E+=Wq(y)+2),Se(q,k,M.getLabelFont(k),M.getLabelColor(k),E,0,0,_),B&&Zb(q,B,f-Wq(B)/2-4,_/2)},validateImpl:function(){var S=this,B=S._view,H=0,r=0,m=S.getWidth(),C=S.getHeight(),K=S._titleHeight,I=S._21o.size()*K,l=S._11o,u=S._9o;delete S._11o,delete S._9o,S._21o.each(function(F){var L,J,D=S._20o[F],a=D.content,x=S._10o===F;Gj(S)?(Xn(D.div,H,0,K,C),L=S.initCanvas(D.canvas,K,C),hi(L,0,C),Cm(L,-Ek),S.drawTitle(L,F,C,K,D),L.restore(),x?(J=E(0,m-I),a&&(S._11o=a,S._9o=Ir(a),Xn(a,H+K,0,J,C)),H+=K+J):H+=K):(Xn(D.div,0,r,m,K),L=S.initCanvas(D.canvas,m,K),S.drawTitle(L,F,m,K,D),L.restore(),x?(J=E(0,C-I),a&&(S._11o=a,S._9o=Ir(a),Xn(a,0,r+K,m,J)),r+=K+J):r+=K)});var y=S._9o;l&&l!==S._11o&&l.endEditing&&l.endEditing(),y&&y!==u&&Bh(B,y),u&&u!==y&&Qn(u)}}),Jt.SplitView=function(t,R,o,b){var k=this,F=k._dividerDiv=Kn(),i=k._60O=rs(),z=k._61O=rs(),L=i.style,M=z.style;k._view=bn(1,k),Bh(k._view,F),L.msTouchAction=un,L.pointerEvents=un,L.cursor=cd,M.msTouchAction=un,M.pointerEvents=un,M.cursor=cd,t&&k.setLeftView(t),R&&k.setRightView(R),o&&k.setOrientation(o),b!=q&&k.setPosition(b),k.setStatus(uc),new Ot(k)},Kt("SplitView",u,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:M.splitViewDividerSize,_dividerBackground:M.splitViewDividerBackground,_dragOpacity:M.splitViewDragOpacity,_toggleIcon:M.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(p,J){var S=this,v=S._position;isNaN(p)||(J||(S._82O=0>p?-1:p>1?1:0),S._position=p,S.fp(Nn,v,p))},getLeftView:function(){return this._leftView},setLeftView:function(n){var Q=this,A=Q._leftView,f=Q._view;if(Q._leftView!==n){if(A&&A!==Q._rightView){var M=Ir(A);M.parentNode===f&&Qn(M)}if(Q._leftView=n,n){var g=Ir(n);g.parentNode!==f&&f.insertBefore(g,Q._dividerDiv)}Q.fp("leftView",A,n)}},getRightView:function(){return this._rightView},setRightView:function(I){var H=this,v=H._rightView,e=H._view;if(H._rightView!==I){if(v&&v!==H._leftView){var x=Ir(v);x.parentNode===e&&Qn(x)}if(H._rightView=I,I){var V=Ir(I);V.parentNode!==e&&e.insertBefore(V,H._dividerDiv)}H.fp("rightView",v,I)}},validateImpl:function(){var y=this,V=y._draggable,s=y._position,U=y.getWidth(),i=y.getHeight(),C=y._dividerSize,l=y._dividerBackground,G=lf?18:8,f=y._dividerDiv,X=y._82O,M=y._60O,v=y._61O,n=y._toggleIcon,g=y._status,F=f.style,H=null,L=lf?20:4,I=n.comps[0];C>=G||0===C?y._coverDiv&&(Qn(y._coverDiv),delete y._coverDiv):y._coverDiv||(y._coverDiv=Kn(),mp&&(y._coverDiv.style.background=Yb),Bh(f,y._coverDiv)),y._togglable?M.parentNode||(Bh(f,M),Bh(f,v)):(Qn(M),Qn(v));var Z=y._coverDiv,r=y._leftView,D=y._rightView;if(Gj(y)){if(C>U&&(C=U),g===uc)if(1===X)var b=e(s,U),c=E(0,U-C-b);else-1===X?(c=e(-s,U),b=E(0,U-C-c)):(b=N((U-C)*s),c=E(0,U-C-b));else"cl"===g?(b=0,c=E(0,U-C)):"cr"===g&&(c=0,b=E(0,U-C));r&&Xn(r,0,0,b,i),D&&Xn(D,b+C,0,c,i),Xn(f,b,0,C,i),y._22o=b,Z&&(Xn(Z,C/2-G/2,0,G,i),Z.style.cursor=V?tf:""),f.style.cursor=V?tf:"";var A=f.clientHeight/2,o=f.clientWidth;Sk(M,o,o),Xn(M,0,A-o-L,o,o),H=bc(M),ih(H,0,0,1),I.rotation=-Ek,xb(H,n,0,0,o,o),H.restore(),Sk(v,o,o),Xn(v,0,A+L,o,o),H=bc(v),ih(H,0,0,1),I.rotation=Ek,xb(H,n,0,0,o,o),H.restore()}else{if(C>i&&(C=i),g===uc)if(1===X)var O=e(s,i),z=E(0,i-C-O);else-1===X?(z=e(-s,i),O=E(0,i-C-z)):(O=N((i-C)*s),z=E(0,i-C-O));else"cl"===g?(O=0,z=E(0,i-C)):"cr"===g&&(z=0,O=E(0,i-C));r&&Xn(r,0,0,U,O),D&&Xn(D,0,O+C,U,z),Xn(f,0,O,U,C),y._22o=O,Z&&(Xn(Z,0,C/2-G/2,U,G),Z.style.cursor=V?ye:""),F.cursor=V?ye:"";var m=f.clientWidth/2,o=f.clientHeight;Sk(M,o,o),Xn(M,m-o-L,0,o,o),H=bc(M),ih(H,0,0,1),I.rotation=0,xb(H,n,0,0,o,o),H.restore(),Sk(v,o,o),Xn(v,m+L,0,o,o),H=bc(v),ih(H,0,0,1),I.rotation=Y,xb(H,n,0,0,o,o),H.restore()}F.background=l}});var Ot=function(G){this.sv=G,this.addListeners()};uj(Ot,u,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(V){var k=this,Q=k.sv,a=Q._dividerDiv,j=Q._60O,g=Q._61O,e=Q._status,o=V.target;if(o===j)e===uc?Q.setStatus("cl"):"cr"===e&&Q.setStatus(uc);else if(o===g)e===uc?Q.setStatus("cr"):"cl"===e&&Q.setStatus(uc);else if(Io(V)&&(o===a||o===Q._coverDiv)&&(lr(V),Q.isDraggable())){Q.getLeftView(),Q.getRightView();var m=k.maskDiv=Kn();if(m.style.left=0,m.style.top=0,m.style.width=Q.getWidth()+"px",m.style.height=Q.getHeight()+"px",Q.getView().appendChild(m),!Q.isContinuousLayout()){var N=k.resizeDiv=Kn();N.style.left=a.style.left,N.style.top=a.style.top,N.style.width=a.style.width,N.style.height=a.style.height,N.style.opacity=Q.getDragOpacity(),N.style.background=Q.getDividerBackground(),Bh(k.getView(),N)}k._lastAbsPosition=Q._22o,k._86o=Gj(Q)?Yi(V).x:Yi(V).y,Tl(k,V)}},handleWindowTouchMove:function(Y){Io(Y)&&this.update(Y,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(u){var B=this;B.update(u,!0),B.sv.setStatus(uc),B.maskDiv&&Qn(B.maskDiv),B.resizeDiv&&Qn(B.resizeDiv),B.maskDiv=B.resizeDiv=q},handle_mousedown:function(D){$h(D)&&this.handle_touchstart(D)},handleWindowMouseMove:function(E){this.handleWindowTouchMove(E)},handleWindowMouseUp:function(C){this.handleWindowTouchEnd(C)},update:function(s,I){var Z=this,K=Z.sv,g=Gj(K)?K.getWidth():K.getHeight(),U=K._dividerSize,m=Z._lastAbsPosition-Z._86o;Gj(K)?(m+=Yi(s).x,m>g-U&&(m=g-U),0>m&&(m=0),Z.resizeDiv&&(Z.resizeDiv.style.left=m+Zh)):(m+=Yi(s).y,m>g-U&&(m=g-U),0>m&&(m=0),Z.resizeDiv&&(Z.resizeDiv.style.top=m+Zh)),I&&g!==U&&(1===K._82O?K.setPosition(m,1):-1===K._82O?K.setPosition(m-g+U,1):K.setPosition(m/(g-U),1))}}),Jt.TabView=function(){var Z=this,X=Z._view=bn(1,Z),V=Z._91O=Kn(1),S=Z._tabModel=new Xl,n=S.sm(),N=Z.invalidate;Z._7o=new lo,Z._canvas=rs(V),Bh(X,V),Bh(X,Z._92O=Kn(1)),n.setSelectionMode(yb),n.ms(Z.handleSelectionChange,Z),S.mm(N,Z),S.mh(N,Z),S.md(N,Z),Z._interactor=new Pt(Z),Z.iv()},Kt("TabView",u,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",Cg,we,"tabHPadding","tabBackground","selectWidth",Uf,"moveBackground","insertColor"],_tabHPadding:0,_tabPosition:vg,_tabHeight:Qi,_tabGap:M.tabViewTabGap,_labelColor:M.tabViewLabelColor,_labelFont:M.tabViewLabelFont,_tabBackground:M.tabViewTabBackground,_selectWidth:M.tabViewSelectWidth,_selectBackground:M.tabViewSelectBackground,_moveBackground:M.tabViewMoveBackground,_insertColor:M.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(Q,N,z){var W,r=this._tabModel;return Q instanceof Lt?(W=Q,N&&W.setView(N)):(W=new Lt,W.setName(Q),W.setView(N)),r.add(W),z&&r.sm().ss(W),W},getLabel:function(h){return h.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(R){this._23o=R,this.iv()},get:function(T){var b=this,r=b._tabModel;if(xe(T))return r._roots.get(T);if(ro(T)){var M;return r.each(function(W){T===b.getLabel(W)&&(M=W)}),M}return T instanceof Lt?T:q},select:function(Y){this._tabModel.sm().ss(this.get(Y))},remove:function(E){var t=this;if(E=t.get(E)){var T=t._tabModel,e=T._roots.indexOf(E);t._tabModel.remove(E),t.selectByIndex(--e)}},getCurrentTab:function(){return this._8o},hideTabView:function(t,h){h.parentNode===this._92O&&(Uo(h)?(h.style.display=Yc,h._tab_=t):Qn(h),Sn())
},showTabView:function(g,k){Uo(k)&&(k.style.display="block",k._tab_=g),k.parentNode!==this._92O&&(Bh(this._92O,k),Sn())},_24o:function(){var k,c=this,v=c._8o,V=c._9o,$=c._tabModel.sm().ld();$&&(k=Ir($.getView())),k!==V&&(V&&(v.getView()&&v.getView().endEditing&&v.getView().endEditing(),c.hideTabView(v,V)),k&&c.showTabView($,k)),c._8o=$,c._9o=k,v!==$&&c.onTabChanged(v,$)},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function(_,S){this.selectByIndex(--S)},selectByIndex:function(_){var U=this,X=U._tabModel,o=X.size();if(o&&!X.sm().ld()){_==q&&(_=0),_>=o&&(_=o-1),0>_&&(_=0);for(var w=_;w>=0;w--){var M=U.get(w);if(!M.isDisabled())return U.select(M),M}for(w=_+1;o>w;w++)if(M=U.get(w),!M.isDisabled())return U.select(M),M}},getTabWidth:function(_){var T=this.getTabHPadding(),F=4+2*T,A=yd(_.getIcon());A&&(F+=Wq(A,_)+4);var O=this.getLabel(_);return O&&(F+=bi(this.getLabelFont(_),O).width+4),_.isClosable()&&(F+=10),F},drawTab:function(a,Q,E,u,C,e,x){var A,f=this,t=f._tabPosition,j=this.getTabHPadding(),B=E+4+j,z=f._selectWidth,V=yd(Q.getIcon()),b=Q.isDisabled(),R=f.getLabelColor(Q),d=f.getLabelFont(Q),W=f.getLabel(Q),J=f._selectBackground,n=t===wk+"-vertical",m=t===Bj+"-vertical";(n||m)&&(B=u+4+j),b&&(a.globalAlpha=ud),Dh(a,E,u,C,e,x),Q===f._8o&&z&&(t===vg?Dh(a,E,u+e-z,C,z,J):t===wk?Dh(a,E+C-z,u,z,e,J):t===Bj?Dh(a,E,u,z,e,J):n?Dh(a,E+C-z,u,z,e,J):m?Dh(a,E,u,z,e,J):Dh(a,E,u,C,z,J));var r=C/2;if(n&&(hi(a,r,u+e/2),Cm(a,Y),hi(a,-r,-u-e/2)),V){var l=pm(V,Q),U=Wq(V,Q);if(n||m){var K=E+C/2,$=B+l/2;hi(a,K,$),Cm(a,Ek),hi(a,-K,-$),Zb(a,V,E+C/2,B+l/2,Q,f),hi(a,K,$),Cm(a,-Ek),hi(a,-K,-$),B+=l+4}else Zb(a,V,B+U/2,u+e/2,Q,f),B+=U+4}return n||m?(hi(a,C/2,B+C/2),Cm(a,Ek),hi(a,-C/2,-B-C/2),Se(a,W,d,R,E,B,e,C),hi(a,C/2,B+C/2),Cm(a,-Ek),hi(a,-C/2,-B-C/2)):Se(a,W,d,R,B,u,C,e),n&&(hi(a,r,u+e/2),Cm(a,-Y),hi(a,-r,-u-e/2)),Q.isClosable()&&(A=m?{x:E+C-12,y:u+e-12,width:12,height:12}:{x:E+C-12,y:u+2,width:12,height:12},this.drawCloseIcon(Q,a,R,A)),b&&(a.globalAlpha=1),A},drawCloseIcon:function(f,U,e,u){var O=u.x,i=u.y;U.strokeStyle=e,U.lineWidth=1,U.beginPath(),U.moveTo(O+2,i+8),U.lineTo(O+8,i+2),U.moveTo(O+8,i+8),U.lineTo(O+2,i+2),U.stroke()},getTabAt:function(L){var Y=this._interactor._8Q(L);return Y?Y.tab:null},validateImpl:function(){var u=this;u._24o();var k,g=u._canvas,m=u._tabPosition,P=u._91O,o=u._92O,r=u._tabModel,l=u.getWidth(),w=u.getHeight(),L=u._tabHeight,h=u._7o,x=u._tabGap,b=m===vg,T=m===wk,N=m===Bj,p=m===wk+"-vertical",G=m===Bj+"-vertical",Y=u._23o,v=0;if((T||N)&&r._roots.each(function(Z){v=E(u.getTabWidth(Z),v)}),b?(Xn(P,0,0,l,L),k={x:0,y:L,width:l,height:E(0,w-L)}):T?(Xn(P,0,0,v,w),k={x:v,y:0,width:E(0,l-v),height:w}):N?(Xn(P,l-v,0,v,w),k={x:0,y:0,width:E(0,l-v),height:w}):p?(Xn(P,0,0,L,w),k={x:L,y:0,width:E(0,l-L),height:w}):G?(Xn(P,l-L,0,L,w),k={x:0,y:0,width:E(0,l-L),height:w}):(Xn(P,0,w-L,l,L),k={x:0,y:0,width:l,height:E(0,w-L)}),Xn(o,k),p||G){u._9o&&(k.x=0,Xn(u._8o.getView(),k)),Sk(g,L,w);var J=bc(g),q=0;if(ih(J,0,u.ty(),1),J.clearRect(0,0,L,w),h.clear(),r._roots.each(function(M){if(M.isVisible()){var E,w=u.getTabWidth(M);if(!Y||Y.tab!==M){var G=u.getTabBackground(M);E=u.drawTab(J,M,0,q,L,w,G)}h.add({_75o:E,tab:M,startY:q,endY:q+w,height:w}),q+=w+x}}),u._23Q=E(0,q-x),Y){var $=Y.position;u.drawTab(J,Y.tab,0,Y.startY,L,Y.height,u._moveBackground),Dh(J,0,$,L,1,u._insertColor)}if(J.restore(),u._selectionChanged){u._selectionChanged=!1;for(var n=u.ty(),j=0;j<h.size();j++){var F=h.get(j);if(F.tab===u._8o){if(F.endY+n<0){u.ty(-F.startY);break}if(F.startY+n>w){u.ty(w-F.endY);break}}}}u.ty(u.ty())}else if(T||N){u._9o&&(k.x=0,Xn(u._8o.getView(),k)),Sk(g,v,w);var J=bc(g),q=0;if(ih(J,0,u.ty(),1),J.clearRect(0,0,v,w),h.clear(),r._roots.each(function(V){if(V.isVisible()){var P;if(!Y||Y.tab!==V){var F=u.getTabBackground(V);P=u.drawTab(J,V,0,q,v,L,F)}h.add({_75o:P,tab:V,startY:q,endY:q+L,height:L}),q+=L+x}}),u._23Q=E(0,q-x),Y){var $=Y.position;u.drawTab(J,Y.tab,0,Y.startY,v,Y.height,u._moveBackground),Dh(J,0,$,v,1,u._insertColor)}if(J.restore(),u._selectionChanged){u._selectionChanged=!1;for(var n=u.ty(),j=0;j<h.size();j++){var F=h.get(j);if(F.tab===u._8o){if(F.endY+n<0){u.ty(-F.startY);break}if(F.startY+n>w){u.ty(w-F.endY);break}}}}u.ty(u.ty())}else{u._9o&&(k.y=0,Xn(u._8o.getView(),k)),Sk(g,l,L);var J=bc(g),U=0;if(ih(J,u.tx(),0,1),J.clearRect(0,0,l,L),h.clear(),r._roots.each(function(z){if(z.isVisible()){var i,q=u.getTabWidth(z);if(!Y||Y.tab!==z){var a=u.getTabBackground(z);i=u.drawTab(J,z,U,0,q,L,a)}h.add({_75o:i,tab:z,startX:U,endX:U+q,width:q}),U+=q+x}}),u._64I=E(0,U-x),Y){var $=Y.position;u.drawTab(J,Y.tab,Y.startX,0,Y.width,L,u._moveBackground),cb(J,u._insertColor,$,0,L)}if(J.restore(),u._selectionChanged){u._selectionChanged=!1;for(var f=u.tx(),j=0;j<h.size();j++){var F=h.get(j);if(F.tab===u._8o){if(F.endX+f<0){u.tx(-F.startX);break}if(F.startX+f>l){u.tx(l-F.endX);break}}}}u.tx(u.tx())}for(var y=[],z=o.children,j=0;j<z.length;j++){var V=z[j],C=V._tab_;C&&!r.contains(C)&&y.push(V)}y.forEach(function(Q){o.removeChild(Q)})}});var Pt=function(U){this.tv=U,this.addListeners()};uj(Pt,u,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(X){this.handleScroll(X,10*(X.wheelDelta/40))},handle_DOMMouseScroll:function(A){this.handleScroll(A,10*-A.detail)},handleScroll:function(j,$){lr(j);var y=this.tv,w=y._tabPosition;!y._40o()||w!==vg&&w!==rj||y.tx(this.tv.tx()+$),!y._41o()||w!==wk&&w!==Bj&&w!==wk+"-vertical"&&w!==Bj+"-vertical"||y.ty(this.tv.ty()+$)},_8Q:function(i){var M,z,b=this.tv,G=b._tabPosition,D=b._7o;if(G===vg||G===rj){var r=b.lp(i).x;for(M=0;M<D.size();M++)if(z=D.get(M),z.startX<=r&&r<=z.endX)return z}else if(G===wk||G===Bj||G===wk+"-vertical"||G===Bj+"-vertical"){var P=b.lp(i).y;for(M=0;M<D.size();M++)if(z=D.get(M),z.startY<=P&&P<=z.endY)return z}return q},isClickable:function(R){var C=this.tv,U=C._tabPosition,S=this._73o=this._8Q(R);return!C._40o()||U!==vg&&U!==rj?!C._41o()||U!==wk&&U!==Bj&&U!==wk+"-vertical"&&U!==Bj+"-vertical"?S&&(!S.tab.isDisabled()||C.isMovable()):!0:!0},handle_mousemove:function(F){var D=this;Yl?D._74o=D._8Q(F):D.getView().style.cursor=D.isClickable(F)?cd:""},handle_mousedown:function(z){this.handle_mousemove(z),this.handle_touchstart(z)},handle_touchstart:function(f){var Z=this,N=Z.tv,E=N._tabPosition;lr(f),$h(f)&&Z.isClickable(f)&&(E===vg||E===rj?(Z.x=Yi(f).x,Z.lp=N.lp(f),Z.tx=N.tx()):(Z.y=Yi(f).y,Z.lp=N.lp(f),Z.ty=N.ty()),Tl(Z,f))},handle_mouseup:function(S){this.handle_touchend(S)},handle_touchend:function(D){if($i(D)){var R=this._73o;if(!R)return;var e=this.tv,c=e.getTabModel(),W=R.tab;if(!W.isDisabled()&&W.isClosable()){var n=function(){var H=c._roots.indexOf(W);c.remove(W),e.onTabClosed(W,H)};e.onTabClosing(W,n)&&n()}}},handleWindowMouseMove:function(z){this.handleWindowTouchMove(z)},handleWindowTouchMove:function(f){var l,G=this,N=G.tv,H=N._tabPosition,d=G._73o;if(H===vg||H===rj){if(l=Yi(f).x-G.x,!G._25o&&!G.moving&&D(l)>2&&(N._40o()&&!qp(f)?G._25o=1:d&&N.isMovable()&&(G.moving=1)),G._25o)N.tx(G.tx+l);else if(G.moving){var r=G.lp.x+l,z=N._tabGap/2;N._7o.each(function(v){var H=v.endX,h=r-v.startX<H-r;r>=v.startX&&H>=r&&N._7Q({tab:d.tab,startX:d.startX+l,width:d.width,front:h,insertTab:v.tab,position:h?E(0,v.startX-z):e(N._64I,H+z)})})}}else if(l=Yi(f).y-G.y,!G._25o&&!G.moving&&D(l)>2&&(N._41o()&&!qp(f)?G._25o=1:d&&N.isMovable()&&(G.moving=1)),G._25o)N.ty(G.ty+l);else if(G.moving){var q=G.lp.y+l,z=N._tabGap/2;N._7o.each(function(D){var x=D.endY,I=q-D.startY<x-q;q>=D.startY&&x>=q&&N._7Q({tab:d.tab,startY:d.startY+l,height:d.height,front:I,insertTab:D.tab,position:I?E(0,D.startY-z):e(N._23Q,x+z)})})}},handleWindowMouseUp:function(s){this.handleWindowTouchEnd(s)},handleWindowTouchEnd:function(){var g=this,E=g.tv,f=E._tabPosition,Y=E.getTabModel(),d=Y._roots,r=g._73o;if(g.moving){var X=E._23o;if(X&&X.insertTab!==X.tab){var F=X.tab,G=d.remove(F),p=d.indexOf(X.insertTab);p>=0&&(X.front||p++,p<=d.size()&&(d.add(F,p),Y._38I(F,G,p)))}E._7Q(q),delete g.moving}else if(!g._25o&&r){F=r.tab;var e=g._74o;if(!e||e.tab===F)if(!F.isDisabled()&&Do(r._75o,g.lp)){var a=function(){var h=d.indexOf(F);Y.remove(F),E.onTabClosed(F,h)};E.onTabClosing(F,a)&&a()}else F.isDisabled()||E._8o===F||Y.sm().ss(F)}g._25o=g._73o=g._74o=f===vg||f===rj?g.x=g.lp=g.tx=q:g.y=g.lp=g.ty=q}}),Jt.PropertyView=function(S){var n=this;n._view=bn(1,n),n._canvas=rs(n._view),Bh(n._view,n._79O=Kn()),n._rows=new lo,n._28o=new lo,n._26o={},n._26Q={};var A=n._propertyModel=new Xl,D=n.ivm;A.mm(D,n),A.md(D,n),A.mh(D,n),n.dm(S?S:new Xl),new Qt(n)},Kt("PropertyView",u,{ms_ac:[Cg,tb,we,cn,Yp,"categorizable",Qk,vc,_q,Gp,Rc,Vd,Ij,Lh,"selectRowIndex",Uf,"background",vj,vq,zn,ec,xd],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:Wb,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:Ro,_background:M.propertyViewBackground,_expandIcon:M.propertyViewExpandIcon,_collapseIcon:M.propertyViewCollapseIcon,_scrollBarColor:lg,_scrollBarSize:Jp,_autoHideScrollBar:yi,_selectBackground:M.propertyViewSelectBackground,_rowHeight:Zq,_rowLineVisible:M.propertyViewRowLineVisible,_rowLineColor:M.propertyViewRowLineColor,_10I:.5,_columnLineVisible:M.propertyViewColumnLineVisible,_columnLineColor:M.propertyViewColumnLineColor,_labelColor:M.propertyViewLabelColor,_labelSelectColor:M.propertyViewLabelSelectColor,_labelFont:M.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(t){0>t&&(t=0),t>1&&(t=1);var b=this,O=b._10I;b._10I=t,b.fp("columnPosition",O,t)},getPropertyName:function(r){return r.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(m,O,G){return G===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(N,p){return p===this._selectRowIndex?this._labelSelectColor:N.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function($){var _=this.getHeight()-this._59I;return _>$&&($=_),$>0?0:N($)},isExpanded:function(h){if(!h)return!0;var t=this._26o[h];return t?t.isExpanded:!(this._26Q[h]===!1)},toggle:function(c){var C=this;C.isExpanded(c)?C.collapse(c):C.expand(c)},expandAll:function(){this.validate();for(var s in this._26o)this.expand(s)},expand:function(r){if(r&&r!==Yc){var Y=this,R=Y._26o[r];R&&!R.isExpanded&&(R.isExpanded=!0,Y.onExpanded(r),Y.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var O in this._26o)this.collapse(O)},collapse:function(K){if(K&&K!==Yc){var c=this,a=c._26o[K];a&&a.isExpanded&&(a.isExpanded=!1,c.onCollapsed(K),c.ivm())}},onCollapsed:function(){},getCategoryName:function(i){if(!this.isCategorizable())return Yc;var g=i.getCategoryName();return g?g:Yc},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(u){var C=this,D=C._dataModel;D!==u&&(D&&(D.umd(C.handlePropertyChange,C),C._selectionModel||D.sm().ums(C.handleSelectionChange,C)),C._dataModel=u,u.md(C.handlePropertyChange,C),C._selectionModel?C._selectionModel._21I(u):u.sm().ms(C.handleSelectionChange,C),C.fp(Sl,D,u))},isVisible:function(G){return this._visibleFunc?this._visibleFunc(G):!0},onPropertyChanged:function(J){var s=this,B=J.property;Et[B]?s.ivm():s.iv(),B===Fd&&s._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:ni},handlePropertyChange:function(Q){this._27o===Q.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var Z=this;Z._96I||(Z.setSelectRowIndex(-1),Z._96I=1,Z.iv())},redraw:function(){this.iv()},validateModel:function(){var N=this,Z=N._rows,Y=N._28o,U={},t=new lo,$=N._27o;N.updateCurrentData(),$!==N._27o&&N.endEditing(),Z.clear(),Y.clear(),N.getRawProperties().each(function(I){if(N.isVisible(I)){t.add(I);var c=N.getCategoryName(I);U[c]||(Y.add(c,c===Yc?0:A),U[c]={isExpanded:N.isExpanded(c),properties:new lo})}}),N._sortFunc&&t.sort(N._sortFunc);for(var a in N._26o)N._26Q[a]=N.isExpanded(a);N._26o=U,Y.each(function(c){c!==Yc&&Z.add(c);var f=U[c];f.isExpanded&&t.each(function(i){N.getCategoryName(i)===c&&(f.properties.add(i),Z.add({property:i,data:N._27o}))},N)})},validateImpl:function(){var S=this;S._76o(),S._96I&&(S.validateModel(),delete S._96I);var U=S._canvas,P=S.getWidth(),k=S.getHeight(),m=-S.ty(),l=S._rowHeight,M=S._indent,p=P-M,b=S._rows,i=b.size(),u=S._9I=M+p*S._10I,z=S._59I=i*l;Sk(U,P,k),S._29I={x:0,y:m,width:P,height:k},S._31I=L(m/l),S._14I=y((m+k)/l),S._31I<0&&(S._31I=0),S._14I>i&&(S._14I=i);var X,_=bc(U),N=S._background;ih(_,0,-m,1),_.beginPath(),_.rect(0,m,P,k),_.clip(),_.clearRect(0,m,P,k),S._93db(_),N&&Dh(_,0,0,M,z,N);for(var n=S._31I;n<S._14I;n++){var x=b.get(n),m=l*n;if(ro(x))N&&Dh(_,M,m,p,l,N),X=yd(S.isExpanded(x)?S._expandIcon:S._collapseIcon),X&&jl(_,X,Ng,0,m,M,l),_.save(),_.beginPath(),_.rect(M,m,p,l),_.clip(),S.drawCategoryName(_,x,n,M,m,p,l),_.restore();else{var W=x.property,f=x.data,X=yd(W.getIcon()),t=S._selectRowIndex===n?S.getSelectBackground():q;if(X&&jl(_,X,Ng,0,m,M,l),t&&Dh(_,M,m,p,l,t),_.save(),_.beginPath(),_.rect(M,m,u-M,l),_.clip(),S.drawPropertyName(_,W,n,M,m,u-M,l),_.restore(),!S.isEditing(f,W)){var v=u+1,C=P-u-1;_.save(),_.beginPath(),_.rect(v,m,C,l),_.clip(),S._87o(S.drawPropertyValue(_,W,S.getValue(f,W),n,v,m,C,l,f),n,v,m,C,l),_.restore()}}S._rowLineVisible&&Dh(_,M,m+l-1,p,1,S._rowLineColor)}S._columnLineVisible&&(Dh(_,u,0,1,z,S._columnLineColor),Dh(_,P-1,0,1,z)),S._92db(_),S._93I(),_.restore(),S.ty(S.ty())},drawCategoryName:function(O,i,V,d,s,k,t){Se(O,i,this.getCategoryFont(i),this.getCategoryColor(i),d,s,k,t)},drawPropertyName:function(N,X,F,T,R,P,s){return X.drawPropertyName?(X.drawPropertyName(N,X,F,T,R,P,s,this),void 0):(Se(N,this.getPropertyName(X),this.getPropertyFont(X,F),this.getPropertyColor(X,F),T,R,P,s),void 0)},drawPropertyValue:function(h,m,x,P,a,i,D,M,o){return m.drawPropertyValue?m.drawPropertyValue(h,m,x,P,a,i,D,M,o,this):(Gt(h,x,m,this.getLabelFont(m,x,P),this.getLabelColor(m,x,P),a,i,D,M,o,this),void 0)},isPropertyEditable:function(D){return D.isEditable()&&this.isEditable()},setProperties:function(l){this._propertyModel.clear(),this.addProperties(l)},addProperties:function($){if($){var u=this._propertyModel;$.forEach(function(Z){if(!(Z instanceof Nt)){var v=jq(Z.className);Z=hb(v?v:Nt,Z)}u.add(Z)})}},getRowIndexAt:function(Q){var I=this,F=L(I.lp(Q).y/I._rowHeight);return F>=0&&F<I._rows.size()?F:-1},getPropertyAt:function(J){var i=this,O=i.getRowIndexAt(J);return O>=0?i._rows.get(O).property:q},getToolTip:function(k){var d=this,M=d.getPropertyAt(k),Z=d._27o;return M&&Z?M.getToolTip(Z,d._9I<d.lp(k).x,d):q}});var Qt=function(Y){this.pv=Y,this.addListeners()};uj(Qt,u,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(F){this.getView().style.cursor=F},clear:function(){var Z=this;Z._62O=Z.cp=Z.ty=Z.p=q,Z.setCursor(mf)},handle_mousedown:function(p){this.handle_touchstart(p)},handle_touchstart:function(H){var K=this,o=K.pv;lr(H),o.setFocus(H)&&($h(H)?(K.cp=Yi(H),K.ty=o.ty(),K.p=o.getColumnPosition(),K.handle_touchmove(H)):o.setSelectRowIndex(o.getRowIndexAt(H)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(h){this.handle_touchend(h)},handle_touchend:function(q){var m=this;if(m.cp&&!m._62O){var $=m.pv,A=$.lp(q),p=A.x,N=A.y,D=$._indent,E=$.getRowIndexAt(q),n=$._9I;if(E>=0){var v=$._rowHeight,k=v*E,x=$._rows.get(E),r=x.property;if(ro(x))yd($.isExpanded(x)?$._expandIcon:$._collapseIcon)&&p>=0&&D>=p&&N>=k&&k+v>=N?$.toggle(x):zr(q)&&$.toggle(x);else if(p>n&&$.isPropertyEditable(r,q)){var T={x:n+1,y:k,width:$.getWidth()-n-1,height:v},w={x:T.x+$.tx(),y:T.y+$.ty(),width:T.width,height:T.height},R=0,V=$._29I;T.y<V.y?R=T.y-V.y:T.y+v>V.y+V.height&&(R=T.y+v-V.y-V.height),R&&($.ty($.ty()-R),w.y-=R),$.beginEditing({data:x.data,property:r,value:$.getValue(x.data,r),event:q,rect:T,editorRect:w,view:$})}}$.setSelectRowIndex(E)}m.clear()},handleWindowMouseMove:function($){this.handleWindowTouchMove($)},handleWindowTouchMove:function(y){var W=this,L=W.pv,Z=W.ty,u=W.cp,O=Yi(y),g=W._62O;if("p"===g)L.setTranslateY(Z+O.y-u.y);else if("c"===g){var f=L.getWidth()-L._indent;if(f>16){var S=W.p-(u.x-O.x)/f,k=16/f;k>S&&(S=k),S>1-k&&(S=1-k),L.setColumnPosition(S)}}else"s"===g&&L.setTranslateY(Z+(u.y-O.y)*L._59I/L._29I.height)},handle_mousemove:function(i){this.handle_touchmove(i)},handle_touchmove:function(F){if(!Yl&&$h(F)){var f=this,R=f.pv,e=D(R.lp(F).x-R._9I)<=(lf?8:3);f.cp?f._62O||(e?(f._62O="c",Tl(f,F)):D(Yi(F).y-f.cp.y)>=2&&(f._62O=f.isV(F)?"s":"p",Tl(f,F))):(e?f.setCursor(tf):f.setCursor(mf),f.isV(F)&&R._43o())}},isV:function(A){var F=this.pv,U=F._29I;return F._41o()&&U.x+U.width-F.lp(A).x<Ym},handle_mousewheel:function(E){this.handleScroll(E,E.wheelDelta/40)},handle_DOMMouseScroll:function(M){2===M.axis&&this.handleScroll(M,-M.detail)},handleScroll:function(B,r){var T=this.pv;lr(B),T.endEditing(),T.translate(0,r*T.getRowHeight())},handle_keydown:function(P){var p=this.pv,o=p._rows.size(),Z=p._selectRowIndex+(zg(P)?-1:1);(zg(P)||Pk(P))&&(0>Z&&(Z=0),Z>=o&&(Z=o-1),p.setSelectRowIndex(Z))}}),Jt.ListView=function(u){this._5o(u),new Rt(this)},Kt("ListView",u,{ms_ac:[Cg,tb,we,vj,Qk,vq,zn,vc,_q,Vd,Ij,Lh,Ig,Uf],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:Ro,_rowHeight:Zq,_rowLineVisible:M.listViewRowLineVisible,_rowLineColor:M.listViewRowLineColor,_scrollBarColor:lg,_scrollBarSize:Jp,_autoMakeVisible:_f,_autoHideScrollBar:yi,_selectBackground:M.listViewSelectBackground,_labelColor:M.listViewLabelColor,_labelSelectColor:M.listViewLabelSelectColor,_labelFont:M.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(N){var G=this,m=G._checkMode;G._checkMode=N,G.fp(Fb,m,N)},drawRow:function(C,a,k,G,V,R,l){var n=this,p=0,B=n._indent,r=n.getIconWidth(a);n.drawRowBackground(C,a,k,G,V,R,l),n._checkMode&&(Zb(C,yd(n.getCheckIcon(a)),p+B/2,V+l/2,a,n),p+=B),n.drawIcon(C,a,p,V,r,l),n.drawLabel(C,a,p+r,V,l)}});var Rt=function(r){this.list=r,this.addListeners()};uj(Rt,u,{ms_listener:1,getView:function(){return this.list._view},clear:function(f){var W=this,z=W.list;f&&"d"===W._62O&&!W.dragCancel&&z.handleDragAndDrop(f,"end"),z.draggingData&&(z.draggingData=null,z.redraw()),W.dragCancel=W._62O=W._isV=W._isH=W.cp=W.tx=W.ty=q},handle_mousedown:function(_){this.handle_touchstart(_)},handle_touchstart:function(F){var n=this,r=n.list;if(lr(F),r.setFocus(F)){var E=r.getDataAt(F);n.cp=Yi(F),n.tx=r.tx(),n.ty=r.ty(),$h(F)?E&&r.handleDragAndDrop&&!n.isV(F)&&!n.isH(F)&&r.isDraggable(E)&&(r.draggingData=E,r.redraw(),r.handleDragAndDrop(F,"prepare")):(E?n._33o(F,E):this._cancelDataDoubleSelect(),n.clear(F))}},handleWindowMouseUp:function(i){this.clear(i)},handleWindowTouchEnd:function(A){this.clear(A)},handle_mouseup:function(f){this.handle_touchend(f)},handle_touchend:function(i){var J=this,W=J.list;if(!J._isV&&!J._isH&&J.cp&&!J._62O){var t=W.getDataAt(i);t?(W.isCheckMode()?J._34o(i,t):J._33o(i,t),zr(i)?W.onDataDoubleClicked(t,i):W.onDataClicked(t,i)):(J._cancelDataDoubleSelect(),W.handleBackgroundClick(i))}J.clear(i)},handleWindowMouseMove:function(f){this.handleWindowTouchMove(f)},handleWindowTouchMove:function(P){var x=this,u=x.list,K=x._62O,a=x.tx,O=x.ty,N=x.cp,D=Yi(P),o=u._29I;"p"===K?u.setTranslate(a+D.x-N.x,O+D.y-N.y):"v"===K?u.ty(O+(N.y-D.y)*u._59I/o.height):"h"===K?u.tx(a+(N.x-D.x)*u._91I/o.width):"d"===K&&(x.dragCancel||u.handleDragAndDrop(P,"between"))},handle_mousemove:function(A){this.handle_touchmove(A)},handle_touchmove:function(Z){if(!Yl&&$h(Z)){var O=this,n=O.list;if(O._isV=O.isV(Z),O._isH=O.isH(Z),O.cp){if(!O._62O){if(Hh(Yi(Z),O.cp)<2)return;O._isV?O._62O="v":O._isH?O._62O="h":n.draggingData&&!this.dragCancel?(O._62O="d",n.handleDragAndDrop(Z,"begin")):O._62O="p",O._62O&&"d"!==O._62O&&n.draggingData&&(n.draggingData=null,n.redraw()),Tl(O,Z)}}else O._isV&&n._43o(),O._isH&&n._42o()}},isV:function(G){var a=this.list,y=a._29I;return a._41o()&&y.x+y.width-a.lp(G).x<Ym},isH:function(m){var F=this.list,D=F._29I;return F._40o()&&D.y+D.height-F.lp(m).y<Ym},handle_mousewheel:function(t){this.handleScroll(t,t.wheelDelta/40,t.wheelDelta!==t.wheelDeltaX)},handle_DOMMouseScroll:function(n){this.handleScroll(n,-n.detail,1)},handleScroll:function(H,l,_){var r=this.list;lr(H),r.endEditing&&r.endEditing(),_&&r._41o()?r.translate(0,l*r.getRowHeight()):r._40o()&&r.translate(10*l,0)},handle_keydown:function(U){if(!M.isInput(U.target)){var P,n=this.list,$=n.sm(),H=n._rows,W=H.size();if(jc(U))n.selectAll();else if(hj(U))n.handleDelete&&n.handleDelete(U);else if($q(U))"d"!==this._62O||this.dragCancel||(n.handleDragAndDrop(U,"cancel"),this.dragCancel=!0);else if(Yo(U))n.isCheckMode()&&(P=n.getFocusData(),P&&n.checkData(P));else if(zg(U)||Pk(U)){var i=n.isCheckMode();if(P=i?n.getFocusData():$.ld()){var v=n.getRowIndex(P);v>=0&&(zg(U)?0!==v&&(P=H.get(v-1),i?n.setFocusData(P):$.ss(P)):v!==W-1&&(P=H.get(v+1),i?n.setFocusData(P):$.ss(P)))}else W>0&&(P=H.get(0),i?n.setFocusData(P):$.ss(P))}}},_34o:function(H,q){var J=this.list,Q=J.lp(H).x;return Q>=0&&Q<=J._indent?(J.checkData(q),void 0):(J.setFocusData(q),void 0)},_33o:function(n,p){var z=this.list,l=z.sm(),S=l.ld();if(!z.canHandleSelectMode(n,p))return this._cancelDataDoubleSelect(),void 0;if(qp(n))z.isSelected(p)?l.rs(p):l.as(p);else if(ck(n))if(S)for(var E=z.getRowIndex(S),A=z.getRowIndex(p);E!==A;)E+=A>E?1:-1,l.as(z._rows.get(E));else l.ss(p);else $h(n)?(l.contains(p)?z.handleDataDoubleSelect&&(this._handleDataDoubleSelect(n,p),zr(n)&&this._cancelDataDoubleSelect()):this._cancelDataDoubleSelect(),l.ss(p)):l.contains(p)||l.ss(p)},_handleDataDoubleSelect:function(Z,$){this._cancelDataDoubleSelect(),this._doubleSelectTimer=Zl(function(){this.list.handleDataDoubleSelect(Z,$),this._doubleSelectTimer=A}.bind(this),M.doubleClickSpeed)},_cancelDataDoubleSelect:function(){this._doubleSelectTimer&&(hh(this._doubleSelectTimer),this._doubleSelectTimer=A)}}),Jt.TreeView=function(T){var P=this;P._35o(),P._5o(T),new St(P)},Kt("TreeView",u,{ms_ac:[Cg,tb,we,"rootVisible",Fb,"rootData",vc,_q,Vd,Ij,Lh,Qk,vj,vq,zn,Gp,Rc,Ig,Uf,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:q,_indent:Ro,_rowHeight:Zq,_rowLineVisible:M.treeViewRowLineVisible,_rowLineColor:M.treeViewRowLineColor,_scrollBarColor:lg,_scrollBarSize:Jp,_autoHideScrollBar:yi,_expandIcon:M.treeViewExpandIcon,_collapseIcon:M.treeViewCollapseIcon,_autoMakeVisible:_f,_selectBackground:M.treeViewSelectBackground,_labelColor:M.treeViewLabelColor,_labelSelectColor:M.treeViewLabelSelectColor,_labelFont:M.treeViewLabelFont,_doubleClickToToggle:M.treeViewDoubleClickToToggle,drawRow:function(j,x,U,K,L,V,o){var h=this;h.drawRowBackground(j,x,U,K,L,V,o),h.drawTree(j,x,U,0,L,V,o)},isOnToggleIcon:function(n){var H=this.getDataAt(n);if(H){var m=this.getIndent(),W=this.lp(n).x;if(yd(this.getToggleIcon(H))){var I=m*this.getLevel(H);if(W>=I&&I+m>=W)return!0}}return!1}});var St=function(Y){Vq(St,this,[Y])};uj(St,Rt,{toggle:function(V,P,a,q){var e=this.list,i=e.lp(V).x;if(yd(e.getToggleIcon(P))){var x=a*q;if(i>=x&&x+a>=i)return e.toggle(P),!0}return e.isDoubleClickToToggle()&&zr(V)?(e.toggle(P),!0):!1},_34o:function(B,O){var s=this.list,Q=s.lp(B).x,A=s._levelMap[O._id],M=s._indent,j=M*(A+1);return Q>=j&&j+M>=Q?(s.checkData(O),void 0):(this.toggle(B,O,M,A)||s.setFocusData(O),void 0)},_33o:function(n,o){var L=this,C=L.list;if(!L.toggle(n,o,C._indent,C.getLevel(o)))if(ck(n)){var A=C.sm();if(A.size()>0){for(var T=C._rows,u=null,c=0,i=T.size();i>c;c++)if(C.isSelected(T.get(c))){u=c;break}for(var h=null,c=T.size()-1;c>=0;c--)if(C.isSelected(T.get(c))){h=c;break}var l,x,N=C.getRowIndex(o);for(u>N?(l=N-1,x=u):N>h?(l=h,x=N):(l=u,x=h);l!==x;)l++,A.as(C._rows.get(l))}else A.ss(o)}else St.superClass._33o.call(L,n,o)},handle_keydown:function(S){if(lp(S)||Up(S)){var V=this.list,F=V._rows,o=V.isCheckMode(),C=V.sm(),n=o?V.getFocusData():C.ld();n?n.hasChildren()&&(lp(S)?V.collapse(n):V.expand(n)):F.size()>0&&(n=F.get(0),o?V.setFocusData(n):C.ss(n))}else St.superClass.handle_keydown.call(this,S)}});var Tt=Jt.TableView=function(r){this._98I(),this._5o(r),new Ut(this)};Kt("TableView",u,{ms_ac:[Cg,tb,we,"sortMode",cn,Yp,vj,vq,zn,ec,xd,"sortColumn",vc,_q,Vd,Ij,Lh,Ig,Uf],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:Gk,_editable:!0,_batchEditable:!1,_rowHeight:Zq,_rowLineVisible:M.tableViewRowLineVisible,_rowLineColor:M.tableViewRowLineColor,_columnLineVisible:M.tableViewColumnLineVisible,_columnLineColor:M.tableViewColumnLineColor,_scrollBarColor:lg,_scrollBarSize:Jp,_autoHideScrollBar:yi,_autoMakeVisible:_f,_selectBackground:M.tableViewSelectBackground,_labelColor:M.tableViewLabelColor,_labelSelectColor:M.tableViewLabelSelectColor,_labelFont:M.tableViewLabelFont,getCheckColumn:function(){var w=this;if(!w._31o){var z=w._31o=new Mt;z.setEditable(!0),z.setWidth(40),z.getValue=w.getCheckColumValue,z.drawCell=w.drawCheckColumnCell}return w._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(U){var p=this,i=p._39o,v=p.getCheckColumn();U!==p.isCheckMode()&&(U?i.add(v,0):i.remove(v),p.fp(Fb,!U,U))},getCheckColumValue:function(h,X,u){return u.isSelected(h)},drawCheckColumnCell:function(W,f,r,n,y,v,q,D,L){Zb(W,L.getCheckIcon(f),y+q/2,v+D/2,f,L)}});var Ut=function(v){Vq(Ut,this,[v])};uj(Ut,Rt,{_34o:function(B,J){var v=this.list,l=v._31o;if(v.isCellEditable(J,l,B)){var V=v._3Q(l),j=v.lp(B).x;if(V&&j>=V.startX&&j<V.startX+l.getWidth())return v.checkData(J),void 0}v._37O(J,B),v.setFocusData(J)},_33o:function(U,s){this.list._37O(s,U),Ut.superClass._33o.apply(this,arguments)}});var Vt=Jt.TreeTableView=function(x){var k=this,m=k._4o=new Mt;k._35o(),k._98I(),k._5o(x),m.setDisplayName("Name"),m.setEditable(!0),m.setWidth(180),m.drawCell=Wt,m.getValue=Xt,k._39o.add(m),new Yt(k)},Wt=function(c,M,X,g,v,s,e,W,N){N.drawTree(c,M,X,v,s,e,W)},Xt=function(G,Y,$){return $.getLabel(G)};Kt("TreeTableView",u,{ms_ac:[Cg,tb,we,"sortMode",cn,Yp,Qk,Fb,"rootData","rootVisible",vc,_q,"sortColumn",Gp,Rc,Vd,Ij,Lh,Ig,zn,vj,vq,ec,xd,Uf,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:Gk,_checkMode:q,_editable:!0,_batchEditable:!1,_indent:Ro,_rowHeight:Zq,_rowLineVisible:M.treeTableViewRowLineVisible,_rowLineColor:M.treeTableViewRowLineColor,_columnLineVisible:M.treeTableViewColumnLineVisible,_columnLineColor:M.treeTableViewColumnLineColor,_expandIcon:M.treeTableViewExpandIcon,_collapseIcon:M.treeTableViewCollapseIcon,_scrollBarColor:lg,_scrollBarSize:Jp,_autoHideScrollBar:yi,_autoMakeVisible:_f,_selectBackground:M.treeTableViewSelectBackground,_labelColor:M.treeTableViewLabelColor,_labelSelectColor:M.treeTableViewLabelSelectColor,_labelFont:M.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var Yt=function(G){Vq(Yt,this,[G])};uj(Yt,Rt,{_34o:function(O,g){var o=this.list,H=o._4o,h=o._3Q(H),d=o.lp(O).x;if(h){var m=o._indent,n=h.startX+m*o.getLevel(g);if(yd(o.getToggleIcon(g))&&d>=n&&n+m>=d)return o.toggle(g),void 0;if(o.isCellEditable(g,H)&&(n+=m,d>=n&&n+m>=d))return o.checkData(g),void 0}o._37O(g,O),o.setFocusData(g)},_33o:function(X,e){var h=this.list,G=h.lp(X).x;if(yd(h.getToggleIcon(e))){var r=h._3Q(h._4o);if(r){var q=h._indent,d=r.startX+q*h.getLevel(e);if(G>=d&&d+q>=G)return h.toggle(e),void 0}}h._37O(e,X),Yt.superClass._33o.apply(this,arguments)}});var Zt=Jt.TableHeader=function(h){var e=this,U=e._view=bn(1,e),L=e._39o=h.getColumnModel(),$=e.iv;e.tv=e._tableView=h,e._60I=new lo,e._canvas=rs(U),U.style.background=M.tableHeaderBackground||"",U.style.height=Nb+Zh,L.mm($,e),L.md($,e),L.mh($,e),h.mp(function(j){At[j.property]&&e.iv()},e),new $t(e),e.iv()};Kt("TableHeader",u,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",Cg,we,Qk,"moveBackground","insertColor",ec,xd,"resizable","movable"],_checkIcon:gq,_movable:!0,_resizable:!0,_labelColor:M.tableHeaderLabelColor,_labelFont:M.tableHeaderLabelFont,_columnLineColor:M.tableHeaderColumnLineColor,_columnLineVisible:M.tableHeaderColumnLineVisible,_sortDescIcon:M.tableHeaderSortDescIcon,_sortAscIcon:M.tableHeaderSortAscIcon,_moveBackground:M.tableHeaderMoveBackground,_insertColor:M.tableHeaderInsertColor,_indent:Ro,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(o){return o.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(k){return k.getColor()||this._labelColor},getLabelAlign:function($){return $._align},onPropertyChanged:function(){this.iv()},_5Q:function(B){this._61I=B,this.iv()},getLogicalPoint:function(l){return Hk(l,this._canvas,this.tv.tx())},validateImpl:function(){var s=this,L=s._canvas,D=s.getWidth(),r=s.getHeight(),j=s.tv,c=s._60I,i=s._61I,I=-j.tx(),N=0;(D!==L.clientWidth||r!==L.clientHeight)&&Sk(L,D,r),c.clear(),s._39o._roots.each(function(W){if(W.isVisible()){var y=N+W.getWidth();I+D>=N&&y>=I&&c.add({column:W,startX:N}),N=y}});var y=bc(L);if(ih(y,-I,0,1),y.beginPath(),y.rect(I,0,D,r),y.clip(),y.clearRect(I,0,D,r),c.each(function(l){var K=l.column,R=l.startX,J=K.getWidth();J>0&&(y.save(),y.beginPath(),y.rect(R,0,J,r),y.clip(),i&&i.column===K||s.drawColumn(y,K,R,0,J,r),s._columnLineVisible&&Dh(y,R+J-1,0,1,r,s._columnLineColor),y.restore())}),i){var z=i.column,N=i.startX,C=i.position,S=z.getWidth();y.save(),y.beginPath(),y.rect(N,0,S,r),y.clip(),y.fillStyle=s._moveBackground,y.fill(),s.drawColumn(y,z,N,0,S,r),y.restore(),cb(y,s._insertColor,C,0,r)}y.restore()},_6Q:function(m){var b=this.tv;return b._31o===m&&b.sm().getSelectionMode()===Yf},drawColumn:function(o,e,g,Z,m,c){var W=this,U=W.tv,P=yd(e.getIcon()),r=W.getLabelAlign(e);if(W._6Q(e)){var N=yd(W._checkIcon);Zb(o,N,g+m/2,Z+c/2,e,W)}else{var T=W.getLabel(e),Q=W.getLabelFont(e),k=W.getLabelColor(e),b=bi(Q,T).width,s=P?W._indent:0;r===wk?(P&&jl(o,P,Ng,g,Z,s,c),Se(o,T,Q,k,g+s,Z,m,c,wk)):r===Bj?(P&&jl(o,P,Ng,g+m-b-s,Z,s,c),Se(o,T,Q,k,g,Z,m,c,Bj)):(P&&jl(o,P,Ng,g+(m-b-s)/2,Z,s,c),Se(o,T,Q,k,g+(m-b+s)/2,Z,0,c,wk))}if(e.isSortable()&&U.getSortColumn()===e&&(P=yd(e.getSortOrder()===ys?W._sortAscIcon:W._sortDescIcon))){var M=Wq(P,e)/2+2;Zb(o,P,r===Bj?g+M:g+m-M,Z+c/2,e,U)}}});var $t=function(z){var x=this;x.th=z,x.tv=z._tableView,x.addListeners()};uj($t,u,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(z){this.getView().style.cursor=z},handle_mousemove:function(o){if(!Yl){var U=this;delete U._29o,U.setCursor(mf);for(var g=U.th,E=g._60I,h=g.lp(o).x,Y=E.size()-1;Y>=0;Y--){var B=E.get(Y),e=B.column,L=B.startX+e.getWidth();if(g.isResizable()&&D(L-h)<=(lf?10:3))return U._29o=B,U.setCursor(tf),void 0;h>B.startX&&L>h&&(U._29o=B),(e.isClickable()||e.isSortable()||g.isMovable()||U.tv.getCheckColumn&&e===U.tv.getCheckColumn())&&h>B.startX&&L>h&&U.setCursor(cd)}}},handle_mousedown:function(E){this.handle_touchstart(E)},handle_touchstart:function(k){var s=this;lr(k),s.tv.endEditing(),s.handle_mousemove(k),s._29o&&(s.x=Yi(k).x,s.lx=s.th.lp(k).x,s.w=s._29o.column.getWidth(),Tl(s,k))},handleWindowMouseMove:function(l){this.handleWindowTouchMove(l)},handleWindowTouchMove:function(j){var L=this,C=L.th,n=L.getView().style.cursor,p=L._29o,b=Yi(j).x-L.x;if(L.resizing||L.moving||(n===tf?L.resizing=1:C.isMovable()&&n===cd&&D(b)>2&&(L.moving=1)),L.resizing)p.column.setWidth(L.w+b);else if(L.moving){var B=L.lx+b;C._60I.each(function(v){var I=v.startX,t=I+v.column.getWidth();if(B>=I&&t>=B){var H={column:p.column,startX:p.startX+b,front:t-B>B-I,insertColumn:v.column};H.position=H.front?I:t,C._5Q(H)
}})}},_16Q:function(r,h){var Q=this,D=Q.tv,E=Q.th,i=E._checkIcon;if(E._6Q(r)){var k=yd(i),m=Q.lx,T=r.getWidth(),t=Wq(k,r);if(m>=h+T/2-t&&h+T/2+t>=m){E.setCheckIcon(i===kc?gq:kc);var y=D.sm(),g=D._rows;return i===kc?y.rs(g):y.ss(g),D.onCheckColumnClicked(r),!0}}return!1},handleWindowMouseUp:function(K){this.handleWindowTouchEnd(K)},handleWindowTouchEnd:function(X){var t=this,W=t.tv,e=t.th,K=t._29o;if(t.moving){var B=e._61I;if(B&&B.insertColumn!==B.column){var s=B.column,m=W.getColumnModel()._roots,G=m.remove(s),Y=m.indexOf(B.insertColumn);Y>=0&&(B.front||Y++,Y<=m.size()&&(m.add(s,Y),W.getColumnModel()._38I(s,G,Y)))}e._5Q(q),delete t.moving}else if(!t.resizing&&K){s=K.column;var Z=e.lp(X).x,p=K.startX,w=!0;if(e.onColumnClicked){var I=e.onColumnClicked(s,X,p);I===!1&&(w=!1)}if(w&&Z>=p&&Z<=p+s.getWidth()&&!t._16Q(s,p)){if(s.isSortable()){var C=W.getSortMode(),z=s.getSortOrder();C===Gk?W.getSortColumn()===s?(z===on&&W.setSortColumn(q),s.setSortOrder(z===ys?on:ys)):W.setSortColumn(s):"bistate"===C&&(W.getSortColumn()===s?s.setSortOrder(z===ys?on:ys):W.setSortColumn(s))}W.onColumnClicked(s,X,p)}}t._29o=t.resizing=t.x=t.lx=t.w=q}}),Jt.TablePane=function($){this.init(new Tt($))},Kt("TablePane",u,{ms_v:1,_44o:1}),Jt.TreeTablePane=function(h){this.init(new Vt(h))},Kt("TreeTablePane",u,{ms_v:1,_44o:1}),Jt.Toolbar=function(L){var X=this,S=X._view=bn(1,X),U=S.style;U.background=M.toolbarBackground||"",U.height=Qi+Zh,X._canvas=rs(S),X._30o=new lo,X._90I=new lo,X.setItems(L||[]),S.handleGroupSelectedChanged=function(i){if(i.isSelected()){var N=i.getGroupId();null!=N&&X._items.forEach(function(V){var q=V.element;q&&q!==i&&q.setSelected&&q.getGroupId&&q.getGroupId()===N&&q.setSelected(!1)})}},new _t(X)},Kt("Toolbar",u,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[fi,Cg,we,tb,Uf,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:M.toolbarLabelColor,_labelSelectColor:M.toolbarLabelSelectColor,_labelFont:M.toolbarLabelFont,_selectBackground:M.toolbarSelectBackground,_itemGap:M.toolbarItemGap,_separatorColor:M.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(R){var l=this.getItemInfoAt(R);return l?l.item.toolTip:q},getLabelColor:function(b){return b&&b.selected&&b.type!==kc&&b.type!==Ul?this._labelSelectColor:this._labelColor},onPropertyChanged:function(f){this.iv(),f.property===fi&&this._items.forEach(function(G){tg(G)})},redraw:function(){this.iv()},addItem:function(p,G){var I=this._items;G==q?I.push(p):I.splice(G,0,p),this.fp(fi,q,I)},removeItem:function(F){if(F)for(var g=this._items,h=0;h<g.length;h++)F===g[h]&&(g.splice(h,1),this.fp(fi,q,g))},removeItemById:function(y){if(y!=q)for(var i=this._items,M=0;M<i.length;M++)if(y===i[M].id){var G=i.splice(M,1)[0];return this.fp(fi,q,i),G}},getItemById:function(z){if(z!=q)for(var O=this._items,D=0;D<O.length;D++){var x=O[D];if(z===x.id)return x}},setItemVisible:function(T,t){var h=this.getItemById(T);h&&(h.visible=t)},getItemInfos:function(){return this._30o},getItemInfoAt:function(H){var s=this,L=0,t=s._30o,N=s.lp(H),Q=N.x,M=N.y;if(M>=0&&M<=s.getHeight())for(;L<t.size();L++){var f=t.get(L);if(f.startX<=Q&&Q<=f.endX)return f}return q},drawItem:function(H,o,Q,D,M){if(o.visible===!1)return 0;if(hc(o.visible)&&!o.visible())return 0;var W=this,V=o.disabled;V&&(H.globalAlpha=ud);var e=W.drawItemImpl(H,o,Q,D,M),J=W._itemGap;return V&&(H.globalAlpha=1),this._currentItem!==o||"separator"===o||o.separator===!0||o.unfocusable||Co(H,W._separatorColor,Q-J/2,0,e+J,D),e},drawItemImpl:function(L,$,e,m,P){var Z=this,d=Z._view,I=Z._itemGap,t=m/2,D=$.type,w=$.element,i=$.label;ro(w)&&(i=w,w=q);var j,o=Z.getLabelFont($),B=Z.getLabelColor($),Y=$.selected,A=yd($.icon),S=Wq(A,$),C=0,X=S+(i?bi(o,i).width:0);if("separator"===$||$.separator===!0)return cb(L,Z._separatorColor,e,m/4,t),1;if(w){A&&Zb(L,A,e+S/2,t,$,Z),Se(L,i,o,B,e+S,0,0,m);var W=Ir(w);P||Z._90I.add(W),W.parentNode!==d&&Bh(d,W),w.iv&&w.iv(),w.validate&&w.validate();var b=W.getBoundingClientRect(),h=b.width,M=W.style;return br(W),M.left=Z.tx()+e+X+Zh,M.top=(m-b.height)/2+Zh,X+h}return D===Ul?j=yd(Y?gp:Jg):D===kc&&(j=yd(Y?kc:gq)),j?(C=Wq(j,$),Zb(L,j,e+C/2,t,$,Z),e+=C,X+=C):Y&&Dh(L,e-I/2,0,X+I,m,Z.getSelectBackground($)),A&&Zb(L,A,e+S/2,t,$,Z),Se(L,i,o,B,e+S,0,0,m),X},validateImpl:function(){var Z=this,w=Z._canvas,S=Z.getWidth(),b=Z.getHeight(),f=Z._30o,o=Z._items;Sk(w,S,b);var s=bc(w),t=Z._itemGap,J=t/2;ih(s,Z.tx(),0,1),s.clearRect(0,0,S,b);var G=Z._90I;Z._90I=new lo,f.clear(),o.forEach(function(O){var P=Z.drawItem(s,O,J,b);f.add({item:O,startX:J,endX:J+P,width:P}),P&&(J+=P+t)}),G.each(function(B){Z._90I.contains(B)||Qn(B)});var R=Z._64I;Z._64I=E(0,J-t/2),s.restore(),Z._stickToRight?(Z._65O=0,s=bc(w),J=S-Z._64I+t/2,ih(s,0,0,1),s.clearRect(0,0,S,b),f.clear(),o.forEach(function(n){var i=Z.drawItem(s,n,J,b,!0);f.add({item:n,startX:J,endX:J+i,width:i}),i&&(J+=i+t)}),s.restore()):Z.tx(Z.tx()),R!==Z._64I&&Z.onSumWidthChanged(R,Z._64I)},onSumWidthChanged:function(){},handleClick:function(W,y){var n=this,D=W.type,v=W.action,f=W.groupId,O=W.selected;W.disabled||(f!=q?O||(W.selected=!0,this._items.forEach(function(L){L.groupId===f&&W!==L&&(L.selected=!1)}),v&&W.action(W,n,y)):D===kc||"toggle"===D?(W.selected=!O,v&&W.action(W,n,y)):v&&W.action(W,n,y)),Sn(),n.iv()}});var _t=function(p){this.tb=p,this.addListeners()};uj(_t,u,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(I){this.handleScroll(I,10*(I.wheelDelta/40))},handle_DOMMouseScroll:function(U){this.handleScroll(U,10*-U.detail)},handleScroll:function(F,r){lr(F);var y=this.tb;y.isScrollable()&&!y._stickToRight&&(y.tx(y.tx()+r),Th())},handle_mousemove:function(i){var u=this;Yl||u.setItem(i)},handle_mouseout:function(R){var I=this;R.target===I.getView()?I.tb.setCurrentItem(q):I.handle_mousemove(R)},handle_mousedown:function(K){this.handle_mousemove(K),this.handle_touchstart(K)},handle_touchstart:function(P){var y=this,$=y.tb,l=P.target;$h(P)&&(l===y.getView()||l===$._canvas)&&(lr(P),$.setFocus(P)&&(this.setItem(P,!0),($.isScrollable()||y.info&&!y.info.item.disabled)&&(y.x=Yi(P).x,y.tx=$.tx(),Tl(y,P))))},handleWindowMouseMove:function(E){this.handleWindowTouchMove(E)},handleWindowTouchMove:function(Z){var M=this,t=M.tb;if(!t._stickToRight){var L=Yi(Z).x-M.x;!M._25o&&D(L)>2&&t.isScrollable()&&(M._25o=1),M._25o&&t.tx(M.tx+L)}},handleWindowMouseUp:function(E){this.handleWindowTouchEnd(E)},handleWindowTouchEnd:function(f){var j=this,e=j.tb,V=j.info,K=j.tb.getItemInfoAt(f);if(!j._25o&&V){var E=V.item;K&&K.item===E&&e.handleClick(E,f)}j._25o=j.x=j.tx=q,j.setItem()},setItem:function($,x){var c=this,Y=c.tb,F=c.info=$?Y.getItemInfoAt($):q,v=F?F.item:q;Y.setCurrentItem(v),x&&v&&hc(v.onDown)&&v.onDown($)}}),Jt.BorderPane=function(){this._view=bn(1,this),this.iv()},Kt("BorderPane",u,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(s,D){this._12o("leftView",s),D!=q&&this.setLeftWidth(D)},getRightView:function(){return this._rightView},setRightView:function(y,h){this._12o("rightView",y),h!=q&&this.setRightWidth(h)},getTopView:function(){return this._topView},setTopView:function(C,Y){this._12o("topView",C),Y!=q&&this.setTopHeight(Y)},getBottomView:function(){return this._bottomView},setBottomView:function(y,x){this._12o("bottomView",y),x!=q&&this.setBottomHeight(x)},getCenterView:function(){return this._centerView},setCenterView:function(x){this._12o("centerView",x)},_12o:function(T,O){var p=this,b="_"+T,P=p._view,R=p[b];R!==O&&(R&&(R.getView?Qn(R.getView()):Qn(R)),p[b]=O,O&&(O.getView?Bh(P,O.getView(),1):Bh(P,O,1)),p.fp(T,R,O))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var j=this,L=j._topView,C=j._bottomView,V=j._leftView,z=j._rightView,O=j._centerView,k=j.getWidth(),Q=j.getHeight(),D=0,n=0,v=k,e=Q,d=0,X=0,g=0,$=0;L&&(d=j._topHeight==q?Zi(L):j._topHeight,n=d),C&&(X=j._bottomHeight==q?Zi(C):j._bottomHeight,e=Q-X),V&&(g=j._leftWidth==q?De(V):j._leftWidth,D=g),z&&($=j._rightWidth==q?De(z):j._rightWidth,v=k-$);var G=E(0,v-D),t=E(0,e-n);L&&Xn(L,0,0,k,d),C&&Xn(C,0,e,k,X),V&&Xn(V,0,n,g,t),z&&Xn(z,v,n,$,t),O&&Xn(O,D,n,G,t)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);