!function(X,u,n){"use strict";var I=X.ht;I.Astar={},function($){var T=$();X.AStar=T.astar,X.AStar.Graph=T.Graph}(function(){function Z(H){for(var i=H,l=[];i.parent;)l.unshift(i),i=i.parent;return l}function e(){return new s(function(v){return v.f})}function c(b,O){O=O||{},this.nodes=[],this.diagonal=!!O.diagonal,this.grid=[];for(var F=0;F<b.length;F++){this.grid[F]=[];for(var H=0,W=b[F];H<W.length;H++){var w=new h(F,H,W[H]);this.grid[F][H]=w,this.nodes.push(w)}}this.$13x()}function h(c,t,f){this.x=c,this.y=t,this.weight=f}function s(w){this.content=[],this.scoreFunction=w}var S={search:function(x,d,g,P){x.$6x(),P=P||{};var H=P.heuristic;H||(H=x.diagonal?S.$4x.diagonal:S.$4x.manhattan);var t=P.closest||!1,E=P.punish,k=e(),M=d;for(d.h=H(d,g),x.$7x(d),k.push(d);k.size()>0;){var v=k.pop();if(v===g)return Z(v);v.closed=!0;for(var c=x.neighbors(v),K=0,X=c.length;X>K;++K){var J=c[K];if(!J.closed&&!J.$9x()){var A=v.g+J.getCost(v,E),r=J.visited;(!r||A<J.g)&&(J.visited=!0,J.parent=v,J.h=J.h||H(J,g),J.g=A,J.f=J.g+J.h,x.$7x(J),t&&(J.h<M.h||J.h===M.h&&J.g<M.g)&&(M=J),r?k.$10x(J):k.push(J))}}}return t?Z(M):[]},$4x:{manhattan:function(G,S){var C=Math.abs(S.x-G.x),Q=Math.abs(S.y-G.y);return C+Q},diagonal:function(c,N){var E=1,j=Math.sqrt(2),L=Math.abs(N.x-c.x),R=Math.abs(N.y-c.y);return E*(L+R)+(j-2*E)*Math.min(L,R)}},$5x:function(K){K.f=0,K.g=0,K.h=0,K.visited=!1,K.closed=!1,K.parent=null}};return c.prototype.$13x=function(){this.dirtyNodes=[];for(var j=0;j<this.nodes.length;j++)S.$5x(this.nodes[j])},c.prototype.$6x=function(){for(var C=0;C<this.dirtyNodes.length;C++)S.$5x(this.dirtyNodes[C]);this.dirtyNodes=[]},c.prototype.$7x=function(Y){this.dirtyNodes.push(Y)},c.prototype.neighbors=function(Q){var $=[],J=Q.x,P=Q.y,A=this.grid;return A[J-1]&&A[J-1][P]&&$.push(A[J-1][P]),A[J+1]&&A[J+1][P]&&$.push(A[J+1][P]),A[J]&&A[J][P-1]&&$.push(A[J][P-1]),A[J]&&A[J][P+1]&&$.push(A[J][P+1]),this.diagonal&&(A[J-1]&&A[J-1][P-1]&&$.push(A[J-1][P-1]),A[J+1]&&A[J+1][P-1]&&$.push(A[J+1][P-1]),A[J-1]&&A[J-1][P+1]&&$.push(A[J-1][P+1]),A[J+1]&&A[J+1][P+1]&&$.push(A[J+1][P+1])),$},c.prototype.toString=function(){for(var t=[],F=this.grid,W=0;W<F.length;W++){for(var i=[],M=F[W],c=0;c<M.length;c++)i.push(M[c].weight);t.push(i.join(" "))}return t.join("\n")},h.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},h.prototype.getCost=function(D,x){var i;if(i=D&&D.x!=this.x&&D.y!=this.y?1.41421*this.weight:this.weight,x){var R=D;if(!R)return i;var X=R.parent;if(!X)return i;if(Math.abs(X.x+this.x-2*R.x)>1e-5)return i+x;if(Math.abs(X.y+this.y-2*R.y)>1e-5)return i+x}return i},h.prototype.$9x=function(){return 0===this.weight},s.prototype={push:function(w){this.content.push(w),this.$11x(this.content.length-1)},pop:function(){var r=this.content[0],k=this.content.pop();return this.content.length>0&&(this.content[0]=k,this.$12x(0)),r},remove:function(f){var Z=this.content.indexOf(f),M=this.content.pop();Z!==this.content.length-1&&(this.content[Z]=M,this.scoreFunction(M)<this.scoreFunction(f)?this.$11x(Z):this.$12x(Z))},size:function(){return this.content.length},$10x:function(x){this.$11x(this.content.indexOf(x))},$11x:function(d){for(var C=this.content[d];d>0;){var n=(d+1>>1)-1,L=this.content[n];if(!(this.scoreFunction(C)<this.scoreFunction(L)))break;this.content[n]=C,this.content[d]=L,d=n}},$12x:function(v){for(var R=this.content.length,o=this.content[v],L=this.scoreFunction(o);;){var Z,w=v+1<<1,$=w-1,B=null;if(R>$){var x=this.content[$];Z=this.scoreFunction(x),L>Z&&(B=$)}if(R>w){var s=this.content[w],E=this.scoreFunction(s);(null===B?L:Z)>E&&(B=w)}if(null===B)break;this.content[v]=this.content[B],this.content[B]=o,v=B}}},{astar:S,Graph:c}});var K=I.Astar.Finder=function(E,J){var o=this;o.gv=E,o.$13x(J),o.refreshMap()};K.prototype={},K.prototype.constructor=K,u.defineProperties(K.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(K){this.gv._astarDebugInfo=K}}}),K.prototype.$13x=function(J){var r=this,x=r.$14x={};J=J||{};var c=J.gridSize||10;x.gridSizeX=J.gridSizeX||c,x.gridSizeY=J.gridSizeY||c,x.rect=J.rect,x.filter=J.filter,x.extendBlocks=J.extendBlocks||3,x.fastOverlap=J.fastOverlap===n?!0:J.fastOverlap,x.nodeRectExtend=J.nodeRectExtend||0,x.diagonal=J.diagonal===n?!0:J.diagonal,x.turnPunish=J.turnPunish===n?.1:J.turnPunish,x.simplify=J.simplify===n?!0:J.simplify,x.toGridCenter=J.toGridCenter===n?!1:J.toGridCenter,x.closest=J.closest===n?!0:J.closest},K.prototype.refreshMap=function(){var K,l=this,j=l.$14x,d=j.gridSizeX,v=j.gridSizeY,_=j.extendBlocks;j.rect?K=j.rect:(K=l.$15x(),I.Default.grow(K,d*_,v*_)),I.Default.grow(K,d,v);var x=Math.floor(K.x/d)*d,S=Math.floor(K.y/v)*v,c=Math.ceil(K.width/d),O=Math.ceil(K.height/v),t=c*d,Z=O*v;l.$16x={x:x,y:S,w:t,h:Z,gridX:d,gridY:v,xLen:c,yLen:O},l.$17x(),l.$21x()},K.prototype.$15x=function(){var h=this.gv;if(h instanceof I.graph.GraphView)return h.getContentRect();var l,U=I.Default.unionRect;return h.dm().each(function(z){h.isVisible(z)&&z.getRect&&(l=U(l,z.getRect()))}),l},K.prototype.$17x=function(){var U,o,d,b,u=this,x=u.$16x,S=x.xLen,T=x.yLen;for(U=new Array(S),d=0;S>d;d++)for(U[d]=o=new Array(T),b=T;b--;)o[b]=1;var A=u.$14x.filter;for(u.gv.dm().each(function(R){A&&A(R)===!1||(!u._debugInfo||R!==u._debugInfo.grid&&R!=u._debugInfo.path)&&u.$1cw(U,R)}),d=0;S>d;d++)U[d][0]=1,U[d][T-1]=1;for(b=0;T>b;b++)U[0][b]=1,U[S-1][b]=1;u.grid=U;var C=new AStar.Graph(U,{diagonal:u.$14x.diagonal});u.graph=C},K.prototype.$18x=function(q,y,w,p,i,E,z,W){var Y=this.$19x,J=Y(w-q,i-z,p-y,E-W);if(1e-6>=J&&J>=-1e-6)return!1;var H=Y(i-q,i-z,E-y,E-W)/J;if(0>H||H>1)return!1;var e=Y(w-q,i-q,p-y,E-y)/J;return 0>e||e>1?!1:!0},K.prototype.$19x=function(Q,t,_,j){return Q*j-t*_},K.prototype.$1aw=function(f,E,i,l){for(var T=[-(E[1]-f[1]),E[0]-f[0]],e=T[0]*(i[0]-f[0])+T[1]*(i[1]-f[1])>=0,d=0,K=l.length;K>d;d+=2)if(T[0]*(l[d]-f[0])+T[1]*(l[d+1]-f[1])>=0===e)return!1;return!0},K.prototype.$1bw=function(c,R){for(var X,w,t=this,F=0,W=c.length;W>F;F+=2)if(X=F===W-2?0:F+2,w=X===W-2?0:X+2,t.$1aw([c[F],c[F+1]],[c[X],c[X+1]],[c[w],c[w+1]],R))return!1;for(var F=0,W=R.length;W>F;F+=2)if(X=F===W-2?0:F+2,w=X===W-2?0:X+2,t.$1aw([R[F],R[F+1]],[R[X],R[X+1]],[R[w],R[w+1]],c))return!1;return!0},K.prototype.$1cw=function($,h){if(h.getRect){var _=this,S=h.getRect();I.Default.grow(S,_.$14x.nodeRectExtend);var t,O,p,z,W,u,M,P,D,J,r,B=_.$1dw({x:S.x,y:S.y}),i=_.$1dw({x:S.x+S.width,y:S.y+S.height}),R=_.$14x.fastOverlap;if(!R){var k=h.getCorners();M=[],k.forEach(function(a){M.push(a.x,a.y)}),J=_.$14x.gridSizeX/2,r=_.$14x.gridSizeY/2}for(O=Math.max(0,B.x),p=Math.min(i.x,$.length-1),W=Math.max(0,B.y),u=Math.min(i.y,$.length?$[0].length-1:-1),t=O;p>=t;t++)for(z=W;u>=z;z++)if(R)$[t][z]=0;else{D=_.$1ew({x:t,y:z});var Z=D.x-J,Y=D.x+J,b=D.y-r,a=D.y+r;P=[Z,b,Z,a,Y,a,Y,b],_.$1bw(M,P)&&($[t][z]=0)}}},K.prototype.$1dw=function(D,j){var _=this,d=_.$16x,l=(D.x-d.x)/d.gridX,f=(D.y-d.y)/d.gridY;return j!==!1&&(l=Math.round(l),f=Math.round(f)),{x:l,y:f}},K.prototype.$1ew=function(g){var y=this,a=y.$16x;return{x:g.x*a.gridX+a.x,y:g.y*a.gridY+a.y}},K.prototype.$1fw=function(i){var J=this,V=J.$16x,y=V.xLen,z=V.yLen;if(i.x>=0&&i.x<y&&i.y>=0&&i.y<z)return i;var l={x:i.x,y:i.y};return l.x<0?l.x=0:l.x>=y&&(l.x=y-1),l.y<0?l.y=0:l.y>=z&&(l.y=z-1),l},K.prototype.findPath=function(B,q){var c,K,U,i,w=this,p=w.$1dw(B),u=w.$1dw(q);if(U=w.$1fw(p),i=w.$1fw(u),U!==p&&i!==u){var F=w.$16x,Q=F.x-F.gridX/2,G=F.y-F.gridY/2,A=Q+F.gridX*F.xLen,g=G+F.gridY*F.yLen;if(!(w.$18x(B.x,B.y,q.x,q.y,Q,G,A,G)||w.$18x(B.x,B.y,q.x,q.y,A,G,A,g)||w.$18x(B.x,B.y,q.x,q.y,A,g,Q,g)||w.$18x(B.x,B.y,q.x,q.y,Q,g,Q,G)))return[B,q]}U!==p&&(c=!0,p=U),i!==u&&(K=!0,u=i);var P=w.graph.grid[p.x][p.y],n=w.graph.grid[u.x][u.y],s=AStar.search(w.graph,P,n,{closest:w.$14x.closest,punish:w.$14x.turnPunish});if(!s||!s.length)return null;var I=[];I.push(B),c&&I.push(w.$1ew(s[0]));for(var J=1,H=s.length;H-1>J;J++)I.push(w.$1ew(s[J]));if(K)I.push(w.$1ew(s[H-1])),I.push(q);else{var x=s[H-1];u.x!==x.x||u.y!==x.y||w.$14x.toGridCenter?I.push(w.$1ew(x)):I.push(q)}return w.$14x.simplify&&(I=w.simplifyPath(I)),w.$20x=I,w.$21x(),I},K.prototype.debugOn=function(r){this.debugFlag=!0,this.debugSettings=r||{},this.$21x()},K.prototype.simplifyPath=function(B){var V=B.length;if(2>=V)return B;var w,r,T=[B[0],B[1]],z=T[0],f=T[1],U=1e-5;for(w=2;V>w;w++)r=B[w],Math.abs((f.x-z.x)*(r.y-z.y)-(f.y-z.y)*(r.x-z.x))<U?f=T[T.length-1]=r:(z=f,f=r,T.push(r));return T},K.prototype.$21x=function(){var r=this;if(r.$22x(),this.debugFlag){var V=r.grid;if(V){var q,n=r.gv;if(r.debugSettings.$16x!==!1){q=[];for(var l,T,o,K,Z,b=[],N=r.$14x.gridSizeX/2,Y=r.$14x.gridSizeY/2,U=V.length,A=U?V[0].length:0,u=1;U-1>u;u++)for(var M=1;A-1>M;M++)V[u][M]||(l=r.$1ew({x:u,y:M}),T=l.x-N,o=l.x+N,K=l.y-Y,Z=l.y+Y,q.push({x:T,y:K},{x:T,y:Z},{x:o,y:Z},{x:o,y:K}),b.push(1,2,2,2,5));var y=new I.Shape;y.s("shape.border.color","rgba(50, 50, 50, 0.2)"),y.s("shape.border.width",1),y.s("shape.background","rgba(200, 50, 100, 0.2)"),y.s("2d.editable",!1),y.s("2d.selectable",!1),y.setPoints(q),y.setSegments(b),r._debugInfo={grid:y},n.dm().add(y)}r.debugSettings.path!==!1&&(q=new I.Shape,r.$20x&&(q.setPoints(r.$20x),q.s("shape.border.color","red"),q.s("shape.border.width",1),q.s("2d.editable",!1),q.s("2d.selectable",!1),q.s("shape.background",null),r._debugInfo||(r._debugInfo={}),r._debugInfo.path=q,n.dm().add(q)))}}},K.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},K.prototype.$22x=function(){var b=this;if(b._debugInfo){var R=b._debugInfo.grid,L=b._debugInfo.path,g=b.gv;R&&g.dm().remove(R),L&&g.dm().remove(L),b._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);