!function(K,F){"use strict";var B="ht",d=B+".layout.",n=K[B]||module.parent.exports.ht,S=n.List,j=n.DataModel,A=n.Node,e=n.Edge,E=n.Group,M=Math,y=M.sqrt,D=M.random,w=M.max,p=M.min,f=function(q){return q*q};n.Default.getInternal().addMSMap({ms_force:function($){$._interval=50,$._stepCount=10,$._motionLimit=.01,$._edgeRepulsion=.65,$._nodeRepulsion=.65,$._damper=1,$._maxMotion=0,$._motionRatio=0,$.init=function(w){var N=this;w instanceof j?N.dm=w:N.gv=w,N._nodeMap={},N._nodes=new S,N._edges=new S},$.start=function(){var E=this,C=E.gv;if(!E._timer){var w=E.cdm=C?C.dm():E.dm;w.mm(E.handleDataModelChange,E),w.md(E.handleDataPropertyChange,E),C&&C.mp(E.handleGV,E),w.each(function(V){if(E.isVisible(V)&&E.isLayoutable(V)&&V instanceof A)if(E instanceof N){var m=V.p3();V.p3([m[0]+D(),m[1]+D(),m[2]+D()])}else m=V.p(),V.p(m.x+D(),m.y+D())}),E._timer=setInterval(function(){E.relax()},E._interval),E._damper=1}},$.stop=function(){var c=this;c._timer&&(c.cdm.umm(c.handleDataModelChange,c),c.cdm.umd(c.handleDataPropertyChange,c),c.gv&&c.gv.ump(c.handleGV,c),clearInterval(c._timer),delete c._timer,delete c.cdm)},$.handleGV=function(u){var J=this;if("dataModel"===u.property){var j=u.oldValue,w=u.newValue;j&&(j.umm(J.handleDataModelChange,J),j.umd(J.handleDataPropertyChange,J)),this.cdm=w,w.mm(J.handleDataModelChange,J),w.md(J.handleDataPropertyChange,J)}},$.relax=function(){var Z=this;if(!(Z._damper<.1&&Z._maxMotion<Z._motionLimit)){this.cdm.each(function(F){Z.isVisible(F)&&(F instanceof e?Z.addEdge(F):F instanceof A&&Z.addNode(F))});for(var J,E,K=0,W=Z._edges,c=Z._nodes,b=c.size();K<Z._stepCount;K++){for(W.each(Z.relaxEdge,Z),J=0;b>J;J++)for(E=0;b>E;E++)Z.relaxNode(c.get(J),c.get(E));Z.moveNode()}Z._isAdjusting=1,c.each(function(y){y.fix||(y.p?y.v.p3(y.p):y.v.p(y.x,y.y))}),delete Z._isAdjusting,Z._nodeMap={},c.clear(),W.clear(),Z.onRelaxed()}},$.onRelaxed=function(){},$.isRunning=function(){return!!this._timer},$.isVisible=function(b){return b.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(b):!0},$.isLayoutable=function(P){if(P.s("layoutable")===!1)return!1;if(P instanceof E)return!1;var c=this;return c.gv?c.gv.isMovable(P)&&!c.gv.isSelected(P):!(c.cdm||c.dm).sm().co(P)},$.getNodeRepulsion=function(){return this._nodeRepulsion},$.setNodeRepulsion=function(s){this._nodeRepulsion=s,this._damper=1},$.getEdgeRepulsion=function(){return this._edgeRepulsion},$.setEdgeRepulsion=function(r){this._edgeRepulsion=r,this._damper=1},$.getStepCount=function(){return this._stepCount},$.setStepCount=function(g){this._stepCount=g,this._damper=1},$.getInterval=function(){return this._interval},$.setInterval=function(u){var e=this;e._interval!==u&&(e._interval=u,e._timer&&(clearInterval(e._timer),e._timer=setInterval(function(){e.relax()},u)))},$.handleDataPropertyChange=function(C){!this._isAdjusting&&this.isVisible(C.data)&&(this._damper=1)},$.handleDataModelChange=function(){this._damper=1},$.damp=function(){var X=this._maxMotion,y=this._damper;this._motionRatio<=.001&&((.2>X||X>1&&.9>y)&&y>.01?this._damper-=.01:.4>X&&y>.003?this._damper-=.003:y>1e-4&&(this._damper-=1e-4)),X<this._motionLimit&&(this._damper=0)}}}),n.layout.ForceLayout=function(Z){this.init(Z)},n.Default.def(d+"ForceLayout",F,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(g){this._limitBounds=g,this._damper=1},getNodeSize:function(j){var Q=this.gv;return Q&&Q.getDataUIBounds?Q.getDataUIBounds(j):j.getRect()},addNode:function(X){var $=this,n=$._nodeMap[X._id];if(n)return n;var z=X.p();n={v:X,x:z.x,y:z.y,dx:0,dy:0,fix:!$.isLayoutable(X),s:$.getNodeSize(X)};var E=n.s,K=y(f(E.width)+f(E.height))*$._nodeRepulsion;return n.r=1>K?100:K,$._nodeMap[X._id]=n,$._nodes.add(n),n},addEdge:function(C){if(C._40I&&C._41I){var O=this,J=O.addNode(C._40I),L=O.addNode(C._41I),p={s:J,t:L};L=L.s,J=J.s;var w=L.width+J.width,D=L.height+J.height;p.length=y(w*w+D*D)*O._edgeRepulsion,p.length<=0&&(p.length=100),O._edges.add(p)}},relaxEdge:function(g){var E=g.t,G=g.s,L=E.x-G.x,q=E.y-G.y,o=y(L*L+q*q),x=100*g.length,w=.25*L/x*o,s=.25*q/x*o;E.dx=E.dx-w,E.dy=E.dy-s,G.dx=G.dx+w,G.dy=G.dy+s},relaxNode:function(l,m){if(l!==m){var d=0,o=0,g=l.x-m.x,P=l.y-m.y,v=g*g+P*P;0===v?(d=D(),o=D()):36e4>v&&(d=g/v,o=P/v);var k=l.r*m.r/400;d*=k,o*=k,l.dx+=d,l.dy+=o,m.dx-=d,m.dy-=o}},moveNode:function(){var E=this,D=E._limitBounds,O=E._maxMotion,$=0,i=E._damper;E._nodes.each(function(g){if(!g.fix){var R=g.dx*i,I=g.dy*i;if(g.dx=R/2,g.dy=I/2,$=w(y(R*R+I*I),$),g.x+=w(-40,p(40,R)),g.y+=w(-40,p(40,I)),D){g.x<D.x&&(g.x=D.x,E.adjust(1,0)),g.y<D.y&&(g.y=D.y,E.adjust(0,1));var j=g.s;g.x+j.width>D.x+D.width&&(g.x=D.x+D.width-j.width,E.adjust(-1,0)),g.y+j.height>D.y+D.height&&(g.y=D.y+D.height-j.height,E.adjust(0,-1))}}}),E._maxMotion=$,E._motionRatio=$>0?O/$-1:0,E.damp()},adjust:function(J,b){var v=this._limitBounds;this._nodes.each(function(F){J>0?(!v||F.x+F.s.width+J<v.x+v.width)&&(F.x+=J):(!v||F.x+J>v.x)&&(F.x+=J),b>0?(!v||F.y+F.s.height+b<v.y+v.height)&&(F.y+=b):(!v||F.y+b>v.y)&&(F.y+=b)})}});var N=n.layout.Force3dLayout=function(K){this.init(K)};n.Default.def(d+"Force3dLayout",F,{ms_force:1,getNodeSize3d:function(v){return v.s3()},addNode:function(Q){var d=this,L=d._nodeMap[Q._id];if(L)return L;L={v:Q,p:Q.p3(),d:[0,0,0],fix:!d.isLayoutable(Q),s:d.getNodeSize3d(Q)};var N=L.s,M=n.Default.getDistance(N)*d._nodeRepulsion;return L.r=1>M?100:M,d._nodeMap[Q._id]=L,d._nodes.add(L),L},addEdge:function(r){if(r._40I&&r._41I){var d=this,O=d.addNode(r._40I),c=d.addNode(r._41I),A={s:O,t:c};c=c.s,O=O.s,A.length=y(f(c[0]+O[0])+f(c[1]+O[1])+f(c[2]+O[2]))*d._edgeRepulsion,A.length<=0&&(A.length=100),d._edges.add(A)}},relaxEdge:function(G){var O=G.t.p,c=G.s.p,p=G.t.d,m=G.s.d,Q=O[0]-c[0],o=O[1]-c[1],i=O[2]-c[2],H=y(Q*Q+o*o+i*i),t=100*G.length,v=.25*Q/t*H,I=.25*o/t*H,X=.25*i/t*H;p[0]-=v,p[1]-=I,p[2]-=X,m[0]+=v,m[1]+=I,m[2]+=X},relaxNode:function(x,M){if(x!==M){var J=x.p,u=M.p,I=0,t=0,m=0,E=J[0]-u[0],p=J[1]-u[1],R=J[2]-u[2],g=E*E+p*p+R*R;0===g?(I=D(),t=D(),m=D()):216e6>g&&(I=E/g,t=p/g,m=R/g);var H=x.r*M.r/400,f=x.d,y=M.d;I*=H,t*=H,m*=H,f[0]+=I,f[1]+=t,f[2]+=m,y[0]-=I,y[1]-=t,y[2]-=m}},moveNode:function(){var G=this,I=G._maxMotion,$=0,k=G._damper;G._nodes.each(function(D){if(!D.fix){var E=D.p,t=D.d,e=t[0]*k,o=t[1]*k,m=t[2]*k;t[0]=e/2,t[1]=o/2,t[2]=m/2,$=w(y(e*e+o*o+m*m),$),E[0]+=w(-40,p(40,e)),E[1]+=w(-40,p(40,o)),E[2]+=w(-40,p(40,m))}}),G._maxMotion=$,G._motionRatio=$>0?I/$-1:0,G.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);