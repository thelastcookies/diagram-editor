!function(G,f,s){"use strict";function e(G){var n,F=G.key.toLowerCase(),L=G.keyCode;return L>=65&&90>=L?(n=String.fromCharCode(L).toLowerCase(),n!==F?n:F):L>=48&&57>=L?(n=String.fromCharCode(L),n!==F&&(F=n),F):L>=96&&105>=L?(n=String.fromCharCode(L-48),n!==F&&(F=n),"numpad"+F):(n=l[L],n!==s?n:F)}function b(p){var s=0;if("keydown"===p.type)p.ctrlKey&&(s+=8),p.metaKey&&(s+=4),p.altKey&&(s+=2),p.shiftKey&&(s+=1);else if("keyup"===p.type){s=i;var t=T(e(p));"control"===t&&8&s?s-=8:"meta"===t&&4&s?s-=4:"alt"===t&&2&s?s-=2:"shift"===t&&1&s&&(s-=1)}i=s}function T(P){return"spacebar"===P?P=" ":["left","right","up","down"].indexOf(P)>=0?P="arrow"+P:"os"===P?P="meta":"help"===P&&(P="insert"),P}function U(H,E){W(H)&&(H=H.split(" + "));var B=H.length,U=0;if(E)U=16;else for(var O=0;B-1>O;O++){var F=H[O].toLowerCase(),R=Y[F];null!=R&&(U+=1<<R)}var q=T(H[B-1].toLowerCase());return U+"_"+q}function P(M,s){var F=0;M.ctrlKey&&(F+=8),M.metaKey&&(F+=4),M.altKey&&(F+=2),M.shiftKey&&(F+=1),s&&(F=16);var d=T(e(M));return F+"_"+d}var O="ht",d=G[O],m=d.Default,W=m.isString,F=d.Default.isFunction,k=(d.Default.clone,"ctrl"),w="meta",r="alt",p="shift",l={192:"`",189:"-",187:"=",219:"[",221:"]",220:"\\",186:";",222:"'",188:",",190:".",191:"/",111:"numpad/",106:"numpad*",109:"numpad-",107:"numpad+",110:"numpad.",32:" "},i=0;G.addEventListener("keydown",b,!0),G.addEventListener("keyup",b,!0);var Y={};Y[k]=3,Y[w]=2,Y[r]=1,Y[p]=0,d.ShortcutManager=function(){this._actionMap={},this._lastEvent=s,this._keyEventNotifier=new d.Notifier,this._target=s,this._global=!1,this._stopPropagation=!1},m.def("ht.ShortcutManager",f,{registerShortcut:function(M,H,N){M&&(M=U(M,N),F(H)&&(H={action:H}),this._actionMap[M]=H)},unregisterShortcut:function(n,c){n&&(n=U(n,c),this._actionMap[n]=s)},clearShortcuts:function(){this._actionMap={},this._keyEventNotifier=new d.Notifier},enableShortcut:function(L){this.disableShortcut();var K=this._target=L||this._target||G;this._global=K===G;var $=this._keydownListenerFunc=this.keydownListener.bind(this),k=this._keyupListenerFunc=this.keyupListener.bind(this);K.addEventListener("keydown",$,!0),K.addEventListener("keyup",k,!0)},disableShortcut:function(){var l=this._target;l&&(l.removeEventListener("keydown",this._keydownListenerFunc,!0),l.removeEventListener("keyup",this._keyupListenerFunc,!0))},keydownListener:function(y){if(!d.Default.ignoreKeyEvent&&(this.fireKeyEvent({kind:"down",event:y}),!d.Default.ignoreShortcuts)){this._lastEvent=y;var f=P(y),c=this._actionMap[f];if(c||(f=P(y,!0),c=this._actionMap[f]),c){var _={kind:"down",shortcut:f,event:y};for(var q in c)_[q]=c[q];var h=this.beforeShortcutAction(y,_);h!==!1&&(c.action(_),this.stopPropagation&&(y.preventDefault(),y.stopImmediatePropagation()))}}},keyupListener:function(O){if(!d.Default.ignoreKeyEvent&&(this.fireKeyEvent({kind:"up",event:O}),!d.Default.ignoreShortcuts)){for(var X="_"+T(e(O)),J=f.keys(this._actionMap),p=0,U=J.length;U>p;p++){var M=J[p];if(!(M.indexOf(X)<0)){var I=this._actionMap[M];if(I){var H={kind:"up",shortcut:M,event:O};for(var b in I)H[b]=I[b];var k=this.beforeShortcutAction(O,H);k!==!1&&I.action(H)}}}this._lastEvent=s}},beforeShortcutAction:function(){},addKeyListener:function(J,m,X){this._keyEventNotifier.add(J,m,X)},removeKeyListener:function(n,F){this._keyEventNotifier.remove(n,F)},fireKeyEvent:function(F){this._keyEventNotifier.fire(F)},isShiftDown:function(){return d.ShortcutManager.isShiftDown()},isCtrlDown:function(){return d.ShortcutManager.isCtrlDown()},isMetaDown:function(){return d.ShortcutManager.isMetaDown()},isAltDown:function(){return d.ShortcutManager.isAltDown()}}),f.defineProperties(d.ShortcutManager.prototype,{global:{get:function(){return this._global}},stopPropagation:{get:function(){return this._stopPropagation},set:function(d){this._stopPropagation=d}}}),d.ShortcutManager.getKey=function(O){return T(e(O))},d.ShortcutManager.isShiftDown=function(){return i&!0},d.ShortcutManager.isCtrlDown=function(){return i&!0},d.ShortcutManager.isMetaDown=function(){return i&!0},d.ShortcutManager.isAltDown=function(){return i&!0}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);