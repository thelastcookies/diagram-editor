!function(E,o){"use strict";var s=ht.AlarmSeverity=function(j,R,o,H,G){this.value=j,this.name=R,this.nickName=o,this.color=H,this.displayName=G};ht.Default.def("ht.AlarmSeverity",o,{toString:function(){return this.displayName||this.name}}),function(){s.severities=new ht.List,s._vm={},s._nm={},s._cp=function(W,F){if(W&&F){var M=W.value-F.value;return M>0?1:0>M?-1:0}return W&&!F?1:!W&&F?-1:0},s.each=function(i,j){s.severities.each(i,j)},s.getSortFunction=function(){return s._cp},s.setSortFunction=function($){s._cp=$,s.severities.sort($)},s.add=function(w,_,P,E,W){var y=new s(w,_,P,E,W);return s._vm[w]=y,s._nm[_]=y,s.severities.add(y),s.severities.sort(s._cp),y},s.remove=function(j){var N=s._nm[j];return N&&(delete s._nm[j],delete s._vm[N.value],s.severities.remove(N)),N},s.CRITICAL=s.add(500,"Critical","C","#FF0000"),s.MAJOR=s.add(400,"Major","M","#FFA000"),s.MINOR=s.add(300,"Minor","m","#FFFF00"),s.WARNING=s.add(200,"Warning","W","#00FFFF"),s.INDETERMINATE=s.add(100,"Indeterminate","N","#C800FF"),s.CLEARED=s.add(0,"Cleared","R","#00FF00"),s.isClearedAlarmSeverity=function(B){return B?0===B.value:!1},s.getByName=function(t){return s._nm[t]},s.getByValue=function(v){return s._vm[v]},s.clear=function(){s.severities.clear(),s._vm={},s._nm={}},s.compare=function(I,A){return s._cp(I,A)}}();var H=ht.AlarmState=function(c){this._d=c,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",o,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var u=null;for(var n in this._am)n=s.getByName(n),s.isClearedAlarmSeverity(n)||0!==this.getAcknowledgedAlarmCount(n)&&(u=u?s.compare(u,n)>0?u:n:n);this._haa=u},_c2:function(){var i=null;for(var l in this._nm)l=s.getByName(l),s.isClearedAlarmSeverity(l)||0!==this.getNewAlarmCount(l)&&(i=i?s.compare(i,l)>0?i:l:l);this._hna=i},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var $ in this._nm)if($=s.getByName($),!s.isClearedAlarmSeverity($)&&0!==this.getNewAlarmCount($)&&s.compare(this._hna,$)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var c=this._haa,i=this._hna,n=this._ps;this._hoa=c,s.compare(i,this._hoa)>0&&(this._hoa=i),s.compare(n,this._hoa)>0&&(this._hoa=n)},_c5:function(){var m=this._haa,a=this._hna;this._hta=m,s.compare(a,this._hta)>0&&(this._hta=a)},increaseAcknowledgedAlarm:function(l,W){if(0!==W){W=W||1;var x=this._am[l.name]||0;x+=W,this._am[l.name]=x,this._f()}},increaseNewAlarm:function(H,s){if(0!==s){s=s||1;var a=this._nm[H.name]||0;a+=s,this._nm[H.name]=a,this._f()}},decreaseAcknowledgedAlarm:function(k,c){if(0!==c){c||(c=1);var z=this._am[k.name]||0;if(z-=c,0>z)throw"Alarm count can not be negative";this._am[k.name]=z,this._f()}},decreaseNewAlarm:function(k,v){if(0!==v){v||(v=1);var x=this._nm[k.name]||0;if(x-=v,0>x)throw"Alarm count can not be negative";this._nm[k.name]=x,this._f()}},acknowledgeAlarm:function(X){this.decreaseNewAlarm(X,1),this.increaseAcknowledgedAlarm(X,1)},acknowledgeAllAlarms:function(G){if(G){var B=this.getNewAlarmCount(G);this.decreaseNewAlarm(G,B),this.increaseAcknowledgedAlarm(G,B)}else for(var L in this._nm)this.acknowledgeAllAlarms(s.getByName(L))},_c6:function(){this._aac=0;for(var p in this._am)p=s.getByName(p),this._aac+=this.getAcknowledgedAlarmCount(p)},getAcknowledgedAlarmCount:function(s){return s?this._am[s.name]||0:this._aac},getAlarmCount:function(J){return this.getAcknowledgedAlarmCount(J)+this.getNewAlarmCount(J)},_c7:function(){this._nac=0;for(var Y in this._nm)this._nac+=this.getNewAlarmCount(s.getByName(Y))},getNewAlarmCount:function(E){return E?this._nm[E.name]||0:this._nac},setNewAlarmCount:function(c,g){this._nm[c.name]=g,this._f()},removeAllNewAlarms:function(K){K?delete this._nm[K]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(c,R){this._am[c.name]=R,this._f()},removeAllAcknowledgedAlarms:function(R){R?delete this._am[R.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(i){if(this._ep||(i=null),this._ps!==i){var S=this._ps;this._ps=i,this._f(),this._d.fp("propagateSeverity",S,i)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(p){var r=this._ep;this._ep=p,this._d.fp("enablePropagation",r,p)&&(p||this.setPropagateSeverity(null))}});var w=ht.AlarmStatePropagator=function(K){this._dataModel=K,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",o,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(I){this._enable!==I&&(this._enable=I,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(h){this.propagate(h)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(V){V.data&&this.propagate(V.data)},handleDataPropertyChange:function(P){if("alarmState"===P.property||"enablePropagation"===P.property)this.propagate(P.data);else if("parent"===P.property){var v=P.oldValue;v&&this.propagate(v),this.propagate(P.data)}},propagate:function(H){H&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(H),this._isPropagating=!1)},propagateToTop:function(c){for(this.propagateToParent(null,c);c&&c.getParent();)this.propagateToParent(c,c.getParent()),c=c.getParent()},propagateToParent:function(z,N){var f=null;N.getChildren().each(function(S){var l=S.getAlarmState().getHighestOverallAlarmSeverity();s.compare(l,f)>0&&(f=l)}),N.getAlarmState().setPropagateSeverity(f)}}),ht.AlarmStateStatistics=function(X){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(X)},ht.Default.def("ht.AlarmStateStatistics",o,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(Y){var N=this._dataModel;N!==Y&&(N&&(N.umd(this.handleDataPropertyChange,this),N.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=Y,this.reset(),Y.md(this.handleDataPropertyChange,this),Y.mm(this.handleDataModelChange,this),this.fp("dataModel",N,Y))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(O){"alarmState"===O.property&&(this.increase(O.data),this.fireAlarmStateChange())},handleDataModelChange:function(m){"add"===m.kind?(this.increase(m.data),this.fireAlarmStateChange()):"remove"===m.kind?(this.decrease(m.data),this.fireAlarmStateChange()):"clear"===m.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,s.each(function(k){var S=this.getSumInfo(k);this.sumAcked+=S.ackedCount,this.sumNew+=S.newCount,this.sumTotal+=S.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(i){if(!i)return this.sumNew;var R=this.getSumInfo(i);return R.newCount},getAcknowledgedAlarmCount:function(A){if(!A)return this.sumAcked;var J=this.getSumInfo(A);return J.ackedCount},getTotalAlarmCount:function(b){if(!b)return this.sumTotal;var U=this.getSumInfo(b);return U.totalCount},getSumInfo:function(P){var K=this.severtiyMap[P.name];return K||(K={},K.newCount=0,K.ackedCount=0,K.totalCount=0,this.severtiyMap[P.name]=K),K},decrease:function(f){var R=this.dataMap[f.getId()];R&&(delete this.dataMap[f.getId()],s.each(function(x){var h=R[x.name],G=this.getSumInfo(x);G.newCount=G.newCount-h.newCount,G.ackedCount=G.ackedCount-h.ackedCount,G.totalCount=G.totalCount-h.totalCount},this))},increase:function(i){if(this.decrease(i),!this._filterFunc||this._filterFunc(i)){var d={},n=i.getAlarmState();this.dataMap[i.getId()]=d,s.each(function(b){var T={};T.newCount=n.getNewAlarmCount(b),T.ackedCount=n.getAcknowledgedAlarmCount(b),T.totalCount=n.getAlarmCount(b),d[b.name]=T;var D=this.getSumInfo(b);D.newCount=D.newCount+T.newCount,D.ackedCount=D.ackedCount+T.ackedCount,D.totalCount=D.totalCount+T.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(v){var A=this._filterFunc;this._filterFunc=v,this.reset(),this.fp("filterFunc",A,v)},getFilterFunc:function(){return this._filterFunc}});var Q=ht.Data.prototype;Q.getAlarmState=function(){return this._alarmState||(this._alarmState=new H(this))},Q=ht.DataModel.prototype,Q.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},Q.setEnableAlarmStatePropagator=function(W){W!=this.isEnableAlarmStatePropagator()&&(W?(this._alarmStatePropagator=new w(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},Q=ht.graph.GraphView.prototype,Q.getNote2=function(S){var p=S.getAlarmState().getHighestNewAlarmSeverity();if(p){var z=S.getAlarmState().getNewAlarmCount(p)+p.nickName;return S.getAlarmState().hasLessSevereNewAlarms()&&(z+="+"),z}return S.s("note2")},Q.getNote2Background=function(k){var j=k.getAlarmState().getHighestNewAlarmSeverity();return j?j.color:k.s("note2.background")},Q.getBodyColor=function(s){var Z=s.getAlarmState().getHighestNativeAlarmSeverity();return Z?Z.color:s.s("body.color")},Q.getBorderColor=function(u){var l=u.getAlarmState().getPropagateSeverity();return l?l.color:u.s("border.color")},Q=ht.widget.TreeView.prototype,Q.getBorderColor=function(H){var l=H.getAlarmState().getPropagateSeverity();return l?l.color:H.s("border.color")},Q.getIcon=function(R){return R.getIcon()?"__alarmIcon__":null},Q=ht.widget.TreeTableView.prototype,Q.getBorderColor=function(X){var U=X.getAlarmState().getPropagateSeverity();return U?U.color:X.s("border.color")},Q.getIcon=function(I){return I.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(B){return B.getIcon()}},color:{func:function(Q){var V=Q.getAlarmState().getHighestNativeAlarmSeverity();return V?V.color:Q.s("body.color")}},rect:[0,0,16,16]}]});var M=ht.Style;M["note2.expanded"]=!0,M["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);