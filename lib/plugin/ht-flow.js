!function(V){"use strict";var i=V.ht,C=i.Default,g=C.getInternal(),$=g.ui(),K=null,B="__segmentLengths",l="__lineTotalLength",x="__linePoints",o="__distance0",z="flow.count",N="flow.step",T="flow.element.max",p="flow.element.count",u="flow.element.min",Z="flow.element.space",b="flow.element.autorotate",_="flow.element.background",L="flow.element.shadow.max",E="flow.element.shadow.min",H="flow.element.shadow.begincolor",j="flow.element.shadow.endcolor",k="flow.element.shadow.visible",J="flow.element.image",c="flow",d=i.Math.Vector2,R=new d;new d,new d,i.List;var t=i.Default._edgeProtectMethod,y=t.getStraightLinePoints,h=function(S,z){for(var C=[],U=S.length,d=0;U>d;d++){var l=S[d];l._as&&(l=l._as);for(var w=l[0],G=1;G<l.length;G++)C.push([w,l[G]]),w=l[G]}for(var o=[],d=0;d<C.length;d++){var x=A(C[d][0],C[d][1],z);o.push(x)}return{distance:o,segments:C}},D=function(e,o,p){if(e){for(var Q,H=h(e,o),M=H.distance,_=H.segments,s=1/0,F=null,k=0,v=M.length;v>k;k++){var f=M[k];f.z<s&&(Q=k,s=f.z,F=f)}if(null==p&&(p=.1),F.z<p){for(var L=0,X=0;Q>=X;X++)L+=C.getDistance(_[X][0],Q>X?_[X][1]:F);return L}}},A=function(W,b,p){var n=W.x,c=W.y,r=b.x,Z=b.y,E=p.x,i=p.y,z=r-n,I=Z-c,K=Math.sqrt(z*z+I*I),T=z/K,S=I/K,a=(-n+E)*T+(-c+i)*S,l={x:n+a*T,y:c+a*S};return l.x>=Math.min(W.x,b.x)&&l.x<=Math.max(W.x,b.x)&&l.y>=Math.min(W.y,b.y)&&l.y<=Math.max(W.y,b.y)||(l.x=Math.abs(l.x-W.x)<Math.abs(l.x-b.x)?W.x:b.x,l.y=Math.abs(l.y-W.y)<Math.abs(l.y-b.y)?W.y:b.y),z=E-l.x,I=i-l.y,l.z=Math.sqrt(z*z+I*I),l},n=function(K,m){if(K){var q=h(K,m).distance,w=1/0,r=null;return q.forEach(function(K){K.z<w&&(w=K.z,r=K)}),r}},m=t.calculateLineLength,O=t.calcSegmentIndexByDistance,W=t.calculatePointAlongLine,I=function(I,g,V){if(!I)return V;if(0===g){var T=I[0][0],j=I[0][1];return V+Math.atan2(j.y-T.y,j.x-T.x)}if(100===g){I=I[I.length-1];var T=I[I.length-2],j=I[I.length-1];return V+Math.atan2(j.y-T.y,j.x-T.x)}for(var K=0,v=[],Y=I.length,x=0;Y>x;x++){var a=I[x],n=m(a);K+=n,v.push(n)}for(var E=K*g/100,w=O(E,v),z=0,d=0;w>d;d++)z+=v[d];E-=z;for(var Q=W(I[w],E),r=I[w],f=0,c=0,F=0;F<r.length-1;F++){var o=r[F],b=r[F+1],B=b.x-o.x,t=b.y-o.y,G=Math.sqrt(B*B+t*t);if(f+=G,f>E){c=F;break}}var e=r[c];return V+Math.atan2(Q.y-e.y,Q.x-e.x)},r=function(D){var Q=0;if(D)if(Array.isArray(D[0]))for(var U=D.length,C=0;U>C;C++){var n=D[C],b=m(n);Q+=b}else Q=m(D);return Q},P=function(s,d,D,Z){return R.set(d,D).rotateAround(null,Z),s?{x:s.x+R.x,y:s.y+R.y}:{x:R.x,y:R.y}},q=function(V){var P=V._data,c=y(V);if(c){P.s("flow.reverse")&&(c.reverse(),c.forEach(function(H){H.reverse()}));for(var h=0,b=[],O=c.length,w=0;O>w;w++){var D=c[w],f=m(D);h+=f,b.push(f)}if(P[B]=b,P[l]=h,P[x]=c,P instanceof i.Edge){var p=C.unionPoint(c),S=p.x+p.width/2,L=p.y+p.height/2;P.$10e={x:S,y:L}}s(V,!0)}},S=t.getPercentPosition,s=function(d,H){var K=d._data,R=K[l],b=K.s(z),q=K.s(N),W=0,h=K[B],C=K.s(T),Q=K.s(u),x=K.s(p),e=(C-Q)/(x-1),P=[];if(h){if(1===x)P.push(C);else if(2===x)P.push(C),P.push(Q);else{if(!(x>2))return;P.push(C);for(var $=x-2;$>0;$--)P.push(Q+e*$);P.push(Q)}var M=0,E=0;P.forEach(function(o){x-1>M&&(E+=K.getFlowElementSpace(o)),M++}),E+=(C+Q)/2,W=(R-b*E+E)/b;var Y=d[o];for(null==Y&&(Y=0),H||(Y+=q);Y>R+E;){var c=d._overCount;c?c++:c=1,c>=b&&(c=null),d._overCount=c,K.s("flow.autoreverse")?c?Y-=W+E:(Y=0,K.s("flow.reverse",!K.s("flow.reverse"))):Y-=W+E}d[o]=Y}},w="prototype",e=i.graph.GraphView[w],U=i.Data[w],M=$.DataUI[w],a=$.ShapeUI[w],Y=$.EdgeUI[w],F=i.DataModel[w],f=i.Style;f[T]==K&&(f[T]=7),f[u]==K&&(f[u]=0),f[z]==K&&(f[z]=1),f[N]==K&&(f[N]=3),f[p]==K&&(f[p]=10),f[Z]==K&&(f[Z]=3.5),f[b]==K&&(f[b]=!1),f[_]==K&&(f[_]="rgba(255, 255, 114, 0.4)"),f[H]==K&&(f[H]="rgba(255, 255, 0, 0.3)"),f[j]==K&&(f[j]="rgba(255, 255, 0, 0)"),f[k]==K&&(f[k]=1),f[L]==K&&(f[L]=22),f[E]==K&&(f[E]=4),e.calculatePointLength=function(Q,C,p){var J=this.getDataUI(Q),N=y(J);return D(N,C,p)},C.calculatePointLength=function(H,z,f,j){var p=y(K,H,z);return D(p,f,j)},C.calculateClosestPointOnLine=A,e.calculateClosestPoint=function(X,g){var e=this.getDataUI(X),x=y(e);return n(x,g)},C.calculateClosestPoint=function(I,l,W){var $=y(K,I,l);return n($,W)},e.getPercentAngle=function(H,t){var e=this.getDataUI(H),D=y(e);return H.getRotation?H.getRotation():0,I(D,t,H.getRotation?H.getRotation():0)},C.getPercentAngle=function(B,T,L){var A=y(K,B,T);return I(A,L,0)},e.calculateLength=function(L){var c=this.getDataUI(L),H=y(c);return r(H)},C.calculateLength=function(C,N){var E=y(K,C,N);return r(E)},e.getPercentPosition=function(z,q){var Q=this.getDataUI(z),L=y(Q);return S(L,q)},C.getPercentPositionOnPoints=function(t,V,W){var Z=y(K,t,V);return S(Z,W)};var Q=function(T){var B=T.data,h=this.dm();if(B&&"add"===T.kind){var J=h.$3e;J&&B.s(c)&&J.indexOf(B)<0&&J.push(B)}"clear"===T.kind&&(h.$3e=[])},G=function(d){var E=d.property,H=d.data,j=d.newValue,X=this.dm().$3e;if(X&&"s:flow"===E)if(j)X.indexOf(H)<0&&X.push(H);else for(var r=X.length,o=0;r>o;o++)if(X[o]===H){X.splice(o,1);break}},X=e.setDataModel;e.setDataModel=function(l){var U=this,e=U._dataModel;if(e!==l){e&&(e.umm(Q,U),e.umd(G,U),e.$3e=[]),l.mm(Q,U),l.md(G,U);var m=l.$3e=[];l.each(function(X){X.s(c)&&m.indexOf(X)<0&&m.push(X)}),X.call(U,l)}},U.getFlowElementSpace=function(){return this.s(Z)};var v=function(g){var i=this,h=i._data,k=h[l],A=h[B],q=h[x],C=h.s(z),c=0,H=i[o],f=h.s(T),Z=h.s(u),Y=h.s(p),v=h.s(E),V=h.s(L),X=h.s(b),S=(V-v)/(Y-1),Q=(f-Z)/(Y-1),m=h.getRotation?h.getRotation():0,$=h.getPosition?h.p():h.$10e,U=[],G=[];if(H!=K){if(1===Y)U.push(f);else if(2===Y)U.push(f),U.push(Z);else{if(!(Y>2))return;U.push(f);for(var t=Y-2;t>0;t--)U.push(Z+Q*t);U.push(Z)}if(1===Y)G.push(V);else if(2===Y)G.push(V),G.push(v);else{if(!(Y>2))return;G.push(V);for(var t=Y-2;t>0;t--)G.push(v+S*t);G.push(v)}var w=0,e=0;U.forEach(function(p){Y-1>w&&(e+=h.getFlowElementSpace(p)),w++}),e+=(f+Z)/2,c=(k-C*e+e)/C,g.save();for(var t=0;C>t;t++){var I=H,d=0,J=i._overCount,D=0;h.s("flow.autoreverse")&&J&&J>C-(t+1)||(I-=t*(c+e),w=0,U.forEach(function(t){var C=I-d;if(C>=0&&k>C){var E=!0,e=O(C,A);D=0;for(var B=0;e>B;B++)D+=A[B];if(C-=D,E){var v=W(q[e],C),K=m;if(X){for(var l=q[e],F=0,n=0,H=0;H<l.length-1;H++){var M=l[H],p=l[H+1],o=p.x-M.x,L=p.y-M.y,z=Math.sqrt(o*o+L*L);if(F+=z,F>C){n=H;break}}var c=l[n];K+=Math.atan2(v.y-c.y,v.x-c.x)}m&&(v=P($,v.x-$.x,v.y-$.y,m)),i.$5e(g,v,t,G[w],K)}}d+=h.getFlowElementSpace(U[w]),w++}))}g.restore()}},lh=Y._80o;Y._80o=function(B){lh.call(this,B);var j=this,z=j._data,l=j.gv;z.s(c)&&l.$7e!=K&&v.call(j,B)};var qb=a._80o;a._80o=function(y){qb.call(this,y);var F=this,u=F._data,D=F.gv;u.s(c)&&D.$7e!=K&&v.call(F,y)};var Jn=Y._79o,hq=a._79o,bo=function(){var A=this,p=A._data,a=p.s(T),V=!1,O=K;if(A._6I||(V=!0),O=p instanceof i.Edge?Jn.call(A):hq.call(A),p.s(c)&&V){var Y=p.s(L),d=p.s(k);d&&Y>a&&(a=Y),a>0&&C.grow(O,Math.ceil(a/2)),q(A)}return!p.s(c)&&V&&(p[B]=p[l]=p[x]=A[o]=K),O};a._79o=bo,Y._79o=bo,M.$5e=function(G,v,q,I,h){var M=this,l=M._data,$=M.gv,a=l.s(_),i=l.s(H),T=l.s(j),F=l.s(k),B=$.$8e,E=l.s(J);if(B==K&&(B=$.$8e={}),G.beginPath(),E!=K){var z=C.getImage(E),x=q/2;G.translate(v.x,v.y),G.rotate(h),G.translate(-v.x,-v.y),C.drawImage(G,z,v.x-x,v.y-x,q,q,l),G.translate(v.x,v.y),G.rotate(-h),G.translate(-v.x,-v.y)}else if($.__flowBatch){var c=$.__flowBatchGroup;c||(c=$.__flowBatchGroup={});var s=[v.x,v.y,q/2];c[a]?c[a].push(s):c[a]=[s]}else G.fillStyle=a,G.arc(v.x,v.y,q/2,0,2*Math.PI,!0),G.fill();if(F){var U=22,N=U+"_"+i+"_"+T,L=B[N];if(L==K){var d=document.createElement("canvas");g.setCanvas(d,U,U);var R=d.getContext("2d"),Q=U/2,D=Q,n=Q;g.translateAndScale(R,0,0,1),R.beginPath();var o=R.createRadialGradient(D,n,0,D,D,Q);o.addColorStop(0,i),o.addColorStop(1,T),R.fillStyle=o,R.arc(D,n,Q,0,2*Math.PI,!0),R.fill(),L=B[N]=d}var x=I/2;C.drawImage(G,L,v.x-x,v.y-x,I,I,l)}},e.$9e=function(){var V=this,e=V.dm().$3e;V._24I,e.forEach(function(_){V._24I[_._id]=_}),V.iv()};var co=F.prepareRemove;F.prepareRemove=function(g){co.call(this,g);var D=g._dataModel,U=D.$3e;if(U)for(var f=U.length,n=0;f>n;n++)if(U[n]===g){U.splice(n,1);break}},e.setFlowInterval=function(L){var q=this,y=q.$11e;q.$11e=L,q.fp("flowInterval",y,L),q.$7e!=K&&(clearInterval(q.$7e),delete q.$7e,q.enableFlow(L))},e.getFlowInterval=function(){return this.$11e},e.enableFlow=function(M){var t=this,i=t.dm(),o=i.$3e;t.$7e==K&&(o.forEach(function(S){var V=t.getDataUI(S);q(V)}),t.$7e=setInterval(function(){i.$3e.forEach(function(B){s(t.getDataUI(B))}),t.$9e()},M||t.$11e||50))},e.disableFlow=function(){var W=this;clearInterval(W.$7e),delete W.$7e;var q=W.dm().$3e;q&&W.$9e()};var Ij=function(){this.__flowBatchGroup={}},ic=function(o){var h=this.__flowBatchGroup;if(h){o.save();for(var c in h){o.fillStyle=c,o.beginPath();var d=h[c];d.forEach(function(v){o.moveTo(v[0],v[1]),o.arc(v[0],v[1],v[2],0,2*Math.PI,!0)}),o.fill()}o.restore()}};e.setFlowBatch=function(F){var q=this;!!q.__flowBatch!=!!F&&(q.__flowBatch=F,F?(q.addBottomPainter(Ij),q.addTopPainter(ic)):(q.removeBottomPainter(Ij),q.removeTopPainter(ic)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);