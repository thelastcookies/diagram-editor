!function(Y,b,w){"use strict";function L(W,e){this.position=W,this.$22n=e}var h="ht",c=Y[h],E=null,I=Math,H=I.PI,D=I.cos,g=I.sin,A=I.abs,d=I.max,X=I.sqrt,F=1e-5,i=c.Default,f=i.def,y=i.startAnim,$=i.createMatrix,T=i.transformVec,J=i.getInternal(),a=J.addMethod,K=J.superCall,N=J.toPointsArray,V=J.createNormals,v=J.toFloatArray,u=J.glMV,p=(J.glPop,c.graph3d.Graph3dView,c.Math),M=p.Vector3,Z=p.Matrix4,R=p.Euler,C=(p.Quaternion,J.batchShape),n=J.createNodeMatrix,k=J.getFaceInfo,P=J.transformAppend,Q=J.drawFaceInfo,B=J.createAnim,G=J.cube(),z=G.is,_=G.vs,S=G.uv,x=J.ui(),j=c.Node,q=c.Shape,m="h",t="v",l="front",s="back",o="left",U="right",r="top",O="bottom",W="dw.expanded",e=".expanded",el="dw.angle",jo=".angle",Xg=function(k,F,$){f(h+"."+k,F,$)},ze=function(f,t,d){d?f.push(t.x,t.y):f.push(t.x,t.y,t.z)},Ud=function(){var s=new c.Math.Vector3,k=new c.Math.Vector3,V=new c.Math.Vector3;return function(T,Z,b,u,H){if(s.copy(Z.$24n),k.copy(b.$24n),V.copy(u.$24n),!(V.equals(s)||k.equals(s)||k.equals(V))){if(!Z.$22n||!b.$22n||!u.$22n){var h=k.sub(s).cross(V.sub(s)).normalize().multiplyScalar(1).toArray();Z.$22n||(Z.$22n=new Fb(h)),b.$22n||(b.$22n=new Fb(h)),u.$22n||(u.$22n=new Fb(h))}T.push(new Ym([Z,b,u],H))}}}(),ng=function(m,r,Q,N){var c,j,w,F,f=0,S=[];if(N)for(c=N.length;c>f;f+=3)j=N[f],w=N[f+1],F=N[f+2],Ud(S,new Km([r[3*j],r[3*j+1],r[3*j+2]],null,Q?[Q[2*j],Q[2*j+1],0]:E),new Km([r[3*w],r[3*w+1],r[3*w+2]],null,Q?[Q[2*w],Q[2*w+1],0]:E),new Km([r[3*F],r[3*F+1],r[3*F+2]],null,Q?[Q[2*F],Q[2*F+1],0]:E),m);else for(c=r.length/3;c>f;f+=3)j=f,w=f+1,F=f+2,Ud(S,new Km([r[3*j],r[3*j+1],r[3*j+2]],null,Q?[Q[2*j],Q[2*j+1],0]:E),new Km([r[3*w],r[3*w+1],r[3*w+2]],null,Q?[Q[2*w],Q[2*w+1],0]:E),new Km([r[3*F],r[3*F+1],r[3*F+2]],null,Q?[Q[2*F],Q[2*F+1],0]:E),m);return S},al=[o,l,U,s,r,O],lm=["",r,O],Rn=al.concat("csg"),xe=[0,6,12,18,24,30],_d=function(y,h,g){var C=n(y),l=[];y.appendAnchorMatrix3d(C);var A,s=h?h.getData3dUI(y):null;if(s&&s.s("shape3d")&&!s.s("csg.cull.box")&&(A=s.shapeModel,s.shapeModel||(A=J.getShapeModel(s,s.s("shape3d"))),A))for(var k=J.createNormalMatrix(C),Q=0,H=lm.length;H>Q;Q++){var i=lm[Q],X=i.length?i+"_":i,u=A[X+"vs"],M=A[X+"uv"],I=A[X+"is"],j=A[X+"ns"];if(u&&u.length)for(var d,N,Z,D=0,W=I?I.length:u.length/3;W>D;D+=3)I?(d=I[D],N=I[D+1],Z=I[D+2]):(d=D,N=D+1,Z=D+2),Ud(l,new Km(T([u[3*d],u[3*d+1],u[3*d+2]],C),j?T([j[3*d],j[3*d+1],j[3*d+2]],k):null,[M[2*d],M[2*d+1],0]),new Km(T([u[3*N],u[3*N+1],u[3*N+2]],C),j?T([j[3*N],j[3*N+1],j[3*N+2]],k):null,[M[2*N],M[2*N+1],0]),new Km(T([u[3*Z],u[3*Z+1],u[3*Z+2]],C),j?T([j[3*Z],j[3*Z+1],j[3*Z+2]],k):null,[M[2*Z],M[2*Z+1],0]),y)}if(!A)for(var Q=0;6>Q;Q++)for(var i=al[Q],R=xe[Q],M=g?h.getFaceUv(y,i):E,V=g?h.getFaceUvScale(y,i):E,Y=g?h.getFaceUvOffset(y,i):E,G=0;2>G;G++){var K,p,a,v=z[R+3*G],t=z[R+3*G+1],m=z[R+3*G+2];if(g){if(M){var U=8*Q;K=[M[2*v-U],M[2*v+1-U],0],p=[M[2*t-U],M[2*t+1-U],0],a=[M[2*m-U],M[2*m+1-U],0]}else K=[S[2*v],S[2*v+1],0],p=[S[2*t],S[2*t+1],0],a=[S[2*m],S[2*m+1],0];V&&(K[0]*=V[0],K[1]*=V[1],p[0]*=V[0],p[1]*=V[1],a[0]*=V[0],a[1]*=V[1]),Y&&(K[0]+=Y[0],K[1]+=Y[1],p[0]+=Y[0],p[1]+=Y[1],a[0]+=Y[0],a[1]+=Y[1])}Ud(l,new Km(T([_[3*v],_[3*v+1],_[3*v+2]],C),null,K),new Km(T([_[3*t],_[3*t+1],_[3*t+2]],C),null,p),new Km(T([_[3*m],_[3*m+1],_[3*m+2]],C),null,a),y)}return $l.$15n(l)},qc=function(P,u){var G,t=P.data.getAttaches();if(t&&t.each(function(V){V instanceof Wq&&V.s("attach.operation")&&(G||(G=[]),G.push(V))}),G){var D;al.forEach(function(N){var u=ng(N,P[N].vs,P[N].tuv);D=D?D.concat(u):u}),D=$l.$15n(D),G.forEach(function(c){var r=c.s("attach.operation");D[r]&&(D=D[r](_d(c,P.gv,P.csg.tuv)))}),al.forEach(function(v){v=P[v],v.vs=[],v.ns=[],v.tuv&&(v.tuv=[])}),P.csg&&!P.csg.ns&&(P.csg.ns=[]);var y=[];if(D.$19n().forEach(function(H){var S,U=H.$10n;if(U instanceof Wq){if(U.s("attach.cull"))return;S=U.s("csg.cull.color"),S&&(S=J.toColorArray(S)),U="csg"}for(var X=P[U],I=X.vs,x=X.ns,k=X.tuv,i=H.$9n,r=2;r<i.length;r++)if(ze(I,i[0].$24n),ze(I,i[r-1].$24n),ze(I,i[r].$24n),x&&(ze(x,i[0].$22n),ze(x,i[r-1].$22n),ze(x,i[r].$22n)),k&&(ze(k,i[0].uv,!0),ze(k,i[r-1].uv,!0),ze(k,i[r].uv,!0)),S)for(var q=4*(I.length/3),F=0;3>F;F++)y[--q]=S[3],y[--q]=S[2],y[--q]=S[1],y[--q]=S[0]}),y.length){for(var K=J.toColorArray(P.csg.color),z=0,j=4*(P.csg.vs.length/3);j>z;z+=4)y[z]==w&&(y[z]=K[0],y[z+1]=K[1],y[z+2]=K[2],y[z+3]=K[3]);P.csg.cs=y}}Rn.forEach(function(E){var l=P[E];l.visible&&l.vs.length?(l.ns&&l.ns.length?v(l,"ns"):l.ns=V(l.vs),v(l,"vs"),v(l,"tuv"),l.cs&&v(l,"cs")):delete P[E]}),u&&(C(P,E,u),P.clear())};a(i,{createFrameModel:function(w,$,I,h){w=w==E?.07:w,$=$==E?w:$,I=I==E?w:I,h=h?h:{};var P=h.top,W=h.bottom,t=h.left,A=h.right,q=h.front,k=h.back,S=[],u=[];return q===!0?(S.push(-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5),u.push(0,0,0,1,1,1,1,1,1,0,0,0)):q===!1||(S.push(-.5,.5,.5,-.5,-.5,.5,-.5+w,-.5,.5,-.5+w,-.5,.5,-.5+w,.5,.5,-.5,.5,.5,.5-w,.5,.5,.5-w,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5-w,.5,.5,-.5+w,.5,.5,-.5+w,.5-$,.5,.5-w,.5-$,.5,.5-w,.5-$,.5,.5-w,.5,.5,-.5+w,.5,.5,-.5+w,-.5+$,.5,-.5+w,-.5,.5,.5-w,-.5,.5,.5-w,-.5,.5,.5-w,-.5+$,.5,-.5+w,-.5+$,.5),u.push(0,0,0,1,w,1,w,1,w,0,0,0,1-w,0,1-w,1,1,1,1,1,1,0,1-w,0,w,0,w,$,1-w,$,1-w,$,1-w,0,w,0,w,1-$,w,1,1-w,1,1-w,1,1-w,1-$,w,1-$)),k===!0?(S.push(-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5),u.push(1,0,0,1,1,1,0,1,1,0,0,0)):k===!1||(S.push(-.5,.5,-.5,-.5+w,-.5,-.5,-.5,-.5,-.5,-.5+w,-.5,-.5,-.5,.5,-.5,-.5+w,.5,-.5,.5-w,.5,-.5,.5,-.5,-.5,.5-w,-.5,-.5,.5,-.5,-.5,.5-w,.5,-.5,.5,.5,-.5,-.5+w,.5,-.5,.5-w,.5-$,-.5,-.5+w,.5-$,-.5,.5-w,.5-$,-.5,-.5+w,.5,-.5,.5-w,.5,-.5,-.5+w,-.5+$,-.5,.5-w,-.5,-.5,-.5+w,-.5,-.5,.5-w,-.5,-.5,-.5+w,-.5+$,-.5,.5-w,-.5+$,-.5),u.push(1,0,1-w,1,1,1,1-w,1,1,0,1-w,0,w,0,0,1,w,1,0,1,w,0,0,0,1-w,0,w,$,1-w,$,w,$,1-w,0,w,0,1-w,1-$,w,1,1-w,1,w,1,1-w,1-$,w,1-$)),t===!0?(S.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5),u.push(0,0,0,1,1,1,1,1,1,0,0,0)):t===!1||(S.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5+I,-.5,-.5,-.5+I,-.5,.5,-.5+I,-.5,.5,-.5,-.5,.5,.5-I,-.5,-.5,.5-I,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5-I,-.5,.5,-.5+I,-.5,.5-$,-.5+I,-.5,.5-$,.5-I,-.5,.5-$,.5-I,-.5,.5,.5-I,-.5,.5,-.5+I,-.5,-.5+$,-.5+I,-.5,-.5,-.5+I,-.5,-.5,.5-I,-.5,-.5,.5-I,-.5,-.5+$,.5-I,-.5,-.5+$,-.5+I),u.push(0,0,0,1,I,1,I,1,I,0,0,0,1-I,0,1-I,1,1,1,1,1,1,0,1-I,0,I,0,I,$,1-I,$,1-I,$,1-I,0,I,0,I,1-$,I,1,1-I,1,1-I,1,1-I,1-$,I,1-$)),A===!0?(S.push(.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5),u.push(1,0,0,1,1,1,0,1,1,0,0,0)):A===!1||(S.push(.5,.5,-.5,.5,-.5,-.5+I,.5,-.5,-.5,.5,-.5,-.5+I,.5,.5,-.5,.5,.5,-.5+I,.5,.5,.5-I,.5,-.5,.5,.5,-.5,.5-I,.5,-.5,.5,.5,.5,.5-I,.5,.5,.5,.5,.5,-.5+I,.5,.5-$,.5-I,.5,.5-$,-.5+I,.5,.5-$,.5-I,.5,.5,-.5+I,.5,.5,.5-I,.5,-.5+$,-.5+I,.5,-.5,.5-I,.5,-.5,-.5+I,.5,-.5,.5-I,.5,-.5+$,-.5+I,.5,-.5+$,.5-I),u.push(1,0,1-I,1,1,1,1-I,1,1,0,1-I,0,I,0,0,1,I,1,0,1,I,0,0,0,1-I,0,I,$,1-I,$,I,$,1-I,0,I,0,1-I,1-$,I,1,1-I,1,I,1,1-I,1-$,I,1-$)),P===!0?(S.push(.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5),u.push(1,1,1,0,0,0,0,0,0,1,1,1)):P===!1||(S.push(.5,.5,.5,.5,.5,-.5,.5-w,.5,-.5,.5-w,.5,-.5,.5-w,.5,.5,.5,.5,.5,-.5+w,.5,.5,-.5+w,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5+w,.5,.5,.5-w,.5,.5,.5-w,.5,.5-I,-.5+w,.5,.5-I,-.5+w,.5,.5-I,-.5+w,.5,.5,.5-w,.5,.5,.5-w,.5,-.5+I,.5-w,.5,-.5,-.5+w,.5,-.5,-.5+w,.5,-.5,-.5+w,.5,-.5+I,.5-w,.5,-.5+I),u.push(1,1,1,0,1-w,0,1-w,0,1-w,1,1,1,w,1,w,0,0,0,0,0,0,1,w,1,1-w,1,1-w,1-I,w,1-I,w,1-I,w,1,1-w,1,1-w,I,1-w,0,w,0,w,0,w,I,1-w,I)),W===!0?(S.push(.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5),u.push(1,0,0,1,1,1,0,1,1,0,0,0)):W===!1||(S.push(.5,-.5,.5,.5-w,-.5,-.5,.5,-.5,-.5,.5-w,-.5,-.5,.5,-.5,.5,.5-w,-.5,.5,-.5+w,-.5,.5,-.5,-.5,-.5,-.5+w,-.5,-.5,-.5,-.5,-.5,-.5+w,-.5,.5,-.5,-.5,.5,.5-w,-.5,.5,-.5+w,-.5,.5-I,.5-w,-.5,.5-I,-.5+w,-.5,.5-I,.5-w,-.5,.5,-.5+w,-.5,.5,.5-w,-.5,-.5+I,-.5+w,-.5,-.5,.5-w,-.5,-.5,-.5+w,-.5,-.5,.5-w,-.5,-.5+I,-.5+w,-.5,-.5+I),u.push(1,0,1-w,1,1,1,1-w,1,1,0,1-w,0,w,0,0,1,w,1,0,1,w,0,0,0,1-w,0,w,I,1-w,I,w,I,1-w,0,w,0,1-w,1-I,w,1,1-w,1,w,1,1-w,1-I,w,1-I)),{vs:S,uv:u}}}),a(c.Style,{"csg.cull.color":w,"csg.cull.box":!0,"dw.flip":!1,"dw.s3":[.999,.999,.5],"dw.t3":w,"dw.expanded":!1,"dw.toggleable":!0,"dw.axis":"left","dw.start":0,"dw.end":H/2,"dw.angle":0,"attach.cull":!1,"attach.operation":"subtract"},!0),al.forEach(function(P){var n={};n[P+e]=!1,n[P+".toggleable"]=!1,n[P+".axis"]=o,n[P+".start"]=0,n[P+".end"]=H/2,n[P+jo]=0,a(c.Style,n,!0)});var $l=function(){this.$4n=[]};$l.$15n=function(S){var C=new $l;return C.$4n=S,C},$l.prototype={clone:function(){var V=new $l;return V.$4n=this.$4n.map(function(P){return P.clone()}),V},$19n:function(){return this.$4n},union:function(d){var e=new Eo(this.clone().$4n),Q=new Eo(d.clone().$4n);return e.$3n(Q),Q.$3n(e),Q.$6n(),Q.$3n(e),Q.$6n(),e.$7n(Q.$2n()),$l.$15n(e.$2n())},subtract:function(w){var P=new Eo(this.clone().$4n),o=new Eo(w.clone().$4n);return P.$6n(),P.$3n(o),o.$3n(P),o.$6n(),o.$3n(P),o.$6n(),P.$7n(o.$2n()),P.$6n(),$l.$15n(P.$2n())},intersect:function(S){var l=new Eo(this.clone().$4n),R=new Eo(S.clone().$4n);return l.$6n(),R.$3n(l),R.$6n(),l.$3n(R),R.$3n(l),l.$7n(R.$2n()),l.$6n(),$l.$15n(l.$2n())},inverse:function(){var s=this.clone();return s.$4n.map(function(i){i.flip()}),s}},$l.cube=function(T){T=T||{};var e=new Fb(T.center||[0,0,0]),s=T.radius?T.radius.length?T.radius:[T.radius,T.radius,T.radius]:[1,1,1];return $l.$15n([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(t){return new Ym(t[0].map(function(S){var r=new Fb(e.x+s[0]*(2*!!(1&S)-1),e.y+s[1]*(2*!!(2&S)-1),e.z+s[2]*(2*!!(4&S)-1));return new Km(r,new Fb(t[1]))}))}))},$l.sphere=function(a){function i(q,z){q*=2*H,z*=H;var Q=new Fb(D(q)*g(z),D(z),g(q)*g(z));R.push(new Km(k.$20n(Q.$21n(T)),Q))}a=a||{};for(var R,k=new Fb(a.center||[0,0,0]),T=a.radius||1,u=a.slices||16,_=a.stacks||8,F=[],d=0;u>d;d++)for(var V=0;_>V;V++)R=[],i(d/u,V/_),V>0&&i((d+1)/u,V/_),_-1>V&&i((d+1)/u,(V+1)/_),i(d/u,(V+1)/_),F.push(new Ym(R));return $l.$15n(F)},$l.cylinder=function(V){function e(n,_,m){var V=2*_*H,w=b.$21n(D(V)).$20n(d.$21n(g(V))),Z=J.$20n(j.$21n(n)).$20n(w.$21n($)),G=w.$21n(1-A(m)).$20n(r.$21n(m));return new Km(Z,G)}V=V||{};for(var J=new Fb(V.start||[0,-1,0]),O=new Fb(V.end||[0,1,0]),j=O.$13n(J),$=V.radius||1,L=V.slices||16,r=j.$14n(),Y=A(r.y)>.5,b=new Fb(Y,!Y,0).cross(r).$14n(),d=b.cross(r).$14n(),c=new Km(J,r.$11n()),i=new Km(O,r.$14n()),M=[],o=0;L>o;o++){var u=o/L,U=(o+1)/L;M.push(new Ym([c,e(0,u,-1),e(0,U,-1)])),M.push(new Ym([e(0,U,0),e(0,u,0),e(1,u,0),e(1,U,0)])),M.push(new Ym([i,e(1,U,1),e(1,u,1)]))}return $l.$15n(M)};var Fb=function(m,F,j){var d=this;3==arguments.length?(d.x=m,d.y=F,d.z=j):"x"in m?(d.x=m.x,d.y=m.y,d.z=m.z):(d.x=m[0],d.y=m[1],d.z=m[2])};Fb.prototype={clone:function(){return new Fb(this.x,this.y,this.z)},$11n:function(){return new Fb(-this.x,-this.y,-this.z)},$20n:function(x){return new Fb(this.x+x.x,this.y+x.y,this.z+x.z)},$13n:function(D){return new Fb(this.x-D.x,this.y-D.y,this.z-D.z)},$21n:function(W){return new Fb(this.x*W,this.y*W,this.z*W)},$16n:function(T){return new Fb(this.x/T,this.y/T,this.z/T)},dot:function(p){return this.x*p.x+this.y*p.y+this.z*p.z},lerp:function(T,N){return this.$20n(T.$13n(this).$21n(N))},length:function(){return X(this.dot(this))},$14n:function(){return this.$16n(this.length())},cross:function(f){var y=this;return new Fb(y.y*f.z-y.z*f.y,y.z*f.x-y.x*f.z,y.x*f.y-y.y*f.x)}};var Km=function(N,D,z){var u=this;u.$24n=new Fb(N),u.$22n=D?new Fb(D):null,u.uv=z?new Fb(z):null};Km.prototype={clone:function(){var O=this;return new Km(O.$24n.clone(),O.$22n.clone(),O.uv?O.uv.clone():null)},flip:function(){this.$22n=this.$22n.$11n()},$18n:function(v,t){var Y=this;return new Km(Y.$24n.lerp(v.$24n,t),Y.$22n.lerp(v.$22n,t),Y.uv?Y.uv.lerp(v.uv,t):null)}};var Pf=function(x,k){this.$22n=x,this.w=k};Pf.$17n=function(n,d,l){var y=d.$13n(n).cross(l.$13n(n)).$14n();return new Pf(y,y.dot(n))},Pf.prototype={clone:function(){return new Pf(this.$22n.clone(),this.w)},flip:function(){var h=this;h.$22n=h.$22n.$11n(),h.w=-h.w},$5n:function(P,t,G,n,Z){for(var s=this,e=0,g=1,K=2,l=3,R=0,h=[],$=0;$<P.$9n.length;$++){var w=s.$22n.dot(P.$9n[$].$24n)-s.w,J=-F>w?K:w>F?g:e;R|=J,h.push(J)}switch(R){case e:(s.$22n.dot(P.$8n.$22n)>0?t:G).push(P);break;case g:n.push(P);break;case K:Z.push(P);break;case l:for(var f=[],o=[],$=0;$<P.$9n.length;$++){var Q=($+1)%P.$9n.length,Y=h[$],x=h[Q],_=P.$9n[$],M=P.$9n[Q];if(Y!=K&&f.push(_),Y!=g&&o.push(Y!=K?_.clone():_),(Y|x)==l){var w=(s.w-this.$22n.dot(_.$24n))/s.$22n.dot(M.$24n.$13n(_.$24n)),u=_.$18n(M,w);f.push(u),o.push(u.clone())}}f.length>=3&&n.push(new Ym(f,P.$10n)),o.length>=3&&Z.push(new Ym(o,P.$10n))}}};var Ym=function(A,Z){var b=this;b.$9n=A,b.$10n=Z,b.$8n=Pf.$17n(A[0].$24n,A[1].$24n,A[2].$24n)};Ym.prototype={clone:function(){var h=this.$9n.map(function(O){return O.clone()});return new Ym(h,this.$10n)},flip:function(){this.$9n.reverse().map(function(J){J.flip()}),this.$8n.flip()}};var Eo=function(M){var l=this;l.$8n=null,l.front=null,l.back=null,l.$4n=[],M&&l.$7n(M)};Eo.prototype={clone:function(){var b=this,j=new Eo;return j.$8n=b.$8n&&b.$8n.clone(),j.front=b.front&&b.front.clone(),j.back=b.back&&b.back.clone(),j.$4n=b.$4n.map(function(R){return R.clone()}),j},$6n:function(){for(var i=this,L=0;L<i.$4n.length;L++)i.$4n[L].flip();i.$8n&&i.$8n.flip(),i.front&&i.front.$6n(),i.back&&i.back.$6n();var D=i.front;i.front=i.back,i.back=D},$1n:function(r){var J=this;if(!J.$8n)return r.slice();for(var w=[],U=[],i=0;i<r.length;i++)J.$8n.$5n(r[i],w,U,w,U);return J.front&&(w=J.front.$1n(w)),U=J.back?J.back.$1n(U):[],w.concat(U)},$3n:function(X){var D=this;D.$4n=X.$1n(D.$4n),D.front&&D.front.$3n(X),D.back&&D.back.$3n(X)},$2n:function(){var K=this,B=K.$4n.slice();return K.front&&(B=B.concat(K.front.$2n())),K.back&&(B=B.concat(K.back.$2n())),B},$7n:function(J){var o=this;if(J.length){o.$8n||(o.$8n=J[0].$8n.clone());for(var R=[],c=[],A=0;A<J.length;A++)this.$8n.$5n(J[A],o.$4n,o.$4n,R,c);R.length&&(o.front||(o.front=new Eo),this.front.$7n(R)),c.length&&(o.back||(o.back=new Eo),o.back.$7n(c))}}};var mm="symbol",vp=c.Symbol=function(N,R,w){var x=this;K(vp,x),x.s3(20,20,20),x.s({"all.visible":!1,shape:"rect"}),x.setIcon(N,R,w)};Xg("Symbol",j,{setIcon:function(S,a,$){var U,k=this;return vp.superClass.setIcon.call(k,S),S?(U={for3d:!0,face:"center",position:44,names:[S]},$&&(U.transaprent=!0),a&&(U.autorotate=a),k.addStyleIcon(mm,U)):k.removeStyleIcon(mm),k.setWidth(J.getImageWidth(i.getImage(S),k)||20),U}});var Wq=c.CSGNode=function(){K(Wq,this),this.s({shape:"rect","attach.thickness":1.001,"2d.attachable":!0})},Wj={position:1,width:1,height:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,tall:1,elevation:1,anchor:1,anchorElevation:1,"s:attach.cull":1,"s:attach.operation":1};Xg("CSGNode",j,{_22Q:function(){return wr},onPropertyChanged:function(D){var c=this,z=c.getHost();Wq.superClass.onPropertyChanged.call(c,D),Wj[D.property]&&(z instanceof Ge||z instanceof Wq)&&z.fp("csgNodeChange",!0,!1)}});var wr=function(g,a){K(wr,this,[g,a])};f(wr,x.Node3dUI,{_80o:function(X,U,E){var Y=this;Y._shape3d?wr.superClass._80o.call(Y,X,U,E):(u(Y.gv),Rn.forEach(function(y){Q(Y,X,U,y,E)}))},validate:function(j,q){var c=this,B=c.gv,K=c.data;if(K.s("shape3d"))return wr.superClass.validate.call(c,j,q),c._shape3d=!0,void 0;c._shape3d=!1;var X=n(K,B.getMat(K));K.appendAnchorMatrix3d(X);var r=j&&j.uv;c.vf2("csg",r);for(var F=0;6>F;F++)for(var W=al[F],D=xe[F],v=c.vf2(W,r,q),E=v.mat||X,k=v.vs,h=v.uv,b=v.tuv,m=0;2>m;m++){var u=z[D+3*m],e=z[D+3*m+1],A=z[D+3*m+2];if(P(k,E,[_[3*u],_[3*u+1],_[3*u+2]]),P(k,E,[_[3*e],_[3*e+1],_[3*e+2]]),P(k,E,[_[3*A],_[3*A+1],_[3*A+2]]),b)if(h){var H=8*F;b.push(h[2*u-H],h[2*u+1-H],h[2*e-H],h[2*e+1-H],h[2*A-H],h[2*A+1-H])}else b.push(S[2*u],S[2*u+1],S[2*e],S[2*e+1],S[2*A],S[2*A+1])}qc(c,j,q)},vf2:function(R,j,r){var m,Y=this,h=Y.gv.getFaceVisible(Y.data,R);return m=k(Y,R,r),m.vs=[],m.tuv=h&&(m.texture||j)?[]:E,m.visible=h,m}});var Ge=c.CSGShape=function(){var a=this;K(Ge,a),a.s({"shape.background":E,"2d.hostable":!0,"shape.border.width":8}),a.setTall(240),a.setElevation(120),a.setThickness(14)};Xg("CSGShape",q,{IRotatable:!1,_22Q:function(){return ns},setRotationX:function(){},setRotation:function(){},setRotationZ:function(){},setSegments:function(){}});var ns=function(g,x){K(ns,this,[g,x])};f(ns,x.Shape3dUI,{_80o:function(Z,R,s){var N=this;N.undrawable||(u(N.gv),Rn.forEach(function(e){Q(N,Z,R,e,s)}))},validate:function(X,k){var o=this,I=o.data,i=I.getPoints();if(o.undrawable=i.size()<2)return o.clear(),void 0;var U=I.isClosePath(),r=d(I._thickness/2,F),D=N(i,E,E,U);Rn.forEach(function(q){o.vf(q,X&&X.uv,!0,k)}),U&&(o.left.visible=!1,o.right.visible=!1),o._12O(D,r),o._20Q(D);var H=I.getPointsMatrix3d(),p=c.Math.requestVector3();al.forEach(function($){if(o[$])for(var u=o[$].vs,m=0,b=u.length;b>m;m+=3)p.set(u[m],u[m+1],u[m+2]).applyMatrix4(H),u[m]=p.x,u[m+1]=p.y,u[m+2]=p.z}),c.Math.releaseVector3(p),qc(o,X,k)}});var Kg=c.DoorWindow=function(){var D=this;K(Kg,D),D.setElevation(100),D.s3(100,200,14)};Xg("DoorWindow",Wq,{IDoorWindow:!0,toggle:function(n){this.setExpanded(!this.s(W),n)},isExpanded:function(){return this.s(W)},setExpanded:function($,E){var Z=this,S=Z.$25n,u=Z.getDataModel(),M=Z.s(W);if(S&&(S.stop(!0),delete Z.$25n),M!==$){u&&u.beginTransaction();var f=$?Z.s("dw.end"):Z.s("dw.start");Z.s(W,$),E=B(E),E?(M=Z.s(el),E.action=function(O){Z.s(el,M+(f-M)*O)},E.finishFunc=function(){u&&u.endTransaction()},Z.$25n=y(E)):(Z.s(el,f),u&&u.endTransaction())}},getMat:function(){var s=this,T=s.s("dw.s3"),Q=s.s("dw.t3"),B=s.s("dw.flip"),W=s.s(el);if(T||W||Q||B){var P=[];if(B&&P.push({r3:[0,H,0]}),T&&P.push({s3:T}),W){T=s.getFinalScale3d();var u=s.s("dw.axis"),e=T[0]/2,S=T[1]/2;T[2]/2,u===o?P.push({t3:[e,0,0]},{r3:[0,-W,0]},{t3:[-e,0,0]}):u===U?P.push({t3:[-e,0,0]},{r3:[0,W,0]},{t3:[e,0,0]}):u===r?P.push({t3:[0,-S,0]},{r3:[-W,0,0]},{t3:[0,S,0]}):u===O?P.push({t3:[0,S,0]},{r3:[W,0,0]},{t3:[0,-S,0]}):u===t?P.push({r3:[0,W,0]}):u===m&&P.push({r3:[W,0,0]})}return Q&&P.push({t3:Q}),$(P)}return E}});var $n=c.CSGBox=function(){var z=this;K($n,z),z.setElevation(100),z.s3(100,200,100)};Xg("CSGBox",Wq,{ICSGBox:!0,toggleFace:function(G,z){this.setFaceExpanded(G,!this.s(G+e),z)},isFaceExpanded:function(Y){return this.s(Y+e)},setFaceExpanded:function(k,r,N){var c=this,b=c.$25n,F=c.s(k+e);if(b&&(b.stop(!0),delete c.$25n),F!==r){var l=r?c.s(k+".end"):c.s(k+".start");c.s(k+e,r),N=B(N),N?(F=c.s(k+jo),N.action=function(I){c.s(k+jo,F+(l-F)*I)},c.$25n=y(N)):c.s(k+jo,l)}},getFaceMat:function(V){var m=this,q=m.s(V+jo);if(!q)return E;var f,e,A,P,r,J,G=m.s(V+".axis"),a=m.getFinalScale3d(),I=m.getAnchor3d(),n=a[0]*I.x,T=a[1]*I.y,U=a[2]*I.z,c=a[0]-n,s=a[1]-T,k=a[2]-U,Q=V+"_"+G;switch(Q){case"front_left":f=-n,e=0,A=k,P=0,r=-q,J=0;break;case"front_right":f=c,e=0,A=k,P=0,r=q,J=0;break;case"front_top":f=0,e=s,A=k,P=-q,r=0,J=0;break;case"front_bottom":f=0,e=-T,A=k,P=q,r=0,J=0;break;case"front_h":f=0,e=0,A=k,P=q,r=0,J=0;break;case"front_v":f=0,e=0,A=k,P=0,r=q,J=0;break;case"back_left":f=c,e=0,A=-U,P=0,r=-q,J=0;break;case"back_right":f=-n,e=0,A=-U,P=0,r=q,J=0;break;case"back_top":f=0,e=s,A=-U,P=q,r=0,J=0;break;case"back_bottom":f=0,e=-T,A=-U,P=-q,r=0,J=0;break;case"back_h":f=0,e=0,A=-U,P=q,r=0,J=0;break;case"back_v":f=0,e=0,A=-U,P=0,r=q,J=0;break;case"left_left":f=-n,e=0,A=-U,P=0,r=-q,J=0;break;case"left_right":f=-n,e=0,A=k,P=0,r=q,J=0;break;case"left_top":f=-n,e=s,A=0,P=0,r=0,J=-q;break;case"left_bottom":f=-n,e=-T,A=0,P=0,r=0,J=q;break;case"left_h":f=-n,e=0,A=0,P=0,r=0,J=q;break;case"left_v":f=-n,e=0,A=0,P=0,r=q,J=0;break;case"right_left":f=c,e=0,A=k,P=0,r=-q,J=0;break;case"right_right":f=c,e=0,A=-U,P=0,r=q,J=0;break;case"right_top":f=c,e=s,A=0,P=0,r=0,J=q;break;case"right_bottom":f=c,e=-T,A=0,P=0,r=0,J=-q;break;case"right_h":f=c,e=0,A=0,P=0,r=0,J=q;break;case"right_v":f=c,e=0,A=0,P=0,r=q,J=0;break;case"top_left":f=-n,e=s,A=0,P=0,r=0,J=q;break;case"top_right":f=c,e=s,A=0,P=0,r=0,J=-q;break;case"top_top":f=0,e=s,A=-U,P=-q,r=0,J=0;break;case"top_bottom":f=0,e=s,A=k,P=q,r=0,J=0;break;case"top_h":f=0,e=s,A=0,P=q,r=0,J=0;break;case"top_v":f=0,e=s,A=0,P=0,r=0,J=q;break;case"bottom_left":f=-n,e=-T,A=0,P=0,r=0,J=-q;break;case"bottom_right":f=c,e=-T,A=0,P=0,r=0,J=q;break;case"bottom_top":f=0,e=-T,A=k,P=-q,r=0,J=0;break;case"bottom_bottom":f=0,e=-T,A=-U,P=q,r=0,J=0;break;case"bottom_h":f=0,e=-T,A=0,P=q,r=0,J=0;break;case"bottom_v":f=0,e=-T,A=0,P=0,r=0,J=q}return $([{t3:[-f,-e,-A]},{r3:[P,r,J]},{t3:[f,e,A]}])}});var ri=function(u,Y,K,R,G){function b(){var i,T=[],k=new M,h=new M;for(p.eachShapeModel(function(O,$,v){for(var i=0,K=$?$.length:O.length/3;K>i;i++)$?(k.fromArray(O,3*$[i]),h.fromArray(v,3*$[i])):(k.fromArray(O,3*i),h.fromArray(v,3*i)),C(T,k,h)}),T=r(T,x.set(1,0,0)),T=r(T,x.set(-1,0,0)),T=r(T,x.set(0,1,0)),T=r(T,x.set(0,-1,0)),T=r(T,x.set(0,0,1)),T=r(T,x.set(0,0,-1)),i=0;i<T.length;i++){var K=T[i];N.push(.5+K.position.x/G.x,.5-K.position.y/G.y),K.position.applyMatrix4(e),o.push(K.position.x,K.position.y,K.position.z),f.push(K.$22n.x,K.$22n.y,K.$22n.z)}}function C(c,E,W){E.applyMatrix4(V),E.applyMatrix4(F),W.transformDirection(V),W.transformDirection(F),c.push(new L(E.clone(),W.clone()))}function r(o,C){for(var t=[],S=.5*Math.abs(G.dot(C)),T=0;T<o.length;T+=3){var M,K,H,D,e,c,w,B=0,k=o[T+0].position.dot(C)-S,j=o[T+1].position.dot(C)-S,n=o[T+2].position.dot(C)-S;switch(M=k>0,K=j>0,H=n>0,B=(M?1:0)+(K?1:0)+(H?1:0)){case 0:t.push(o[T]),t.push(o[T+1]),t.push(o[T+2]);break;case 1:if(M&&(D=o[T+1],e=o[T+2],c=W(o[T],D,C,S),w=W(o[T],e,C,S)),K){D=o[T],e=o[T+2],c=W(o[T+1],D,C,S),w=W(o[T+1],e,C,S),t.push(c),t.push(e.clone()),t.push(D.clone()),t.push(e.clone()),t.push(c.clone()),t.push(w);break}H&&(D=o[T],e=o[T+1],c=W(o[T+2],D,C,S),w=W(o[T+2],e,C,S)),t.push(D.clone()),t.push(e.clone()),t.push(c),t.push(w),t.push(c.clone()),t.push(e.clone());break;case 2:M||(D=o[T].clone(),e=W(D,o[T+1],C,S),c=W(D,o[T+2],C,S),t.push(D),t.push(e),t.push(c)),K||(D=o[T+1].clone(),e=W(D,o[T+2],C,S),c=W(D,o[T],C,S),t.push(D),t.push(e),t.push(c)),H||(D=o[T+2].clone(),e=W(D,o[T],C,S),c=W(D,o[T+1],C,S),t.push(D),t.push(e),t.push(c));break;case 3:}}return t}function W(K,H,I,S){var w=K.position.dot(I)-S,h=H.position.dot(I)-S,i=w/(w-h),N=new L(new M(K.position.x+i*(H.position.x-K.position.x),K.position.y+i*(H.position.y-K.position.y),K.position.z+i*(H.position.z-K.position.z)),new M(K.$22n.x+i*(H.$22n.x-K.$22n.x),K.$22n.y+i*(H.$22n.y-K.$22n.y),K.$22n.z+i*(H.$22n.z-K.$22n.z)));return N}var o=[],f=[],N=[],x=new M,p=u.getData3dUI(Y);if(p.mat){var V=(new Z).fromArray(p.mat),d=new Z;d.makeRotationFromEuler(R),d.setPosition(K);var F=(new Z).getInverse(d),e=(new Z).scale({x:1/G.x,y:1/G.y,z:1/G.z});return b(),{vs:o,ns:f,uv:N}}};L.prototype.clone=function(){return new L(this.position.clone(),this.$22n.clone())};var mb=function(T,o,e,Q){var P=this,B=P.getDataAt(T);if(B){var S=P.intersectObject(T,B);if(S){"object"==typeof o?o=o.x?new M(o.x,o.y,o.z):new M(o[0],o[1],o[2]):(o=o||20,o=new M(o,o,o)),e=e===w?.1:e;var E=new M(P.getUp()),H=new M(P.getCenter()).sub(new M(P.getEye())).normalize(),L="cross",h=H.clone()[L](E).normalize();E.copy(h)[L](H).normalize(),Q&&E.applyAxisAngle(S.worldNormal,-Q);var f=new c.Node,j=S.worldNormal.clone().setLength(e).add(S.world),b=(new Z).lookAt(S.worldNormal.clone(),new M(0,0,0),E),C=(new R).setFromRotationMatrix(b),r=ri(P,B,S.world.clone(),C,o);return f.p3(j.x,j.y,j.z),f.setEuler(C),f.s3(o.x,o.y,o.z),f.s({shape3d:r,"shape3d.reverse.flip":!0}),f}}};a(c.graph3d.Graph3dView,{createDecal:mb})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);